function html5ModeConfig(e){window.history&&history.pushState?e.html5Mode(!0):e.html5Mode(!1).hashPrefix("!")}spreedlyIntegrationServiceFactory.$inject=["$q","lang","utilsService"],utilsServiceFactory.$inject=["$q"],Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert first argument to object");for(var n=Object(e),r=1;r<arguments.length;r++){var o=arguments[r];if(null!=o)for(var i=Object.keys(Object(o)),a=0,c=i.length;a<c;a++){var s=i[a],u=Object.getOwnPropertyDescriptor(o,s);void 0!==u&&u.enumerable&&(n[s]=o[s])}}return n}}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),function(){if("function"==typeof window.CustomEvent)return!1;function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}e.prototype=window.Event.prototype,window.CustomEvent=e}(),Array.prototype.find||(Array.prototype.find=function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),r=n.length>>>0,o=arguments[1],i=0;i<r;i++)if(t=n[i],e.call(o,t,i,n))return t}),Object.keys||(Object.keys=function(){"use strict";var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],r=n.length;return function(o){if("object"!=typeof o&&("function"!=typeof o||null===o))throw new TypeError("Object.keys called on non-object");var i,a,c=[];for(i in o)e.call(o,i)&&c.push(i);if(t)for(a=0;a<r;a++)e.call(o,n[a])&&c.push(n[a]);return c}}()),Array.prototype.reduce||(Array.prototype.reduce=function(e){"use strict";if(null==this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof e)throw new TypeError(e+" is not a function");var t,n=Object(this),r=n.length>>>0,o=0;if(arguments.length>=2)t=arguments[1];else{for(;o<r&&!(o in n);)o++;if(o>=r)throw new TypeError("Reduce of empty array with no initial value");t=n[o++]}for(;o<r;o++)o in n&&(t=e(t,n[o],o,n));return t}),Array.prototype.fill||(Array.prototype.fill=function(e){if(null==this)throw new TypeError("this is null or not defined");for(var t=Object(this),n=t.length>>>0,r=arguments[1]>>0,o=r<0?Math.max(n+r,0):Math.min(r,n),i=arguments[2],a=void 0===i?n:i>>0,c=a<0?Math.max(n+a,0):Math.min(a,n);o<c;)t[o]=e,o++;return t}),Object.freeze||(Object.freeze=function(e){if(Object(e)!==e)throw new TypeError("Object.freeze can only be called on Objects.");return e}),function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){var n=[],r=e.document,o=n.slice,i=n.concat,a=n.push,c=n.indexOf,s={},u=s.toString,l=s.hasOwnProperty,d={},p="1.12.4",f=function(e,t){return new f.fn.init(e,t)},m=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,h=/^-ms-/,g=/-([\da-z])/gi,v=function(e,t){return t.toUpperCase()};function y(e){var t=!!e&&"length"in e&&e.length,n=f.type(e);return"function"!==n&&!f.isWindow(e)&&("array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e)}f.fn=f.prototype={jquery:p,constructor:f,selector:"",length:0,toArray:function(){return o.call(this)},get:function(e){return null!=e?0>e?this[e+this.length]:this[e]:o.call(this)},pushStack:function(e){var t=f.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e){return f.each(this,e)},map:function(e){return this.pushStack(f.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(o.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:a,sort:n.sort,splice:n.splice},f.extend=f.fn.extend=function(){var e,t,n,r,o,i,a=arguments[0]||{},c=1,s=arguments.length,u=!1;for("boolean"==typeof a&&(u=a,a=arguments[c]||{},c++),"object"==typeof a||f.isFunction(a)||(a={}),c===s&&(a=this,c--);s>c;c++)if(null!=(o=arguments[c]))for(r in o)e=a[r],a!==(n=o[r])&&(u&&n&&(f.isPlainObject(n)||(t=f.isArray(n)))?(t?(t=!1,i=e&&f.isArray(e)?e:[]):i=e&&f.isPlainObject(e)?e:{},a[r]=f.extend(u,i,n)):void 0!==n&&(a[r]=n));return a},f.extend({expando:"jQuery"+(p+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===f.type(e)},isArray:Array.isArray||function(e){return"array"===f.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){var t=e&&e.toString();return!f.isArray(e)&&t-parseFloat(t)+1>=0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},isPlainObject:function(e){var t;if(!e||"object"!==f.type(e)||e.nodeType||f.isWindow(e))return!1;try{if(e.constructor&&!l.call(e,"constructor")&&!l.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}if(!d.ownFirst)for(t in e)return l.call(e,t);for(t in e);return void 0===t||l.call(e,t)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?s[u.call(e)]||"object":typeof e},globalEval:function(t){t&&f.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(h,"ms-").replace(g,v)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t){var n,r=0;if(y(e))for(n=e.length;n>r&&!1!==t.call(e[r],r,e[r]);r++);else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},trim:function(e){return null==e?"":(e+"").replace(m,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(y(Object(e))?f.merge(n,"string"==typeof e?[e]:e):a.call(n,e)),n},inArray:function(e,t,n){var r;if(t){if(c)return c.call(t,e,n);for(r=t.length,n=n?0>n?Math.max(0,r+n):n:0;r>n;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,t){for(var n=+t.length,r=0,o=e.length;n>r;)e[o++]=t[r++];if(n!=n)for(;void 0!==t[r];)e[o++]=t[r++];return e.length=o,e},grep:function(e,t,n){for(var r=[],o=0,i=e.length,a=!n;i>o;o++)!t(e[o],o)!==a&&r.push(e[o]);return r},map:function(e,t,n){var r,o,a=0,c=[];if(y(e))for(r=e.length;r>a;a++)null!=(o=t(e[a],a,n))&&c.push(o);else for(a in e)null!=(o=t(e[a],a,n))&&c.push(o);return i.apply([],c)},guid:1,proxy:function(e,t){var n,r,i;return"string"==typeof t&&(i=e[t],t=e,e=i),f.isFunction(e)?(n=o.call(arguments,2),(r=function(){return e.apply(t||this,n.concat(o.call(arguments)))}).guid=e.guid=e.guid||f.guid++,r):void 0},now:function(){return+new Date},support:d}),"function"==typeof Symbol&&(f.fn[Symbol.iterator]=n[Symbol.iterator]),f.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){s["[object "+t+"]"]=t.toLowerCase()});var C=function(e){var t,n,r,o,i,a,c,s,u,l,d,p,f,m,h,g,v,y,C,E="sizzle"+1*new Date,S=e.document,T=0,_=0,w=ie(),b=ie(),P=ie(),A=function(e,t){return e===t&&(d=!0),0},$=1<<31,I={}.hasOwnProperty,k=[],N=k.pop,x=k.push,D=k.push,M=k.slice,O=function(e,t){for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1},R="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",L="[\\x20\\t\\r\\n\\f]",V="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",U="\\["+L+"*("+V+")(?:"+L+"*([*^$|!~]?=)"+L+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+V+"))|)"+L+"*\\]",F=":("+V+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+U+")*)|.*)\\)|)",B=new RegExp(L+"+","g"),H=new RegExp("^"+L+"+|((?:^|[^\\\\])(?:\\\\.)*)"+L+"+$","g"),W=new RegExp("^"+L+"*,"+L+"*"),q=new RegExp("^"+L+"*([>+~]|"+L+")"+L+"*"),j=new RegExp("="+L+"*([^\\]'\"]*?)"+L+"*\\]","g"),Y=new RegExp(F),G=new RegExp("^"+V+"$"),z={ID:new RegExp("^#("+V+")"),CLASS:new RegExp("^\\.("+V+")"),TAG:new RegExp("^("+V+"|[*])"),ATTR:new RegExp("^"+U),PSEUDO:new RegExp("^"+F),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+L+"*(even|odd|(([+-]|)(\\d*)n|)"+L+"*(?:([+-]|)"+L+"*(\\d+)|))"+L+"*\\)|)","i"),bool:new RegExp("^(?:"+R+")$","i"),needsContext:new RegExp("^"+L+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+L+"*((?:-\\d)?\\d*)"+L+"*\\)|)(?=[^-]|$)","i")},K=/^(?:input|select|textarea|button)$/i,Z=/^h\d$/i,J=/^[^{]+\{\s*\[native \w/,Q=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,X=/[+~]/,ee=/'|\\/g,te=new RegExp("\\\\([\\da-f]{1,6}"+L+"?|("+L+")|.)","ig"),ne=function(e,t,n){var r="0x"+t-65536;return r!=r||n?t:0>r?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)},re=function(){p()};try{D.apply(k=M.call(S.childNodes),S.childNodes),k[S.childNodes.length].nodeType}catch(e){D={apply:k.length?function(e,t){x.apply(e,M.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}function oe(e,t,r,o){var i,c,u,l,d,m,v,y,T=t&&t.ownerDocument,_=t?t.nodeType:9;if(r=r||[],"string"!=typeof e||!e||1!==_&&9!==_&&11!==_)return r;if(!o&&((t?t.ownerDocument||t:S)!==f&&p(t),t=t||f,h)){if(11!==_&&(m=Q.exec(e)))if(i=m[1]){if(9===_){if(!(u=t.getElementById(i)))return r;if(u.id===i)return r.push(u),r}else if(T&&(u=T.getElementById(i))&&C(t,u)&&u.id===i)return r.push(u),r}else{if(m[2])return D.apply(r,t.getElementsByTagName(e)),r;if((i=m[3])&&n.getElementsByClassName&&t.getElementsByClassName)return D.apply(r,t.getElementsByClassName(i)),r}if(n.qsa&&!P[e+" "]&&(!g||!g.test(e))){if(1!==_)T=t,y=e;else if("object"!==t.nodeName.toLowerCase()){for((l=t.getAttribute("id"))?l=l.replace(ee,"\\$&"):t.setAttribute("id",l=E),c=(v=a(e)).length,d=G.test(l)?"#"+l:"[id='"+l+"']";c--;)v[c]=d+" "+he(v[c]);y=v.join(","),T=X.test(e)&&fe(t.parentNode)||t}if(y)try{return D.apply(r,T.querySelectorAll(y)),r}catch(e){}finally{l===E&&t.removeAttribute("id")}}}return s(e.replace(H,"$1"),t,r,o)}function ie(){var e=[];return function t(n,o){return e.push(n+" ")>r.cacheLength&&delete t[e.shift()],t[n+" "]=o}}function ae(e){return e[E]=!0,e}function ce(e){var t=f.createElement("div");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function se(e,t){for(var n=e.split("|"),o=n.length;o--;)r.attrHandle[n[o]]=t}function ue(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||$)-(~e.sourceIndex||$);if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function le(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function de(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function pe(e){return ae(function(t){return t=+t,ae(function(n,r){for(var o,i=e([],n.length,t),a=i.length;a--;)n[o=i[a]]&&(n[o]=!(r[o]=n[o]))})})}function fe(e){return e&&void 0!==e.getElementsByTagName&&e}for(t in n=oe.support={},i=oe.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},p=oe.setDocument=function(e){var t,o,a=e?e.ownerDocument||e:S;return a!==f&&9===a.nodeType&&a.documentElement?(m=(f=a).documentElement,h=!i(f),(o=f.defaultView)&&o.top!==o&&(o.addEventListener?o.addEventListener("unload",re,!1):o.attachEvent&&o.attachEvent("onunload",re)),n.attributes=ce(function(e){return e.className="i",!e.getAttribute("className")}),n.getElementsByTagName=ce(function(e){return e.appendChild(f.createComment("")),!e.getElementsByTagName("*").length}),n.getElementsByClassName=J.test(f.getElementsByClassName),n.getById=ce(function(e){return m.appendChild(e).id=E,!f.getElementsByName||!f.getElementsByName(E).length}),n.getById?(r.find.ID=function(e,t){if(void 0!==t.getElementById&&h){var n=t.getElementById(e);return n?[n]:[]}},r.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute("id")===t}}):(delete r.find.ID,r.filter.ID=function(e){var t=e.replace(te,ne);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}}),r.find.TAG=n.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):n.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],o=0,i=t.getElementsByTagName(e);if("*"===e){for(;n=i[o++];)1===n.nodeType&&r.push(n);return r}return i},r.find.CLASS=n.getElementsByClassName&&function(e,t){return void 0!==t.getElementsByClassName&&h?t.getElementsByClassName(e):void 0},v=[],g=[],(n.qsa=J.test(f.querySelectorAll))&&(ce(function(e){m.appendChild(e).innerHTML="<a id='"+E+"'></a><select id='"+E+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&g.push("[*^$]="+L+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||g.push("\\["+L+"*(?:value|"+R+")"),e.querySelectorAll("[id~="+E+"-]").length||g.push("~="),e.querySelectorAll(":checked").length||g.push(":checked"),e.querySelectorAll("a#"+E+"+*").length||g.push(".#.+[+~]")}),ce(function(e){var t=f.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&g.push("name"+L+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||g.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),g.push(",.*:")})),(n.matchesSelector=J.test(y=m.matches||m.webkitMatchesSelector||m.mozMatchesSelector||m.oMatchesSelector||m.msMatchesSelector))&&ce(function(e){n.disconnectedMatch=y.call(e,"div"),y.call(e,"[s!='']:x"),v.push("!=",F)}),g=g.length&&new RegExp(g.join("|")),v=v.length&&new RegExp(v.join("|")),t=J.test(m.compareDocumentPosition),C=t||J.test(m.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},A=t?function(e,t){if(e===t)return d=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r||(1&(r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!n.sortDetached&&t.compareDocumentPosition(e)===r?e===f||e.ownerDocument===S&&C(S,e)?-1:t===f||t.ownerDocument===S&&C(S,t)?1:l?O(l,e)-O(l,t):0:4&r?-1:1)}:function(e,t){if(e===t)return d=!0,0;var n,r=0,o=e.parentNode,i=t.parentNode,a=[e],c=[t];if(!o||!i)return e===f?-1:t===f?1:o?-1:i?1:l?O(l,e)-O(l,t):0;if(o===i)return ue(e,t);for(n=e;n=n.parentNode;)a.unshift(n);for(n=t;n=n.parentNode;)c.unshift(n);for(;a[r]===c[r];)r++;return r?ue(a[r],c[r]):a[r]===S?-1:c[r]===S?1:0},f):f},oe.matches=function(e,t){return oe(e,null,null,t)},oe.matchesSelector=function(e,t){if((e.ownerDocument||e)!==f&&p(e),t=t.replace(j,"='$1']"),n.matchesSelector&&h&&!P[t+" "]&&(!v||!v.test(t))&&(!g||!g.test(t)))try{var r=y.call(e,t);if(r||n.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(e){}return oe(t,f,null,[e]).length>0},oe.contains=function(e,t){return(e.ownerDocument||e)!==f&&p(e),C(e,t)},oe.attr=function(e,t){(e.ownerDocument||e)!==f&&p(e);var o=r.attrHandle[t.toLowerCase()],i=o&&I.call(r.attrHandle,t.toLowerCase())?o(e,t,!h):void 0;return void 0!==i?i:n.attributes||!h?e.getAttribute(t):(i=e.getAttributeNode(t))&&i.specified?i.value:null},oe.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},oe.uniqueSort=function(e){var t,r=[],o=0,i=0;if(d=!n.detectDuplicates,l=!n.sortStable&&e.slice(0),e.sort(A),d){for(;t=e[i++];)t===e[i]&&(o=r.push(i));for(;o--;)e.splice(r[o],1)}return l=null,e},o=oe.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r++];)n+=o(t);return n},(r=oe.selectors={cacheLength:50,createPseudo:ae,match:z,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ne),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||oe.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&oe.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return z.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&Y.test(n)&&(t=a(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=w[e+" "];return t||(t=new RegExp("(^|"+L+")"+e+"("+L+"|$)"))&&w(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var o=oe.attr(r,e);return null==o?"!="===t:!t||(o+="","="===t?o===n:"!="===t?o!==n:"^="===t?n&&0===o.indexOf(n):"*="===t?n&&o.indexOf(n)>-1:"$="===t?n&&o.slice(-n.length)===n:"~="===t?(" "+o.replace(B," ")+" ").indexOf(n)>-1:"|="===t&&(o===n||o.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,r,o){var i="nth"!==e.slice(0,3),a="last"!==e.slice(-4),c="of-type"===t;return 1===r&&0===o?function(e){return!!e.parentNode}:function(t,n,s){var u,l,d,p,f,m,h=i!==a?"nextSibling":"previousSibling",g=t.parentNode,v=c&&t.nodeName.toLowerCase(),y=!s&&!c,C=!1;if(g){if(i){for(;h;){for(p=t;p=p[h];)if(c?p.nodeName.toLowerCase()===v:1===p.nodeType)return!1;m=h="only"===e&&!m&&"nextSibling"}return!0}if(m=[a?g.firstChild:g.lastChild],a&&y){for(C=(f=(u=(l=(d=(p=g)[E]||(p[E]={}))[p.uniqueID]||(d[p.uniqueID]={}))[e]||[])[0]===T&&u[1])&&u[2],p=f&&g.childNodes[f];p=++f&&p&&p[h]||(C=f=0)||m.pop();)if(1===p.nodeType&&++C&&p===t){l[e]=[T,f,C];break}}else if(y&&(C=f=(u=(l=(d=(p=t)[E]||(p[E]={}))[p.uniqueID]||(d[p.uniqueID]={}))[e]||[])[0]===T&&u[1]),!1===C)for(;(p=++f&&p&&p[h]||(C=f=0)||m.pop())&&((c?p.nodeName.toLowerCase()!==v:1!==p.nodeType)||!++C||(y&&((l=(d=p[E]||(p[E]={}))[p.uniqueID]||(d[p.uniqueID]={}))[e]=[T,C]),p!==t)););return(C-=o)===r||C%r==0&&C/r>=0}}},PSEUDO:function(e,t){var n,o=r.pseudos[e]||r.setFilters[e.toLowerCase()]||oe.error("unsupported pseudo: "+e);return o[E]?o(t):o.length>1?(n=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?ae(function(e,n){for(var r,i=o(e,t),a=i.length;a--;)e[r=O(e,i[a])]=!(n[r]=i[a])}):function(e){return o(e,0,n)}):o}},pseudos:{not:ae(function(e){var t=[],n=[],r=c(e.replace(H,"$1"));return r[E]?ae(function(e,t,n,o){for(var i,a=r(e,null,o,[]),c=e.length;c--;)(i=a[c])&&(e[c]=!(t[c]=i))}):function(e,o,i){return t[0]=e,r(t,null,i,n),t[0]=null,!n.pop()}}),has:ae(function(e){return function(t){return oe(e,t).length>0}}),contains:ae(function(e){return e=e.replace(te,ne),function(t){return(t.textContent||t.innerText||o(t)).indexOf(e)>-1}}),lang:ae(function(e){return G.test(e||"")||oe.error("unsupported lang: "+e),e=e.replace(te,ne).toLowerCase(),function(t){var n;do{if(n=h?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===m},focus:function(e){return e===f.activeElement&&(!f.hasFocus||f.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return!1===e.disabled},disabled:function(e){return!0===e.disabled},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return Z.test(e.nodeName)},input:function(e){return K.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:pe(function(){return[0]}),last:pe(function(e,t){return[t-1]}),eq:pe(function(e,t,n){return[0>n?n+t:n]}),even:pe(function(e,t){for(var n=0;t>n;n+=2)e.push(n);return e}),odd:pe(function(e,t){for(var n=1;t>n;n+=2)e.push(n);return e}),lt:pe(function(e,t,n){for(var r=0>n?n+t:n;--r>=0;)e.push(r);return e}),gt:pe(function(e,t,n){for(var r=0>n?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=r.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=le(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=de(t);function me(){}function he(e){for(var t=0,n=e.length,r="";n>t;t++)r+=e[t].value;return r}function ge(e,t,n){var r=t.dir,o=n&&"parentNode"===r,i=_++;return t.first?function(t,n,i){for(;t=t[r];)if(1===t.nodeType||o)return e(t,n,i)}:function(t,n,a){var c,s,u,l=[T,i];if(a){for(;t=t[r];)if((1===t.nodeType||o)&&e(t,n,a))return!0}else for(;t=t[r];)if(1===t.nodeType||o){if((c=(s=(u=t[E]||(t[E]={}))[t.uniqueID]||(u[t.uniqueID]={}))[r])&&c[0]===T&&c[1]===i)return l[2]=c[2];if(s[r]=l,l[2]=e(t,n,a))return!0}}}function ve(e){return e.length>1?function(t,n,r){for(var o=e.length;o--;)if(!e[o](t,n,r))return!1;return!0}:e[0]}function ye(e,t,n,r,o){for(var i,a=[],c=0,s=e.length,u=null!=t;s>c;c++)(i=e[c])&&(n&&!n(i,r,o)||(a.push(i),u&&t.push(c)));return a}function Ce(e,t,n,r,o,i){return r&&!r[E]&&(r=Ce(r)),o&&!o[E]&&(o=Ce(o,i)),ae(function(i,a,c,s){var u,l,d,p=[],f=[],m=a.length,h=i||function(e,t,n){for(var r=0,o=t.length;o>r;r++)oe(e,t[r],n);return n}(t||"*",c.nodeType?[c]:c,[]),g=!e||!i&&t?h:ye(h,p,e,c,s),v=n?o||(i?e:m||r)?[]:a:g;if(n&&n(g,v,c,s),r)for(u=ye(v,f),r(u,[],c,s),l=u.length;l--;)(d=u[l])&&(v[f[l]]=!(g[f[l]]=d));if(i){if(o||e){if(o){for(u=[],l=v.length;l--;)(d=v[l])&&u.push(g[l]=d);o(null,v=[],u,s)}for(l=v.length;l--;)(d=v[l])&&(u=o?O(i,d):p[l])>-1&&(i[u]=!(a[u]=d))}}else v=ye(v===a?v.splice(m,v.length):v),o?o(null,a,v,s):D.apply(a,v)})}function Ee(e){for(var t,n,o,i=e.length,a=r.relative[e[0].type],c=a||r.relative[" "],s=a?1:0,l=ge(function(e){return e===t},c,!0),d=ge(function(e){return O(t,e)>-1},c,!0),p=[function(e,n,r){var o=!a&&(r||n!==u)||((t=n).nodeType?l(e,n,r):d(e,n,r));return t=null,o}];i>s;s++)if(n=r.relative[e[s].type])p=[ge(ve(p),n)];else{if((n=r.filter[e[s].type].apply(null,e[s].matches))[E]){for(o=++s;i>o&&!r.relative[e[o].type];o++);return Ce(s>1&&ve(p),s>1&&he(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace(H,"$1"),n,o>s&&Ee(e.slice(s,o)),i>o&&Ee(e=e.slice(o)),i>o&&he(e))}p.push(n)}return ve(p)}function Se(e,t){var n=t.length>0,o=e.length>0,i=function(i,a,c,s,l){var d,m,g,v=0,y="0",C=i&&[],E=[],S=u,_=i||o&&r.find.TAG("*",l),w=T+=null==S?1:Math.random()||.1,b=_.length;for(l&&(u=a===f||a||l);y!==b&&null!=(d=_[y]);y++){if(o&&d){for(m=0,a||d.ownerDocument===f||(p(d),c=!h);g=e[m++];)if(g(d,a||f,c)){s.push(d);break}l&&(T=w)}n&&((d=!g&&d)&&v--,i&&C.push(d))}if(v+=y,n&&y!==v){for(m=0;g=t[m++];)g(C,E,a,c);if(i){if(v>0)for(;y--;)C[y]||E[y]||(E[y]=N.call(s));E=ye(E)}D.apply(s,E),l&&!i&&E.length>0&&v+t.length>1&&oe.uniqueSort(s)}return l&&(T=w,u=S),C};return n?ae(i):i}return me.prototype=r.filters=r.pseudos,r.setFilters=new me,a=oe.tokenize=function(e,t){var n,o,i,a,c,s,u,l=b[e+" "];if(l)return t?0:l.slice(0);for(c=e,s=[],u=r.preFilter;c;){for(a in n&&!(o=W.exec(c))||(o&&(c=c.slice(o[0].length)||c),s.push(i=[])),n=!1,(o=q.exec(c))&&(n=o.shift(),i.push({value:n,type:o[0].replace(H," ")}),c=c.slice(n.length)),r.filter)!(o=z[a].exec(c))||u[a]&&!(o=u[a](o))||(n=o.shift(),i.push({value:n,type:a,matches:o}),c=c.slice(n.length));if(!n)break}return t?c.length:c?oe.error(e):b(e,s).slice(0)},c=oe.compile=function(e,t){var n,r=[],o=[],i=P[e+" "];if(!i){for(t||(t=a(e)),n=t.length;n--;)(i=Ee(t[n]))[E]?r.push(i):o.push(i);(i=P(e,Se(o,r))).selector=e}return i},s=oe.select=function(e,t,o,i){var s,u,l,d,p,f="function"==typeof e&&e,m=!i&&a(e=f.selector||e);if(o=o||[],1===m.length){if((u=m[0]=m[0].slice(0)).length>2&&"ID"===(l=u[0]).type&&n.getById&&9===t.nodeType&&h&&r.relative[u[1].type]){if(!(t=(r.find.ID(l.matches[0].replace(te,ne),t)||[])[0]))return o;f&&(t=t.parentNode),e=e.slice(u.shift().value.length)}for(s=z.needsContext.test(e)?0:u.length;s--&&(l=u[s],!r.relative[d=l.type]);)if((p=r.find[d])&&(i=p(l.matches[0].replace(te,ne),X.test(u[0].type)&&fe(t.parentNode)||t))){if(u.splice(s,1),!(e=i.length&&he(u)))return D.apply(o,i),o;break}}return(f||c(e,m))(i,t,!h,o,!t||X.test(e)&&fe(t.parentNode)||t),o},n.sortStable=E.split("").sort(A).join("")===E,n.detectDuplicates=!!d,p(),n.sortDetached=ce(function(e){return 1&e.compareDocumentPosition(f.createElement("div"))}),ce(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||se("type|href|height|width",function(e,t,n){return n?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),n.attributes&&ce(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||se("value",function(e,t,n){return n||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),ce(function(e){return null==e.getAttribute("disabled")})||se(R,function(e,t,n){var r;return n?void 0:!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),oe}(e);f.find=C,f.expr=C.selectors,f.expr[":"]=f.expr.pseudos,f.uniqueSort=f.unique=C.uniqueSort,f.text=C.getText,f.isXMLDoc=C.isXML,f.contains=C.contains;var E=function(e,t,n){for(var r=[],o=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(o&&f(e).is(n))break;r.push(e)}return r},S=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},T=f.expr.match.needsContext,_=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,w=/^.[^:#\[\.,]*$/;function b(e,t,n){if(f.isFunction(t))return f.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return f.grep(e,function(e){return e===t!==n});if("string"==typeof t){if(w.test(t))return f.filter(t,e,n);t=f.filter(t,e)}return f.grep(e,function(e){return f.inArray(e,t)>-1!==n})}f.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?f.find.matchesSelector(r,e)?[r]:[]:f.find.matches(e,f.grep(t,function(e){return 1===e.nodeType}))},f.fn.extend({find:function(e){var t,n=[],r=this,o=r.length;if("string"!=typeof e)return this.pushStack(f(e).filter(function(){for(t=0;o>t;t++)if(f.contains(r[t],this))return!0}));for(t=0;o>t;t++)f.find(e,r[t],n);return(n=this.pushStack(o>1?f.unique(n):n)).selector=this.selector?this.selector+" "+e:e,n},filter:function(e){return this.pushStack(b(this,e||[],!1))},not:function(e){return this.pushStack(b(this,e||[],!0))},is:function(e){return!!b(this,"string"==typeof e&&T.test(e)?f(e):e||[],!1).length}});var P,A=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/;(f.fn.init=function(e,t,n){var o,i;if(!e)return this;if(n=n||P,"string"==typeof e){if(!(o="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:A.exec(e))||!o[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(o[1]){if(t=t instanceof f?t[0]:t,f.merge(this,f.parseHTML(o[1],t&&t.nodeType?t.ownerDocument||t:r,!0)),_.test(o[1])&&f.isPlainObject(t))for(o in t)f.isFunction(this[o])?this[o](t[o]):this.attr(o,t[o]);return this}if((i=r.getElementById(o[2]))&&i.parentNode){if(i.id!==o[2])return P.find(e);this.length=1,this[0]=i}return this.context=r,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):f.isFunction(e)?void 0!==n.ready?n.ready(e):e(f):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),f.makeArray(e,this))}).prototype=f.fn,P=f(r);var $=/^(?:parents|prev(?:Until|All))/,I={children:!0,contents:!0,next:!0,prev:!0};function k(e,t){do{e=e[t]}while(e&&1!==e.nodeType);return e}f.fn.extend({has:function(e){var t,n=f(e,this),r=n.length;return this.filter(function(){for(t=0;r>t;t++)if(f.contains(this,n[t]))return!0})},closest:function(e,t){for(var n,r=0,o=this.length,i=[],a=T.test(e)||"string"!=typeof e?f(e,t||this.context):0;o>r;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?a.index(n)>-1:1===n.nodeType&&f.find.matchesSelector(n,e))){i.push(n);break}return this.pushStack(i.length>1?f.uniqueSort(i):i)},index:function(e){return e?"string"==typeof e?f.inArray(this[0],f(e)):f.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(f.uniqueSort(f.merge(this.get(),f(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),f.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return E(e,"parentNode")},parentsUntil:function(e,t,n){return E(e,"parentNode",n)},next:function(e){return k(e,"nextSibling")},prev:function(e){return k(e,"previousSibling")},nextAll:function(e){return E(e,"nextSibling")},prevAll:function(e){return E(e,"previousSibling")},nextUntil:function(e,t,n){return E(e,"nextSibling",n)},prevUntil:function(e,t,n){return E(e,"previousSibling",n)},siblings:function(e){return S((e.parentNode||{}).firstChild,e)},children:function(e){return S(e.firstChild)},contents:function(e){return f.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:f.merge([],e.childNodes)}},function(e,t){f.fn[e]=function(n,r){var o=f.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(o=f.filter(r,o)),this.length>1&&(I[e]||(o=f.uniqueSort(o)),$.test(e)&&(o=o.reverse())),this.pushStack(o)}});var N,x,D=/\S+/g;function M(){r.addEventListener?(r.removeEventListener("DOMContentLoaded",O),e.removeEventListener("load",O)):(r.detachEvent("onreadystatechange",O),e.detachEvent("onload",O))}function O(){(r.addEventListener||"load"===e.event.type||"complete"===r.readyState)&&(M(),f.ready())}for(x in f.Callbacks=function(e){e="string"==typeof e?function(e){var t={};return f.each(e.match(D)||[],function(e,n){t[n]=!0}),t}(e):f.extend({},e);var t,n,r,o,i=[],a=[],c=-1,s=function(){for(o=e.once,r=t=!0;a.length;c=-1)for(n=a.shift();++c<i.length;)!1===i[c].apply(n[0],n[1])&&e.stopOnFalse&&(c=i.length,n=!1);e.memory||(n=!1),t=!1,o&&(i=n?[]:"")},u={add:function(){return i&&(n&&!t&&(c=i.length-1,a.push(n)),function t(n){f.each(n,function(n,r){f.isFunction(r)?e.unique&&u.has(r)||i.push(r):r&&r.length&&"string"!==f.type(r)&&t(r)})}(arguments),n&&!t&&s()),this},remove:function(){return f.each(arguments,function(e,t){for(var n;(n=f.inArray(t,i,n))>-1;)i.splice(n,1),c>=n&&c--}),this},has:function(e){return e?f.inArray(e,i)>-1:i.length>0},empty:function(){return i&&(i=[]),this},disable:function(){return o=a=[],i=n="",this},disabled:function(){return!i},lock:function(){return o=!0,n||u.disable(),this},locked:function(){return!!o},fireWith:function(e,n){return o||(n=[e,(n=n||[]).slice?n.slice():n],a.push(n),t||s()),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!r}};return u},f.extend({Deferred:function(e){var t=[["resolve","done",f.Callbacks("once memory"),"resolved"],["reject","fail",f.Callbacks("once memory"),"rejected"],["notify","progress",f.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return o.done(arguments).fail(arguments),this},then:function(){var e=arguments;return f.Deferred(function(n){f.each(t,function(t,i){var a=f.isFunction(e[t])&&e[t];o[i[1]](function(){var e=a&&a.apply(this,arguments);e&&f.isFunction(e.promise)?e.promise().progress(n.notify).done(n.resolve).fail(n.reject):n[i[0]+"With"](this===r?n.promise():this,a?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?f.extend(e,r):r}},o={};return r.pipe=r.then,f.each(t,function(e,i){var a=i[2],c=i[3];r[i[1]]=a.add,c&&a.add(function(){n=c},t[1^e][2].disable,t[2][2].lock),o[i[0]]=function(){return o[i[0]+"With"](this===o?r:this,arguments),this},o[i[0]+"With"]=a.fireWith}),r.promise(o),e&&e.call(o,o),o},when:function(e){var t,n,r,i=0,a=o.call(arguments),c=a.length,s=1!==c||e&&f.isFunction(e.promise)?c:0,u=1===s?e:f.Deferred(),l=function(e,n,r){return function(i){n[e]=this,r[e]=arguments.length>1?o.call(arguments):i,r===t?u.notifyWith(n,r):--s||u.resolveWith(n,r)}};if(c>1)for(t=new Array(c),n=new Array(c),r=new Array(c);c>i;i++)a[i]&&f.isFunction(a[i].promise)?a[i].promise().progress(l(i,n,t)).done(l(i,r,a)).fail(u.reject):--s;return s||u.resolveWith(r,a),u.promise()}}),f.fn.ready=function(e){return f.ready.promise().done(e),this},f.extend({isReady:!1,readyWait:1,holdReady:function(e){e?f.readyWait++:f.ready(!0)},ready:function(e){(!0===e?--f.readyWait:f.isReady)||(f.isReady=!0,!0!==e&&--f.readyWait>0||(N.resolveWith(r,[f]),f.fn.triggerHandler&&(f(r).triggerHandler("ready"),f(r).off("ready"))))}}),f.ready.promise=function(t){if(!N)if(N=f.Deferred(),"complete"===r.readyState||"loading"!==r.readyState&&!r.documentElement.doScroll)e.setTimeout(f.ready);else if(r.addEventListener)r.addEventListener("DOMContentLoaded",O),e.addEventListener("load",O);else{r.attachEvent("onreadystatechange",O),e.attachEvent("onload",O);var n=!1;try{n=null==e.frameElement&&r.documentElement}catch(e){}n&&n.doScroll&&function t(){if(!f.isReady){try{n.doScroll("left")}catch(n){return e.setTimeout(t,50)}M(),f.ready()}}()}return N.promise(t)},f.ready.promise(),f(d))break;d.ownFirst="0"===x,d.inlineBlockNeedsLayout=!1,f(function(){var e,t,n,o;(n=r.getElementsByTagName("body")[0])&&n.style&&(t=r.createElement("div"),(o=r.createElement("div")).style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",n.appendChild(o).appendChild(t),void 0!==t.style.zoom&&(t.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",d.inlineBlockNeedsLayout=e=3===t.offsetWidth,e&&(n.style.zoom=1)),n.removeChild(o))}),function(){var e=r.createElement("div");d.deleteExpando=!0;try{delete e.test}catch(e){d.deleteExpando=!1}e=null}();var R=function(e){var t=f.noData[(e.nodeName+" ").toLowerCase()],n=+e.nodeType||1;return(1===n||9===n)&&(!t||!0!==t&&e.getAttribute("classid")===t)},L=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,V=/([A-Z])/g;function U(e,t,n){if(void 0===n&&1===e.nodeType){var r="data-"+t.replace(V,"-$1").toLowerCase();if("string"==typeof(n=e.getAttribute(r))){try{n="true"===n||"false"!==n&&("null"===n?null:+n+""===n?+n:L.test(n)?f.parseJSON(n):n)}catch(e){}f.data(e,t,n)}else n=void 0}return n}function F(e){var t;for(t in e)if(("data"!==t||!f.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function B(e,t,r,o){if(R(e)){var i,a,c=f.expando,s=e.nodeType,u=s?f.cache:e,l=s?e[c]:e[c]&&c;if(l&&u[l]&&(o||u[l].data)||void 0!==r||"string"!=typeof t)return l||(l=s?e[c]=n.pop()||f.guid++:c),u[l]||(u[l]=s?{}:{toJSON:f.noop}),"object"!=typeof t&&"function"!=typeof t||(o?u[l]=f.extend(u[l],t):u[l].data=f.extend(u[l].data,t)),a=u[l],o||(a.data||(a.data={}),a=a.data),void 0!==r&&(a[f.camelCase(t)]=r),"string"==typeof t?null==(i=a[t])&&(i=a[f.camelCase(t)]):i=a,i}}function H(e,t,n){if(R(e)){var r,o,i=e.nodeType,a=i?f.cache:e,c=i?e[f.expando]:f.expando;if(a[c]){if(t&&(r=n?a[c]:a[c].data)){f.isArray(t)?t=t.concat(f.map(t,f.camelCase)):t in r?t=[t]:t=(t=f.camelCase(t))in r?[t]:t.split(" "),o=t.length;for(;o--;)delete r[t[o]];if(n?!F(r):!f.isEmptyObject(r))return}(n||(delete a[c].data,F(a[c])))&&(i?f.cleanData([e],!0):d.deleteExpando||a!=a.window?delete a[c]:a[c]=void 0)}}}f.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(e){return!!(e=e.nodeType?f.cache[e[f.expando]]:e[f.expando])&&!F(e)},data:function(e,t,n){return B(e,t,n)},removeData:function(e,t){return H(e,t)},_data:function(e,t,n){return B(e,t,n,!0)},_removeData:function(e,t){return H(e,t,!0)}}),f.fn.extend({data:function(e,t){var n,r,o,i=this[0],a=i&&i.attributes;if(void 0===e){if(this.length&&(o=f.data(i),1===i.nodeType&&!f._data(i,"parsedAttrs"))){for(n=a.length;n--;)a[n]&&(0===(r=a[n].name).indexOf("data-")&&U(i,r=f.camelCase(r.slice(5)),o[r]));f._data(i,"parsedAttrs",!0)}return o}return"object"==typeof e?this.each(function(){f.data(this,e)}):arguments.length>1?this.each(function(){f.data(this,e,t)}):i?U(i,e,f.data(i,e)):void 0},removeData:function(e){return this.each(function(){f.removeData(this,e)})}}),f.extend({queue:function(e,t,n){var r;return e?(t=(t||"fx")+"queue",r=f._data(e,t),n&&(!r||f.isArray(n)?r=f._data(e,t,f.makeArray(n)):r.push(n)),r||[]):void 0},dequeue:function(e,t){t=t||"fx";var n=f.queue(e,t),r=n.length,o=n.shift(),i=f._queueHooks(e,t);"inprogress"===o&&(o=n.shift(),r--),o&&("fx"===t&&n.unshift("inprogress"),delete i.stop,o.call(e,function(){f.dequeue(e,t)},i)),!r&&i&&i.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return f._data(e,n)||f._data(e,n,{empty:f.Callbacks("once memory").add(function(){f._removeData(e,t+"queue"),f._removeData(e,n)})})}}),f.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?f.queue(this[0],e):void 0===t?this:this.each(function(){var n=f.queue(this,e,t);f._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&f.dequeue(this,e)})},dequeue:function(e){return this.each(function(){f.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,o=f.Deferred(),i=this,a=this.length,c=function(){--r||o.resolveWith(i,[i])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";a--;)(n=f._data(i[a],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(c));return c(),o.promise(t)}}),function(){var e;d.shrinkWrapBlocks=function(){return null!=e?e:(e=!1,(n=r.getElementsByTagName("body")[0])&&n.style?(t=r.createElement("div"),(o=r.createElement("div")).style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",n.appendChild(o).appendChild(t),void 0!==t.style.zoom&&(t.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",t.appendChild(r.createElement("div")).style.width="5px",e=3!==t.offsetWidth),n.removeChild(o),e):void 0);var t,n,o}}();var W=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,q=new RegExp("^(?:([+-])=|)("+W+")([a-z%]*)$","i"),j=["Top","Right","Bottom","Left"],Y=function(e,t){return e=t||e,"none"===f.css(e,"display")||!f.contains(e.ownerDocument,e)};function G(e,t,n,r){var o,i=1,a=20,c=r?function(){return r.cur()}:function(){return f.css(e,t,"")},s=c(),u=n&&n[3]||(f.cssNumber[t]?"":"px"),l=(f.cssNumber[t]||"px"!==u&&+s)&&q.exec(f.css(e,t));if(l&&l[3]!==u){u=u||l[3],n=n||[],l=+s||1;do{l/=i=i||".5",f.style(e,t,l+u)}while(i!==(i=c()/s)&&1!==i&&--a)}return n&&(l=+l||+s||0,o=n[1]?l+(n[1]+1)*n[2]:+n[2],r&&(r.unit=u,r.start=l,r.end=o)),o}var z=function(e,t,n,r,o,i,a){var c=0,s=e.length,u=null==n;if("object"===f.type(n))for(c in o=!0,n)z(e,t,c,n[c],!0,i,a);else if(void 0!==r&&(o=!0,f.isFunction(r)||(a=!0),u&&(a?(t.call(e,r),t=null):(u=t,t=function(e,t,n){return u.call(f(e),n)})),t))for(;s>c;c++)t(e[c],n,a?r:r.call(e[c],c,t(e[c],n)));return o?e:u?t.call(e):s?t(e[0],n):i},K=/^(?:checkbox|radio)$/i,Z=/<([\w:-]+)/,J=/^$|\/(?:java|ecma)script/i,Q=/^\s+/,X="abbr|article|aside|audio|bdi|canvas|data|datalist|details|dialog|figcaption|figure|footer|header|hgroup|main|mark|meter|nav|output|picture|progress|section|summary|template|time|video";function ee(e){var t=X.split("|"),n=e.createDocumentFragment();if(n.createElement)for(;t.length;)n.createElement(t.pop());return n}!function(){var e=r.createElement("div"),t=r.createDocumentFragment(),n=r.createElement("input");e.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",d.leadingWhitespace=3===e.firstChild.nodeType,d.tbody=!e.getElementsByTagName("tbody").length,d.htmlSerialize=!!e.getElementsByTagName("link").length,d.html5Clone="<:nav></:nav>"!==r.createElement("nav").cloneNode(!0).outerHTML,n.type="checkbox",n.checked=!0,t.appendChild(n),d.appendChecked=n.checked,e.innerHTML="<textarea>x</textarea>",d.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue,t.appendChild(e),(n=r.createElement("input")).setAttribute("type","radio"),n.setAttribute("checked","checked"),n.setAttribute("name","t"),e.appendChild(n),d.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,d.noCloneEvent=!!e.addEventListener,e[f.expando]=1,d.attributes=!e.getAttribute(f.expando)}();var te={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:d.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]};function ne(e,t){var n,r,o=0,i=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):void 0;if(!i)for(i=[],n=e.childNodes||e;null!=(r=n[o]);o++)!t||f.nodeName(r,t)?i.push(r):f.merge(i,ne(r,t));return void 0===t||t&&f.nodeName(e,t)?f.merge([e],i):i}function re(e,t){for(var n,r=0;null!=(n=e[r]);r++)f._data(n,"globalEval",!t||f._data(t[r],"globalEval"))}te.optgroup=te.option,te.tbody=te.tfoot=te.colgroup=te.caption=te.thead,te.th=te.td;var oe=/<|&#?\w+;/,ie=/<tbody/i;function ae(e){K.test(e.type)&&(e.defaultChecked=e.checked)}function ce(e,t,n,r,o){for(var i,a,c,s,u,l,p,m=e.length,h=ee(t),g=[],v=0;m>v;v++)if((a=e[v])||0===a)if("object"===f.type(a))f.merge(g,a.nodeType?[a]:a);else if(oe.test(a)){for(s=s||h.appendChild(t.createElement("div")),u=(Z.exec(a)||["",""])[1].toLowerCase(),p=te[u]||te._default,s.innerHTML=p[1]+f.htmlPrefilter(a)+p[2],i=p[0];i--;)s=s.lastChild;if(!d.leadingWhitespace&&Q.test(a)&&g.push(t.createTextNode(Q.exec(a)[0])),!d.tbody)for(i=(a="table"!==u||ie.test(a)?"<table>"!==p[1]||ie.test(a)?0:s:s.firstChild)&&a.childNodes.length;i--;)f.nodeName(l=a.childNodes[i],"tbody")&&!l.childNodes.length&&a.removeChild(l);for(f.merge(g,s.childNodes),s.textContent="";s.firstChild;)s.removeChild(s.firstChild);s=h.lastChild}else g.push(t.createTextNode(a));for(s&&h.removeChild(s),d.appendChecked||f.grep(ne(g,"input"),ae),v=0;a=g[v++];)if(r&&f.inArray(a,r)>-1)o&&o.push(a);else if(c=f.contains(a.ownerDocument,a),s=ne(h.appendChild(a),"script"),c&&re(s),n)for(i=0;a=s[i++];)J.test(a.type||"")&&n.push(a);return s=null,h}!function(){var t,n,o=r.createElement("div");for(t in{submit:!0,change:!0,focusin:!0})n="on"+t,(d[t]=n in e)||(o.setAttribute(n,"t"),d[t]=!1===o.attributes[n].expando);o=null}();var se=/^(?:input|select|textarea)$/i,ue=/^key/,le=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,de=/^(?:focusinfocus|focusoutblur)$/,pe=/^([^.]*)(?:\.(.+)|)/;function fe(){return!0}function me(){return!1}function he(){try{return r.activeElement}catch(e){}}function ge(e,t,n,r,o,i){var a,c;if("object"==typeof t){for(c in"string"!=typeof n&&(r=r||n,n=void 0),t)ge(e,c,n,r,t[c],i);return e}if(null==r&&null==o?(o=n,r=n=void 0):null==o&&("string"==typeof n?(o=r,r=void 0):(o=r,r=n,n=void 0)),!1===o)o=me;else if(!o)return e;return 1===i&&(a=o,(o=function(e){return f().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=f.guid++)),e.each(function(){f.event.add(this,t,o,r,n)})}f.event={global:{},add:function(e,t,n,r,o){var i,a,c,s,u,l,d,p,m,h,g,v=f._data(e);if(v){for(n.handler&&(n=(s=n).handler,o=s.selector),n.guid||(n.guid=f.guid++),(a=v.events)||(a=v.events={}),(l=v.handle)||((l=v.handle=function(e){return void 0===f||e&&f.event.triggered===e.type?void 0:f.event.dispatch.apply(l.elem,arguments)}).elem=e),c=(t=(t||"").match(D)||[""]).length;c--;)m=g=(i=pe.exec(t[c])||[])[1],h=(i[2]||"").split(".").sort(),m&&(u=f.event.special[m]||{},m=(o?u.delegateType:u.bindType)||m,u=f.event.special[m]||{},d=f.extend({type:m,origType:g,data:r,handler:n,guid:n.guid,selector:o,needsContext:o&&f.expr.match.needsContext.test(o),namespace:h.join(".")},s),(p=a[m])||((p=a[m]=[]).delegateCount=0,u.setup&&!1!==u.setup.call(e,r,h,l)||(e.addEventListener?e.addEventListener(m,l,!1):e.attachEvent&&e.attachEvent("on"+m,l))),u.add&&(u.add.call(e,d),d.handler.guid||(d.handler.guid=n.guid)),o?p.splice(p.delegateCount++,0,d):p.push(d),f.event.global[m]=!0);e=null}},remove:function(e,t,n,r,o){var i,a,c,s,u,l,d,p,m,h,g,v=f.hasData(e)&&f._data(e);if(v&&(l=v.events)){for(u=(t=(t||"").match(D)||[""]).length;u--;)if(m=g=(c=pe.exec(t[u])||[])[1],h=(c[2]||"").split(".").sort(),m){for(d=f.event.special[m]||{},p=l[m=(r?d.delegateType:d.bindType)||m]||[],c=c[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=i=p.length;i--;)a=p[i],!o&&g!==a.origType||n&&n.guid!==a.guid||c&&!c.test(a.namespace)||r&&r!==a.selector&&("**"!==r||!a.selector)||(p.splice(i,1),a.selector&&p.delegateCount--,d.remove&&d.remove.call(e,a));s&&!p.length&&(d.teardown&&!1!==d.teardown.call(e,h,v.handle)||f.removeEvent(e,m,v.handle),delete l[m])}else for(m in l)f.event.remove(e,m+t[u],n,r,!0);f.isEmptyObject(l)&&(delete v.handle,f._removeData(e,"events"))}},trigger:function(t,n,o,i){var a,c,s,u,d,p,m,h=[o||r],g=l.call(t,"type")?t.type:t,v=l.call(t,"namespace")?t.namespace.split("."):[];if(s=p=o=o||r,3!==o.nodeType&&8!==o.nodeType&&!de.test(g+f.event.triggered)&&(g.indexOf(".")>-1&&(v=g.split("."),g=v.shift(),v.sort()),c=g.indexOf(":")<0&&"on"+g,(t=t[f.expando]?t:new f.Event(g,"object"==typeof t&&t)).isTrigger=i?2:3,t.namespace=v.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+v.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=o),n=null==n?[t]:f.makeArray(n,[t]),d=f.event.special[g]||{},i||!d.trigger||!1!==d.trigger.apply(o,n))){if(!i&&!d.noBubble&&!f.isWindow(o)){for(u=d.delegateType||g,de.test(u+g)||(s=s.parentNode);s;s=s.parentNode)h.push(s),p=s;p===(o.ownerDocument||r)&&h.push(p.defaultView||p.parentWindow||e)}for(m=0;(s=h[m++])&&!t.isPropagationStopped();)t.type=m>1?u:d.bindType||g,(a=(f._data(s,"events")||{})[t.type]&&f._data(s,"handle"))&&a.apply(s,n),(a=c&&s[c])&&a.apply&&R(s)&&(t.result=a.apply(s,n),!1===t.result&&t.preventDefault());if(t.type=g,!i&&!t.isDefaultPrevented()&&(!d._default||!1===d._default.apply(h.pop(),n))&&R(o)&&c&&o[g]&&!f.isWindow(o)){(p=o[c])&&(o[c]=null),f.event.triggered=g;try{o[g]()}catch(e){}f.event.triggered=void 0,p&&(o[c]=p)}return t.result}},dispatch:function(e){e=f.event.fix(e);var t,n,r,i,a,c=[],s=o.call(arguments),u=(f._data(this,"events")||{})[e.type]||[],l=f.event.special[e.type]||{};if(s[0]=e,e.delegateTarget=this,!l.preDispatch||!1!==l.preDispatch.call(this,e)){for(c=f.event.handlers.call(this,e,u),t=0;(i=c[t++])&&!e.isPropagationStopped();)for(e.currentTarget=i.elem,n=0;(a=i.handlers[n++])&&!e.isImmediatePropagationStopped();)e.rnamespace&&!e.rnamespace.test(a.namespace)||(e.handleObj=a,e.data=a.data,void 0!==(r=((f.event.special[a.origType]||{}).handle||a.handler).apply(i.elem,s))&&!1===(e.result=r)&&(e.preventDefault(),e.stopPropagation()));return l.postDispatch&&l.postDispatch.call(this,e),e.result}},handlers:function(e,t){var n,r,o,i,a=[],c=t.delegateCount,s=e.target;if(c&&s.nodeType&&("click"!==e.type||isNaN(e.button)||e.button<1))for(;s!=this;s=s.parentNode||this)if(1===s.nodeType&&(!0!==s.disabled||"click"!==e.type)){for(r=[],n=0;c>n;n++)void 0===r[o=(i=t[n]).selector+" "]&&(r[o]=i.needsContext?f(o,this).index(s)>-1:f.find(o,this,null,[s]).length),r[o]&&r.push(i);r.length&&a.push({elem:s,handlers:r})}return c<t.length&&a.push({elem:this,handlers:t.slice(c)}),a},fix:function(e){if(e[f.expando])return e;var t,n,o,i=e.type,a=e,c=this.fixHooks[i];for(c||(this.fixHooks[i]=c=le.test(i)?this.mouseHooks:ue.test(i)?this.keyHooks:{}),o=c.props?this.props.concat(c.props):this.props,e=new f.Event(a),t=o.length;t--;)e[n=o[t]]=a[n];return e.target||(e.target=a.srcElement||r),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,c.filter?c.filter(e,a):e},props:"altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,o,i,a=t.button,c=t.fromElement;return null==e.pageX&&null!=t.clientX&&(i=(o=e.target.ownerDocument||r).documentElement,n=o.body,e.pageX=t.clientX+(i&&i.scrollLeft||n&&n.scrollLeft||0)-(i&&i.clientLeft||n&&n.clientLeft||0),e.pageY=t.clientY+(i&&i.scrollTop||n&&n.scrollTop||0)-(i&&i.clientTop||n&&n.clientTop||0)),!e.relatedTarget&&c&&(e.relatedTarget=c===e.target?t.toElement:c),e.which||void 0===a||(e.which=1&a?1:2&a?3:4&a?2:0),e}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==he()&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===he()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return f.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(e){return f.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n){var r=f.extend(new f.Event,n,{type:e,isSimulated:!0});f.event.trigger(r,null,t),r.isDefaultPrevented()&&n.preventDefault()}},f.removeEvent=r.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)}:function(e,t,n){var r="on"+t;e.detachEvent&&(void 0===e[r]&&(e[r]=null),e.detachEvent(r,n))},f.Event=function(e,t){return this instanceof f.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?fe:me):this.type=e,t&&f.extend(this,t),this.timeStamp=e&&e.timeStamp||f.now(),void(this[f.expando]=!0)):new f.Event(e,t)},f.Event.prototype={constructor:f.Event,isDefaultPrevented:me,isPropagationStopped:me,isImmediatePropagationStopped:me,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=fe,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=fe,e&&!this.isSimulated&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=fe,e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()}},f.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){f.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=e.relatedTarget,o=e.handleObj;return r&&(r===this||f.contains(this,r))||(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}}),d.submit||(f.event.special.submit={setup:function(){return!f.nodeName(this,"form")&&void f.event.add(this,"click._submit keypress._submit",function(e){var t=e.target,n=f.nodeName(t,"input")||f.nodeName(t,"button")?f.prop(t,"form"):void 0;n&&!f._data(n,"submit")&&(f.event.add(n,"submit._submit",function(e){e._submitBubble=!0}),f._data(n,"submit",!0))})},postDispatch:function(e){e._submitBubble&&(delete e._submitBubble,this.parentNode&&!e.isTrigger&&f.event.simulate("submit",this.parentNode,e))},teardown:function(){return!f.nodeName(this,"form")&&void f.event.remove(this,"._submit")}}),d.change||(f.event.special.change={setup:function(){return se.test(this.nodeName)?("checkbox"!==this.type&&"radio"!==this.type||(f.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._justChanged=!0)}),f.event.add(this,"click._change",function(e){this._justChanged&&!e.isTrigger&&(this._justChanged=!1),f.event.simulate("change",this,e)})),!1):void f.event.add(this,"beforeactivate._change",function(e){var t=e.target;se.test(t.nodeName)&&!f._data(t,"change")&&(f.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||f.event.simulate("change",this.parentNode,e)}),f._data(t,"change",!0))})},handle:function(e){var t=e.target;return this!==t||e.isSimulated||e.isTrigger||"radio"!==t.type&&"checkbox"!==t.type?e.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return f.event.remove(this,"._change"),!se.test(this.nodeName)}}),d.focusin||f.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){f.event.simulate(t,e.target,f.event.fix(e))};f.event.special[t]={setup:function(){var r=this.ownerDocument||this,o=f._data(r,t);o||r.addEventListener(e,n,!0),f._data(r,t,(o||0)+1)},teardown:function(){var r=this.ownerDocument||this,o=f._data(r,t)-1;o?f._data(r,t,o):(r.removeEventListener(e,n,!0),f._removeData(r,t))}}}),f.fn.extend({on:function(e,t,n,r){return ge(this,e,t,n,r)},one:function(e,t,n,r){return ge(this,e,t,n,r,1)},off:function(e,t,n){var r,o;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,f(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(o in e)this.off(o,t,e[o]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=me),this.each(function(){f.event.remove(this,e,n,t)})},trigger:function(e,t){return this.each(function(){f.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];return n?f.event.trigger(e,t,n,!0):void 0}});var ve=/ jQuery\d+="(?:null|\d+)"/g,ye=new RegExp("<(?:"+X+")[\\s/>]","i"),Ce=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,Ee=/<script|<style|<link/i,Se=/checked\s*(?:[^=]|=\s*.checked.)/i,Te=/^true\/(.*)/,_e=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,we=ee(r).appendChild(r.createElement("div"));function be(e,t){return f.nodeName(e,"table")&&f.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function Pe(e){return e.type=(null!==f.find.attr(e,"type"))+"/"+e.type,e}function Ae(e){var t=Te.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function $e(e,t){if(1===t.nodeType&&f.hasData(e)){var n,r,o,i=f._data(e),a=f._data(t,i),c=i.events;if(c)for(n in delete a.handle,a.events={},c)for(r=0,o=c[n].length;o>r;r++)f.event.add(t,n,c[n][r]);a.data&&(a.data=f.extend({},a.data))}}function Ie(e,t){var n,r,o;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!d.noCloneEvent&&t[f.expando]){for(r in(o=f._data(t)).events)f.removeEvent(t,r,o.handle);t.removeAttribute(f.expando)}"script"===n&&t.text!==e.text?(Pe(t).text=e.text,Ae(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),d.html5Clone&&e.innerHTML&&!f.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&K.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:"input"!==n&&"textarea"!==n||(t.defaultValue=e.defaultValue)}}function ke(e,t,n,r){t=i.apply([],t);var o,a,c,s,u,l,p=0,m=e.length,h=m-1,g=t[0],v=f.isFunction(g);if(v||m>1&&"string"==typeof g&&!d.checkClone&&Se.test(g))return e.each(function(o){var i=e.eq(o);v&&(t[0]=g.call(this,o,i.html())),ke(i,t,n,r)});if(m&&(o=(l=ce(t,e[0].ownerDocument,!1,e,r)).firstChild,1===l.childNodes.length&&(l=o),o||r)){for(c=(s=f.map(ne(l,"script"),Pe)).length;m>p;p++)a=l,p!==h&&(a=f.clone(a,!0,!0),c&&f.merge(s,ne(a,"script"))),n.call(e[p],a,p);if(c)for(u=s[s.length-1].ownerDocument,f.map(s,Ae),p=0;c>p;p++)a=s[p],J.test(a.type||"")&&!f._data(a,"globalEval")&&f.contains(u,a)&&(a.src?f._evalUrl&&f._evalUrl(a.src):f.globalEval((a.text||a.textContent||a.innerHTML||"").replace(_e,"")));l=o=null}return e}function Ne(e,t,n){for(var r,o=t?f.filter(t,e):e,i=0;null!=(r=o[i]);i++)n||1!==r.nodeType||f.cleanData(ne(r)),r.parentNode&&(n&&f.contains(r.ownerDocument,r)&&re(ne(r,"script")),r.parentNode.removeChild(r));return e}f.extend({htmlPrefilter:function(e){return e.replace(Ce,"<$1></$2>")},clone:function(e,t,n){var r,o,i,a,c,s=f.contains(e.ownerDocument,e);if(d.html5Clone||f.isXMLDoc(e)||!ye.test("<"+e.nodeName+">")?i=e.cloneNode(!0):(we.innerHTML=e.outerHTML,we.removeChild(i=we.firstChild)),!(d.noCloneEvent&&d.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||f.isXMLDoc(e)))for(r=ne(i),c=ne(e),a=0;null!=(o=c[a]);++a)r[a]&&Ie(o,r[a]);if(t)if(n)for(c=c||ne(e),r=r||ne(i),a=0;null!=(o=c[a]);a++)$e(o,r[a]);else $e(e,i);return(r=ne(i,"script")).length>0&&re(r,!s&&ne(e,"script")),r=c=o=null,i},cleanData:function(e,t){for(var r,o,i,a,c=0,s=f.expando,u=f.cache,l=d.attributes,p=f.event.special;null!=(r=e[c]);c++)if((t||R(r))&&(a=(i=r[s])&&u[i])){if(a.events)for(o in a.events)p[o]?f.event.remove(r,o):f.removeEvent(r,o,a.handle);u[i]&&(delete u[i],l||void 0===r.removeAttribute?r[s]=void 0:r.removeAttribute(s),n.push(i))}}}),f.fn.extend({domManip:ke,detach:function(e){return Ne(this,e,!0)},remove:function(e){return Ne(this,e)},text:function(e){return z(this,function(e){return void 0===e?f.text(this):this.empty().append((this[0]&&this[0].ownerDocument||r).createTextNode(e))},null,e,arguments.length)},append:function(){return ke(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||be(this,e).appendChild(e)})},prepend:function(){return ke(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=be(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return ke(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return ke(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++){for(1===e.nodeType&&f.cleanData(ne(e,!1));e.firstChild;)e.removeChild(e.firstChild);e.options&&f.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return f.clone(this,e,t)})},html:function(e){return z(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e)return 1===t.nodeType?t.innerHTML.replace(ve,""):void 0;if("string"==typeof e&&!Ee.test(e)&&(d.htmlSerialize||!ye.test(e))&&(d.leadingWhitespace||!Q.test(e))&&!te[(Z.exec(e)||["",""])[1].toLowerCase()]){e=f.htmlPrefilter(e);try{for(;r>n;n++)1===(t=this[n]||{}).nodeType&&(f.cleanData(ne(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return ke(this,arguments,function(t){var n=this.parentNode;f.inArray(this,e)<0&&(f.cleanData(ne(this)),n&&n.replaceChild(t,this))},e)}}),f.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){f.fn[e]=function(e){for(var n,r=0,o=[],i=f(e),c=i.length-1;c>=r;r++)n=r===c?this:this.clone(!0),f(i[r])[t](n),a.apply(o,n.get());return this.pushStack(o)}});var xe,De={HTML:"block",BODY:"block"};function Me(e,t){var n=f(t.createElement(e)).appendTo(t.body),r=f.css(n[0],"display");return n.detach(),r}function Oe(e){var t=r,n=De[e];return n||("none"!==(n=Me(e,t))&&n||((t=((xe=(xe||f("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement))[0].contentWindow||xe[0].contentDocument).document).write(),t.close(),n=Me(e,t),xe.detach()),De[e]=n),n}var Re=/^margin/,Le=new RegExp("^("+W+")(?!px)[a-z%]+$","i"),Ve=function(e,t,n,r){var o,i,a={};for(i in t)a[i]=e.style[i],e.style[i]=t[i];for(i in o=n.apply(e,r||[]),t)e.style[i]=a[i];return o},Ue=r.documentElement;!function(){var t,n,o,i,a,c,s=r.createElement("div"),u=r.createElement("div");if(u.style){function l(){var l,d,p=r.documentElement;p.appendChild(s),u.style.cssText="-webkit-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",t=o=c=!1,n=a=!0,e.getComputedStyle&&(d=e.getComputedStyle(u),t="1%"!==(d||{}).top,c="2px"===(d||{}).marginLeft,o="4px"===(d||{width:"4px"}).width,u.style.marginRight="50%",n="4px"===(d||{marginRight:"4px"}).marginRight,(l=u.appendChild(r.createElement("div"))).style.cssText=u.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",l.style.marginRight=l.style.width="0",u.style.width="1px",a=!parseFloat((e.getComputedStyle(l)||{}).marginRight),u.removeChild(l)),u.style.display="none",(i=0===u.getClientRects().length)&&(u.style.display="",u.innerHTML="<table><tr><td></td><td>t</td></tr></table>",u.childNodes[0].style.borderCollapse="separate",(l=u.getElementsByTagName("td"))[0].style.cssText="margin:0;border:0;padding:0;display:none",(i=0===l[0].offsetHeight)&&(l[0].style.display="",l[1].style.display="none",i=0===l[0].offsetHeight)),p.removeChild(s)}u.style.cssText="float:left;opacity:.5",d.opacity="0.5"===u.style.opacity,d.cssFloat=!!u.style.cssFloat,u.style.backgroundClip="content-box",u.cloneNode(!0).style.backgroundClip="",d.clearCloneStyle="content-box"===u.style.backgroundClip,(s=r.createElement("div")).style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",u.innerHTML="",s.appendChild(u),d.boxSizing=""===u.style.boxSizing||""===u.style.MozBoxSizing||""===u.style.WebkitBoxSizing,f.extend(d,{reliableHiddenOffsets:function(){return null==t&&l(),i},boxSizingReliable:function(){return null==t&&l(),o},pixelMarginRight:function(){return null==t&&l(),n},pixelPosition:function(){return null==t&&l(),t},reliableMarginRight:function(){return null==t&&l(),a},reliableMarginLeft:function(){return null==t&&l(),c}})}}();var Fe,Be,He=/^(top|right|bottom|left)$/;function We(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}e.getComputedStyle?(Fe=function(t){var n=t.ownerDocument.defaultView;return n&&n.opener||(n=e),n.getComputedStyle(t)},Be=function(e,t,n){var r,o,i,a,c=e.style;return""!==(a=(n=n||Fe(e))?n.getPropertyValue(t)||n[t]:void 0)&&void 0!==a||f.contains(e.ownerDocument,e)||(a=f.style(e,t)),n&&!d.pixelMarginRight()&&Le.test(a)&&Re.test(t)&&(r=c.width,o=c.minWidth,i=c.maxWidth,c.minWidth=c.maxWidth=c.width=a,a=n.width,c.width=r,c.minWidth=o,c.maxWidth=i),void 0===a?a:a+""}):Ue.currentStyle&&(Fe=function(e){return e.currentStyle},Be=function(e,t,n){var r,o,i,a,c=e.style;return null==(a=(n=n||Fe(e))?n[t]:void 0)&&c&&c[t]&&(a=c[t]),Le.test(a)&&!He.test(t)&&(r=c.left,(i=(o=e.runtimeStyle)&&o.left)&&(o.left=e.currentStyle.left),c.left="fontSize"===t?"1em":a,a=c.pixelLeft+"px",c.left=r,i&&(o.left=i)),void 0===a?a:a+""||"auto"});var qe=/alpha\([^)]*\)/i,je=/opacity\s*=\s*([^)]*)/i,Ye=/^(none|table(?!-c[ea]).+)/,Ge=new RegExp("^("+W+")(.*)$","i"),ze={position:"absolute",visibility:"hidden",display:"block"},Ke={letterSpacing:"0",fontWeight:"400"},Ze=["Webkit","O","Moz","ms"],Je=r.createElement("div").style;function Qe(e){if(e in Je)return e;for(var t=e.charAt(0).toUpperCase()+e.slice(1),n=Ze.length;n--;)if((e=Ze[n]+t)in Je)return e}function Xe(e,t){for(var n,r,o,i=[],a=0,c=e.length;c>a;a++)(r=e[a]).style&&(i[a]=f._data(r,"olddisplay"),n=r.style.display,t?(i[a]||"none"!==n||(r.style.display=""),""===r.style.display&&Y(r)&&(i[a]=f._data(r,"olddisplay",Oe(r.nodeName)))):(o=Y(r),(n&&"none"!==n||!o)&&f._data(r,"olddisplay",o?n:f.css(r,"display"))));for(a=0;c>a;a++)(r=e[a]).style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?i[a]||"":"none"));return e}function et(e,t,n){var r=Ge.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function tt(e,t,n,r,o){for(var i=n===(r?"border":"content")?4:"width"===t?1:0,a=0;4>i;i+=2)"margin"===n&&(a+=f.css(e,n+j[i],!0,o)),r?("content"===n&&(a-=f.css(e,"padding"+j[i],!0,o)),"margin"!==n&&(a-=f.css(e,"border"+j[i]+"Width",!0,o))):(a+=f.css(e,"padding"+j[i],!0,o),"padding"!==n&&(a+=f.css(e,"border"+j[i]+"Width",!0,o)));return a}function nt(e,t,n){var r=!0,o="width"===t?e.offsetWidth:e.offsetHeight,i=Fe(e),a=d.boxSizing&&"border-box"===f.css(e,"boxSizing",!1,i);if(0>=o||null==o){if((0>(o=Be(e,t,i))||null==o)&&(o=e.style[t]),Le.test(o))return o;r=a&&(d.boxSizingReliable()||o===e.style[t]),o=parseFloat(o)||0}return o+tt(e,t,n||(a?"border":"content"),r,i)+"px"}function rt(e,t,n,r,o){return new rt.prototype.init(e,t,n,r,o)}f.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Be(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:d.cssFloat?"cssFloat":"styleFloat"},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var o,i,a,c=f.camelCase(t),s=e.style;if(t=f.cssProps[c]||(f.cssProps[c]=Qe(c)||c),a=f.cssHooks[t]||f.cssHooks[c],void 0===n)return a&&"get"in a&&void 0!==(o=a.get(e,!1,r))?o:s[t];if("string"===(i=typeof n)&&(o=q.exec(n))&&o[1]&&(n=G(e,t,o),i="number"),null!=n&&n==n&&("number"===i&&(n+=o&&o[3]||(f.cssNumber[c]?"":"px")),d.clearCloneStyle||""!==n||0!==t.indexOf("background")||(s[t]="inherit"),!(a&&"set"in a&&void 0===(n=a.set(e,n,r)))))try{s[t]=n}catch(e){}}},css:function(e,t,n,r){var o,i,a,c=f.camelCase(t);return t=f.cssProps[c]||(f.cssProps[c]=Qe(c)||c),(a=f.cssHooks[t]||f.cssHooks[c])&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=Be(e,t,r)),"normal"===i&&t in Ke&&(i=Ke[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),f.each(["height","width"],function(e,t){f.cssHooks[t]={get:function(e,n,r){return n?Ye.test(f.css(e,"display"))&&0===e.offsetWidth?Ve(e,ze,function(){return nt(e,t,r)}):nt(e,t,r):void 0},set:function(e,n,r){var o=r&&Fe(e);return et(0,n,r?tt(e,t,r,d.boxSizing&&"border-box"===f.css(e,"boxSizing",!1,o),o):0)}}}),d.opacity||(f.cssHooks.opacity={get:function(e,t){return je.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,o=f.isNumeric(t)?"alpha(opacity="+100*t+")":"",i=r&&r.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===f.trim(i.replace(qe,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||r&&!r.filter)||(n.filter=qe.test(i)?i.replace(qe,o):i+" "+o)}}),f.cssHooks.marginRight=We(d.reliableMarginRight,function(e,t){return t?Ve(e,{display:"inline-block"},Be,[e,"marginRight"]):void 0}),f.cssHooks.marginLeft=We(d.reliableMarginLeft,function(e,t){return t?(parseFloat(Be(e,"marginLeft"))||(f.contains(e.ownerDocument,e)?e.getBoundingClientRect().left-Ve(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}):0))+"px":void 0}),f.each({margin:"",padding:"",border:"Width"},function(e,t){f.cssHooks[e+t]={expand:function(n){for(var r=0,o={},i="string"==typeof n?n.split(" "):[n];4>r;r++)o[e+j[r]+t]=i[r]||i[r-2]||i[0];return o}},Re.test(e)||(f.cssHooks[e+t].set=et)}),f.fn.extend({css:function(e,t){return z(this,function(e,t,n){var r,o,i={},a=0;if(f.isArray(t)){for(r=Fe(e),o=t.length;o>a;a++)i[t[a]]=f.css(e,t[a],!1,r);return i}return void 0!==n?f.style(e,t,n):f.css(e,t)},e,t,arguments.length>1)},show:function(){return Xe(this,!0)},hide:function(){return Xe(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){Y(this)?f(this).show():f(this).hide()})}}),f.Tween=rt,rt.prototype={constructor:rt,init:function(e,t,n,r,o,i){this.elem=e,this.prop=n,this.easing=o||f.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=i||(f.cssNumber[n]?"":"px")},cur:function(){var e=rt.propHooks[this.prop];return e&&e.get?e.get(this):rt.propHooks._default.get(this)},run:function(e){var t,n=rt.propHooks[this.prop];return this.options.duration?this.pos=t=f.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):rt.propHooks._default.set(this),this}},rt.prototype.init.prototype=rt.prototype,rt.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=f.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){f.fx.step[e.prop]?f.fx.step[e.prop](e):1!==e.elem.nodeType||null==e.elem.style[f.cssProps[e.prop]]&&!f.cssHooks[e.prop]?e.elem[e.prop]=e.now:f.style(e.elem,e.prop,e.now+e.unit)}}},rt.propHooks.scrollTop=rt.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},f.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},f.fx=rt.prototype.init,f.fx.step={};var ot,it,at=/^(?:toggle|show|hide)$/,ct=/queueHooks$/;function st(){return e.setTimeout(function(){ot=void 0}),ot=f.now()}function ut(e,t){var n,r={height:e},o=0;for(t=t?1:0;4>o;o+=2-t)r["margin"+(n=j[o])]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function lt(e,t,n){for(var r,o=(dt.tweeners[t]||[]).concat(dt.tweeners["*"]),i=0,a=o.length;a>i;i++)if(r=o[i].call(n,t,e))return r}function dt(e,t,n){var r,o,i=0,a=dt.prefilters.length,c=f.Deferred().always(function(){delete s.elem}),s=function(){if(o)return!1;for(var t=ot||st(),n=Math.max(0,u.startTime+u.duration-t),r=1-(n/u.duration||0),i=0,a=u.tweens.length;a>i;i++)u.tweens[i].run(r);return c.notifyWith(e,[u,r,n]),1>r&&a?n:(c.resolveWith(e,[u]),!1)},u=c.promise({elem:e,props:f.extend({},t),opts:f.extend(!0,{specialEasing:{},easing:f.easing._default},n),originalProperties:t,originalOptions:n,startTime:ot||st(),duration:n.duration,tweens:[],createTween:function(t,n){var r=f.Tween(e,u.opts,t,n,u.opts.specialEasing[t]||u.opts.easing);return u.tweens.push(r),r},stop:function(t){var n=0,r=t?u.tweens.length:0;if(o)return this;for(o=!0;r>n;n++)u.tweens[n].run(1);return t?(c.notifyWith(e,[u,1,0]),c.resolveWith(e,[u,t])):c.rejectWith(e,[u,t]),this}}),l=u.props;for(function(e,t){var n,r,o,i,a;for(n in e)if(o=t[r=f.camelCase(n)],i=e[n],f.isArray(i)&&(o=i[1],i=e[n]=i[0]),n!==r&&(e[r]=i,delete e[n]),(a=f.cssHooks[r])&&"expand"in a)for(n in i=a.expand(i),delete e[r],i)n in e||(e[n]=i[n],t[n]=o);else t[r]=o}(l,u.opts.specialEasing);a>i;i++)if(r=dt.prefilters[i].call(u,e,l,u.opts))return f.isFunction(r.stop)&&(f._queueHooks(u.elem,u.opts.queue).stop=f.proxy(r.stop,r)),r;return f.map(l,lt,u),f.isFunction(u.opts.start)&&u.opts.start.call(e,u),f.fx.timer(f.extend(s,{elem:e,anim:u,queue:u.opts.queue})),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always)}f.Animation=f.extend(dt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return G(n.elem,e,q.exec(t),n),n}]},tweener:function(e,t){f.isFunction(e)?(t=e,e=["*"]):e=e.match(D);for(var n,r=0,o=e.length;o>r;r++)n=e[r],dt.tweeners[n]=dt.tweeners[n]||[],dt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,o,i,a,c,s,u,l=this,p={},m=e.style,h=e.nodeType&&Y(e),g=f._data(e,"fxshow");for(r in n.queue||(null==(c=f._queueHooks(e,"fx")).unqueued&&(c.unqueued=0,s=c.empty.fire,c.empty.fire=function(){c.unqueued||s()}),c.unqueued++,l.always(function(){l.always(function(){c.unqueued--,f.queue(e,"fx").length||c.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[m.overflow,m.overflowX,m.overflowY],"inline"===("none"===(u=f.css(e,"display"))?f._data(e,"olddisplay")||Oe(e.nodeName):u)&&"none"===f.css(e,"float")&&(d.inlineBlockNeedsLayout&&"inline"!==Oe(e.nodeName)?m.zoom=1:m.display="inline-block")),n.overflow&&(m.overflow="hidden",d.shrinkWrapBlocks()||l.always(function(){m.overflow=n.overflow[0],m.overflowX=n.overflow[1],m.overflowY=n.overflow[2]})),t)if(o=t[r],at.exec(o)){if(delete t[r],i=i||"toggle"===o,o===(h?"hide":"show")){if("show"!==o||!g||void 0===g[r])continue;h=!0}p[r]=g&&g[r]||f.style(e,r)}else u=void 0;if(f.isEmptyObject(p))"inline"===("none"===u?Oe(e.nodeName):u)&&(m.display=u);else for(r in g?"hidden"in g&&(h=g.hidden):g=f._data(e,"fxshow",{}),i&&(g.hidden=!h),h?f(e).show():l.done(function(){f(e).hide()}),l.done(function(){var t;for(t in f._removeData(e,"fxshow"),p)f.style(e,t,p[t])}),p)a=lt(h?g[r]:0,r,l),r in g||(g[r]=a.start,h&&(a.end=a.start,a.start="width"===r||"height"===r?1:0))}],prefilter:function(e,t){t?dt.prefilters.unshift(e):dt.prefilters.push(e)}}),f.speed=function(e,t,n){var r=e&&"object"==typeof e?f.extend({},e):{complete:n||!n&&t||f.isFunction(e)&&e,duration:e,easing:n&&t||t&&!f.isFunction(t)&&t};return r.duration=f.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in f.fx.speeds?f.fx.speeds[r.duration]:f.fx.speeds._default,null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){f.isFunction(r.old)&&r.old.call(this),r.queue&&f.dequeue(this,r.queue)},r},f.fn.extend({fadeTo:function(e,t,n,r){return this.filter(Y).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var o=f.isEmptyObject(e),i=f.speed(t,n,r),a=function(){var t=dt(this,f.extend({},e),i);(o||f._data(this,"finish"))&&t.stop(!0)};return a.finish=a,o||!1===i.queue?this.each(a):this.queue(i.queue,a)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&!1!==e&&this.queue(e||"fx",[]),this.each(function(){var t=!0,o=null!=e&&e+"queueHooks",i=f.timers,a=f._data(this);if(o)a[o]&&a[o].stop&&r(a[o]);else for(o in a)a[o]&&a[o].stop&&ct.test(o)&&r(a[o]);for(o=i.length;o--;)i[o].elem!==this||null!=e&&i[o].queue!==e||(i[o].anim.stop(n),t=!1,i.splice(o,1));!t&&n||f.dequeue(this,e)})},finish:function(e){return!1!==e&&(e=e||"fx"),this.each(function(){var t,n=f._data(this),r=n[e+"queue"],o=n[e+"queueHooks"],i=f.timers,a=r?r.length:0;for(n.finish=!0,f.queue(this,e,[]),o&&o.stop&&o.stop.call(this,!0),t=i.length;t--;)i[t].elem===this&&i[t].queue===e&&(i[t].anim.stop(!0),i.splice(t,1));for(t=0;a>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),f.each(["toggle","show","hide"],function(e,t){var n=f.fn[t];f.fn[t]=function(e,r,o){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(ut(t,!0),e,r,o)}}),f.each({slideDown:ut("show"),slideUp:ut("hide"),slideToggle:ut("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){f.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),f.timers=[],f.fx.tick=function(){var e,t=f.timers,n=0;for(ot=f.now();n<t.length;n++)(e=t[n])()||t[n]!==e||t.splice(n--,1);t.length||f.fx.stop(),ot=void 0},f.fx.timer=function(e){f.timers.push(e),e()?f.fx.start():f.timers.pop()},f.fx.interval=13,f.fx.start=function(){it||(it=e.setInterval(f.fx.tick,f.fx.interval))},f.fx.stop=function(){e.clearInterval(it),it=null},f.fx.speeds={slow:600,fast:200,_default:400},f.fn.delay=function(t,n){return t=f.fx&&f.fx.speeds[t]||t,n=n||"fx",this.queue(n,function(n,r){var o=e.setTimeout(n,t);r.stop=function(){e.clearTimeout(o)}})},function(){var e,t=r.createElement("input"),n=r.createElement("div"),o=r.createElement("select"),i=o.appendChild(r.createElement("option"));(n=r.createElement("div")).setAttribute("className","t"),n.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",e=n.getElementsByTagName("a")[0],t.setAttribute("type","checkbox"),n.appendChild(t),(e=n.getElementsByTagName("a")[0]).style.cssText="top:1px",d.getSetAttribute="t"!==n.className,d.style=/top/.test(e.getAttribute("style")),d.hrefNormalized="/a"===e.getAttribute("href"),d.checkOn=!!t.value,d.optSelected=i.selected,d.enctype=!!r.createElement("form").enctype,o.disabled=!0,d.optDisabled=!i.disabled,(t=r.createElement("input")).setAttribute("value",""),d.input=""===t.getAttribute("value"),t.value="t",t.setAttribute("type","radio"),d.radioValue="t"===t.value}();var pt=/\r/g,ft=/[\x20\t\r\n\f]+/g;f.fn.extend({val:function(e){var t,n,r,o=this[0];return arguments.length?(r=f.isFunction(e),this.each(function(n){var o;1===this.nodeType&&(null==(o=r?e.call(this,n,f(this).val()):e)?o="":"number"==typeof o?o+="":f.isArray(o)&&(o=f.map(o,function(e){return null==e?"":e+""})),(t=f.valHooks[this.type]||f.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,o,"value")||(this.value=o))})):o?(t=f.valHooks[o.type]||f.valHooks[o.nodeName.toLowerCase()])&&"get"in t&&void 0!==(n=t.get(o,"value"))?n:"string"==typeof(n=o.value)?n.replace(pt,""):null==n?"":n:void 0}}),f.extend({valHooks:{option:{get:function(e){var t=f.find.attr(e,"value");return null!=t?t:f.trim(f.text(e)).replace(ft," ")}},select:{get:function(e){for(var t,n,r=e.options,o=e.selectedIndex,i="select-one"===e.type||0>o,a=i?null:[],c=i?o+1:r.length,s=0>o?c:i?o:0;c>s;s++)if(((n=r[s]).selected||s===o)&&(d.optDisabled?!n.disabled:null===n.getAttribute("disabled"))&&(!n.parentNode.disabled||!f.nodeName(n.parentNode,"optgroup"))){if(t=f(n).val(),i)return t;a.push(t)}return a},set:function(e,t){for(var n,r,o=e.options,i=f.makeArray(t),a=o.length;a--;)if(r=o[a],f.inArray(f.valHooks.option.get(r),i)>-1)try{r.selected=n=!0}catch(e){r.scrollHeight}else r.selected=!1;return n||(e.selectedIndex=-1),o}}}}),f.each(["radio","checkbox"],function(){f.valHooks[this]={set:function(e,t){return f.isArray(t)?e.checked=f.inArray(f(e).val(),t)>-1:void 0}},d.checkOn||(f.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var mt,ht,gt=f.expr.attrHandle,vt=/^(?:checked|selected)$/i,yt=d.getSetAttribute,Ct=d.input;f.fn.extend({attr:function(e,t){return z(this,f.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){f.removeAttr(this,e)})}}),f.extend({attr:function(e,t,n){var r,o,i=e.nodeType;if(3!==i&&8!==i&&2!==i)return void 0===e.getAttribute?f.prop(e,t,n):(1===i&&f.isXMLDoc(e)||(t=t.toLowerCase(),o=f.attrHooks[t]||(f.expr.match.bool.test(t)?ht:mt)),void 0!==n?null===n?void f.removeAttr(e,t):o&&"set"in o&&void 0!==(r=o.set(e,n,t))?r:(e.setAttribute(t,n+""),n):o&&"get"in o&&null!==(r=o.get(e,t))?r:null==(r=f.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!d.radioValue&&"radio"===t&&f.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r,o=0,i=t&&t.match(D);if(i&&1===e.nodeType)for(;n=i[o++];)r=f.propFix[n]||n,f.expr.match.bool.test(n)?Ct&&yt||!vt.test(n)?e[r]=!1:e[f.camelCase("default-"+n)]=e[r]=!1:f.attr(e,n,""),e.removeAttribute(yt?n:r)}}),ht={set:function(e,t,n){return!1===t?f.removeAttr(e,n):Ct&&yt||!vt.test(n)?e.setAttribute(!yt&&f.propFix[n]||n,n):e[f.camelCase("default-"+n)]=e[n]=!0,n}},f.each(f.expr.match.bool.source.match(/\w+/g),function(e,t){var n=gt[t]||f.find.attr;Ct&&yt||!vt.test(t)?gt[t]=function(e,t,r){var o,i;return r||(i=gt[t],gt[t]=o,o=null!=n(e,t,r)?t.toLowerCase():null,gt[t]=i),o}:gt[t]=function(e,t,n){return n?void 0:e[f.camelCase("default-"+t)]?t.toLowerCase():null}}),Ct&&yt||(f.attrHooks.value={set:function(e,t,n){return f.nodeName(e,"input")?void(e.defaultValue=t):mt&&mt.set(e,t,n)}}),yt||(mt={set:function(e,t,n){var r=e.getAttributeNode(n);return r||e.setAttributeNode(r=e.ownerDocument.createAttribute(n)),r.value=t+="","value"===n||t===e.getAttribute(n)?t:void 0}},gt.id=gt.name=gt.coords=function(e,t,n){var r;return n?void 0:(r=e.getAttributeNode(t))&&""!==r.value?r.value:null},f.valHooks.button={get:function(e,t){var n=e.getAttributeNode(t);return n&&n.specified?n.value:void 0},set:mt.set},f.attrHooks.contenteditable={set:function(e,t,n){mt.set(e,""!==t&&t,n)}},f.each(["width","height"],function(e,t){f.attrHooks[t]={set:function(e,n){return""===n?(e.setAttribute(t,"auto"),n):void 0}}})),d.style||(f.attrHooks.style={get:function(e){return e.style.cssText||void 0},set:function(e,t){return e.style.cssText=t+""}});var Et=/^(?:input|select|textarea|button|object)$/i,St=/^(?:a|area)$/i;f.fn.extend({prop:function(e,t){return z(this,f.prop,e,t,arguments.length>1)},removeProp:function(e){return e=f.propFix[e]||e,this.each(function(){try{this[e]=void 0,delete this[e]}catch(e){}})}}),f.extend({prop:function(e,t,n){var r,o,i=e.nodeType;if(3!==i&&8!==i&&2!==i)return 1===i&&f.isXMLDoc(e)||(t=f.propFix[t]||t,o=f.propHooks[t]),void 0!==n?o&&"set"in o&&void 0!==(r=o.set(e,n,t))?r:e[t]=n:o&&"get"in o&&null!==(r=o.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=f.find.attr(e,"tabindex");return t?parseInt(t,10):Et.test(e.nodeName)||St.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),d.hrefNormalized||f.each(["href","src"],function(e,t){f.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}}),d.optSelected||(f.propHooks.selected={get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),f.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){f.propFix[this.toLowerCase()]=this}),d.enctype||(f.propFix.enctype="encoding");var Tt=/[\t\r\n\f]/g;function _t(e){return f.attr(e,"class")||""}f.fn.extend({addClass:function(e){var t,n,r,o,i,a,c,s=0;if(f.isFunction(e))return this.each(function(t){f(this).addClass(e.call(this,t,_t(this)))});if("string"==typeof e&&e)for(t=e.match(D)||[];n=this[s++];)if(o=_t(n),r=1===n.nodeType&&(" "+o+" ").replace(Tt," ")){for(a=0;i=t[a++];)r.indexOf(" "+i+" ")<0&&(r+=i+" ");o!==(c=f.trim(r))&&f.attr(n,"class",c)}return this},removeClass:function(e){var t,n,r,o,i,a,c,s=0;if(f.isFunction(e))return this.each(function(t){f(this).removeClass(e.call(this,t,_t(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof e&&e)for(t=e.match(D)||[];n=this[s++];)if(o=_t(n),r=1===n.nodeType&&(" "+o+" ").replace(Tt," ")){for(a=0;i=t[a++];)for(;r.indexOf(" "+i+" ")>-1;)r=r.replace(" "+i+" "," ");o!==(c=f.trim(r))&&f.attr(n,"class",c)}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):f.isFunction(e)?this.each(function(n){f(this).toggleClass(e.call(this,n,_t(this),t),t)}):this.each(function(){var t,r,o,i;if("string"===n)for(r=0,o=f(this),i=e.match(D)||[];t=i[r++];)o.hasClass(t)?o.removeClass(t):o.addClass(t);else void 0!==e&&"boolean"!==n||((t=_t(this))&&f._data(this,"__className__",t),f.attr(this,"class",t||!1===e?"":f._data(this,"__className__")||""))})},hasClass:function(e){var t,n,r=0;for(t=" "+e+" ";n=this[r++];)if(1===n.nodeType&&(" "+_t(n)+" ").replace(Tt," ").indexOf(t)>-1)return!0;return!1}}),f.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){f.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),f.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}});var wt=e.location,bt=f.now(),Pt=/\?/,At=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;f.parseJSON=function(t){if(e.JSON&&e.JSON.parse)return e.JSON.parse(t+"");var n,r=null,o=f.trim(t+"");return o&&!f.trim(o.replace(At,function(e,t,o,i){return n&&t&&(r=0),0===r?e:(n=o||t,r+=!i-!o,"")}))?Function("return "+o)():f.error("Invalid JSON: "+t)},f.parseXML=function(t){var n;if(!t||"string"!=typeof t)return null;try{e.DOMParser?n=(new e.DOMParser).parseFromString(t,"text/xml"):((n=new e.ActiveXObject("Microsoft.XMLDOM")).async="false",n.loadXML(t))}catch(e){n=void 0}return n&&n.documentElement&&!n.getElementsByTagName("parsererror").length||f.error("Invalid XML: "+t),n};var $t=/#.*$/,It=/([?&])_=[^&]*/,kt=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Nt=/^(?:GET|HEAD)$/,xt=/^\/\//,Dt=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Mt={},Ot={},Rt="*/".concat("*"),Lt=wt.href,Vt=Dt.exec(Lt.toLowerCase())||[];function Ut(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,o=0,i=t.toLowerCase().match(D)||[];if(f.isFunction(n))for(;r=i[o++];)"+"===r.charAt(0)?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function Ft(e,t,n,r){var o={},i=e===Ot;function a(c){var s;return o[c]=!0,f.each(e[c]||[],function(e,c){var u=c(t,n,r);return"string"!=typeof u||i||o[u]?i?!(s=u):void 0:(t.dataTypes.unshift(u),a(u),!1)}),s}return a(t.dataTypes[0])||!o["*"]&&a("*")}function Bt(e,t){var n,r,o=f.ajaxSettings.flatOptions||{};for(r in t)void 0!==t[r]&&((o[r]?e:n||(n={}))[r]=t[r]);return n&&f.extend(!0,e,n),e}function Ht(e){return e.style&&e.style.display||f.css(e,"display")}f.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Lt,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Vt[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Rt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":f.parseJSON,"text xml":f.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Bt(Bt(e,f.ajaxSettings),t):Bt(f.ajaxSettings,e)},ajaxPrefilter:Ut(Mt),ajaxTransport:Ut(Ot),ajax:function(t,n){"object"==typeof t&&(n=t,t=void 0),n=n||{};var r,o,i,a,c,s,u,l,d=f.ajaxSetup({},n),p=d.context||d,m=d.context&&(p.nodeType||p.jquery)?f(p):f.event,h=f.Deferred(),g=f.Callbacks("once memory"),v=d.statusCode||{},y={},C={},E=0,S="canceled",T={readyState:0,getResponseHeader:function(e){var t;if(2===E){if(!l)for(l={};t=kt.exec(a);)l[t[1].toLowerCase()]=t[2];t=l[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===E?a:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return E||(e=C[n]=C[n]||e,y[e]=t),this},overrideMimeType:function(e){return E||(d.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>E)for(t in e)v[t]=[v[t],e[t]];else T.always(e[T.status]);return this},abort:function(e){var t=e||S;return u&&u.abort(t),_(0,t),this}};if(h.promise(T).complete=g.add,T.success=T.done,T.error=T.fail,d.url=((t||d.url||Lt)+"").replace($t,"").replace(xt,Vt[1]+"//"),d.type=n.method||n.type||d.method||d.type,d.dataTypes=f.trim(d.dataType||"*").toLowerCase().match(D)||[""],null==d.crossDomain&&(r=Dt.exec(d.url.toLowerCase()),d.crossDomain=!(!r||r[1]===Vt[1]&&r[2]===Vt[2]&&(r[3]||("http:"===r[1]?"80":"443"))===(Vt[3]||("http:"===Vt[1]?"80":"443")))),d.data&&d.processData&&"string"!=typeof d.data&&(d.data=f.param(d.data,d.traditional)),Ft(Mt,d,n,T),2===E)return T;for(o in(s=f.event&&d.global)&&0==f.active++&&f.event.trigger("ajaxStart"),d.type=d.type.toUpperCase(),d.hasContent=!Nt.test(d.type),i=d.url,d.hasContent||(d.data&&(i=d.url+=(Pt.test(i)?"&":"?")+d.data,delete d.data),!1===d.cache&&(d.url=It.test(i)?i.replace(It,"$1_="+bt++):i+(Pt.test(i)?"&":"?")+"_="+bt++)),d.ifModified&&(f.lastModified[i]&&T.setRequestHeader("If-Modified-Since",f.lastModified[i]),f.etag[i]&&T.setRequestHeader("If-None-Match",f.etag[i])),(d.data&&d.hasContent&&!1!==d.contentType||n.contentType)&&T.setRequestHeader("Content-Type",d.contentType),T.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", "+Rt+"; q=0.01":""):d.accepts["*"]),d.headers)T.setRequestHeader(o,d.headers[o]);if(d.beforeSend&&(!1===d.beforeSend.call(p,T,d)||2===E))return T.abort();for(o in S="abort",{success:1,error:1,complete:1})T[o](d[o]);if(u=Ft(Ot,d,n,T)){if(T.readyState=1,s&&m.trigger("ajaxSend",[T,d]),2===E)return T;d.async&&d.timeout>0&&(c=e.setTimeout(function(){T.abort("timeout")},d.timeout));try{E=1,u.send(y,_)}catch(e){if(!(2>E))throw e;_(-1,e)}}else _(-1,"No Transport");function _(t,n,r,o){var l,y,C,S,_,w=n;2!==E&&(E=2,c&&e.clearTimeout(c),u=void 0,a=o||"",T.readyState=t>0?4:0,l=t>=200&&300>t||304===t,r&&(S=function(e,t,n){for(var r,o,i,a,c=e.contents,s=e.dataTypes;"*"===s[0];)s.shift(),void 0===o&&(o=e.mimeType||t.getResponseHeader("Content-Type"));if(o)for(a in c)if(c[a]&&c[a].test(o)){s.unshift(a);break}if(s[0]in n)i=s[0];else{for(a in n){if(!s[0]||e.converters[a+" "+s[0]]){i=a;break}r||(r=a)}i=i||r}return i?(i!==s[0]&&s.unshift(i),n[i]):void 0}(d,T,r)),S=function(e,t,n,r){var o,i,a,c,s,u={},l=e.dataTypes.slice();if(l[1])for(a in e.converters)u[a.toLowerCase()]=e.converters[a];for(i=l.shift();i;)if(e.responseFields[i]&&(n[e.responseFields[i]]=t),!s&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),s=i,i=l.shift())if("*"===i)i=s;else if("*"!==s&&s!==i){if(!(a=u[s+" "+i]||u["* "+i]))for(o in u)if((c=o.split(" "))[1]===i&&(a=u[s+" "+c[0]]||u["* "+c[0]])){!0===a?a=u[o]:!0!==u[o]&&(i=c[0],l.unshift(c[1]));break}if(!0!==a)if(a&&e.throws)t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+s+" to "+i}}}return{state:"success",data:t}}(d,S,T,l),l?(d.ifModified&&((_=T.getResponseHeader("Last-Modified"))&&(f.lastModified[i]=_),(_=T.getResponseHeader("etag"))&&(f.etag[i]=_)),204===t||"HEAD"===d.type?w="nocontent":304===t?w="notmodified":(w=S.state,y=S.data,l=!(C=S.error))):(C=w,!t&&w||(w="error",0>t&&(t=0))),T.status=t,T.statusText=(n||w)+"",l?h.resolveWith(p,[y,w,T]):h.rejectWith(p,[T,w,C]),T.statusCode(v),v=void 0,s&&m.trigger(l?"ajaxSuccess":"ajaxError",[T,d,l?y:C]),g.fireWith(p,[T,w]),s&&(m.trigger("ajaxComplete",[T,d]),--f.active||f.event.trigger("ajaxStop")))}return T},getJSON:function(e,t,n){return f.get(e,t,n,"json")},getScript:function(e,t){return f.get(e,void 0,t,"script")}}),f.each(["get","post"],function(e,t){f[t]=function(e,n,r,o){return f.isFunction(n)&&(o=o||r,r=n,n=void 0),f.ajax(f.extend({url:e,type:t,dataType:o,data:n,success:r},f.isPlainObject(e)&&e))}}),f._evalUrl=function(e){return f.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},f.fn.extend({wrapAll:function(e){if(f.isFunction(e))return this.each(function(t){f(this).wrapAll(e.call(this,t))});if(this[0]){var t=f(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return f.isFunction(e)?this.each(function(t){f(this).wrapInner(e.call(this,t))}):this.each(function(){var t=f(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=f.isFunction(e);return this.each(function(n){f(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){f.nodeName(this,"body")||f(this).replaceWith(this.childNodes)}).end()}}),f.expr.filters.hidden=function(e){return d.reliableHiddenOffsets()?e.offsetWidth<=0&&e.offsetHeight<=0&&!e.getClientRects().length:function(e){if(!f.contains(e.ownerDocument||r,e))return!0;for(;e&&1===e.nodeType;){if("none"===Ht(e)||"hidden"===e.type)return!0;e=e.parentNode}return!1}(e)},f.expr.filters.visible=function(e){return!f.expr.filters.hidden(e)};var Wt=/%20/g,qt=/\[\]$/,jt=/\r?\n/g,Yt=/^(?:submit|button|image|reset|file)$/i,Gt=/^(?:input|select|textarea|keygen)/i;function zt(e,t,n,r){var o;if(f.isArray(t))f.each(t,function(t,o){n||qt.test(e)?r(e,o):zt(e+"["+("object"==typeof o&&null!=o?t:"")+"]",o,n,r)});else if(n||"object"!==f.type(t))r(e,t);else for(o in t)zt(e+"["+o+"]",t[o],n,r)}f.param=function(e,t){var n,r=[],o=function(e,t){t=f.isFunction(t)?t():null==t?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(void 0===t&&(t=f.ajaxSettings&&f.ajaxSettings.traditional),f.isArray(e)||e.jquery&&!f.isPlainObject(e))f.each(e,function(){o(this.name,this.value)});else for(n in e)zt(n,e[n],t,o);return r.join("&").replace(Wt,"+")},f.fn.extend({serialize:function(){return f.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=f.prop(this,"elements");return e?f.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!f(this).is(":disabled")&&Gt.test(this.nodeName)&&!Yt.test(e)&&(this.checked||!K.test(e))}).map(function(e,t){var n=f(this).val();return null==n?null:f.isArray(n)?f.map(n,function(e){return{name:t.name,value:e.replace(jt,"\r\n")}}):{name:t.name,value:n.replace(jt,"\r\n")}}).get()}}),f.ajaxSettings.xhr=void 0!==e.ActiveXObject?function(){return this.isLocal?Xt():r.documentMode>8?Qt():/^(get|post|head|put|delete|options)$/i.test(this.type)&&Qt()||Xt()}:Qt;var Kt=0,Zt={},Jt=f.ajaxSettings.xhr();function Qt(){try{return new e.XMLHttpRequest}catch(e){}}function Xt(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}e.attachEvent&&e.attachEvent("onunload",function(){for(var e in Zt)Zt[e](void 0,!0)}),d.cors=!!Jt&&"withCredentials"in Jt,(Jt=d.ajax=!!Jt)&&f.ajaxTransport(function(t){var n;if(!t.crossDomain||d.cors)return{send:function(r,o){var i,a=t.xhr(),c=++Kt;if(a.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(i in t.xhrFields)a[i]=t.xhrFields[i];for(i in t.mimeType&&a.overrideMimeType&&a.overrideMimeType(t.mimeType),t.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest"),r)void 0!==r[i]&&a.setRequestHeader(i,r[i]+"");a.send(t.hasContent&&t.data||null),n=function(e,r){var i,s,u;if(n&&(r||4===a.readyState))if(delete Zt[c],n=void 0,a.onreadystatechange=f.noop,r)4!==a.readyState&&a.abort();else{u={},i=a.status,"string"==typeof a.responseText&&(u.text=a.responseText);try{s=a.statusText}catch(e){s=""}i||!t.isLocal||t.crossDomain?1223===i&&(i=204):i=u.text?200:404}u&&o(i,s,u,a.getAllResponseHeaders())},t.async?4===a.readyState?e.setTimeout(n):a.onreadystatechange=Zt[c]=n:n()},abort:function(){n&&n(void 0,!0)}}}),f.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return f.globalEval(e),e}}}),f.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),f.ajaxTransport("script",function(e){if(e.crossDomain){var t,n=r.head||f("head")[0]||r.documentElement;return{send:function(o,i){(t=r.createElement("script")).async=!0,e.scriptCharset&&(t.charset=e.scriptCharset),t.src=e.url,t.onload=t.onreadystatechange=function(e,n){(n||!t.readyState||/loaded|complete/.test(t.readyState))&&(t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),t=null,n||i(200,"success"))},n.insertBefore(t,n.firstChild)},abort:function(){t&&t.onload(void 0,!0)}}}});var en=[],tn=/(=)\?(?=&|$)|\?\?/;f.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=en.pop()||f.expando+"_"+bt++;return this[e]=!0,e}}),f.ajaxPrefilter("json jsonp",function(t,n,r){var o,i,a,c=!1!==t.jsonp&&(tn.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&tn.test(t.data)&&"data");return c||"jsonp"===t.dataTypes[0]?(o=t.jsonpCallback=f.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,c?t[c]=t[c].replace(tn,"$1"+o):!1!==t.jsonp&&(t.url+=(Pt.test(t.url)?"&":"?")+t.jsonp+"="+o),t.converters["script json"]=function(){return a||f.error(o+" was not called"),a[0]},t.dataTypes[0]="json",i=e[o],e[o]=function(){a=arguments},r.always(function(){void 0===i?f(e).removeProp(o):e[o]=i,t[o]&&(t.jsonpCallback=n.jsonpCallback,en.push(o)),a&&f.isFunction(i)&&i(a[0]),a=i=void 0}),"script"):void 0}),f.parseHTML=function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||r;var o=_.exec(e),i=!n&&[];return o?[t.createElement(o[1])]:(o=ce([e],t,i),i&&i.length&&f(i).remove(),f.merge([],o.childNodes))};var nn=f.fn.load;function rn(e){return f.isWindow(e)?e:9===e.nodeType&&(e.defaultView||e.parentWindow)}f.fn.load=function(e,t,n){if("string"!=typeof e&&nn)return nn.apply(this,arguments);var r,o,i,a=this,c=e.indexOf(" ");return c>-1&&(r=f.trim(e.slice(c,e.length)),e=e.slice(0,c)),f.isFunction(t)?(n=t,t=void 0):t&&"object"==typeof t&&(o="POST"),a.length>0&&f.ajax({url:e,type:o||"GET",dataType:"html",data:t}).done(function(e){i=arguments,a.html(r?f("<div>").append(f.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,i||[e.responseText,t,e])})}),this},f.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){f.fn[t]=function(e){return this.on(t,e)}}),f.expr.filters.animated=function(e){return f.grep(f.timers,function(t){return e===t.elem}).length},f.offset={setOffset:function(e,t,n){var r,o,i,a,c,s,u=f.css(e,"position"),l=f(e),d={};"static"===u&&(e.style.position="relative"),c=l.offset(),i=f.css(e,"top"),s=f.css(e,"left"),("absolute"===u||"fixed"===u)&&f.inArray("auto",[i,s])>-1?(a=(r=l.position()).top,o=r.left):(a=parseFloat(i)||0,o=parseFloat(s)||0),f.isFunction(t)&&(t=t.call(e,n,f.extend({},c))),null!=t.top&&(d.top=t.top-c.top+a),null!=t.left&&(d.left=t.left-c.left+o),"using"in t?t.using.call(e,d):l.css(d)}},f.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){f.offset.setOffset(this,e,t)});var t,n,r={top:0,left:0},o=this[0],i=o&&o.ownerDocument;return i?(t=i.documentElement,f.contains(t,o)?(void 0!==o.getBoundingClientRect&&(r=o.getBoundingClientRect()),n=rn(i),{top:r.top+(n.pageYOffset||t.scrollTop)-(t.clientTop||0),left:r.left+(n.pageXOffset||t.scrollLeft)-(t.clientLeft||0)}):r):void 0},position:function(){if(this[0]){var e,t,n={top:0,left:0},r=this[0];return"fixed"===f.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),f.nodeName(e[0],"html")||(n=e.offset()),n.top+=f.css(e[0],"borderTopWidth",!0),n.left+=f.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-f.css(r,"marginTop",!0),left:t.left-n.left-f.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&!f.nodeName(e,"html")&&"static"===f.css(e,"position");)e=e.offsetParent;return e||Ue})}}),f.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n=/Y/.test(t);f.fn[e]=function(r){return z(this,function(e,r,o){var i=rn(e);return void 0===o?i?t in i?i[t]:i.document.documentElement[r]:e[r]:void(i?i.scrollTo(n?f(i).scrollLeft():o,n?o:f(i).scrollTop()):e[r]=o)},e,r,arguments.length,null)}}),f.each(["top","left"],function(e,t){f.cssHooks[t]=We(d.pixelPosition,function(e,n){return n?(n=Be(e,t),Le.test(n)?f(e).position()[t]+"px":n):void 0})}),f.each({Height:"height",Width:"width"},function(e,t){f.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){f.fn[r]=function(r,o){var i=arguments.length&&(n||"boolean"!=typeof r),a=n||(!0===r||!0===o?"margin":"border");return z(this,function(t,n,r){var o;return f.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(o=t.documentElement,Math.max(t.body["scroll"+e],o["scroll"+e],t.body["offset"+e],o["offset"+e],o["client"+e])):void 0===r?f.css(t,n,a):f.style(t,n,r,a)},t,i?r:void 0,i,null)}})}),f.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}}),f.fn.size=function(){return this.length},f.fn.andSelf=f.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return f});var on=e.jQuery,an=e.$;return f.noConflict=function(t){return e.$===f&&(e.$=an),t&&e.jQuery===f&&(e.jQuery=on),f},t||(e.jQuery=e.$=f),f}),void 0===jQuery.migrateMute&&(jQuery.migrateMute=!0),function(e,t,n){function r(n){var r=t.console;i[n]||(i[n]=!0,e.migrateWarnings.push(n),r&&r.warn&&!e.migrateMute&&(r.warn("JQMIGRATE: "+n),e.migrateTrace&&r.trace&&r.trace()))}function o(t,n,o,i){if(Object.defineProperty)try{return void Object.defineProperty(t,n,{configurable:!0,enumerable:!0,get:function(){return r(i),o},set:function(e){r(i),o=e}})}catch(e){}e._definePropertyBroken=!0,t[n]=o}e.migrateVersion="1.4.1";var i={};e.migrateWarnings=[],e.migrateTrace===n&&(e.migrateTrace=!0),e.migrateReset=function(){i={},e.migrateWarnings.length=0},"BackCompat"===document.compatMode&&r("jQuery is not compatible with Quirks Mode");var a=e("<input/>",{size:1}).attr("size")&&e.attrFn,c=e.attr,s=e.attrHooks.value&&e.attrHooks.value.get||function(){return null},u=e.attrHooks.value&&e.attrHooks.value.set||function(){return n},l=/^(?:input|button)$/i,d=/^[238]$/,p=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,f=/^(?:checked|selected)$/i;o(e,"attrFn",a||{},"jQuery.attrFn is deprecated"),e.attr=function(t,o,i,s){var u=o.toLowerCase(),m=t&&t.nodeType;return s&&(c.length<4&&r("jQuery.fn.attr( props, pass ) is deprecated"),t&&!d.test(m)&&(a?o in a:e.isFunction(e.fn[o])))?e(t)[o](i):("type"===o&&i!==n&&l.test(t.nodeName)&&t.parentNode&&r("Can't change the 'type' of an input or button in IE 6/7/8"),!e.attrHooks[u]&&p.test(u)&&(e.attrHooks[u]={get:function(t,r){var o,i=e.prop(t,r);return!0===i||"boolean"!=typeof i&&(o=t.getAttributeNode(r))&&!1!==o.nodeValue?r.toLowerCase():n},set:function(t,n,r){var o;return!1===n?e.removeAttr(t,r):((o=e.propFix[r]||r)in t&&(t[o]=!0),t.setAttribute(r,r.toLowerCase())),r}},f.test(u)&&r("jQuery.fn.attr('"+u+"') might use property instead of attribute")),c.call(e,t,o,i))},e.attrHooks.value={get:function(e,t){var n=(e.nodeName||"").toLowerCase();return"button"===n?s.apply(this,arguments):("input"!==n&&"option"!==n&&r("jQuery.fn.attr('value') no longer gets properties"),t in e?e.value:null)},set:function(e,t){var n=(e.nodeName||"").toLowerCase();return"button"===n?u.apply(this,arguments):("input"!==n&&"option"!==n&&r("jQuery.fn.attr('value', val) no longer sets properties"),void(e.value=t))}};var m,h,g,v=e.fn.init,y=e.find,C=e.parseJSON,E=/^\s*</,S=/\[(\s*[-\w]+\s*)([~|^$*]?=)\s*([-\w#]*?#[-\w#]*)\s*\]/,T=/\[(\s*[-\w]+\s*)([~|^$*]?=)\s*([-\w#]*?#[-\w#]*)\s*\]/g,_=/^([^<]*)(<[\w\W]+>)([^>]*)$/;for(g in e.fn.init=function(t,o,i){var a,c;return t&&"string"==typeof t&&!e.isPlainObject(o)&&(a=_.exec(e.trim(t)))&&a[0]&&(E.test(t)||r("$(html) HTML strings must start with '<' character"),a[3]&&r("$(html) HTML text after last tag is ignored"),"#"===a[0].charAt(0)&&(r("HTML string cannot start with a '#' character"),e.error("JQMIGRATE: Invalid selector string (XSS)")),o&&o.context&&o.context.nodeType&&(o=o.context),e.parseHTML)?v.call(this,e.parseHTML(a[2],o&&o.ownerDocument||o||document,!0),o,i):(c=v.apply(this,arguments),t&&t.selector!==n?(c.selector=t.selector,c.context=t.context):(c.selector="string"==typeof t?t:"",t&&(c.context=t.nodeType?t:o||document)),c)},e.fn.init.prototype=e.fn,e.find=function(e){var t=Array.prototype.slice.call(arguments);if("string"==typeof e&&S.test(e))try{document.querySelector(e)}catch(n){e=e.replace(T,function(e,t,n,r){return"["+t+n+'"'+r+'"]'});try{document.querySelector(e),r("Attribute selector with '#' must be quoted: "+t[0]),t[0]=e}catch(e){r("Attribute selector with '#' was not fixed: "+t[0])}}return y.apply(this,t)},y)Object.prototype.hasOwnProperty.call(y,g)&&(e.find[g]=y[g]);e.parseJSON=function(e){return e?C.apply(this,arguments):(r("jQuery.parseJSON requires a valid JSON string"),null)},e.uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},e.browser||(h={},(m=e.uaMatch(navigator.userAgent)).browser&&(h[m.browser]=!0,h.version=m.version),h.chrome?h.webkit=!0:h.webkit&&(h.safari=!0),e.browser=h),o(e,"browser",e.browser,"jQuery.browser is deprecated"),e.boxModel=e.support.boxModel="CSS1Compat"===document.compatMode,o(e,"boxModel",e.boxModel,"jQuery.boxModel is deprecated"),o(e.support,"boxModel",e.support.boxModel,"jQuery.support.boxModel is deprecated"),e.sub=function(){function t(e,n){return new t.fn.init(e,n)}e.extend(!0,t,this),t.superclass=this,t.fn=t.prototype=this(),t.fn.constructor=t,t.sub=this.sub,t.fn.init=function(r,o){var i=e.fn.init.call(this,r,o,n);return i instanceof t?i:t(i)},t.fn.init.prototype=t.fn;var n=t(document);return r("jQuery.sub() is deprecated"),t},e.fn.size=function(){return r("jQuery.fn.size() is deprecated; use the .length property"),this.length};var w=!1;e.swap&&e.each(["height","width","reliableMarginRight"],function(t,n){var r=e.cssHooks[n]&&e.cssHooks[n].get;r&&(e.cssHooks[n].get=function(){var e;return w=!0,e=r.apply(this,arguments),w=!1,e})}),e.swap=function(e,t,n,o){var i,a,c={};for(a in w||r("jQuery.swap() is undocumented and deprecated"),t)c[a]=e.style[a],e.style[a]=t[a];for(a in i=n.apply(e,o||[]),t)e.style[a]=c[a];return i},e.ajaxSetup({converters:{"text json":e.parseJSON}});var b=e.fn.data;e.fn.data=function(t){var o,i,a=this[0];return!a||"events"!==t||1!==arguments.length||(o=e.data(a,t),i=e._data(a,t),o!==n&&o!==i||i===n)?b.apply(this,arguments):(r("Use of jQuery.fn.data('events') is deprecated"),i)};var P=/\/(java|ecma)script/i;e.clean||(e.clean=function(t,n,o,i){n=(n=!(n=n||document).nodeType&&n[0]||n).ownerDocument||n,r("jQuery.clean() is deprecated");var a,c,s,u,l=[];if(e.merge(l,e.buildFragment(t,n).childNodes),o)for(s=function(e){return!e.type||P.test(e.type)?i?i.push(e.parentNode?e.parentNode.removeChild(e):e):o.appendChild(e):void 0},a=0;null!=(c=l[a]);a++)e.nodeName(c,"script")&&s(c)||(o.appendChild(c),void 0!==c.getElementsByTagName&&(u=e.grep(e.merge([],c.getElementsByTagName("script")),s),l.splice.apply(l,[a+1,0].concat(u)),a+=u.length));return l});var A=e.event.add,$=e.event.remove,I=e.event.trigger,k=e.fn.toggle,N=e.fn.live,x=e.fn.die,D=e.fn.load,M="ajaxStart|ajaxStop|ajaxSend|ajaxComplete|ajaxError|ajaxSuccess",O=new RegExp("\\b(?:"+M+")\\b"),R=/(?:^|\s)hover(\.\S+|)\b/,L=function(t){return"string"!=typeof t||e.event.special.hover?t:(R.test(t)&&r("'hover' pseudo-event is deprecated, use 'mouseenter mouseleave'"),t&&t.replace(R,"mouseenter$1 mouseleave$1"))};e.event.props&&"attrChange"!==e.event.props[0]&&e.event.props.unshift("attrChange","attrName","relatedNode","srcElement"),e.event.dispatch&&o(e.event,"handle",e.event.dispatch,"jQuery.event.handle is undocumented and deprecated"),e.event.add=function(e,t,n,o,i){e!==document&&O.test(t)&&r("AJAX events should be attached to document: "+t),A.call(this,e,L(t||""),n,o,i)},e.event.remove=function(e,t,n,r,o){$.call(this,e,L(t)||"",n,r,o)},e.each(["load","unload","error"],function(t,n){e.fn[n]=function(){var e=Array.prototype.slice.call(arguments,0);return"load"===n&&"string"==typeof e[0]?D.apply(this,e):(r("jQuery.fn."+n+"() is deprecated"),e.splice(0,0,n),arguments.length?this.bind.apply(this,e):(this.triggerHandler.apply(this,e),this))}}),e.fn.toggle=function(t,n){if(!e.isFunction(t)||!e.isFunction(n))return k.apply(this,arguments);r("jQuery.fn.toggle(handler, handler...) is deprecated");var o=arguments,i=t.guid||e.guid++,a=0,c=function(n){var r=(e._data(this,"lastToggle"+t.guid)||0)%a;return e._data(this,"lastToggle"+t.guid,r+1),n.preventDefault(),o[r].apply(this,arguments)||!1};for(c.guid=i;a<o.length;)o[a++].guid=i;return this.click(c)},e.fn.live=function(t,n,o){return r("jQuery.fn.live() is deprecated"),N?N.apply(this,arguments):(e(this.context).on(t,this.selector,n,o),this)},e.fn.die=function(t,n){return r("jQuery.fn.die() is deprecated"),x?x.apply(this,arguments):(e(this.context).off(t,this.selector||"**",n),this)},e.event.trigger=function(e,t,n,o){return n||O.test(e)||r("Global events are undocumented and deprecated"),I.call(this,e,t,n||document,o)},e.each(M.split("|"),function(t,n){e.event.special[n]={setup:function(){var t=this;return t!==document&&(e.event.add(document,n+"."+e.guid,function(){e.event.trigger(n,Array.prototype.slice.call(arguments,1),t,!0)}),e._data(this,n,e.guid++)),!1},teardown:function(){return this!==document&&e.event.remove(document,n+"."+e._data(this,n)),!1}}}),e.event.special.ready={setup:function(){this===document&&r("'ready' event is deprecated")}};var V=e.fn.andSelf||e.fn.addBack,U=e.fn.find;if(e.fn.andSelf=function(){return r("jQuery.fn.andSelf() replaced by jQuery.fn.addBack()"),V.apply(this,arguments)},e.fn.find=function(e){var t=U.apply(this,arguments);return t.context=this.context,t.selector=this.selector?this.selector+" "+e:e,t},e.Callbacks){var F=e.Deferred,B=[["resolve","done",e.Callbacks("once memory"),e.Callbacks("once memory"),"resolved"],["reject","fail",e.Callbacks("once memory"),e.Callbacks("once memory"),"rejected"],["notify","progress",e.Callbacks("memory"),e.Callbacks("memory")]];e.Deferred=function(t){var n=F(),o=n.promise();return n.pipe=o.pipe=function(){var t=arguments;return r("deferred.pipe() is deprecated"),e.Deferred(function(r){e.each(B,function(i,a){var c=e.isFunction(t[i])&&t[i];n[a[1]](function(){var t=c&&c.apply(this,arguments);t&&e.isFunction(t.promise)?t.promise().done(r.resolve).fail(r.reject).progress(r.notify):r[a[0]+"With"](this===o?r.promise():this,c?[t]:arguments)})}),t=null}).promise()},n.isResolved=function(){return r("deferred.isResolved is deprecated"),"resolved"===n.state()},n.isRejected=function(){return r("deferred.isRejected is deprecated"),"rejected"===n.state()},t&&t.call(n,n),n}}}(jQuery,window),function(e){var t,n,r,o,i=1,a=this,c="postMessage",s="addEventListener",u=a[c]&&!e.browser.opera;e[c]=function(t,n,r){n&&(t="string"==typeof t?t:e.param(t),r=r||parent,u?r[c](t,n.replace(/([^:]+:\/\/[^\/]+).*/,"$1")):n&&(r.location=n.replace(/#.*$/,"")+"#"+ +new Date+i+++"&"+t))},e.receiveMessage=o=function(i,c,l){u?(i&&(r&&o(),r=function(t){if("string"==typeof c&&t.origin!==c||e.isFunction(c)&&!1===c(t.origin))return!1;i(t)}),a[s]?a[i?s:"removeEventListener"]("message",r,!1):a[i?"attachEvent":"detachEvent"]("onmessage",r)):(t&&clearInterval(t),t=null,i&&(l="number"==typeof c?c:"number"==typeof l?l:100,t=setInterval(function(){var e=document.location.hash,t=/^#?\d+&/;e!==n&&t.test(e)&&(n=e,i({data:e.replace(t,"")}))},l)))}}(jQuery),function(e){var t,n;void 0===e.tinypass&&(e.tinypass={}),tinypass.uploadFile2=function(e,t){},tinypass.setMessageDashboard=function(e,t){return"error"===e?tinypass.__setErrorMessageDashboard(t):tinypass.__setMessage(e,t)},tinypass.__buildAlertPopupDashboard=function(e,t){if(t){var n=$('<div class="notification error"><span class="message">'+t+'</span><button type="button" class="close close-alert-dashboard">&times;</button></div>');$(document.body).append(n),n.css("marginLeft",-n.outerWidth()/2),n.addClass("in"),$(".close-alert-dashboard").unbind("click").click(function(){$(this).parent().remove(),tinypass.__buildAlertPopupDashboard()})}for(var r=$(".notification"),o=0,i=0;i<r.length;i++)$(r[i]),0!==i?$(r[i]).css({top:90+o+"px"}):$(r[i]).css({top:"90px"}),o+=$(r[i]).outerHeight()+10},tinypass.__setErrorMessageDashboard=function(e){if($(".modal-body").is(":visible"))$(".modal-body  .alert").remove(),$(".modal-body").prepend(tinypass.__buildAlertPopup("error",e));else if($("#popup").is(":visible"))$("#popup #popup-content .alert").remove(),$("#popup #popup-content").prepend(tinypass.__buildAlertPopup("error",e));else if($(".modal .modal-body").length>0){for(var t=$(".modal .modal-body"),n=!1,r=0;r<t.length;r++){var o=t[r];$(o).is(":visible")&&($(".alert",o).remove(),$(o).prepend($('<div class="row"></div>').append(tinypass.__buildAlertPopup("error",e))),n=!0)}n||($(".container .main").length>0?tinypass.__buildAlertPopupDashboard("error",e):tinypass.__setMessage("error",e))}else if($(".container .main").length>0)tinypass.__buildAlertPopupDashboard("error",e);else if($("#payscreen #alert").length>0){$("#payscreen #alert").html(e)}else tinypass.__setMessage("error",e)},tinypass.setMessage=function(e,t){return"error"===e?tinypass.__setErrorMessage(t):tinypass.__setMessage(e,t)},tinypass.hideMessage=function(){$(".alert-top").remove(),$(".tinypass-alert-messase").remove(),$(".notification.error").remove()},tinypass.__buildAlertPopup=function(e,t){return $('<div class="alert alert-block alert-'+e+' tinypass-alert-messase"></div>').append('<button type="button" class="close" data-dismiss="alert">&times;</button>').append(t)},tinypass.__setErrorMessage=function(e){if($(".modal-body").is(":visible"))$(".modal-body  .alert").remove(),$(".modal-body").prepend(tinypass.__buildAlertPopup("error",e));else if($("#popup").is(":visible"))$("#popup #popup-content .alert").remove(),$("#popup #popup-content").prepend(tinypass.__buildAlertPopup("error",e));else if($(".modal .modal-body").length>0){for(var t=$(".modal .modal-body"),n=!1,r=0;r<t.length;r++){var o=t[r];$(o).is(":visible")&&($(".alert",o).remove(),$(o).prepend($('<div class="row"></div>').append(tinypass.__buildAlertPopup("error",e))),n=!0)}n||($(".container .main").length>0?($(".container .main .alert").remove(),$(".container .main").prepend($('<div class="row"></div>').append(tinypass.__buildAlertPopup("error",e)))):tinypass.__setMessage("error",e))}else if($(".container .main").length>0)$(".container .main .alert").remove(),$(".container .main").prepend($('<div class="row"></div>').append(tinypass.__buildAlertPopup("error",e))),setTimeout(function(){$(".container .main .alert").fadeOut(2e3)},1e3);else if($("#payscreen #alert").length>0){$("#payscreen #alert").html(e)}else tinypass.__setMessage("error",e)},tinypass.__setMessage=function(e,t,n){var r=$('<div class="notification"><i class="icon-check-white status"></i><span class="message">'+t+"</span></div>");$(document.body).append(r),r.css("marginLeft",-r.outerWidth()/2),r.addClass("in"),setTimeout(function(){r.removeClass("in")},1600),setTimeout(function(){r.remove()},3200)},tinypass.setOpacity=function(e,t){$(e).css("filter","alpha(opacity="+100*t+")").css("-khtml-opacity",t).css("-moz-opacity",t).css("opacity",t)},tinypass.showWaitPanel=function(e){if(e||(e={}),tinypass.hideWaitPanel(),$("body").append($('<div id="waitPanel">'+(e.title?e.title:"Loading...")+"</div>").css("display","block")),e.modal){var t=$('<div id="tinypassModalWindow"/>');t.css("position","fixed").css("left","0").css("top","0").css("width","100%").css("height","100%").css("z-index","1000"),e.opacity?tinypass.setOpacity(t.css("background-color",e.background?e.background:"white"),e.opacity):t.css("background-color","transparent"),$("body").append(t)}},tinypass.hideWaitPanel=function(){$("#waitPanel").remove(),$("#tinypassModalWindow").remove()},tinypass.__buildPopup=function(){return $('<div id="popup" class="modal hide fade" tabindex="-1" role="dialog" aria-hidden="true" style="display: none;"><div id="popup-title" class="modal-header"></div><div id="popup-content" class="modal-body"></div><div id="popup-controls" class="modal-footer"></div></div>')},tinypass.updateMetaRefresh=function(e){e&&(n=e),n&&!isNaN(n)&&(clearTimeout(t),t=setTimeout("window.location.reload()",n))},tinypass.__initNewlyAddedContent=function(e){tinypass.__initToolTips(e)},$(document).ready(function(){var e=$("body");e.append(tinypass.__buildPopup()),e.ajaxStart(function(){tinypass.updateMetaRefresh(),tinypass.showWaitPanel()}),e.ajaxStop(function(){tinypass.hideWaitPanel()}),$("table.row-alternate").each(function(){$(this).find("tr:even").find("td").toggleClass("line-item-alt",!0),$(this).find("tr:odd").find("td").toggleClass("line-item-alt2",!0)}),tinypass.__initNewlyAddedContent(e),function(e){var t=new Array;e.Watermark={ShowAll:function(){for(var e=0;e<t.length;e++)""===t[e].obj.val()?(t[e].obj.val(t[e].text),t[e].obj.toggleClass("watermark",!0)):t[e].obj.toggleClass("watermark",!1)},HideAll:function(){for(var e=0;e<t.length;e++)t[e].obj.val()===t[e].text&&t[e].obj.val("")}},e.fn.Watermark=function(n){return this.each(function(){var r=e(this);function o(){0===r.val().length&&r.toggleClass("watermark",!0).val(n)}t[t.length]={text:n,obj:r},r.focus(function(){r.hasClass("watermark")&&r.toggleClass("watermark",!1).val("")}),r.blur(o),o()})}}(jQuery)}),tinypass.__initToolTips=function(e){$(e).find('*[data-toggle="tooltip"]').each(function(){var e=$(this);e.attr("title")||e.attr("title",e.html()),e.tooltip({html:!0})})},tinypass.hasFlash=function(){try{return ZeroClipboard.detectFlashSupport()}catch(e){}return!1},tinypass.copyToClipboard=function(e,t){var n,r,o;try{if(!tinypass.hasFlash())return null;for(var i in r=$(e),(o={}).moviePath="/js/ZeroClipboard.swf",t)o[i]=t[i];return(n=new ZeroClipboard(r,o)).glue(r),n}catch(e){}},tinypass.initImageCropper=function(e,t,n,r){},tinypass.cropImage=function(e,t,n,r,o,i,a,c,s,u){},tinypass.stripSpaces=function(e){return null==e?e:e.replace(/\s+/g,"")},tinypass.ccLuhnCheck=function(e){if(!e.match(/^\d+$/))return!1;for(var t=e.length,n=1&t,r=0,o=0;o<t;o++){var i=parseInt(e.charAt(o));1&o^n||(i*=2)>9&&(i-=9),r+=i}return r%10==0},tinypass.convertCurrencyAndFormat=function(e,t){try{if(!e||e.match(/.*[^0-9.].*/))return"?.??";if(!t||t.match(/.*[^0-9.].*/))return"?.??";var n=parseFloat(e)/parseFloat(t);return 0===n||isNaN(n)?"?.??":n=(Math.ceil(Math.round(1e4*n)/100)/100).toFixed(2).replace(/[.]00$/,"")}catch(e){return"?.??"}};try{$(document).ready(function(){$(e).on("resize",function(){$("#left-nav").find("#left-nav-panel").height($(e).height()-121)}),$(e).trigger("resize")})}catch(e){}}(window),function(e,t,n){"use strict";function r(e){return function(){var t,n=arguments[0];n="["+(e?e+":":"")+n+"] http://errors.angularjs.org/1.2.22/"+(e?e+"/":"")+n;for(t=1;t<arguments.length;t++)n=n+(1==t?"?":"&")+"p"+(t-1)+"="+encodeURIComponent("function"==typeof arguments[t]?arguments[t].toString().replace(/ \{[\s\S]*$/,""):void 0===arguments[t]?"undefined":"string"!=typeof arguments[t]?JSON.stringify(arguments[t]):arguments[t]);return Error(n)}}function o(e){if(null==e||w(e))return!1;var t=e.length;return!(1!==e.nodeType||!t)||(C(e)||Gt(e)||0===t||"number"==typeof t&&0<t&&t-1 in e)}function i(e,t,n){var r;if(e)if(T(e))for(r in e)"prototype"==r||"length"==r||"name"==r||e.hasOwnProperty&&!e.hasOwnProperty(r)||t.call(n,e[r],r);else if(Gt(e)||o(e))for(r=0;r<e.length;r++)t.call(n,e[r],r);else if(e.forEach&&e.forEach!==i)e.forEach(t,n);else for(r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r);return e}function a(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&n.push(t);return n.sort()}function c(e){return function(t,n){e(n,t)}}function s(){for(var e,t=Yt.length;t;){if(57==(e=Yt[--t].charCodeAt(0)))return Yt[t]="A",Yt.join("");if(90!=e)return Yt[t]=String.fromCharCode(e+1),Yt.join("");Yt[t]="0"}return Yt.unshift("0"),Yt.join("")}function u(e,t){t?e.$$hashKey=t:delete e.$$hashKey}function l(e){var t=e.$$hashKey;return i(arguments,function(t){t!==e&&i(t,function(t,n){e[n]=t})}),u(e,t),e}function d(e){return parseInt(e,10)}function p(e,t){return l(new(l(function(){},{prototype:e})),t)}function f(){}function m(e){return e}function h(e){return function(){return e}}function g(e){return void 0===e}function v(e){return void 0!==e}function y(e){return null!=e&&"object"==typeof e}function C(e){return"string"==typeof e}function E(e){return"number"==typeof e}function S(e){return"[object Date]"===Wt.call(e)}function T(e){return"function"==typeof e}function _(e){return"[object RegExp]"===Wt.call(e)}function w(e){return e&&e.document&&e.location&&e.alert&&e.setInterval}function b(e){return!(!e||!(e.nodeName||e.prop&&e.attr&&e.find))}function P(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0;n<e.length;n++)if(t===e[n])return n;return-1}function A(e,t){var n=P(e,t);return 0<=n&&e.splice(n,1),t}function $(e,t,n,r){if(w(e)||e&&e.$evalAsync&&e.$watch)throw qt("cpws");if(t){if(e===t)throw qt("cpi");if(n=n||[],r=r||[],y(e)){var o=P(n,e);if(-1!==o)return r[o];n.push(e),r.push(t)}if(Gt(e))for(var a=t.length=0;a<e.length;a++)o=$(e[a],null,n,r),y(e[a])&&(n.push(e[a]),r.push(o)),t.push(o);else{var c=t.$$hashKey;for(a in i(t,function(e,n){delete t[n]}),e)o=$(e[a],null,n,r),y(e[a])&&(n.push(e[a]),r.push(o)),t[a]=o;u(t,c)}}else(t=e)&&(Gt(e)?t=$(e,[],n,r):S(e)?t=new Date(e.getTime()):_(e)?(t=RegExp(e.source,e.toString().match(/[^\/]*$/)[0])).lastIndex=e.lastIndex:y(e)&&(t=$(e,{},n,r)));return t}function I(e,t){if(Gt(e)){t=t||[];for(var n=0;n<e.length;n++)t[n]=e[n]}else if(y(e))for(n in t=t||{},e)!Ut.call(e,n)||"$"===n.charAt(0)&&"$"===n.charAt(1)||(t[n]=e[n]);return t||e}function k(e,t){if(e===t)return!0;if(null===e||null===t)return!1;if(e!=e&&t!=t)return!0;var r,o=typeof e;if(o==typeof t&&"object"==o){if(!Gt(e)){if(S(e))return S(t)&&e.getTime()==t.getTime();if(_(e)&&_(t))return e.toString()==t.toString();if(e&&e.$evalAsync&&e.$watch||t&&t.$evalAsync&&t.$watch||w(e)||w(t)||Gt(t))return!1;for(r in o={},e)if("$"!==r.charAt(0)&&!T(e[r])){if(!k(e[r],t[r]))return!1;o[r]=!0}for(r in t)if(!o.hasOwnProperty(r)&&"$"!==r.charAt(0)&&t[r]!==n&&!T(t[r]))return!1;return!0}if(!Gt(t))return!1;if((o=e.length)==t.length){for(r=0;r<o;r++)if(!k(e[r],t[r]))return!1;return!0}}return!1}function N(e,t){var n=2<arguments.length?Bt.call(arguments,2):[];return!T(t)||t instanceof RegExp?t:n.length?function(){return arguments.length?t.apply(e,n.concat(Bt.call(arguments,0))):t.apply(e,n)}:function(){return arguments.length?t.apply(e,arguments):t.call(e)}}function x(e,r){var o=r;return"string"==typeof e&&"$"===e.charAt(0)?o=n:w(r)?o="$WINDOW":r&&t===r?o="$DOCUMENT":r&&r.$evalAsync&&r.$watch&&(o="$SCOPE"),o}function D(e,t){return void 0===e?n:JSON.stringify(e,x,t?"  ":null)}function M(e){return C(e)?JSON.parse(e):e}function O(e){return"function"==typeof e?e=!0:e&&0!==e.length?e=!("f"==(e=Vt(""+e))||"0"==e||"false"==e||"no"==e||"n"==e||"[]"==e):e=!1,e}function R(e){e=Dt(e).clone();try{e.empty()}catch(e){}var t=Dt("<div>").append(e).html();try{return 3===e[0].nodeType?Vt(t):t.match(/^(<[^>]+>)/)[1].replace(/^<([\w\-]+)/,function(e,t){return"<"+Vt(t)})}catch(e){return Vt(t)}}function L(e){try{return decodeURIComponent(e)}catch(e){}}function V(e){var t,n,r={};return i((e||"").split("&"),function(e){e&&(t=e.replace(/\+/g,"%20").split("="),v(n=L(t[0]))&&(e=!v(t[1])||L(t[1]),Ut.call(r,n)?Gt(r[n])?r[n].push(e):r[n]=[r[n],e]:r[n]=e))}),r}function U(e){var t=[];return i(e,function(e,n){Gt(e)?i(e,function(e){t.push(B(n,!0)+(!0===e?"":"="+B(e,!0)))}):t.push(B(n,!0)+(!0===e?"":"="+B(e,!0)))}),t.length?t.join("&"):""}function F(e){return B(e,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function B(e,t){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,t?"%20":"+")}function H(n,r){var o=function(){if((n=Dt(n)).injector()){var e=n[0]===t?"document":R(n);throw qt("btstrpd",e)}return(r=r||[]).unshift(["$provide",function(e){e.value("$rootElement",n)}]),r.unshift("ng"),(e=he(r)).invoke(["$rootScope","$rootElement","$compile","$injector","$animate",function(e,t,n,r,o){e.$apply(function(){t.data("$injector",r),n(t)(e)})}]),e},a=/^NG_DEFER_BOOTSTRAP!/;if(e&&!a.test(e.name))return o();e.name=e.name.replace(a,""),jt.resumeBootstrap=function(e){i(e,function(e){r.push(e)}),o()}}function W(e,t){return t=t||"_",e.replace(Zt,function(e,n){return(n?t:"")+e.toLowerCase()})}function q(e,t,n){if(!e)throw qt("areq",t||"?",n||"required");return e}function j(e,t,n){return n&&Gt(e)&&(e=e[e.length-1]),q(T(e),t,"not a function, got "+(e&&"object"==typeof e?e.constructor.name||"Object":typeof e)),e}function Y(e,t){if("hasOwnProperty"===e)throw qt("badname",t)}function G(e,t,n){if(!t)return e;for(var r,o=e,i=(t=t.split(".")).length,a=0;a<i;a++)r=t[a],e&&(e=(o=e)[r]);return!n&&T(e)?N(o,e):e}function z(e){var t=e[0];if(t===(e=e[e.length-1]))return Dt(t);var n=[t];do{if(!(t=t.nextSibling))break;n.push(t)}while(t!==e);return Dt(n)}function K(e){return e.replace(nn,function(e,t,n,r){return r?n.toUpperCase():n}).replace(rn,"Moz$1")}function Z(e,t,n,r){function o(e){var o,a,c,s,u,l,d=n&&e?[this.filter(e)]:[this],p=t;if(!r||null!=e)for(;d.length;)for(a=0,c=(o=d.shift()).length;a<c;a++)for(s=Dt(o[a]),p?s.triggerHandler("$destroy"):p=!p,u=0,s=(l=s.children()).length;u<s;u++)d.push(Mt(l[u]));return i.apply(this,arguments)}var i=(i=Mt.fn[e]).$original||i;o.$original=i,Mt.fn[e]=o}function J(e){if(e instanceof J)return e;if(C(e)&&(e=zt(e)),!(this instanceof J)){if(C(e)&&"<"!=e.charAt(0))throw on("nosel");return new J(e)}if(C(e)){var n,r=e;if(e=t,n=an.exec(r))e=[e.createElement(n[1])];else{var o,i=e;if(e=i.createDocumentFragment(),n=[],cn.test(r)){for(i=e.appendChild(i.createElement("div")),o=(sn.exec(r)||["",""])[1].toLowerCase(),o=ln[o]||ln._default,i.innerHTML="<div>&#160;</div>"+o[1]+r.replace(un,"<$1></$2>")+o[2],i.removeChild(i.firstChild),r=o[0];r--;)i=i.lastChild;for(r=0,o=i.childNodes.length;r<o;++r)n.push(i.childNodes[r]);(i=e.firstChild).textContent=""}else n.push(i.createTextNode(r));e.textContent="",e.innerHTML="",e=n}ce(this,e),Dt(t.createDocumentFragment()).append(this)}else ce(this,e)}function Q(e){return e.cloneNode(!0)}function X(e){te(e);var t=0;for(e=e.childNodes||[];t<e.length;t++)X(e[t])}function ee(e,t,n,r){if(v(r))throw on("offargs");var o=ne(e,"events");ne(e,"handle")&&(g(t)?i(o,function(t,n){tn(e,n,t),delete o[n]}):i(t.split(" "),function(t){g(n)?(tn(e,t,o[t]),delete o[t]):A(o[t]||[],n)}))}function te(e,t){var r=e.ng339,o=Qt[r];o&&(t?delete Qt[r].data[t]:(o.handle&&(o.events.$destroy&&o.handle({},"$destroy"),ee(e)),delete Qt[r],e.ng339=n))}function ne(e,t,n){var r=e.ng339;r=Qt[r||-1];if(!v(n))return r&&r[t];r||(e.ng339=r=++Xt,r=Qt[r]={}),r[t]=n}function re(e,t,n){var r=ne(e,"data"),o=v(n),i=!o&&v(t),a=i&&!y(t);if(r||a||ne(e,"data",r={}),o)r[t]=n;else{if(!i)return r;if(a)return r&&r[t];l(r,t)}}function oe(e,t){return!!e.getAttribute&&-1<(" "+(e.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").indexOf(" "+t+" ")}function ie(e,t){t&&e.setAttribute&&i(t.split(" "),function(t){e.setAttribute("class",zt((" "+(e.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").replace(" "+zt(t)+" "," ")))})}function ae(e,t){if(t&&e.setAttribute){var n=(" "+(e.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ");i(t.split(" "),function(e){e=zt(e),-1===n.indexOf(" "+e+" ")&&(n+=e+" ")}),e.setAttribute("class",zt(n))}}function ce(e,t){if(t){t=t.nodeName||!v(t.length)||w(t)?[t]:t;for(var n=0;n<t.length;n++)e.push(t[n])}}function se(e,t){return ue(e,"$"+(t||"ngController")+"Controller")}function ue(e,t,r){for(9==e.nodeType&&(e=e.documentElement),t=Gt(t)?t:[t];e;){for(var o=0,i=t.length;o<i;o++)if((r=Dt.data(e,t[o]))!==n)return r;e=e.parentNode||11===e.nodeType&&e.host}}function le(e){for(var t=0,n=e.childNodes;t<n.length;t++)X(n[t]);for(;e.firstChild;)e.removeChild(e.firstChild)}function de(e,t){var n=pn[t.toLowerCase()];return n&&fn[e.nodeName]&&n}function pe(e,t){var r,o=typeof e;return"function"==o||"object"==o&&null!==e?"function"==typeof(r=e.$$hashKey)?r=e.$$hashKey():r===n&&(r=e.$$hashKey=(t||s)()):r=e,o+":"+r}function fe(e,t){if(t){var n=0;this.nextUid=function(){return++n}}i(e,this.put,this)}function me(e){var t,n;return"function"==typeof e?(t=e.$inject)||(t=[],e.length&&i((n=(n=e.toString().replace(vn,"")).match(mn))[1].split(hn),function(e){e.replace(gn,function(e,n,r){t.push(r)})}),e.$inject=t):Gt(e)?(j(e[n=e.length-1],"fn"),t=e.slice(0,n)):j(e,"fn",!0),t}function he(e){function t(e){return function(t,n){if(!y(t))return e(t,n);i(t,c(e))}}function n(e,t){if(Y(e,"service"),(T(t)||Gt(t))&&(t=p.instantiate(t)),!t.$get)throw yn("pget",e);return d[e+s]=t}function r(e,t){return n(e,{$get:t})}function o(e,t){function n(n){if(e.hasOwnProperty(n)){if(e[n]===a)throw yn("cdep",n+" <- "+u.join(" <- "));return e[n]}try{return u.unshift(n),e[n]=a,e[n]=t(n)}catch(t){throw e[n]===a&&delete e[n],t}finally{u.shift()}}function r(e,t,r){var o,i,a,c=[],s=me(e);for(i=0,o=s.length;i<o;i++){if("string"!=typeof(a=s[i]))throw yn("itkn",a);c.push(r&&r.hasOwnProperty(a)?r[a]:n(a))}return Gt(e)&&(e=e[o]),e.apply(t,c)}return{invoke:r,instantiate:function(e,t){var n,o=function(){};return o.prototype=(Gt(e)?e[e.length-1]:e).prototype,y(n=r(e,o=new o,t))||T(n)?n:o},get:n,annotate:me,has:function(t){return d.hasOwnProperty(t+s)||e.hasOwnProperty(t)}}}var a={},s="Provider",u=[],l=new fe([],!0),d={$provide:{provider:t(n),factory:t(r),service:t(function(e,t){return r(e,["$injector",function(e){return e.instantiate(t)}])}),value:t(function(e,t){return r(e,h(t))}),constant:t(function(e,t){Y(e,"constant"),d[e]=t,m[e]=t}),decorator:function(e,t){var n=p.get(e+s),r=n.$get;n.$get=function(){var e=g.invoke(r,n);return g.invoke(t,null,{$delegate:e})}}}},p=d.$injector=o(d,function(){throw yn("unpr",u.join(" <- "))}),m={},g=m.$injector=o(m,function(e){return e=p.get(e+s),g.invoke(e.$get,e)});return i(function e(t){var n,r,o,a,c=[];return i(t,function(t){if(!l.get(t)){l.put(t,!0);try{if(C(t))for(n=Ot(t),c=c.concat(e(n.requires)).concat(n._runBlocks),r=n._invokeQueue,o=0,a=r.length;o<a;o++){var i=r[o],s=p.get(i[0]);s[i[1]].apply(s,i[2])}else T(t)?c.push(p.invoke(t)):Gt(t)?c.push(p.invoke(t)):j(t,"module")}catch(e){throw Gt(t)&&(t=t[t.length-1]),e.message&&e.stack&&-1==e.stack.indexOf(e.message)&&(e=e.message+"\n"+e.stack),yn("modulerr",t,e.stack||e.message||e)}}}),c}(e),function(e){g.invoke(e||f)}),g}function ge(){var e=!0;this.disableAutoScrolling=function(){e=!1},this.$get=["$window","$location","$rootScope",function(t,n,r){function o(){var e,r=n.hash();r?(e=a.getElementById(r))?e.scrollIntoView():(e=function(e){var t=null;return i(e,function(e){t||"a"!==Vt(e.nodeName)||(t=e)}),t}(a.getElementsByName(r)))?e.scrollIntoView():"top"===r&&t.scrollTo(0,0):t.scrollTo(0,0)}var a=t.document;return e&&r.$watch(function(){return n.hash()},function(){r.$evalAsync(o)}),o}]}function ve(){this.$get=["$$rAF","$timeout",function(e,t){return e.supported?function(t){return e(t)}:function(e){return t(e,0,!1)}}]}function ye(e,t,r,o){function a(e){try{e.apply(null,Bt.call(arguments,1))}finally{if(0===--v)for(;y.length;)try{y.pop()()}catch(e){r.error(e)}}}function c(){w=null,T!=s.url()&&(T=s.url(),i(b,function(e){e(s.url())}))}var s=this,u=t[0],l=e.location,d=e.history,p=e.setTimeout,m=e.clearTimeout,h={};s.isMock=!1;var v=0,y=[];s.$$completeOutstandingRequest=a,s.$$incOutstandingRequestCount=function(){v++},s.notifyWhenNoOutstandingRequests=function(e){i(S,function(e){e()}),0===v?e():y.push(e)};var E,S=[];s.addPollFn=function(e){return g(E)&&function(e,t){!function n(){i(S,function(e){e()}),E=t(n,e)}()}(100,p),S.push(e),e};var T=l.href,_=t.find("base"),w=null;s.url=function(t,n){return l!==e.location&&(l=e.location),d!==e.history&&(d=e.history),t?T!=t?(T=t,o.history?n?d.replaceState(null,"",t):(d.pushState(null,"",t),_.attr("href",_.attr("href"))):(w=t,n?l.replace(t):l.href=t),s):void 0:w||l.href.replace(/%27/g,"'")};var b=[],P=!1;s.onUrlChange=function(t){return P||(o.history&&Dt(e).on("popstate",c),o.hashchange?Dt(e).on("hashchange",c):s.addPollFn(c),P=!0),b.push(t),t},s.baseHref=function(){var e=_.attr("href");return e?e.replace(/^(https?\:)?\/\/[^\/]*/,""):""};var A={},$="",I=s.baseHref();s.cookies=function(e,t){var o,i,a,c;if(!e){if(u.cookie!==$)for(o=($=u.cookie).split("; "),A={},a=0;a<o.length;a++)0<(c=(i=o[a]).indexOf("="))&&(e=unescape(i.substring(0,c)),A[e]===n&&(A[e]=unescape(i.substring(c+1))));return A}t===n?u.cookie=escape(e)+"=;path="+I+";expires=Thu, 01 Jan 1970 00:00:00 GMT":C(t)&&(4096<(o=(u.cookie=escape(e)+"="+escape(t)+";path="+I).length+1)&&r.warn("Cookie '"+e+"' possibly not set or overflowed because it was too large ("+o+" > 4096 bytes)!"))},s.defer=function(e,t){var n;return v++,n=p(function(){delete h[n],a(e)},t||0),h[n]=!0,n},s.defer.cancel=function(e){return!!h[e]&&(delete h[e],m(e),a(f),!0)}}function Ce(){this.$get=["$window","$log","$sniffer","$document",function(e,t,n,r){return new ye(e,r,t,n)}]}function Ee(){this.$get=function(){function e(e,n){function o(e){e!=p&&(f?f==e&&(f=e.n):f=e,i(e.n,e.p),i(e,p),(p=e).n=null)}function i(e,t){e!=t&&(e&&(e.p=t),t&&(t.n=e))}if(e in t)throw r("$cacheFactory")("iid",e);var a=0,c=l({},n,{id:e}),s={},u=n&&n.capacity||Number.MAX_VALUE,d={},p=null,f=null;return t[e]={put:function(e,t){u<Number.MAX_VALUE&&o(d[e]||(d[e]={key:e}));if(!g(t))return e in s||a++,s[e]=t,a>u&&this.remove(f.key),t},get:function(e){if(u<Number.MAX_VALUE){var t=d[e];if(!t)return;o(t)}return s[e]},remove:function(e){if(u<Number.MAX_VALUE){var t=d[e];if(!t)return;t==p&&(p=t.p),t==f&&(f=t.n),i(t.n,t.p),delete d[e]}delete s[e],a--},removeAll:function(){s={},a=0,d={},p=f=null},destroy:function(){d=c=s=null,delete t[e]},info:function(){return l({},c,{size:a})}}}var t={};return e.info=function(){var e={};return i(t,function(t,n){e[n]=t.info()}),e},e.get=function(e){return t[e]},e}}function Se(){this.$get=["$cacheFactory",function(e){return e("templates")}]}function Te(e,r){var o={},a="Directive",s=/^\s*directive\:\s*([\d\w_\-]+)\s+(.*)$/,u=/(([\d\w_\-]+)(?:\:([^;]+))?;?)/,d=/^(on[a-z]+|formaction)$/;this.directive=function t(n,r){return Y(n,"directive"),C(n)?(q(r,"directiveFactory"),o.hasOwnProperty(n)||(o[n]=[],e.factory(n+a,["$injector","$exceptionHandler",function(e,t){var r=[];return i(o[n],function(o,i){try{var a=e.invoke(o);T(a)?a={compile:h(a)}:!a.compile&&a.link&&(a.compile=h(a.link)),a.priority=a.priority||0,a.index=i,a.name=a.name||n,a.require=a.require||a.controller&&a.name,a.restrict=a.restrict||"A",r.push(a)}catch(e){t(e)}}),r}])),o[n].push(r)):i(n,c(t)),this},this.aHrefSanitizationWhitelist=function(e){return v(e)?(r.aHrefSanitizationWhitelist(e),this):r.aHrefSanitizationWhitelist()},this.imgSrcSanitizationWhitelist=function(e){return v(e)?(r.imgSrcSanitizationWhitelist(e),this):r.imgSrcSanitizationWhitelist()},this.$get=["$injector","$interpolate","$exceptionHandler","$http","$templateCache","$parse","$controller","$rootScope","$document","$sce","$animate","$$sanitizeUri",function(e,r,c,f,h,g,v,E,S,_,w,b){function P(e,t,n,r,o){e instanceof Dt||(e=Dt(e)),i(e,function(t,n){3==t.nodeType&&t.nodeValue.match(/\S+/)&&(e[n]=Dt(t).wrap("<span></span>").parent()[0])});var a=$(e,t,e,n,r,o);return A(e,"ng-scope"),function(t,n,r,o){q(t,"scope");var c=n?dn.clone.call(e):e;i(r,function(e,t){c.data("$"+t+"Controller",e)}),r=0;for(var s=c.length;r<s;r++){var u=c[r].nodeType;1!==u&&9!==u||c.eq(r).data("$scope",t)}return n&&n(c,t),a&&a(t,c,c,o),c}}function A(e,t){try{e.addClass(t)}catch(e){}}function $(e,t,r,o,i,a){for(var c,s,u,l,d=[],p=0;p<e.length;p++)c=new K,(a=(s=x(e[p],[],c,0===p?o:n,i)).length?O(s,e[p],c,t,r,null,[],[],a):null)&&a.scope&&A(c.$$element,"ng-scope"),c=a&&a.terminal||!(u=e[p].childNodes)||!u.length?null:$(u,a?(a.transcludeOnThisElement||!a.templateOnThisElement)&&a.transclude:t),d.push(a,c),l=l||a||c,a=null;return l?function(e,r,o,i){var a,c,s,u,l,p;a=r.length;var f=Array(a);for(u=0;u<a;u++)f[u]=r[u];for(p=u=0,l=d.length;u<l;p++)c=f[p],r=d[u++],a=d[u++],r?(r.scope?(s=e.$new(),Dt.data(c,"$scope",s)):s=e,r(a,s,c,o,r.transcludeOnThisElement?N(e,r.transclude,i):!r.templateOnThisElement&&i?i:!i&&t?N(e,t):null)):a&&a(e,c.childNodes,n,i)}:null}function N(e,t,n){return function(r,o,i){var a=!1;return r||(a=(r=e.$new()).$$transcluded=!0),o=t(r,o,i,n),a&&o.on("$destroy",function(){r.$destroy()}),o}}function x(e,t,n,r,o){var i,a=n.$attr;switch(e.nodeType){case 1:V(t,_e(Rt(e).toLowerCase()),"E",r,o);for(var c,l,d,p=e.attributes,f=0,m=p&&p.length;f<m;f++){var h=!1,g=!1;if(c=p[f],!xt||8<=xt||c.specified){i=c.name,l=zt(c.value),c=_e(i),(d=ee.test(c))&&(i=W(c.substr(6),"-"));var v=c.replace(/(Start|End)$/,"");c===v+"Start"&&(h=i,g=i.substr(0,i.length-5)+"end",i=i.substr(0,i.length-6)),a[c=_e(i.toLowerCase())]=i,!d&&n.hasOwnProperty(c)||(n[c]=l,de(e,c)&&(n[c]=!0)),Y(e,t,l,c),V(t,c,"A",r,o,h,g)}}if(C(e=e.className)&&""!==e)for(;i=u.exec(e);)V(t,c=_e(i[2]),"C",r,o)&&(n[c]=zt(i[3])),e=e.substr(i.index+i[0].length);break;case 3:j(t,e.nodeValue);break;case 8:try{(i=s.exec(e.nodeValue))&&(V(t,c=_e(i[1]),"M",r,o)&&(n[c]=zt(i[2])))}catch(e){}}return t.sort(B),t}function D(e,t,n){var r=[],o=0;if(t&&e.hasAttribute&&e.hasAttribute(t))do{if(!e)throw Sn("uterdir",t,n);1==e.nodeType&&(e.hasAttribute(t)&&o++,e.hasAttribute(n)&&o--),r.push(e),e=e.nextSibling}while(0<o);else r.push(e);return Dt(r)}function M(e,t,n){return function(r,o,i,a,c){return o=D(o[0],t,n),e(r,o,i,a,c)}}function O(e,o,a,s,u,l,d,p,f){function m(e,t,n,r){e&&(n&&(e=M(e,n,r)),e.require=_.require,e.directiveName=w,(V===_||_.$$isolateScope)&&(e=z(e,{isolateScope:!0})),d.push(e)),t&&(n&&(t=M(t,n,r)),t.require=_.require,t.directiveName=w,(V===_||_.$$isolateScope)&&(t=z(t,{isolateScope:!0})),p.push(t))}function h(e,t,n,r){var o,a="data",c=!1;if(C(t)){for(;"^"==(o=t.charAt(0))||"?"==o;)t=t.substr(1),"^"==o&&(a="inheritedData"),c=c||"?"==o;if(o=null,r&&"data"===a&&(o=r[t]),!(o=o||n[a]("$"+t+"Controller"))&&!c)throw Sn("ctreq",t,e)}else Gt(t)&&(o=[],i(t,function(t){o.push(h(e,t,n,r))}));return o}function E(e,t,s,u,l){var f,m,y,C,E,S,T,_={};if(f=o===s?a:I(a,new K(Dt(s),a.$attr)),m=f.$$element,V){var w=/^\s*([@=&])(\??)\s*(\w*)\s*$/;S=t.$new(!0),!B||B!==V&&B!==V.$$originalDirective?m.data("$isolateScopeNoTemplate",S):m.data("$isolateScope",S),A(m,"ng-isolate-scope"),i(V.scope,function(e,n){var o,i,a,c,s=(l=e.match(w)||[])[3]||n,u="?"==l[2],l=l[1];switch(S.$$isolateBindings[n]=l+s,l){case"@":f.$observe(s,function(e){S[n]=e}),f.$$observers[s].$$scope=t,f[s]&&(S[n]=r(f[s])(t));break;case"=":if(u&&!f[s])break;i=g(f[s]),c=i.literal?k:function(e,t){return e===t||e!=e&&t!=t},a=i.assign||function(){throw o=S[n]=i(t),Sn("nonassign",f[s],V.name)},o=S[n]=i(t),S.$watch(function(){var e=i(t);return c(e,S[n])||(c(e,o)?a(t,e=S[n]):S[n]=e),o=e},null,i.literal);break;case"&":i=g(f[s]),S[n]=function(e){return i(t,e)};break;default:throw Sn("iscp",V.name,n,e)}})}for(T=l&&function(e,t){var r;return 2>arguments.length&&(t=e,e=n),Y&&(r=_),l(e,t,r)},O&&i(O,function(e){var n,r={$scope:e===V||e.$$isolateScope?S:t,$element:m,$attrs:f,$transclude:T};"@"==(E=e.controller)&&(E=f[e.name]),n=v(E,r),_[e.name]=n,Y||m.data("$"+e.name+"Controller",n),e.controllerAs&&(r.$scope[e.controllerAs]=n)}),u=0,y=d.length;u<y;u++)try{(C=d[u])(C.isolateScope?S:t,m,f,C.require&&h(C.directiveName,C.require,m,_),T)}catch(e){c(e,R(m))}for(u=t,V&&(V.template||null===V.templateUrl)&&(u=S),e&&e(u,s.childNodes,n,l),u=p.length-1;0<=u;u--)try{(C=p[u])(C.isolateScope?S:t,m,f,C.require&&h(C.directiveName,C.require,m,_),T)}catch(e){c(e,R(m))}}f=f||{};for(var S,_,w,b,$,N=-Number.MAX_VALUE,O=f.controllerDirectives,V=f.newIsolateScopeDirective,B=f.templateDirective,W=f.nonTlbTranscludeDirective,q=!1,j=!1,Y=f.hasElementTranscludeDirective,Z=a.$$element=Dt(o),J=s,ee=0,te=e.length;ee<te;ee++){var ne=(_=e[ee]).$$start,re=_.$$end;if(ne&&(Z=D(o,ne,re)),b=n,N>_.priority)break;if((b=_.scope)&&(S=S||_,_.templateUrl||(H("new/isolated scope",V,_,Z),y(b)&&(V=_))),w=_.name,!_.templateUrl&&_.controller&&(b=_.controller,H("'"+w+"' controller",(O=O||{})[w],_,Z),O[w]=_),(b=_.transclude)&&(q=!0,_.$$tlb||(H("transclusion",W,_,Z),W=_),"element"==b?(Y=!0,N=_.priority,b=Z,Z=a.$$element=Dt(t.createComment(" "+w+": "+a[w]+" ")),o=Z[0],G(u,Bt.call(b,0),o),J=P(b,s,N,l&&l.name,{nonTlbTranscludeDirective:W})):(b=Dt(Q(o)).contents(),Z.empty(),J=P(b,s))),_.template)if(j=!0,H("template",B,_,Z),B=_,b=T(_.template)?_.template(Z,a):_.template,b=X(b),_.replace){if(l=_,b=cn.test(b)?Dt(zt(b)):[],o=b[0],1!=b.length||1!==o.nodeType)throw Sn("tplrt",w,"");G(u,Z,o),b=x(o,[],te={$attr:{}});var oe=e.splice(ee+1,e.length-(ee+1));V&&L(b),e=e.concat(b).concat(oe),U(a,te),te=e.length}else Z.html(b);if(_.templateUrl)j=!0,H("template",B,_,Z),B=_,_.replace&&(l=_),E=F(e.splice(ee,e.length-ee),Z,a,u,q&&J,d,p,{controllerDirectives:O,newIsolateScopeDirective:V,templateDirective:B,nonTlbTranscludeDirective:W}),te=e.length;else if(_.compile)try{T($=_.compile(Z,a,J))?m(null,$,ne,re):$&&m($.pre,$.post,ne,re)}catch(e){c(e,R(Z))}_.terminal&&(E.terminal=!0,N=Math.max(N,_.priority))}return E.scope=S&&!0===S.scope,E.transcludeOnThisElement=q,E.templateOnThisElement=j,E.transclude=J,f.hasElementTranscludeDirective=Y,E}function L(e){for(var t=0,n=e.length;t<n;t++)e[t]=p(e[t],{$$isolateScope:!0})}function V(t,r,i,s,u,l,d){if(r===u)return null;if(u=null,o.hasOwnProperty(r))for(var f,m=0,h=(r=e.get(r+a)).length;m<h;m++)try{f=r[m],(s===n||s>f.priority)&&-1!=f.restrict.indexOf(i)&&(l&&(f=p(f,{$$start:l,$$end:d})),t.push(f),u=f)}catch(e){c(e)}return u}function U(e,t){var n=t.$attr,r=e.$attr,o=e.$$element;i(e,function(r,o){"$"!=o.charAt(0)&&(t[o]&&t[o]!==r&&(r+=("style"===o?";":" ")+t[o]),e.$set(o,r,!0,n[o]))}),i(t,function(t,i){"class"==i?(A(o,t),e.class=(e.class?e.class+" ":"")+t):"style"==i?(o.attr("style",o.attr("style")+";"+t),e.style=(e.style?e.style+";":"")+t):"$"==i.charAt(0)||e.hasOwnProperty(i)||(e[i]=t,r[i]=n[i])})}function F(e,t,n,r,o,a,c,s){var u,d,p=[],m=t[0],g=e.shift(),v=l({},g,{templateUrl:null,transclude:null,replace:null,$$originalDirective:g}),C=T(g.templateUrl)?g.templateUrl(t,n):g.templateUrl;return t.empty(),f.get(_.getTrustedResourceUrl(C),{cache:h}).success(function(l){var f,h;if(l=X(l),g.replace){if(l=cn.test(l)?Dt(zt(l)):[],f=l[0],1!=l.length||1!==f.nodeType)throw Sn("tplrt",g.name,C);l={$attr:{}},G(r,t,f);var E=x(f,[],l);y(g.scope)&&L(E),e=E.concat(e),U(n,l)}else f=m,t.html(l);for(e.unshift(v),u=O(e,f,n,o,t,g,a,c,s),i(r,function(e,n){e==f&&(r[n]=t[0])}),d=$(t[0].childNodes,o);p.length;){l=p.shift(),h=p.shift();var S=p.shift(),T=p.shift();E=t[0];if(h!==m){var _=h.className;s.hasElementTranscludeDirective&&g.replace||(E=Q(f)),G(S,Dt(h),E),A(Dt(E),_)}h=u.transcludeOnThisElement?N(l,u.transclude,T):T,u(d,l,E,r,h)}p=null}).error(function(e,t,n,r){throw Sn("tpload",r.url)}),function(e,t,n,r,o){e=o,p?(p.push(t),p.push(n),p.push(r),p.push(e)):(u.transcludeOnThisElement&&(e=N(t,u.transclude,o)),u(d,t,n,r,e))}}function B(e,t){var n=t.priority-e.priority;return 0!==n?n:e.name!==t.name?e.name<t.name?-1:1:e.index-t.index}function H(e,t,n,r){if(t)throw Sn("multidir",t.name,n.name,e,R(r))}function j(e,t){var n=r(t,!0);n&&e.push({priority:0,compile:function(e){var t=e.parent().length;return t&&A(e.parent(),"ng-binding"),function(e,r){var o=r.parent(),i=o.data("$binding")||[];i.push(n),o.data("$binding",i),t||A(o,"ng-binding"),e.$watch(n,function(e){r[0].nodeValue=e})}}})}function Y(e,t,n,o){var i=r(n,!0);if(i){if("multiple"===o&&"SELECT"===Rt(e))throw Sn("selmulti",R(e));t.push({priority:100,compile:function(){return{pre:function(t,n,a){if(n=a.$$observers||(a.$$observers={}),d.test(o))throw Sn("nodomevents");(i=r(a[o],!0,function(e,t){if("srcdoc"==t)return _.HTML;var n=Rt(e);return"xlinkHref"==t||"FORM"==n&&"action"==t||"IMG"!=n&&("src"==t||"ngSrc"==t)?_.RESOURCE_URL:void 0}(e,o)))&&(a[o]=i(t),(n[o]||(n[o]=[])).$$inter=!0,(a.$$observers&&a.$$observers[o].$$scope||t).$watch(i,function(e,t){"class"===o&&e!=t?a.$updateClass(e,t):a.$set(o,e)}))}}}})}}function G(e,n,r){var o,i,a=n[0],c=n.length,s=a.parentNode;if(e)for(o=0,i=e.length;o<i;o++)if(e[o]==a){e[o++]=r,i=o+c-1;for(var u=e.length;o<u;o++,i++)i<u?e[o]=e[i]:delete e[o];e.length-=c-1;break}for(s&&s.replaceChild(r,a),(e=t.createDocumentFragment()).appendChild(a),r[Dt.expando]=a[Dt.expando],a=1,c=n.length;a<c;a++)s=n[a],Dt(s).remove(),e.appendChild(s),delete n[a];n[0]=r,n.length=1}function z(e,t){return l(function(){return e.apply(null,arguments)},e,t)}var K=function(e,t){this.$$element=e,this.$attr=t||{}};K.prototype={$normalize:_e,$addClass:function(e){e&&0<e.length&&w.addClass(this.$$element,e)},$removeClass:function(e){e&&0<e.length&&w.removeClass(this.$$element,e)},$updateClass:function(e,t){var n=we(e,t),r=we(t,e);0===n.length?w.removeClass(this.$$element,r):0===r.length?w.addClass(this.$$element,n):w.setClass(this.$$element,n,r)},$set:function(e,t,r,o){var a=de(this.$$element[0],e);a&&(this.$$element.prop(e,t),o=a),this[e]=t,o?this.$attr[e]=o:(o=this.$attr[e])||(this.$attr[e]=o=W(e,"-")),("A"===(a=Rt(this.$$element))&&"href"===e||"IMG"===a&&"src"===e)&&(this[e]=t=b(t,"src"===e)),!1!==r&&(null===t||t===n?this.$$element.removeAttr(o):this.$$element.attr(o,t)),(r=this.$$observers)&&i(r[e],function(e){try{e(t)}catch(e){c(e)}})},$observe:function(e,t){var n=this,r=n.$$observers||(n.$$observers={}),o=r[e]||(r[e]=[]);return o.push(t),E.$evalAsync(function(){o.$$inter||t(n[e])}),t}};var Z=r.startSymbol(),J=r.endSymbol(),X="{{"==Z||"}}"==J?m:function(e){return e.replace(/\{\{/g,Z).replace(/}}/g,J)},ee=/^ngAttr[A-Z]/;return P}]}function _e(e){return K(e.replace(Tn,""))}function we(e,t){var n="",r=e.split(/\s+/),o=t.split(/\s+/),i=0;e:for(;i<r.length;i++){for(var a=r[i],c=0;c<o.length;c++)if(a==o[c])continue e;n+=(0<n.length?" ":"")+a}return n}function be(){var e={},t=/^(\S+)(\s+as\s+(\w+))?$/;this.register=function(t,n){Y(t,"controller"),y(t)?l(e,t):e[t]=n},this.$get=["$injector","$window",function(n,o){return function(i,a){var c,s,u;if(C(i)&&(s=(c=i.match(t))[1],u=c[3],j(i=e.hasOwnProperty(s)?e[s]:G(a.$scope,s,!0)||G(o,s,!0),s,!0)),c=n.instantiate(i,a),u){if(!a||"object"!=typeof a.$scope)throw r("$controller")("noscp",s||i.name,u);a.$scope[u]=c}return c}}]}function Pe(){this.$get=["$window",function(e){return Dt(e.document)}]}function Ae(){this.$get=["$log",function(e){return function(t,n){e.error.apply(e,arguments)}}]}function $e(e){var t,n,r,o={};return e?(i(e.split("\n"),function(e){r=e.indexOf(":"),t=Vt(zt(e.substr(0,r))),n=zt(e.substr(r+1)),t&&(o[t]=o[t]?o[t]+", "+n:n)}),o):o}function Ie(e){var t=y(e)?e:n;return function(n){return t||(t=$e(e)),n?t[Vt(n)]||null:t}}function ke(e,t,n){return T(n)?n(e,t):(i(n,function(n){e=n(e,t)}),e)}function Ne(){var e=/^\s*(\[|\{[^\{])/,t=/[\}\]]\s*$/,r=/^\)\]\}',?\n/,o={"Content-Type":"application/json;charset=utf-8"},c=this.defaults={transformResponse:[function(n){return C(n)&&(n=n.replace(r,""),e.test(n)&&t.test(n)&&(n=M(n))),n}],transformRequest:[function(e){return y(e)&&"[object File]"!==Wt.call(e)&&"[object Blob]"!==Wt.call(e)?D(e):e}],headers:{common:{Accept:"application/json, text/plain, */*"},post:I(o),put:I(o),patch:I(o)},xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN"},s=this.interceptors=[],u=this.responseInterceptors=[];this.$get=["$httpBackend","$browser","$cacheFactory","$rootScope","$q","$injector",function(e,t,r,o,d,p){function f(e){function t(e){var t=l({},e,{data:ke(e.data,e.headers,r.transformResponse)});return 200<=e.status&&300>e.status?t:d.reject(t)}var r={method:"get",transformRequest:c.transformRequest,transformResponse:c.transformResponse},o=function(e){var t,n,r=c.headers,o=l({},e.headers);r=l({},r.common,r[Vt(e.method)]);e:for(t in r){for(n in e=Vt(t),o)if(Vt(n)===e)continue e;o[t]=r[t]}return function(e){var t;i(e,function(n,r){T(n)&&(null!=(t=n())?e[r]=t:delete e[r])})}(o),o}(e);l(r,e),r.headers=o,r.method=Ft(r.method);var a=[function(e){o=e.headers;var n=ke(e.data,Ie(o),e.transformRequest);return g(n)&&i(o,function(e,t){"content-type"===Vt(t)&&delete o[t]}),g(e.withCredentials)&&!g(c.withCredentials)&&(e.withCredentials=c.withCredentials),m(e,n,o).then(t,t)},n],s=d.when(r);for(i(_,function(e){(e.request||e.requestError)&&a.unshift(e.request,e.requestError),(e.response||e.responseError)&&a.push(e.response,e.responseError)});a.length;){e=a.shift();var u=a.shift();s=s.then(e,u)}return s.success=function(e){return s.then(function(t){e(t.data,t.status,t.headers,r)}),s},s.error=function(e){return s.then(null,function(t){e(t.data,t.status,t.headers,r)}),s},s}function m(r,i,a){function s(e,t,n,o){(200<=(t=Math.max(t,0))&&300>t?m.resolve:m.reject)({data:e,status:t,headers:Ie(n),config:r,statusText:o})}function u(){var e=P(f.pendingRequests,r);-1!==e&&f.pendingRequests.splice(e,1)}var l,p,m=d.defer(),C=m.promise,S=h(r.url,r.params);if(f.pendingRequests.push(r),C.then(u,u),!r.cache&&!c.cache||!1===r.cache||"GET"!==r.method&&"JSONP"!==r.method||(l=y(r.cache)?r.cache:y(c.cache)?c.cache:E),l)if(v(p=l.get(S))){if(p&&T(p.then))return p.then(u,u),p;Gt(p)?s(p[1],p[0],I(p[2]),p[3]):s(p,200,{},"OK")}else l.put(S,C);return g(p)&&((p=pt(r.url)?t.cookies()[r.xsrfCookieName||c.xsrfCookieName]:n)&&(a[r.xsrfHeaderName||c.xsrfHeaderName]=p),e(r.method,S,i,function(e,t,n,r){l&&(200<=e&&300>e?l.put(S,[e,t,$e(n),r]):l.remove(S)),s(t,e,n,r),o.$$phase||o.$apply()},a,r.timeout,r.withCredentials,r.responseType)),C}function h(e,t){if(!t)return e;var n=[];return function(e,t,n){for(var r=a(e),o=0;o<r.length;o++)t.call(n,e[r[o]],r[o])}(t,function(e,t){null===e||g(e)||(Gt(e)||(e=[e]),i(e,function(e){y(e)&&(S(e)?e=e.toISOString():y(e)&&(e=D(e))),n.push(B(t)+"="+B(e))}))}),0<n.length&&(e+=(-1==e.indexOf("?")?"?":"&")+n.join("&")),e}var E=r("$http"),_=[];return i(s,function(e){_.unshift(C(e)?p.get(e):p.invoke(e))}),i(u,function(e,t){var n=C(e)?p.get(e):p.invoke(e);_.splice(t,0,{response:function(e){return n(d.when(e))},responseError:function(e){return n(d.reject(e))}})}),f.pendingRequests=[],function(e){i(arguments,function(e){f[e]=function(t,n){return f(l(n||{},{method:e,url:t}))}})}("get","delete","head","jsonp"),function(e){i(arguments,function(e){f[e]=function(t,n,r){return f(l(r||{},{method:e,url:t,data:n}))}})}("post","put"),f.defaults=c,f}]}function xe(t){if(8>=xt&&(!t.match(/^(get|post|head|put|delete|options)$/i)||!e.XMLHttpRequest))return new e.ActiveXObject("Microsoft.XMLHTTP");if(e.XMLHttpRequest)return new e.XMLHttpRequest;throw r("$httpBackend")("noxhr")}function De(){this.$get=["$browser","$window","$document",function(e,t,n){return function(e,t,n,r,o){function a(e,t,n){var i=o.createElement("script"),a=null;return i.type="text/javascript",i.src=e,i.async=!0,a=function(e){tn(i,"load",a),tn(i,"error",a),o.body.removeChild(i),i=null;var c=-1,s="unknown";e&&("load"!==e.type||r[t].called||(e={type:"error"}),s=e.type,c="error"===e.type?404:200),n&&n(c,s)},en(i,"load",a),en(i,"error",a),8>=xt&&(i.onreadystatechange=function(){C(i.readyState)&&/loaded|complete/.test(i.readyState)&&(i.onreadystatechange=null,a({type:"load"}))}),o.body.appendChild(i),a}var c=-1;return function(o,s,u,l,d,p,m,h){function g(){C=c,S&&S(),_&&_.abort()}function y(t,r,o,i,a){w&&n.cancel(w),S=_=null,0===r&&(r=o?200:"file"==dt(s).protocol?404:0),t(1223===r?204:r,o,i,a||""),e.$$completeOutstandingRequest(f)}var C;if(e.$$incOutstandingRequestCount(),s=s||e.url(),"jsonp"==Vt(o)){var E="_"+(r.counter++).toString(36);r[E]=function(e){r[E].data=e,r[E].called=!0};var S=a(s.replace("JSON_CALLBACK","angular.callbacks."+E),E,function(e,t){y(l,e,r[E].data,"",t),r[E]=f})}else{var _=t(o);if(_.open(o,s,!0),i(d,function(e,t){v(e)&&_.setRequestHeader(t,e)}),_.onreadystatechange=function(){if(_&&4==_.readyState){var e=null,t=null,n="";C!==c&&(e=_.getAllResponseHeaders(),t="response"in _?_.response:_.responseText),C===c&&10>xt||(n=_.statusText),y(l,C||_.status,t,e,n)}},m&&(_.withCredentials=!0),h)try{_.responseType=h}catch(e){if("json"!==h)throw e}_.send(u||null)}if(0<p)var w=n(g,p);else p&&T(p.then)&&p.then(g)}}(e,xe,e.defer,t.angular.callbacks,n[0])}]}function Me(){var e="{{",t="}}";this.startSymbol=function(t){return t?(e=t,this):e},this.endSymbol=function(e){return e?(t=e,this):t},this.$get=["$parse","$exceptionHandler","$sce",function(n,r,o){function i(i,s,u){for(var l,d,p=0,f=[],m=i.length,h=!1,g=[];p<m;)-1!=(l=i.indexOf(e,p))&&-1!=(d=i.indexOf(t,l+a))?(p!=l&&f.push(i.substring(p,l)),f.push(p=n(h=i.substring(l+a,d))),p.exp=h,p=d+c,h=!0):(p!=m&&f.push(i.substring(p)),p=m);if((m=f.length)||(f.push(""),m=1),u&&1<f.length)throw _n("noconcat",i);if(!s||h)return g.length=m,(p=function(e){try{for(var t,n=0,a=m;n<a;n++){if("function"==typeof(t=f[n]))if(t=t(e),null==(t=u?o.getTrusted(u,t):o.valueOf(t)))t="";else switch(typeof t){case"string":break;case"number":t=""+t;break;default:t=D(t)}g[n]=t}return g.join("")}catch(t){e=_n("interr",i,t.toString()),r(e)}}).exp=i,p.parts=f,p}var a=e.length,c=t.length;return i.startSymbol=function(){return e},i.endSymbol=function(){return t},i}]}function Oe(){this.$get=["$rootScope","$window","$q",function(e,t,n){function r(r,i,a,c){var s=t.setInterval,u=t.clearInterval,l=n.defer(),d=l.promise,p=0,f=v(c)&&!c;return a=v(a)?a:0,d.then(null,null,r),d.$$intervalId=s(function(){l.notify(p++),0<a&&p>=a&&(l.resolve(p),u(d.$$intervalId),delete o[d.$$intervalId]),f||e.$apply()},i),o[d.$$intervalId]=l,d}var o={};return r.cancel=function(e){return!!(e&&e.$$intervalId in o)&&(o[e.$$intervalId].reject("canceled"),t.clearInterval(e.$$intervalId),delete o[e.$$intervalId],!0)},r}]}function Re(){this.$get=function(){return{id:"en-us",NUMBER_FORMATS:{DECIMAL_SEP:".",GROUP_SEP:",",PATTERNS:[{minInt:1,minFrac:0,maxFrac:3,posPre:"",posSuf:"",negPre:"-",negSuf:"",gSize:3,lgSize:3},{minInt:1,minFrac:2,maxFrac:2,posPre:"¤",posSuf:"",negPre:"(¤",negSuf:")",gSize:3,lgSize:3}],CURRENCY_SYM:"$"},DATETIME_FORMATS:{MONTH:"January February March April May June July August September October November December".split(" "),SHORTMONTH:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),DAY:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),SHORTDAY:"Sun Mon Tue Wed Thu Fri Sat".split(" "),AMPMS:["AM","PM"],medium:"MMM d, y h:mm:ss a",short:"M/d/yy h:mm a",fullDate:"EEEE, MMMM d, y",longDate:"MMMM d, y",mediumDate:"MMM d, y",shortDate:"M/d/yy",mediumTime:"h:mm:ss a",shortTime:"h:mm a"},pluralCat:function(e){return 1===e?"one":"other"}}}}function Le(e){for(var t=(e=e.split("/")).length;t--;)e[t]=F(e[t]);return e.join("/")}function Ve(e,t,n){e=dt(e,n),t.$$protocol=e.protocol,t.$$host=e.hostname,t.$$port=d(e.port)||bn[e.protocol]||null}function Ue(e,t,n){var r="/"!==e.charAt(0);r&&(e="/"+e),e=dt(e,n),t.$$path=decodeURIComponent(r&&"/"===e.pathname.charAt(0)?e.pathname.substring(1):e.pathname),t.$$search=V(e.search),t.$$hash=decodeURIComponent(e.hash),t.$$path&&"/"!=t.$$path.charAt(0)&&(t.$$path="/"+t.$$path)}function Fe(e,t){if(0===t.indexOf(e))return t.substr(e.length)}function Be(e){var t=e.indexOf("#");return-1==t?e:e.substr(0,t)}function He(e){return e.substr(0,Be(e).lastIndexOf("/")+1)}function We(e,t){this.$$html5=!0,t=t||"";var r=He(e);Ve(e,this,e),this.$$parse=function(t){var n=Fe(r,t);if(!C(n))throw Pn("ipthprfx",t,r);Ue(n,this,e),this.$$path||(this.$$path="/"),this.$$compose()},this.$$compose=function(){var e=U(this.$$search),t=this.$$hash?"#"+F(this.$$hash):"";this.$$url=Le(this.$$path)+(e?"?"+e:"")+t,this.$$absUrl=r+this.$$url.substr(1)},this.$$rewrite=function(o){var i;return(i=Fe(e,o))!==n?(o=i,(i=Fe(t,i))!==n?r+(Fe("/",i)||i):e+o):(i=Fe(r,o))!==n?r+i:r==o+"/"?r:void 0}}function qe(e,t){var n=He(e);Ve(e,this,e),this.$$parse=function(r){var o;if(!C(o="#"==(o=Fe(e,r)||Fe(n,r)).charAt(0)?Fe(t,o):this.$$html5?o:""))throw Pn("ihshprfx",r,t);Ue(o,this,e),r=this.$$path;var i=/^\/[A-Z]:(\/.*)/;0===o.indexOf(e)&&(o=o.replace(e,"")),i.exec(o)||(r=(o=i.exec(r))?o[1]:r),this.$$path=r,this.$$compose()},this.$$compose=function(){var n=U(this.$$search),r=this.$$hash?"#"+F(this.$$hash):"";this.$$url=Le(this.$$path)+(n?"?"+n:"")+r,this.$$absUrl=e+(this.$$url?t+this.$$url:"")},this.$$rewrite=function(t){if(Be(e)==Be(t))return t}}function je(e,t){this.$$html5=!0,qe.apply(this,arguments);var n=He(e);this.$$rewrite=function(r){var o;return e==Be(r)?r:(o=Fe(n,r))?e+t+o:n===r+"/"?n:void 0},this.$$compose=function(){var n=U(this.$$search),r=this.$$hash?"#"+F(this.$$hash):"";this.$$url=Le(this.$$path)+(n?"?"+n:"")+r,this.$$absUrl=e+t+this.$$url}}function Ye(e){return function(){return this[e]}}function Ge(e,t){return function(n){return g(n)?this[e]:(this[e]=t(n),this.$$compose(),this)}}function ze(){var t="",n=!1;this.hashPrefix=function(e){return v(e)?(t=e,this):t},this.html5Mode=function(e){return v(e)?(n=e,this):n},this.$get=["$rootScope","$browser","$sniffer","$rootElement",function(r,o,i,a){function c(e){r.$broadcast("$locationChangeSuccess",s.absUrl(),e)}var s,u,l,d=o.baseHref(),p=o.url();n?(l=p.substring(0,p.indexOf("/",p.indexOf("//")+2))+(d||"/"),u=i.history?We:je):(l=Be(p),u=qe),(s=new u(l,"#"+t)).$$parse(s.$$rewrite(p));var f=/^\s*(javascript|mailto):/i;a.on("click",function(n){if(!n.ctrlKey&&!n.metaKey&&2!=n.which){for(var i=Dt(n.target);"a"!==Vt(i[0].nodeName);)if(i[0]===a[0]||!(i=i.parent())[0])return;var c=i.prop("href");if(y(c)&&"[object SVGAnimatedString]"===c.toString()&&(c=dt(c.animVal).href),!f.test(c)){if(u===je)if(0>(p=i.attr("href")||i.attr("xlink:href")).indexOf("://"))if(c="#"+t,"/"==p[0])c=l+c+p;else if("#"==p[0])c=l+c+(s.path()||"/")+p;else{for(var d=s.path().split("/"),p=p.split("/"),m=0;m<p.length;m++)"."!=p[m]&&(".."==p[m]?d.pop():p[m].length&&d.push(p[m]));c=l+c+d.join("/")}d=s.$$rewrite(c),c&&!i.attr("target")&&d&&!n.isDefaultPrevented()&&(n.preventDefault(),d!=o.url()&&(s.$$parse(d),r.$apply(),e.angular["ff-684208-preventDefault"]=!0))}}}),s.absUrl()!=p&&o.url(s.absUrl(),!0),o.onUrlChange(function(e){s.absUrl()!=e&&(r.$evalAsync(function(){var t=s.absUrl();s.$$parse(e),r.$broadcast("$locationChangeStart",e,t).defaultPrevented?(s.$$parse(t),o.url(t)):c(t)}),r.$$phase||r.$digest())});var m=0;return r.$watch(function(){var e=o.url(),t=s.$$replace;return m&&e==s.absUrl()||(m++,r.$evalAsync(function(){r.$broadcast("$locationChangeStart",s.absUrl(),e).defaultPrevented?s.$$parse(e):(o.url(s.absUrl(),t),c(e))})),s.$$replace=!1,m}),s}]}function Ke(){var e=!0,t=this;this.debugEnabled=function(t){return v(t)?(e=t,this):e},this.$get=["$window",function(n){function r(e){var t=n.console||{},r=t[e]||t.log||f;e=!1;try{e=!!r.apply}catch(e){}return e?function(){var e=[];return i(arguments,function(t){e.push(function(e){return e instanceof Error&&(e.stack?e=e.message&&-1===e.stack.indexOf(e.message)?"Error: "+e.message+"\n"+e.stack:e.stack:e.sourceURL&&(e=e.message+"\n"+e.sourceURL+":"+e.line)),e}(t))}),r.apply(t,e)}:function(e,t){r(e,null==t?"":t)}}return{log:r("log"),info:r("info"),warn:r("warn"),error:r("error"),debug:function(){var n=r("debug");return function(){e&&n.apply(t,arguments)}}()}}]}function Ze(e,t){if("__defineGetter__"===e||"__defineSetter__"===e||"__lookupGetter__"===e||"__lookupSetter__"===e||"__proto__"===e)throw $n("isecfld",t);return e}function Je(e,t){if(e){if(e.constructor===e)throw $n("isecfn",t);if(e.document&&e.location&&e.alert&&e.setInterval)throw $n("isecwindow",t);if(e.children&&(e.nodeName||e.prop&&e.attr&&e.find))throw $n("isecdom",t);if(e===Object)throw $n("isecobj",t)}return e}function Qe(e,t,r,o,i){i=i||{},t=t.split(".");for(var a,c=0;1<t.length;c++){var s=e[a=Ze(t.shift(),o)];s||(s={},e[a]=s),(e=s).then&&i.unwrapPromises&&(An(o),"$$v"in e||function(e){e.then(function(t){e.$$v=t})}(e),e.$$v===n&&(e.$$v={}),e=e.$$v)}return a=Ze(t.shift(),o),Je(e,o),Je(e[a],o),e[a]=r}function Xe(e,t,r,o,i,a,c){return Ze(e,a),Ze(t,a),Ze(r,a),Ze(o,a),Ze(i,a),c.unwrapPromises?function(c,s){var u,l=s&&s.hasOwnProperty(e)?s:c;return null==l?l:((l=l[e])&&l.then&&(An(a),"$$v"in l||((u=l).$$v=n,u.then(function(e){u.$$v=e})),l=l.$$v),t?null==l?n:((l=l[t])&&l.then&&(An(a),"$$v"in l||((u=l).$$v=n,u.then(function(e){u.$$v=e})),l=l.$$v),r?null==l?n:((l=l[r])&&l.then&&(An(a),"$$v"in l||((u=l).$$v=n,u.then(function(e){u.$$v=e})),l=l.$$v),o?null==l?n:((l=l[o])&&l.then&&(An(a),"$$v"in l||((u=l).$$v=n,u.then(function(e){u.$$v=e})),l=l.$$v),i?null==l?n:((l=l[i])&&l.then&&(An(a),"$$v"in l||((u=l).$$v=n,u.then(function(e){u.$$v=e})),l=l.$$v),l):l):l):l):l)}:function(a,c){var s=c&&c.hasOwnProperty(e)?c:a;return null==s?s:(s=s[e],t?null==s?n:(s=s[t],r?null==s?n:(s=s[r],o?null==s?n:(s=s[o],i?null==s?n:s=s[i]:s):s):s):s)}}function et(e,t,r){if(Ln.hasOwnProperty(e))return Ln[e];var o,a=e.split("."),c=a.length;if(t.csp)o=6>c?Xe(a[0],a[1],a[2],a[3],a[4],r,t):function(e,o){var i,s=0;do{i=Xe(a[s++],a[s++],a[s++],a[s++],a[s++],r,t)(e,o),o=n,e=i}while(s<c);return i};else{var s="var p;\n";i(a,function(e,n){Ze(e,r),s+="if(s == null) return undefined;\ns="+(n?"s":'((k&&k.hasOwnProperty("'+e+'"))?k:s)')+'["'+e+'"];\n'+(t.unwrapPromises?'if (s && s.then) {\n pw("'+r.replace(/(["\r\n])/g,"\\$1")+'");\n if (!("$$v" in s)) {\n p=s;\n p.$$v = undefined;\n p.then(function(v) {p.$$v=v;});\n}\n s=s.$$v\n}\n':"")});s=s+"return s;";var u=new Function("s","k","pw",s);u.toString=h(s),o=t.unwrapPromises?function(e,t){return u(e,t,An)}:u}return"hasOwnProperty"!==e&&(Ln[e]=o),o}function tt(){var e={},t={csp:!1,unwrapPromises:!1,logPromiseWarnings:!0};this.unwrapPromises=function(e){return v(e)?(t.unwrapPromises=!!e,this):t.unwrapPromises},this.logPromiseWarnings=function(e){return v(e)?(t.logPromiseWarnings=e,this):t.logPromiseWarnings},this.$get=["$filter","$sniffer","$log",function(n,r,o){return t.csp=r.csp,An=function(e){t.logPromiseWarnings&&!In.hasOwnProperty(e)&&(In[e]=!0,o.warn("[$parse] Promise found in the expression `"+e+"`. Automatic unwrapping of promises in Angular expressions is deprecated."))},function(r){var o;switch(typeof r){case"string":return e.hasOwnProperty(r)?e[r]:(o=new On(t),o=new Rn(o,n,t).parse(r),"hasOwnProperty"!==r&&(e[r]=o),o);case"function":return r;default:return f}}}]}function nt(){this.$get=["$rootScope","$exceptionHandler",function(e,t){return function(e,t){function r(e){return e}function o(e){return s(e)}var a=function(){var i,s,l=[];return s={resolve:function(t){if(l){var r=l;l=n,i=c(t),r.length&&e(function(){for(var e,t=0,n=r.length;t<n;t++)e=r[t],i.then(e[0],e[1],e[2])})}},reject:function(e){s.resolve(u(e))},notify:function(t){if(l){var n=l;l.length&&e(function(){for(var e=0,r=n.length;e<r;e++)n[e][2](t)})}},promise:{then:function(e,n,c){var s=a(),u=function(n){try{s.resolve((T(e)?e:r)(n))}catch(e){s.reject(e),t(e)}},d=function(e){try{s.resolve((T(n)?n:o)(e))}catch(e){s.reject(e),t(e)}},p=function(e){try{s.notify((T(c)?c:r)(e))}catch(e){t(e)}};return l?l.push([u,d,p]):i.then(u,d,p),s.promise},catch:function(e){return this.then(null,e)},finally:function(e){function t(e,t){var n=a();return t?n.resolve(e):n.reject(e),n.promise}function n(n,o){var i=null;try{i=(e||r)()}catch(e){return t(e,!1)}return i&&T(i.then)?i.then(function(){return t(n,o)},function(e){return t(e,!1)}):t(n,o)}return this.then(function(e){return n(e,!0)},function(e){return n(e,!1)})}}}},c=function(t){return t&&T(t.then)?t:{then:function(n){var r=a();return e(function(){r.resolve(n(t))}),r.promise}}},s=function(e){var t=a();return t.reject(e),t.promise},u=function(n){return{then:function(r,i){var c=a();return e(function(){try{c.resolve((T(i)?i:o)(n))}catch(e){c.reject(e),t(e)}}),c.promise}}};return{defer:a,reject:s,when:function(n,i,u,l){var d,p=a(),f=function(e){try{return(T(i)?i:r)(e)}catch(e){return t(e),s(e)}},m=function(e){try{return(T(u)?u:o)(e)}catch(e){return t(e),s(e)}},h=function(e){try{return(T(l)?l:r)(e)}catch(e){t(e)}};return e(function(){c(n).then(function(e){d||(d=!0,p.resolve(c(e).then(f,m,h)))},function(e){d||(d=!0,p.resolve(m(e)))},function(e){d||p.notify(h(e))})}),p.promise},all:function(e){var t=a(),n=0,r=Gt(e)?[]:{};return i(e,function(e,o){n++,c(e).then(function(e){r.hasOwnProperty(o)||(r[o]=e,--n||t.resolve(r))},function(e){r.hasOwnProperty(o)||t.reject(e)})}),0===n&&t.resolve(r),t.promise}}}(function(t){e.$evalAsync(t)},t)}]}function rt(){this.$get=["$window","$timeout",function(e,t){var n=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame,r=e.cancelAnimationFrame||e.webkitCancelAnimationFrame||e.mozCancelAnimationFrame||e.webkitCancelRequestAnimationFrame,o=!!n,i=o?function(e){var t=n(e);return function(){r(t)}}:function(e){var n=t(e,16.66,!1);return function(){t.cancel(n)}};return i.supported=o,i}]}function ot(){var e=10,t=r("$rootScope"),n=null;this.digestTtl=function(t){return arguments.length&&(e=t),e},this.$get=["$injector","$exceptionHandler","$parse","$browser",function(r,a,c,u){function l(){this.$id=s(),this.$$phase=this.$parent=this.$$watchers=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=null,this.this=this.$root=this,this.$$destroyed=!1,this.$$asyncQueue=[],this.$$postDigestQueue=[],this.$$listeners={},this.$$listenerCount={},this.$$isolateBindings={}}function d(e){if(g.$$phase)throw t("inprog",g.$$phase);g.$$phase=e}function p(e,t){var n=c(e);return j(n,t),n}function m(e,t,n){do{e.$$listenerCount[n]-=t,0===e.$$listenerCount[n]&&delete e.$$listenerCount[n]}while(e=e.$parent)}function h(){}l.prototype={constructor:l,$new:function(e){return e?((e=new l).$root=this.$root,e.$$asyncQueue=this.$$asyncQueue,e.$$postDigestQueue=this.$$postDigestQueue):(this.$$childScopeClass||(this.$$childScopeClass=function(){this.$$watchers=this.$$nextSibling=this.$$childHead=this.$$childTail=null,this.$$listeners={},this.$$listenerCount={},this.$id=s(),this.$$childScopeClass=null},this.$$childScopeClass.prototype=this),e=new this.$$childScopeClass),e.this=e,e.$parent=this,e.$$prevSibling=this.$$childTail,this.$$childHead?this.$$childTail=this.$$childTail.$$nextSibling=e:this.$$childHead=this.$$childTail=e,e},$watch:function(e,t,r){var o=p(e,"watch"),i=this.$$watchers,a={fn:t,last:h,get:o,exp:e,eq:!!r};if(n=null,!T(t)){var c=p(t||f,"listener");a.fn=function(e,t,n){c(n)}}if("string"==typeof e&&o.constant){var s=a.fn;a.fn=function(e,t,n){s.call(this,e,t,n),A(i,a)}}return i||(i=this.$$watchers=[]),i.unshift(a),function(){A(i,a),n=null}},$watchCollection:function(e,t){var n,r,i,a=this,s=1<t.length,u=0,l=c(e),d=[],p={},f=!0,m=0;return this.$watch(function(){var e,t;if(y(n=l(a)))if(o(n))for(r!==d&&(m=(r=d).length=0,u++),e=n.length,m!==e&&(u++,r.length=m=e),t=0;t<e;t++)r[t]!=r[t]&&n[t]!=n[t]||r[t]===n[t]||(u++,r[t]=n[t]);else{for(t in r!==p&&(r=p={},m=0,u++),e=0,n)n.hasOwnProperty(t)&&(e++,r.hasOwnProperty(t)?r[t]!=r[t]&&n[t]!=n[t]||r[t]===n[t]||(u++,r[t]=n[t]):(m++,r[t]=n[t],u++));if(m>e)for(t in u++,r)r.hasOwnProperty(t)&&!n.hasOwnProperty(t)&&(m--,delete r[t])}else r!==n&&(r=n,u++);return u},function(){if(f?(f=!1,t(n,n,a)):t(n,i,a),s)if(y(n))if(o(n)){i=Array(n.length);for(var e=0;e<n.length;e++)i[e]=n[e]}else for(e in i={},n)Ut.call(n,e)&&(i[e]=n[e]);else i=n})},$digest:function(){var r,o,i,c,s,u,l,p,f,m,v=this.$$asyncQueue,y=this.$$postDigestQueue,C=e,E=[];d("$digest"),n=null;do{for(u=!1,l=this;v.length;){try{(m=v.shift()).scope.$eval(m.expression)}catch(e){g.$$phase=null,a(e)}n=null}e:do{if(c=l.$$watchers)for(s=c.length;s--;)try{if(r=c[s])if((o=r.get(l))===(i=r.last)||(r.eq?k(o,i):"number"==typeof o&&"number"==typeof i&&isNaN(o)&&isNaN(i))){if(r===n){u=!1;break e}}else u=!0,n=r,r.last=r.eq?$(o,null):o,r.fn(o,i===h?o:i,l),5>C&&(E[p=4-C]||(E[p]=[]),f=T(r.exp)?"fn: "+(r.exp.name||r.exp.toString()):r.exp,f+="; newVal: "+D(o)+"; oldVal: "+D(i),E[p].push(f))}catch(e){g.$$phase=null,a(e)}if(!(c=l.$$childHead||l!==this&&l.$$nextSibling))for(;l!==this&&!(c=l.$$nextSibling);)l=l.$parent}while(l=c);if((u||v.length)&&!C--)throw g.$$phase=null,t("infdig",e,D(E))}while(u||v.length);for(g.$$phase=null;y.length;)try{y.shift()()}catch(e){a(e)}},$destroy:function(){if(!this.$$destroyed){var e=this.$parent;this.$broadcast("$destroy"),this.$$destroyed=!0,this!==g&&(i(this.$$listenerCount,N(null,m,this)),e.$$childHead==this&&(e.$$childHead=this.$$nextSibling),e.$$childTail==this&&(e.$$childTail=this.$$prevSibling),this.$$prevSibling&&(this.$$prevSibling.$$nextSibling=this.$$nextSibling),this.$$nextSibling&&(this.$$nextSibling.$$prevSibling=this.$$prevSibling),this.$parent=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=this.$root=null,this.$$listeners={},this.$$watchers=this.$$asyncQueue=this.$$postDigestQueue=[],this.$destroy=this.$digest=this.$apply=f,this.$on=this.$watch=function(){return f})}},$eval:function(e,t){return c(e)(this,t)},$evalAsync:function(e){g.$$phase||g.$$asyncQueue.length||u.defer(function(){g.$$asyncQueue.length&&g.$digest()}),this.$$asyncQueue.push({scope:this,expression:e})},$$postDigest:function(e){this.$$postDigestQueue.push(e)},$apply:function(e){try{return d("$apply"),this.$eval(e)}catch(e){a(e)}finally{g.$$phase=null;try{g.$digest()}catch(e){throw a(e),e}}},$on:function(e,t){var n=this.$$listeners[e];n||(this.$$listeners[e]=n=[]),n.push(t);var r=this;do{r.$$listenerCount[e]||(r.$$listenerCount[e]=0),r.$$listenerCount[e]++}while(r=r.$parent);var o=this;return function(){n[P(n,t)]=null,m(o,1,e)}},$emit:function(e,t){var n,r,o,i=[],c=this,s=!1,u={name:e,targetScope:c,stopPropagation:function(){s=!0},preventDefault:function(){u.defaultPrevented=!0},defaultPrevented:!1},l=[u].concat(Bt.call(arguments,1));do{for(n=c.$$listeners[e]||i,u.currentScope=c,r=0,o=n.length;r<o;r++)if(n[r])try{n[r].apply(null,l)}catch(e){a(e)}else n.splice(r,1),r--,o--;if(s)break;c=c.$parent}while(c);return u},$broadcast:function(e,t){for(var n,r,o=this,i=this,c={name:e,targetScope:this,preventDefault:function(){c.defaultPrevented=!0},defaultPrevented:!1},s=[c].concat(Bt.call(arguments,1));o=i;){for(c.currentScope=o,n=0,r=(i=o.$$listeners[e]||[]).length;n<r;n++)if(i[n])try{i[n].apply(null,s)}catch(e){a(e)}else i.splice(n,1),n--,r--;if(!(i=o.$$listenerCount[e]&&o.$$childHead||o!==this&&o.$$nextSibling))for(;o!==this&&!(i=o.$$nextSibling);)o=o.$parent}return c}};var g=new l;return g}]}function it(){var e=/^\s*(https?|ftp|mailto|tel|file):/,t=/^\s*(https?|ftp|file):|data:image\//;this.aHrefSanitizationWhitelist=function(t){return v(t)?(e=t,this):e},this.imgSrcSanitizationWhitelist=function(e){return v(e)?(t=e,this):t},this.$get=function(){return function(n,r){var o,i=r?t:e;return xt&&!(8<=xt)||(""===(o=dt(n).href)||o.match(i))?n:"unsafe:"+o}}}function at(e){var t=[];return v(e)&&i(e,function(e){t.push(function(e){if("self"===e)return e;if(C(e)){if(-1<e.indexOf("***"))throw Vn("iwcard",e);return e=e.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08").replace("\\*\\*",".*").replace("\\*","[^:/.?&;]*"),RegExp("^"+e+"$")}if(_(e))return RegExp("^"+e.source+"$");throw Vn("imatcher")}(e))}),t}function ct(){this.SCE_CONTEXTS=Un;var e=["self"],t=[];this.resourceUrlWhitelist=function(t){return arguments.length&&(e=at(t)),e},this.resourceUrlBlacklist=function(e){return arguments.length&&(t=at(e)),t},this.$get=["$injector",function(r){function o(e){var t=function(e){this.$$unwrapTrustedValue=function(){return e}};return e&&(t.prototype=new e),t.prototype.valueOf=function(){return this.$$unwrapTrustedValue()},t.prototype.toString=function(){return this.$$unwrapTrustedValue().toString()},t}var i=function(e){throw Vn("unsafe")};r.has("$sanitize")&&(i=r.get("$sanitize"));var a=o(),c={};return c[Un.HTML]=o(a),c[Un.CSS]=o(a),c[Un.URL]=o(a),c[Un.JS]=o(a),c[Un.RESOURCE_URL]=o(c[Un.URL]),{trustAs:function(e,t){var r=c.hasOwnProperty(e)?c[e]:null;if(!r)throw Vn("icontext",e,t);if(null===t||t===n||""===t)return t;if("string"!=typeof t)throw Vn("itype",e);return new r(t)},getTrusted:function(r,o){if(null===o||o===n||""===o)return o;if((u=c.hasOwnProperty(r)?c[r]:null)&&o instanceof u)return o.$$unwrapTrustedValue();if(r===Un.RESOURCE_URL){var a,s,u=dt(o.toString()),l=!1;for(a=0,s=e.length;a<s;a++)if("self"===e[a]?pt(u):e[a].exec(u.href)){l=!0;break}if(l)for(a=0,s=t.length;a<s;a++)if("self"===t[a]?pt(u):t[a].exec(u.href)){l=!1;break}if(l)return o;throw Vn("insecurl",o.toString())}if(r===Un.HTML)return i(o);throw Vn("unsafe")},valueOf:function(e){return e instanceof a?e.$$unwrapTrustedValue():e}}}]}function st(){var e=!0;this.enabled=function(t){return arguments.length&&(e=!!t),e},this.$get=["$parse","$sniffer","$sceDelegate",function(t,n,r){if(e&&n.msie&&8>n.msieDocumentMode)throw Vn("iequirks");var o=I(Un);o.isEnabled=function(){return e},o.trustAs=r.trustAs,o.getTrusted=r.getTrusted,o.valueOf=r.valueOf,e||(o.trustAs=o.getTrusted=function(e,t){return t},o.valueOf=m),o.parseAs=function(e,n){var r=t(n);return r.literal&&r.constant?r:function(t,n){return o.getTrusted(e,r(t,n))}};var a=o.parseAs,c=o.getTrusted,s=o.trustAs;return i(Un,function(e,t){var n=Vt(t);o[K("parse_as_"+n)]=function(t){return a(e,t)},o[K("get_trusted_"+n)]=function(t){return c(e,t)},o[K("trust_as_"+n)]=function(t){return s(e,t)}}),o}]}function ut(){this.$get=["$window","$document",function(e,t){var n,r={},o=d((/android (\d+)/.exec(Vt((e.navigator||{}).userAgent))||[])[1]),i=/Boxee/i.test((e.navigator||{}).userAgent),a=t[0]||{},c=a.documentMode,s=/^(Moz|webkit|O|ms)(?=[A-Z])/,u=a.body&&a.body.style,l=!1,p=!1;if(u){for(var f in u)if(l=s.exec(f)){n=(n=l[0]).substr(0,1).toUpperCase()+n.substr(1);break}n||(n="WebkitOpacity"in u&&"webkit"),l=!!("transition"in u||n+"Transition"in u),p=!!("animation"in u||n+"Animation"in u),!o||l&&p||(l=C(a.body.style.webkitTransition),p=C(a.body.style.webkitAnimation))}return{history:!(!e.history||!e.history.pushState||4>o||i),hashchange:"onhashchange"in e&&(!c||7<c),hasEvent:function(e){if("input"==e&&9==xt)return!1;if(g(r[e])){var t=a.createElement("div");r[e]="on"+e in t}return r[e]},csp:Kt(),vendorPrefix:n,transitions:l,animations:p,android:o,msie:xt,msieDocumentMode:c}}]}function lt(){this.$get=["$rootScope","$browser","$q","$exceptionHandler",function(e,t,n,r){function o(o,a,c){var s=n.defer(),u=s.promise,l=v(c)&&!c;return a=t.defer(function(){try{s.resolve(o())}catch(e){s.reject(e),r(e)}finally{delete i[u.$$timeoutId]}l||e.$apply()},a),u.$$timeoutId=a,i[a]=s,u}var i={};return o.cancel=function(e){return!!(e&&e.$$timeoutId in i)&&(i[e.$$timeoutId].reject("canceled"),delete i[e.$$timeoutId],t.defer.cancel(e.$$timeoutId))},o}]}function dt(e,t){var n=e;return xt&&(Fn.setAttribute("href",n),n=Fn.href),Fn.setAttribute("href",n),{href:Fn.href,protocol:Fn.protocol?Fn.protocol.replace(/:$/,""):"",host:Fn.host,search:Fn.search?Fn.search.replace(/^\?/,""):"",hash:Fn.hash?Fn.hash.replace(/^#/,""):"",hostname:Fn.hostname,port:Fn.port,pathname:"/"===Fn.pathname.charAt(0)?Fn.pathname:"/"+Fn.pathname}}function pt(e){return(e=C(e)?dt(e):e).protocol===Bn.protocol&&e.host===Bn.host}function ft(){this.$get=h(e)}function mt(e){function t(r,o){if(y(r)){var a={};return i(r,function(e,n){a[n]=t(n,e)}),a}return e.factory(r+n,o)}var n="Filter";this.register=t,this.$get=["$injector",function(e){return function(t){return e.get(t+n)}}],t("currency",gt),t("date",Tt),t("filter",ht),t("json",_t),t("limitTo",wt),t("lowercase",Yn),t("number",vt),t("orderBy",bt),t("uppercase",Gn)}function ht(){return function(e,t,n){if(!Gt(e))return e;var r=typeof n,o=[];o.check=function(e){for(var t=0;t<o.length;t++)if(!o[t](e))return!1;return!0},"function"!==r&&(n="boolean"===r&&n?function(e,t){return jt.equals(e,t)}:function(e,t){if(e&&t&&"object"==typeof e&&"object"==typeof t){for(var r in e)if("$"!==r.charAt(0)&&Ut.call(e,r)&&n(e[r],t[r]))return!0;return!1}return t=(""+t).toLowerCase(),-1<(""+e).toLowerCase().indexOf(t)});var i=function(e,t){if("string"==typeof t&&"!"===t.charAt(0))return!i(e,t.substr(1));switch(typeof e){case"boolean":case"number":case"string":return n(e,t);case"object":switch(typeof t){case"object":return n(e,t);default:for(var r in e)if("$"!==r.charAt(0)&&i(e[r],t))return!0}return!1;case"array":for(r=0;r<e.length;r++)if(i(e[r],t))return!0;return!1;default:return!1}};switch(typeof t){case"boolean":case"number":case"string":t={$:t};case"object":for(var a in t)!function(e){void 0!==t[e]&&o.push(function(n){return i("$"==e?n:n&&n[e],t[e])})}(a);break;case"function":o.push(t);break;default:return e}for(r=[],a=0;a<e.length;a++){var c=e[a];o.check(c)&&r.push(c)}return r}}function gt(e){var t=e.NUMBER_FORMATS;return function(e,n){return g(n)&&(n=t.CURRENCY_SYM),yt(e,t.PATTERNS[1],t.GROUP_SEP,t.DECIMAL_SEP,2).replace(/\u00A4/g,n)}}function vt(e){var t=e.NUMBER_FORMATS;return function(e,n){return yt(e,t.PATTERNS[0],t.GROUP_SEP,t.DECIMAL_SEP,n)}}function yt(e,t,n,r,o){if(null==e||!isFinite(e)||y(e))return"";var i=0>e,a=(e=Math.abs(e))+"",c="",s=[],u=!1;-1!==a.indexOf("e")&&((l=a.match(/([\d\.]+)e(-?)(\d+)/))&&"-"==l[2]&&l[3]>o+1?(a="0",e=0):(c=a,u=!0));if(u)0<o&&-1<e&&1>e&&(c=e.toFixed(o));else{a=(a.split(Hn)[1]||"").length,g(o)&&(o=Math.min(Math.max(t.minFrac,a),t.maxFrac)),a=(e=(""+(e=+(Math.round(+(e.toString()+"e"+o)).toString()+"e"+-o))).split(Hn))[0],e=e[1]||"";var l=0,d=t.lgSize,p=t.gSize;if(a.length>=d+p)for(l=a.length-d,u=0;u<l;u++)0==(l-u)%p&&0!==u&&(c+=n),c+=a.charAt(u);for(u=l;u<a.length;u++)0==(a.length-u)%d&&0!==u&&(c+=n),c+=a.charAt(u);for(;e.length<o;)e+="0";o&&"0"!==o&&(c+=r+e.substr(0,o))}return s.push(i?t.negPre:t.posPre),s.push(c),s.push(i?t.negSuf:t.posSuf),s.join("")}function Ct(e,t,n){var r="";for(0>e&&(r="-",e=-e),e=""+e;e.length<t;)e="0"+e;return n&&(e=e.substr(e.length-t)),r+e}function Et(e,t,n,r){return n=n||0,function(o){return o=o["get"+e](),(0<n||o>-n)&&(o+=n),0===o&&-12==n&&(o=12),Ct(o,t,r)}}function St(e,t){return function(n,r){var o=n["get"+e]();return r[Ft(t?"SHORT"+e:e)][o]}}function Tt(e){function t(e){var t;if(t=e.match(n)){e=new Date(0);var r=0,o=0,i=t[8]?e.setUTCFullYear:e.setFullYear,a=t[8]?e.setUTCHours:e.setHours;t[9]&&(r=d(t[9]+t[10]),o=d(t[9]+t[11])),i.call(e,d(t[1]),d(t[2])-1,d(t[3])),r=d(t[4]||0)-r,o=d(t[5]||0)-o,i=d(t[6]||0),t=Math.round(1e3*parseFloat("0."+(t[7]||0))),a.call(e,r,o,i,t)}return e}var n=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/;return function(n,r){var o,a,c="",s=[];if(r=r||"mediumDate",r=e.DATETIME_FORMATS[r]||r,C(n)&&(n=jn.test(n)?d(n):t(n)),E(n)&&(n=new Date(n)),!S(n))return n;for(;r;)(a=qn.exec(r))?r=(s=s.concat(Bt.call(a,1))).pop():(s.push(r),r=null);return i(s,function(t){o=Wn[t],c+=o?o(n,e.DATETIME_FORMATS):t.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),c}}function _t(){return function(e){return D(e,!0)}}function wt(){return function(e,t){if(!Gt(e)&&!C(e))return e;if(t=1/0===Math.abs(Number(t))?Number(t):d(t),C(e))return t?0<=t?e.slice(0,t):e.slice(t,e.length):"";var n,r,o=[];for(t>e.length?t=e.length:t<-e.length&&(t=-e.length),0<t?(n=0,r=t):(n=e.length+t,r=e.length);n<r;n++)o.push(e[n]);return o}}function bt(e){return function(t,n,r){function o(e,t){return O(t)?function(t,n){return e(n,t)}:e}function a(e,t){var n=typeof e,r=typeof t;return n==r?(S(e)&&S(t)&&(e=e.valueOf(),t=t.valueOf()),"string"==n&&(e=e.toLowerCase(),t=t.toLowerCase()),e===t?0:e<t?-1:1):n<r?-1:1}if(!Gt(t)||!n)return t;n=function(e,t,n){var r=[];return i(e,function(e,o,i){r.push(t.call(n,e,o,i))}),r}(n=Gt(n)?n:[n],function(t){var n=!1,r=t||m;if(C(t)&&("+"!=t.charAt(0)&&"-"!=t.charAt(0)||(n="-"==t.charAt(0),t=t.substring(1)),(r=e(t)).constant)){var i=r();return o(function(e,t){return a(e[i],t[i])},n)}return o(function(e,t){return a(r(e),r(t))},n)});for(var c=[],s=0;s<t.length;s++)c.push(t[s]);return c.sort(o(function(e,t){for(var r=0;r<n.length;r++){var o=n[r](e,t);if(0!==o)return o}return 0},r))}}function Pt(e){return T(e)&&(e={link:e}),e.restrict=e.restrict||"AC",h(e)}function At(e,t,n,r){function o(t,n){n=n?"-"+W(n,"-"):"",r.removeClass(e,(t?cr:ar)+n),r.addClass(e,(t?ar:cr)+n)}var a=this,c=e.parent().controller("form")||Zn,s=0,u=a.$error={},l=[];a.$name=t.name||t.ngForm,a.$dirty=!1,a.$pristine=!0,a.$valid=!0,a.$invalid=!1,c.$addControl(a),e.addClass(sr),o(!0),a.$addControl=function(e){Y(e.$name,"input"),l.push(e),e.$name&&(a[e.$name]=e)},a.$removeControl=function(e){e.$name&&a[e.$name]===e&&delete a[e.$name],i(u,function(t,n){a.$setValidity(n,!0,e)}),A(l,e)},a.$setValidity=function(e,t,n){var r=u[e];if(t)r&&(A(r,n),r.length||(--s||(o(t),a.$valid=!0,a.$invalid=!1),u[e]=!1,o(!0,e),c.$setValidity(e,!0,a)));else{if(s||o(t),r){if(-1!=P(r,n))return}else u[e]=r=[],s++,o(!1,e),c.$setValidity(e,!1,a);r.push(n),a.$valid=!1,a.$invalid=!0}},a.$setDirty=function(){r.removeClass(e,sr),r.addClass(e,ur),a.$dirty=!0,a.$pristine=!1,c.$setDirty()},a.$setPristine=function(){r.removeClass(e,ur),r.addClass(e,sr),a.$dirty=!1,a.$pristine=!0,i(l,function(e){e.$setPristine()})}}function $t(e,t,r,o){return e.$setValidity(t,r),r?o:n}function It(e,t){var n;if(t)for(n=0;n<t.length;++n)if(e[t[n]])return!0;return!1}function kt(e,t,n,o,i,a){var c=t.prop(Lt),s=t[0].placeholder,u={};if(o.$$validityState=c,!i.android){var l=!1;t.on("compositionstart",function(e){l=!0}),t.on("compositionend",function(){l=!1,p()})}var p=function(r){if(!l){var i=t.val();xt&&"input"===(r||u).type&&t[0].placeholder!==s?s=t[0].placeholder:(O(n.ngTrim||"T")&&(i=zt(i)),r=c&&o.$$hasNativeValidators,(o.$viewValue!==i||""===i&&r)&&(e.$$phase?o.$setViewValue(i):e.$apply(function(){o.$setViewValue(i)})))}};if(i.hasEvent("input"))t.on("input",p);else{var f,m=function(){f||(f=a.defer(function(){p(),f=null}))};t.on("keydown",function(e){91===(e=e.keyCode)||15<e&&19>e||37<=e&&40>=e||m()}),i.hasEvent("paste")&&t.on("paste cut",m)}t.on("change",p),o.$render=function(){t.val(o.$isEmpty(o.$viewValue)?"":o.$viewValue)};var h=n.ngPattern;if(h&&((i=h.match(/^\/(.*)\/([gim]*)$/))?(h=RegExp(i[1],i[2]),i=function(e){return $t(o,"pattern",o.$isEmpty(e)||h.test(e),e)}):i=function(n){var i=e.$eval(h);if(!i||!i.test)throw r("ngPattern")("noregexp",h,i,R(t));return $t(o,"pattern",o.$isEmpty(n)||i.test(n),n)},o.$formatters.push(i),o.$parsers.push(i)),n.ngMinlength){var g=d(n.ngMinlength);i=function(e){return $t(o,"minlength",o.$isEmpty(e)||e.length>=g,e)},o.$parsers.push(i),o.$formatters.push(i)}if(n.ngMaxlength){var v=d(n.ngMaxlength);i=function(e){return $t(o,"maxlength",o.$isEmpty(e)||e.length<=v,e)},o.$parsers.push(i),o.$formatters.push(i)}}function Nt(e,t){return e="ngClass"+e,["$animate",function(n){function r(e,t){var n=[],r=0;e:for(;r<e.length;r++){for(var o=e[r],i=0;i<t.length;i++)if(o==t[i])continue e;n.push(o)}return n}function o(e){if(!Gt(e)){if(C(e))return e.split(" ");if(y(e)){var t=[];return i(e,function(e,n){e&&(t=t.concat(n.split(" ")))}),t}}return e}return{restrict:"AC",link:function(a,c,s){function u(e,t){var n=c.data("$classCounts")||{},r=[];return i(e,function(e){(0<t||n[e])&&(n[e]=(n[e]||0)+t,n[e]===+(0<t)&&r.push(e))}),c.data("$classCounts",n),r.join(" ")}function l(e){if(!0===t||a.$index%2===t){var i=o(e||[]);if(d){if(!k(e,d)){var l=o(d);p=r(i,l),i=u(i=r(l,i),-1);0===(p=u(p,1)).length?n.removeClass(c,i):0===i.length?n.addClass(c,p):n.setClass(c,p,i)}}else{var p=u(i,1);s.$addClass(p)}}d=I(e)}var d;a.$watch(s[e],l,!0),s.$observe("class",function(t){l(a.$eval(s[e]))}),"ngClass"!==e&&a.$watch("$index",function(n,r){var i=1&n;if(i!==(1&r)){var c=o(a.$eval(s[e]));i===t?(i=u(c,1),s.$addClass(i)):(i=u(c,-1),s.$removeClass(i))}})}}}]}var xt,Dt,Mt,Ot,Rt,Lt="validity",Vt=function(e){return C(e)?e.toLowerCase():e},Ut=Object.prototype.hasOwnProperty,Ft=function(e){return C(e)?e.toUpperCase():e},Bt=[].slice,Ht=[].push,Wt=Object.prototype.toString,qt=r("ng"),jt=e.angular||(e.angular={}),Yt=["0","0","0"];xt=d((/msie (\d+)/.exec(Vt(navigator.userAgent))||[])[1]),isNaN(xt)&&(xt=d((/trident\/.*; rv:(\d+)/.exec(Vt(navigator.userAgent))||[])[1])),f.$inject=[],m.$inject=[];var Gt=T(Array.isArray)?Array.isArray:function(e){return"[object Array]"===Wt.call(e)},zt=String.prototype.trim?function(e){return C(e)?e.trim():e}:function(e){return C(e)?e.replace(/^\s\s*/,"").replace(/\s\s*$/,""):e};Rt=9>xt?function(e){return(e=e.nodeName?e:e[0]).scopeName&&"HTML"!=e.scopeName?Ft(e.scopeName+":"+e.nodeName):e.nodeName}:function(e){return e.nodeName?e.nodeName:e[0].nodeName};var Kt=function(){if(v(Kt.isActive_))return Kt.isActive_;var e=!(!t.querySelector("[ng-csp]")&&!t.querySelector("[data-ng-csp]"));if(!e)try{new Function("")}catch(t){e=!0}return Kt.isActive_=e},Zt=/[A-Z]/g,Jt={full:"1.2.22",major:1,minor:2,dot:22,codeName:"finicky-pleasure"};J.expando="ng339";var Qt=J.cache={},Xt=1,en=e.document.addEventListener?function(e,t,n){e.addEventListener(t,n,!1)}:function(e,t,n){e.attachEvent("on"+t,n)},tn=e.document.removeEventListener?function(e,t,n){e.removeEventListener(t,n,!1)}:function(e,t,n){e.detachEvent("on"+t,n)};J._data=function(e){return this.cache[e[this.expando]]||{}};var nn=/([\:\-\_]+(.))/g,rn=/^moz([A-Z])/,on=r("jqLite"),an=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,cn=/<|&#?\w+;/,sn=/<([\w:]+)/,un=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,ln={option:[1,'<select multiple="multiple">',"</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ln.optgroup=ln.option,ln.tbody=ln.tfoot=ln.colgroup=ln.caption=ln.thead,ln.th=ln.td;var dn=J.prototype={ready:function(n){function r(){o||(o=!0,n())}var o=!1;"complete"===t.readyState?setTimeout(r):(this.on("DOMContentLoaded",r),J(e).on("load",r))},toString:function(){var e=[];return i(this,function(t){e.push(""+t)}),"["+e.join(", ")+"]"},eq:function(e){return Dt(0<=e?this[e]:this[this.length+e])},length:0,push:Ht,sort:[].sort,splice:[].splice},pn={};i("multiple selected checked disabled readOnly required open".split(" "),function(e){pn[Vt(e)]=e});var fn={};i("input select option textarea button form details".split(" "),function(e){fn[Ft(e)]=!0}),i({data:re,removeData:te},function(e,t){J[t]=e}),i({data:re,inheritedData:ue,scope:function(e){return Dt.data(e,"$scope")||ue(e.parentNode||e,["$isolateScope","$scope"])},isolateScope:function(e){return Dt.data(e,"$isolateScope")||Dt.data(e,"$isolateScopeNoTemplate")},controller:se,injector:function(e){return ue(e,"$injector")},removeAttr:function(e,t){e.removeAttribute(t)},hasClass:oe,css:function(e,t,r){var o;if(t=K(t),!v(r))return 8>=xt&&(""===(o=e.currentStyle&&e.currentStyle[t])&&(o="auto")),o=o||e.style[t],8>=xt&&(o=""===o?n:o),o;e.style[t]=r},attr:function(e,t,r){var o=Vt(t);if(pn[o]){if(!v(r))return e[t]||(e.attributes.getNamedItem(t)||f).specified?o:n;r?(e[t]=!0,e.setAttribute(t,o)):(e[t]=!1,e.removeAttribute(o))}else if(v(r))e.setAttribute(t,r);else if(e.getAttribute)return null===(e=e.getAttribute(t,2))?n:e},prop:function(e,t,n){if(!v(n))return e[t];e[t]=n},text:function(){function e(e,n){var r=t[e.nodeType];if(g(n))return r?e[r]:"";e[r]=n}var t=[];return 9>xt?(t[1]="innerText",t[3]="nodeValue"):t[1]=t[3]="textContent",e.$dv="",e}(),val:function(e,t){if(g(t)){if("SELECT"===Rt(e)&&e.multiple){var n=[];return i(e.options,function(e){e.selected&&n.push(e.value||e.text)}),0===n.length?null:n}return e.value}e.value=t},html:function(e,t){if(g(t))return e.innerHTML;for(var n=0,r=e.childNodes;n<r.length;n++)X(r[n]);e.innerHTML=t},empty:le},function(e,t){J.prototype[t]=function(t,r){var o,i,a=this.length;if(e!==le&&(2==e.length&&e!==oe&&e!==se?t:r)===n){if(y(t)){for(o=0;o<a;o++)if(e===re)e(this[o],t);else for(i in t)e(this[o],i,t[i]);return this}for(a=(o=e.$dv)===n?Math.min(a,1):a,i=0;i<a;i++){var c=e(this[i],t,r);o=o?o+c:c}return o}for(o=0;o<a;o++)e(this[o],t,r);return this}}),i({removeData:te,dealoc:X,on:function e(n,r,o,a){if(v(a))throw on("onargs");var c=ne(n,"events"),s=ne(n,"handle");c||ne(n,"events",c={}),s||ne(n,"handle",s=function(e,n){var r=function(r,o){if(r.preventDefault||(r.preventDefault=function(){r.returnValue=!1}),r.stopPropagation||(r.stopPropagation=function(){r.cancelBubble=!0}),r.target||(r.target=r.srcElement||t),g(r.defaultPrevented)){var a=r.preventDefault;r.preventDefault=function(){r.defaultPrevented=!0,a.call(r)},r.defaultPrevented=!1}r.isDefaultPrevented=function(){return r.defaultPrevented||!1===r.returnValue},i(I(n[o||r.type]||[]),function(t){t.call(e,r)}),8>=xt?(r.preventDefault=null,r.stopPropagation=null,r.isDefaultPrevented=null):(delete r.preventDefault,delete r.stopPropagation,delete r.isDefaultPrevented)};return r.elem=e,r}(n,c)),i(r.split(" "),function(r){var i=c[r];if(!i){if("mouseenter"==r||"mouseleave"==r){var a=t.body.contains||t.body.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1};c[r]=[],e(n,{mouseleave:"mouseout",mouseenter:"mouseover"}[r],function(e){var t=e.relatedTarget;t&&(t===this||a(this,t))||s(e,r)})}else en(n,r,s),c[r]=[];i=c[r]}i.push(o)})},off:ee,one:function(e,t,n){(e=Dt(e)).on(t,function r(){e.off(t,n),e.off(t,r)}),e.on(t,n)},replaceWith:function(e,t){var n,r=e.parentNode;X(e),i(new J(t),function(t){n?r.insertBefore(t,n.nextSibling):r.replaceChild(t,e),n=t})},children:function(e){var t=[];return i(e.childNodes,function(e){1===e.nodeType&&t.push(e)}),t},contents:function(e){return e.contentDocument||e.childNodes||[]},append:function(e,t){i(new J(t),function(t){1!==e.nodeType&&11!==e.nodeType||e.appendChild(t)})},prepend:function(e,t){if(1===e.nodeType){var n=e.firstChild;i(new J(t),function(t){e.insertBefore(t,n)})}},wrap:function(e,t){t=Dt(t)[0];var n=e.parentNode;n&&n.replaceChild(t,e),t.appendChild(e)},remove:function(e){X(e);var t=e.parentNode;t&&t.removeChild(e)},after:function(e,t){var n=e,r=e.parentNode;i(new J(t),function(e){r.insertBefore(e,n.nextSibling),n=e})},addClass:ae,removeClass:ie,toggleClass:function(e,t,n){t&&i(t.split(" "),function(t){var r=n;g(r)&&(r=!oe(e,t)),(r?ae:ie)(e,t)})},parent:function(e){return(e=e.parentNode)&&11!==e.nodeType?e:null},next:function(e){if(e.nextElementSibling)return e.nextElementSibling;for(e=e.nextSibling;null!=e&&1!==e.nodeType;)e=e.nextSibling;return e},find:function(e,t){return e.getElementsByTagName?e.getElementsByTagName(t):[]},clone:Q,triggerHandler:function(e,t,n){var r,o;r=t.type||t;var a=(ne(e,"events")||{})[r];a&&(r={preventDefault:function(){this.defaultPrevented=!0},isDefaultPrevented:function(){return!0===this.defaultPrevented},stopPropagation:f,type:r,target:e},t.type&&(r=l(r,t)),t=I(a),o=n?[r].concat(n):[r],i(t,function(t){t.apply(e,o)}))}},function(e,t){J.prototype[t]=function(t,n,r){for(var o,i=0;i<this.length;i++)g(o)?v(o=e(this[i],t,n,r))&&(o=Dt(o)):ce(o,e(this[i],t,n,r));return v(o)?o:this},J.prototype.bind=J.prototype.on,J.prototype.unbind=J.prototype.off}),fe.prototype={put:function(e,t){this[pe(e,this.nextUid)]=t},get:function(e){return this[pe(e,this.nextUid)]},remove:function(e){var t=this[e=pe(e,this.nextUid)];return delete this[e],t}};var mn=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,hn=/,/,gn=/^\s*(_?)(\S+?)\1\s*$/,vn=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,yn=r("$injector"),Cn=r("$animate"),En=["$provide",function(e){this.$$selectors={},this.register=function(t,n){var r=t+"-animation";if(t&&"."!=t.charAt(0))throw Cn("notcsel",t);this.$$selectors[t.substr(1)]=r,e.factory(r,n)},this.classNameFilter=function(e){return 1===arguments.length&&(this.$$classNameFilter=e instanceof RegExp?e:null),this.$$classNameFilter},this.$get=["$timeout","$$asyncCallback",function(e,t){return{enter:function(e,n,r,o){r?r.after(e):(n&&n[0]||(n=r.parent()),n.append(e)),o&&t(o)},leave:function(e,n){e.remove(),n&&t(n)},move:function(e,t,n,r){this.enter(e,t,n,r)},addClass:function(e,n,r){n=C(n)?n:Gt(n)?n.join(" "):"",i(e,function(e){ae(e,n)}),r&&t(r)},removeClass:function(e,n,r){n=C(n)?n:Gt(n)?n.join(" "):"",i(e,function(e){ie(e,n)}),r&&t(r)},setClass:function(e,n,r,o){i(e,function(e){ae(e,n),ie(e,r)}),o&&t(o)},enabled:f}}]}],Sn=r("$compile");Te.$inject=["$provide","$$sanitizeUriProvider"];var Tn=/^(x[\:\-_]|data[\:\-_])/i,_n=r("$interpolate"),wn=/^([^\?#]*)(\?([^#]*))?(#(.*))?$/,bn={http:80,https:443,ftp:21},Pn=r("$location");je.prototype=qe.prototype=We.prototype={$$html5:!1,$$replace:!1,absUrl:Ye("$$absUrl"),url:function(e,t){if(g(e))return this.$$url;var n=wn.exec(e);return n[1]&&this.path(decodeURIComponent(n[1])),(n[2]||n[1])&&this.search(n[3]||""),this.hash(n[5]||"",t),this},protocol:Ye("$$protocol"),host:Ye("$$host"),port:Ye("$$port"),path:Ge("$$path",function(e){return"/"==e.charAt(0)?e:"/"+e}),search:function(e,t){switch(arguments.length){case 0:return this.$$search;case 1:if(C(e))this.$$search=V(e);else{if(!y(e))throw Pn("isrcharg");i(e,function(t,n){null==t&&delete e[n]}),this.$$search=e}break;default:g(t)||null===t?delete this.$$search[e]:this.$$search[e]=t}return this.$$compose(),this},hash:Ge("$$hash",m),replace:function(){return this.$$replace=!0,this}};var An,$n=r("$parse"),In={},kn=Function.prototype.call,Nn=Function.prototype.apply,xn=Function.prototype.bind,Dn={null:function(){return null},true:function(){return!0},false:function(){return!1},undefined:f,"+":function(e,t,r,o){return r=r(e,t),o=o(e,t),v(r)?v(o)?r+o:r:v(o)?o:n},"-":function(e,t,n,r){return n=n(e,t),r=r(e,t),(v(n)?n:0)-(v(r)?r:0)},"*":function(e,t,n,r){return n(e,t)*r(e,t)},"/":function(e,t,n,r){return n(e,t)/r(e,t)},"%":function(e,t,n,r){return n(e,t)%r(e,t)},"^":function(e,t,n,r){return n(e,t)^r(e,t)},"=":f,"===":function(e,t,n,r){return n(e,t)===r(e,t)},"!==":function(e,t,n,r){return n(e,t)!==r(e,t)},"==":function(e,t,n,r){return n(e,t)==r(e,t)},"!=":function(e,t,n,r){return n(e,t)!=r(e,t)},"<":function(e,t,n,r){return n(e,t)<r(e,t)},">":function(e,t,n,r){return n(e,t)>r(e,t)},"<=":function(e,t,n,r){return n(e,t)<=r(e,t)},">=":function(e,t,n,r){return n(e,t)>=r(e,t)},"&&":function(e,t,n,r){return n(e,t)&&r(e,t)},"||":function(e,t,n,r){return n(e,t)||r(e,t)},"&":function(e,t,n,r){return n(e,t)&r(e,t)},"|":function(e,t,n,r){return r(e,t)(e,t,n(e,t))},"!":function(e,t,n){return!n(e,t)}},Mn={n:"\n",f:"\f",r:"\r",t:"\t",v:"\v","'":"'",'"':'"'},On=function(e){this.options=e};On.prototype={constructor:On,lex:function(e){for(this.text=e,this.index=0,this.ch=n,this.lastCh=":",this.tokens=[];this.index<this.text.length;){if(this.ch=this.text.charAt(this.index),this.is("\"'"))this.readString(this.ch);else if(this.isNumber(this.ch)||this.is(".")&&this.isNumber(this.peek()))this.readNumber();else if(this.isIdent(this.ch))this.readIdent();else if(this.is("(){}[].,;:?"))this.tokens.push({index:this.index,text:this.ch}),this.index++;else{if(this.isWhitespace(this.ch)){this.index++;continue}var t=(e=this.ch+this.peek())+this.peek(2),r=Dn[this.ch],o=Dn[e],i=Dn[t];i?(this.tokens.push({index:this.index,text:t,fn:i}),this.index+=3):o?(this.tokens.push({index:this.index,text:e,fn:o}),this.index+=2):r?(this.tokens.push({index:this.index,text:this.ch,fn:r}),this.index+=1):this.throwError("Unexpected next character ",this.index,this.index+1)}this.lastCh=this.ch}return this.tokens},is:function(e){return-1!==e.indexOf(this.ch)},was:function(e){return-1!==e.indexOf(this.lastCh)},peek:function(e){return e=e||1,this.index+e<this.text.length&&this.text.charAt(this.index+e)},isNumber:function(e){return"0"<=e&&"9">=e},isWhitespace:function(e){return" "===e||"\r"===e||"\t"===e||"\n"===e||"\v"===e||" "===e},isIdent:function(e){return"a"<=e&&"z">=e||"A"<=e&&"Z">=e||"_"===e||"$"===e},isExpOperator:function(e){return"-"===e||"+"===e||this.isNumber(e)},throwError:function(e,t,n){throw n=n||this.index,t=v(t)?"s "+t+"-"+this.index+" ["+this.text.substring(t,n)+"]":" "+n,$n("lexerr",e,t,this.text)},readNumber:function(){for(var e="",t=this.index;this.index<this.text.length;){var n=Vt(this.text.charAt(this.index));if("."==n||this.isNumber(n))e+=n;else{var r=this.peek();if("e"==n&&this.isExpOperator(r))e+=n;else if(this.isExpOperator(n)&&r&&this.isNumber(r)&&"e"==e.charAt(e.length-1))e+=n;else{if(!this.isExpOperator(n)||r&&this.isNumber(r)||"e"!=e.charAt(e.length-1))break;this.throwError("Invalid exponent")}}this.index++}e*=1,this.tokens.push({index:t,text:e,literal:!0,constant:!0,fn:function(){return e}})},readIdent:function(){for(var e,t,n,r,o=this,i="",a=this.index;this.index<this.text.length&&("."===(r=this.text.charAt(this.index))||this.isIdent(r)||this.isNumber(r));)"."===r&&(e=this.index),i+=r,this.index++;if(e)for(t=this.index;t<this.text.length;){if("("===(r=this.text.charAt(t))){n=i.substr(e-a+1),i=i.substr(0,e-a),this.index=t;break}if(!this.isWhitespace(r))break;t++}if(a={index:a,text:i},Dn.hasOwnProperty(i))a.fn=Dn[i],a.literal=!0,a.constant=!0;else{var c=et(i,this.options,this.text);a.fn=l(function(e,t){return c(e,t)},{assign:function(e,t){return Qe(e,i,t,o.text,o.options)}})}this.tokens.push(a),n&&(this.tokens.push({index:e,text:"."}),this.tokens.push({index:e+1,text:n}))},readString:function(e){var t=this.index;this.index++;for(var n="",r=e,o=!1;this.index<this.text.length;){var i=this.text.charAt(this.index);r=r+i;if(o)"u"===i?((o=this.text.substring(this.index+1,this.index+5)).match(/[\da-f]{4}/i)||this.throwError("Invalid unicode escape [\\u"+o+"]"),this.index+=4,n+=String.fromCharCode(parseInt(o,16))):n+=Mn[i]||i,o=!1;else if("\\"===i)o=!0;else{if(i===e)return this.index++,void this.tokens.push({index:t,text:r,string:n,literal:!0,constant:!0,fn:function(){return n}});n+=i}this.index++}this.throwError("Unterminated quote",t)}};var Rn=function(e,t,n){this.lexer=e,this.$filter=t,this.options=n};Rn.ZERO=l(function(){return 0},{constant:!0}),Rn.prototype={constructor:Rn,parse:function(e){return this.text=e,this.tokens=this.lexer.lex(e),e=this.statements(),0!==this.tokens.length&&this.throwError("is an unexpected token",this.tokens[0]),e.literal=!!e.literal,e.constant=!!e.constant,e},primary:function(){var e,t;if(this.expect("("))e=this.filterChain(),this.consume(")");else if(this.expect("["))e=this.arrayDeclaration();else if(this.expect("{"))e=this.object();else{var n=this.expect();(e=n.fn)||this.throwError("not a primary expression",n),e.literal=!!n.literal,e.constant=!!n.constant}for(;n=this.expect("(","[",".");)"("===n.text?(e=this.functionCall(e,t),t=null):"["===n.text?(t=e,e=this.objectIndex(e)):"."===n.text?(t=e,e=this.fieldAccess(e)):this.throwError("IMPOSSIBLE");return e},throwError:function(e,t){throw $n("syntax",t.text,e,t.index+1,this.text,this.text.substring(t.index))},peekToken:function(){if(0===this.tokens.length)throw $n("ueoe",this.text);return this.tokens[0]},peek:function(e,t,n,r){if(0<this.tokens.length){var o=this.tokens[0],i=o.text;if(i===e||i===t||i===n||i===r||!(e||t||n||r))return o}return!1},expect:function(e,t,n,r){return!!(e=this.peek(e,t,n,r))&&(this.tokens.shift(),e)},consume:function(e){this.expect(e)||this.throwError("is unexpected, expecting ["+e+"]",this.peek())},unaryFn:function(e,t){return l(function(n,r){return e(n,r,t)},{constant:t.constant})},ternaryFn:function(e,t,n){return l(function(r,o){return e(r,o)?t(r,o):n(r,o)},{constant:e.constant&&t.constant&&n.constant})},binaryFn:function(e,t,n){return l(function(r,o){return t(r,o,e,n)},{constant:e.constant&&n.constant})},statements:function(){for(var e=[];;)if(0<this.tokens.length&&!this.peek("}",")",";","]")&&e.push(this.filterChain()),!this.expect(";"))return 1===e.length?e[0]:function(t,n){for(var r,o=0;o<e.length;o++){var i=e[o];i&&(r=i(t,n))}return r}},filterChain:function(){for(var e,t=this.expression();;){if(!(e=this.expect("|")))return t;t=this.binaryFn(t,e.fn,this.filter())}},filter:function(){for(var e=this.expect(),t=this.$filter(e.text),n=[];;){if(!(e=this.expect(":"))){var r=function(e,r,o){o=[o];for(var i=0;i<n.length;i++)o.push(n[i](e,r));return t.apply(e,o)};return function(){return r}}n.push(this.expression())}},expression:function(){return this.assignment()},assignment:function(){var e,t,n=this.ternary();return(t=this.expect("="))?(n.assign||this.throwError("implies assignment but ["+this.text.substring(0,t.index)+"] can not be assigned to",t),e=this.ternary(),function(t,r){return n.assign(t,e(t,r),r)}):n},ternary:function(){var e,t,n=this.logicalOR();return this.expect("?")?(e=this.assignment(),(t=this.expect(":"))?this.ternaryFn(n,e,this.assignment()):void this.throwError("expected :",t)):n},logicalOR:function(){for(var e,t=this.logicalAND();;){if(!(e=this.expect("||")))return t;t=this.binaryFn(t,e.fn,this.logicalAND())}},logicalAND:function(){var e,t=this.equality();return(e=this.expect("&&"))&&(t=this.binaryFn(t,e.fn,this.logicalAND())),t},equality:function(){var e,t=this.relational();return(e=this.expect("==","!=","===","!=="))&&(t=this.binaryFn(t,e.fn,this.equality())),t},relational:function(){var e,t=this.additive();return(e=this.expect("<",">","<=",">="))&&(t=this.binaryFn(t,e.fn,this.relational())),t},additive:function(){for(var e,t=this.multiplicative();e=this.expect("+","-");)t=this.binaryFn(t,e.fn,this.multiplicative());return t},multiplicative:function(){for(var e,t=this.unary();e=this.expect("*","/","%");)t=this.binaryFn(t,e.fn,this.unary());return t},unary:function(){var e;return this.expect("+")?this.primary():(e=this.expect("-"))?this.binaryFn(Rn.ZERO,e.fn,this.unary()):(e=this.expect("!"))?this.unaryFn(e.fn,this.unary()):this.primary()},fieldAccess:function(e){var t=this,n=this.expect().text,r=et(n,this.options,this.text);return l(function(t,n,o){return r(o||e(t,n))},{assign:function(r,o,i){return(i=e(r,i))||e.assign(r,i={}),Qe(i,n,o,t.text,t.options)}})},objectIndex:function(e){var t=this,r=this.expression();return this.consume("]"),l(function(o,i){var a,c=e(o,i),s=r(o,i);return Ze(s,t.text),c?((c=Je(c[s],t.text))&&c.then&&t.options.unwrapPromises&&(a=c,"$$v"in c||(a.$$v=n,a.then(function(e){a.$$v=e})),c=c.$$v),c):n},{assign:function(n,o,i){var a=Ze(r(n,i),t.text);return(i=Je(e(n,i),t.text))||e.assign(n,i={}),i[a]=o}})},functionCall:function(e,t){var n=[];if(")"!==this.peekToken().text)do{n.push(this.expression())}while(this.expect(","));this.consume(")");var r=this;return function(o,i){for(var a=[],c=t?t(o,i):o,s=0;s<n.length;s++)a.push(n[s](o,i));s=e(o,i,c)||f,Je(c,r.text);var u=r.text;if(s){if(s.constructor===s)throw $n("isecfn",u);if(s===kn||s===Nn||xn&&s===xn)throw $n("isecff",u)}return Je(a=s.apply?s.apply(c,a):s(a[0],a[1],a[2],a[3],a[4]),r.text)}},arrayDeclaration:function(){var e=[],t=!0;if("]"!==this.peekToken().text)do{if(this.peek("]"))break;var n=this.expression();e.push(n),n.constant||(t=!1)}while(this.expect(","));return this.consume("]"),l(function(t,n){for(var r=[],o=0;o<e.length;o++)r.push(e[o](t,n));return r},{literal:!0,constant:t})},object:function(){var e=[],t=!0;if("}"!==this.peekToken().text)do{if(this.peek("}"))break;var n=(n=this.expect()).string||n.text;this.consume(":");var r=this.expression();e.push({key:n,value:r}),r.constant||(t=!1)}while(this.expect(","));return this.consume("}"),l(function(t,n){for(var r={},o=0;o<e.length;o++){var i=e[o];r[i.key]=i.value(t,n)}return r},{literal:!0,constant:t})}};var Ln={},Vn=r("$sce"),Un={HTML:"html",CSS:"css",URL:"url",RESOURCE_URL:"resourceUrl",JS:"js"},Fn=t.createElement("a"),Bn=dt(e.location.href);mt.$inject=["$provide"],gt.$inject=["$locale"],vt.$inject=["$locale"];var Hn=".",Wn={yyyy:Et("FullYear",4),yy:Et("FullYear",2,0,!0),y:Et("FullYear",1),MMMM:St("Month"),MMM:St("Month",!0),MM:Et("Month",2,1),M:Et("Month",1,1),dd:Et("Date",2),d:Et("Date",1),HH:Et("Hours",2),H:Et("Hours",1),hh:Et("Hours",2,-12),h:Et("Hours",1,-12),mm:Et("Minutes",2),m:Et("Minutes",1),ss:Et("Seconds",2),s:Et("Seconds",1),sss:Et("Milliseconds",3),EEEE:St("Day"),EEE:St("Day",!0),a:function(e,t){return 12>e.getHours()?t.AMPMS[0]:t.AMPMS[1]},Z:function(e){return(0<=(e=-1*e.getTimezoneOffset())?"+":"")+(Ct(Math[0<e?"floor":"ceil"](e/60),2)+Ct(Math.abs(e%60),2))}},qn=/((?:[^yMdHhmsaZE']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z))(.*)/,jn=/^\-?\d+$/;Tt.$inject=["$locale"];var Yn=h(Vt),Gn=h(Ft);bt.$inject=["$parse"];var zn=h({restrict:"E",compile:function(e,n){if(8>=xt&&(n.href||n.name||n.$set("href",""),e.append(t.createComment("IE fix"))),!n.href&&!n.xlinkHref&&!n.name)return function(e,t){var n="[object SVGAnimatedString]"===Wt.call(t.prop("href"))?"xlink:href":"href";t.on("click",function(e){t.attr(n)||e.preventDefault()})}}}),Kn={};i(pn,function(e,t){if("multiple"!=e){var n=_e("ng-"+t);Kn[n]=function(){return{priority:100,link:function(e,r,o){e.$watch(o[n],function(e){o.$set(t,!!e)})}}}}}),i(["src","srcset","href"],function(e){var t=_e("ng-"+e);Kn[t]=function(){return{priority:99,link:function(n,r,o){var i=e,a=e;"href"===e&&"[object SVGAnimatedString]"===Wt.call(r.prop("href"))&&(a="xlinkHref",o.$attr[a]="xlink:href",i=null),o.$observe(t,function(e){e&&(o.$set(a,e),xt&&i&&r.prop(i,o[a]))})}}}});var Zn={$addControl:f,$removeControl:f,$setValidity:f,$setDirty:f,$setPristine:f};At.$inject=["$element","$attrs","$scope","$animate"];var Jn=function(e){return["$timeout",function(t){return{name:"form",restrict:e?"EAC":"E",controller:At,compile:function(){return{pre:function(e,r,o,i){if(!o.action){var a=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1};en(r[0],"submit",a),r.on("$destroy",function(){t(function(){tn(r[0],"submit",a)},0,!1)})}var c=r.parent().controller("form"),s=o.name||o.ngForm;s&&Qe(e,s,i,s),c&&r.on("$destroy",function(){c.$removeControl(i),s&&Qe(e,s,n,s),l(i,Zn)})}}}}}]},Qn=Jn(),Xn=Jn(!0),er=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/,tr=/^[a-z0-9!#$%&'*+\/=?^_`{|}~.-]+@[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)*$/i,nr=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/,rr={text:kt,number:function(e,t,r,o,i,a){kt(e,t,r,o,i,a),o.$parsers.push(function(e){var t=o.$isEmpty(e);return t||nr.test(e)?(o.$setValidity("number",!0),""===e?null:t?e:parseFloat(e)):(o.$setValidity("number",!1),n)}),function(e,t,n,r,o){y(o)&&(e.$$hasNativeValidators=!0,e.$parsers.push(function(i){if(e.$error[t]||It(o,r)||!It(o,n))return i;e.$setValidity(t,!1)}))}(o,"number",or,null,o.$$validityState),o.$formatters.push(function(e){return o.$isEmpty(e)?"":""+e}),r.min&&(e=function(e){var t=parseFloat(r.min);return $t(o,"min",o.$isEmpty(e)||e>=t,e)},o.$parsers.push(e),o.$formatters.push(e)),r.max&&(e=function(e){var t=parseFloat(r.max);return $t(o,"max",o.$isEmpty(e)||e<=t,e)},o.$parsers.push(e),o.$formatters.push(e)),o.$formatters.push(function(e){return $t(o,"number",o.$isEmpty(e)||E(e),e)})},url:function(e,t,n,r,o,i){kt(e,t,n,r,o,i),e=function(e){return $t(r,"url",r.$isEmpty(e)||er.test(e),e)},r.$formatters.push(e),r.$parsers.push(e)},email:function(e,t,n,r,o,i){kt(e,t,n,r,o,i),e=function(e){return $t(r,"email",r.$isEmpty(e)||tr.test(e),e)},r.$formatters.push(e),r.$parsers.push(e)},radio:function(e,t,n,r){g(n.name)&&t.attr("name",s()),t.on("click",function(){t[0].checked&&e.$apply(function(){r.$setViewValue(n.value)})}),r.$render=function(){t[0].checked=n.value==r.$viewValue},n.$observe("value",r.$render)},checkbox:function(e,t,n,r){var o=n.ngTrueValue,i=n.ngFalseValue;C(o)||(o=!0),C(i)||(i=!1),t.on("click",function(){e.$apply(function(){r.$setViewValue(t[0].checked)})}),r.$render=function(){t[0].checked=r.$viewValue},r.$isEmpty=function(e){return e!==o},r.$formatters.push(function(e){return e===o}),r.$parsers.push(function(e){return e?o:i})},hidden:f,button:f,submit:f,reset:f,file:f},or=["badInput"],ir=["$browser","$sniffer",function(e,t){return{restrict:"E",require:"?ngModel",link:function(n,r,o,i){i&&(rr[Vt(o.type)]||rr.text)(n,r,o,i,t,e)}}}],ar="ng-valid",cr="ng-invalid",sr="ng-pristine",ur="ng-dirty",lr=["$scope","$exceptionHandler","$attrs","$element","$parse","$animate",function(e,t,n,o,a,c){function s(e,t){t=t?"-"+W(t,"-"):"",c.removeClass(o,(e?cr:ar)+t),c.addClass(o,(e?ar:cr)+t)}this.$modelValue=this.$viewValue=Number.NaN,this.$parsers=[],this.$formatters=[],this.$viewChangeListeners=[],this.$pristine=!0,this.$dirty=!1,this.$valid=!0,this.$invalid=!1,this.$name=n.name;var u=a(n.ngModel),l=u.assign;if(!l)throw r("ngModel")("nonassign",n.ngModel,R(o));this.$render=f,this.$isEmpty=function(e){return g(e)||""===e||null===e||e!=e};var d=o.inheritedData("$formController")||Zn,p=0,m=this.$error={};o.addClass(sr),s(!0),this.$setValidity=function(e,t){m[e]!==!t&&(t?(m[e]&&p--,p||(s(!0),this.$valid=!0,this.$invalid=!1)):(s(!1),this.$invalid=!0,this.$valid=!1,p++),m[e]=!t,s(t,e),d.$setValidity(e,t,this))},this.$setPristine=function(){this.$dirty=!1,this.$pristine=!0,c.removeClass(o,ur),c.addClass(o,sr)},this.$setViewValue=function(n){this.$viewValue=n,this.$pristine&&(this.$dirty=!0,this.$pristine=!1,c.removeClass(o,sr),c.addClass(o,ur),d.$setDirty()),i(this.$parsers,function(e){n=e(n)}),this.$modelValue!==n&&(this.$modelValue=n,l(e,n),i(this.$viewChangeListeners,function(e){try{e()}catch(e){t(e)}}))};var h=this;e.$watch(function(){var t=u(e);if(h.$modelValue!==t){var n=h.$formatters,r=n.length;for(h.$modelValue=t;r--;)t=n[r](t);h.$viewValue!==t&&(h.$viewValue=t,h.$render())}return t})}],dr=function(){return{require:["ngModel","^?form"],controller:lr,link:function(e,t,n,r){var o=r[0],i=r[1]||Zn;i.$addControl(o),e.$on("$destroy",function(){i.$removeControl(o)})}}},pr=h({require:"ngModel",link:function(e,t,n,r){r.$viewChangeListeners.push(function(){e.$eval(n.ngChange)})}}),fr=function(){return{require:"?ngModel",link:function(e,t,n,r){if(r){n.required=!0;var o=function(e){if(!n.required||!r.$isEmpty(e))return r.$setValidity("required",!0),e;r.$setValidity("required",!1)};r.$formatters.push(o),r.$parsers.unshift(o),n.$observe("required",function(){o(r.$viewValue)})}}}},mr=function(){return{require:"ngModel",link:function(e,t,r,o){var a=(e=/\/(.*)\//.exec(r.ngList))&&RegExp(e[1])||r.ngList||",";o.$parsers.push(function(e){if(!g(e)){var t=[];return e&&i(e.split(a),function(e){e&&t.push(zt(e))}),t}}),o.$formatters.push(function(e){return Gt(e)?e.join(", "):n}),o.$isEmpty=function(e){return!e||!e.length}}}},hr=/^(true|false|\d+)$/,gr=function(){return{priority:100,compile:function(e,t){return hr.test(t.ngValue)?function(e,t,n){n.$set("value",e.$eval(n.ngValue))}:function(e,t,n){e.$watch(n.ngValue,function(e){n.$set("value",e)})}}}},vr=Pt({compile:function(e){return e.addClass("ng-binding"),function(e,t,r){t.data("$binding",r.ngBind),e.$watch(r.ngBind,function(e){t.text(e==n?"":e)})}}}),yr=["$interpolate",function(e){return function(t,n,r){t=e(n.attr(r.$attr.ngBindTemplate)),n.addClass("ng-binding").data("$binding",t),r.$observe("ngBindTemplate",function(e){n.text(e)})}}],Cr=["$sce","$parse",function(e,t){return{compile:function(n){return n.addClass("ng-binding"),function(n,r,o){r.data("$binding",o.ngBindHtml);var i=t(o.ngBindHtml);n.$watch(function(){return(i(n)||"").toString()},function(t){r.html(e.getTrustedHtml(i(n))||"")})}}}}],Er=Nt("",!0),Sr=Nt("Odd",0),Tr=Nt("Even",1),_r=Pt({compile:function(e,t){t.$set("ngCloak",n),e.removeClass("ng-cloak")}}),wr=[function(){return{scope:!0,controller:"@",priority:500}}],br={};i("click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave keydown keyup keypress submit focus blur copy cut paste".split(" "),function(e){var t=_e("ng-"+e);br[t]=["$parse",function(n){return{compile:function(r,o){var i=n(o[t]);return function(t,n){n.on(Vt(e),function(e){t.$apply(function(){i(t,{$event:e})})})}}}}]});var Pr=["$animate",function(e){return{transclude:"element",priority:600,terminal:!0,restrict:"A",$$tlb:!0,link:function(n,r,o,i,a){var c,s,u;n.$watch(o.ngIf,function(i){O(i)?s||(s=n.$new(),a(s,function(n){n[n.length++]=t.createComment(" end ngIf: "+o.ngIf+" "),c={clone:n},e.enter(n,r.parent(),r)})):(u&&(u.remove(),u=null),s&&(s.$destroy(),s=null),c&&(u=z(c.clone),e.leave(u,function(){u=null}),c=null))})}}}],Ar=["$http","$templateCache","$anchorScroll","$animate","$sce",function(e,t,n,r,o){return{restrict:"ECA",priority:400,terminal:!0,transclude:"element",controller:jt.noop,compile:function(i,a){var c=a.ngInclude||a.src,s=a.onload||"",u=a.autoscroll;return function(i,a,l,d,p){var f,m,h,g=0,y=function(){m&&(m.remove(),m=null),f&&(f.$destroy(),f=null),h&&(r.leave(h,function(){m=null}),m=h,h=null)};i.$watch(o.parseAsResourceUrl(c),function(o){var c=function(){!v(u)||u&&!i.$eval(u)||n()},l=++g;o?(e.get(o,{cache:t}).success(function(e){if(l===g){var t=i.$new();d.template=e,e=p(t,function(e){y(),r.enter(e,null,a,c)}),h=e,(f=t).$emit("$includeContentLoaded"),i.$eval(s)}}).error(function(){l===g&&y()}),i.$emit("$includeContentRequested")):(y(),d.template=null)})}}}}],$r=["$compile",function(e){return{restrict:"ECA",priority:-400,require:"ngInclude",link:function(t,n,r,o){n.html(o.template),e(n.contents())(t)}}}],Ir=Pt({priority:450,compile:function(){return{pre:function(e,t,n){e.$eval(n.ngInit)}}}}),kr=Pt({terminal:!0,priority:1e3}),Nr=["$locale","$interpolate",function(e,t){var n=/{}/g;return{restrict:"EA",link:function(r,o,a){var c=a.count,s=a.$attr.when&&o.attr(a.$attr.when),u=a.offset||0,l=r.$eval(s)||{},d={},p=t.startSymbol(),f=t.endSymbol(),m=/^when(Minus)?(.+)$/;i(a,function(e,t){m.test(t)&&(l[Vt(t.replace("when","").replace("Minus","-"))]=o.attr(a.$attr[t]))}),i(l,function(e,r){d[r]=t(e.replace(n,p+c+"-"+u+f))}),r.$watch(function(){var t=parseFloat(r.$eval(c));return isNaN(t)?"":(t in l||(t=e.pluralCat(t-u)),d[t](r,o,!0))},function(e){o.text(e)})}}}],xr=["$parse","$animate",function(e,n){var a=r("ngRepeat");return{transclude:"element",priority:1e3,terminal:!0,$$tlb:!0,link:function(r,c,s,u,l){var d,p,f,m,h,g,v=s.ngRepeat,y=v.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?\s*$/),C={$id:pe};if(!y)throw a("iexp",v);if(s=y[1],u=y[2],(y=y[3])?(d=e(y),p=function(e,t,n){return g&&(C[g]=e),C[h]=t,C.$index=n,d(r,C)}):(f=function(e,t){return pe(t)},m=function(e){return e}),!(y=s.match(/^(?:([\$\w]+)|\(([\$\w]+)\s*,\s*([\$\w]+)\))$/)))throw a("iidexp",s);h=y[3]||y[1],g=y[2];var E={};r.$watchCollection(u,function(e){var s,u,d,y,C,S,T,_,w,b=c[0],P={},A=[];if(o(e))_=e,d=p||f;else{for(S in d=p||m,_=[],e)e.hasOwnProperty(S)&&"$"!=S.charAt(0)&&_.push(S);_.sort()}for(y=_.length,u=A.length=_.length,s=0;s<u;s++)if(Y(T=d(S=e===_?s:_[s],T=e[S],s),"`track by` id"),E.hasOwnProperty(T))w=E[T],delete E[T],P[T]=w,A[s]=w;else{if(P.hasOwnProperty(T))throw i(A,function(e){e&&e.scope&&(E[e.id]=e)}),a("dupes",v,T);A[s]={id:T},P[T]=!1}for(S in E)E.hasOwnProperty(S)&&(s=z((w=E[S]).clone),n.leave(s),i(s,function(e){e.$$NG_REMOVED=!0}),w.scope.$destroy());for(s=0,u=_.length;s<u;s++){if(T=e[S=e===_?s:_[s]],w=A[s],A[s-1]&&(b=A[s-1].clone[A[s-1].clone.length-1]),w.scope){C=w.scope,d=b;do{d=d.nextSibling}while(d&&d.$$NG_REMOVED);w.clone[0]!=d&&n.move(z(w.clone),null,Dt(b)),b=w.clone[w.clone.length-1]}else C=r.$new();C[h]=T,g&&(C[g]=S),C.$index=s,C.$first=0===s,C.$last=s===y-1,C.$middle=!(C.$first||C.$last),C.$odd=!(C.$even=0==(1&s)),w.scope||l(C,function(e){e[e.length++]=t.createComment(" end ngRepeat: "+v+" "),n.enter(e,null,Dt(b)),b=e,w.scope=C,w.clone=e,P[w.id]=w})}E=P})}}}],Dr=["$animate",function(e){return function(t,n,r){t.$watch(r.ngShow,function(t){e[O(t)?"removeClass":"addClass"](n,"ng-hide")})}}],Mr=["$animate",function(e){return function(t,n,r){t.$watch(r.ngHide,function(t){e[O(t)?"addClass":"removeClass"](n,"ng-hide")})}}],Or=Pt(function(e,t,n){e.$watch(n.ngStyle,function(e,n){n&&e!==n&&i(n,function(e,n){t.css(n,"")}),e&&t.css(e)},!0)}),Rr=["$animate",function(e){return{restrict:"EA",require:"ngSwitch",controller:["$scope",function(){this.cases={}}],link:function(t,n,r,o){var a=[],c=[],s=[],u=[];t.$watch(r.ngSwitch||r.on,function(n){var l,d;for(l=0,d=s.length;l<d;++l)s[l].remove();for(l=s.length=0,d=u.length;l<d;++l){var p=c[l];u[l].$destroy(),s[l]=p,e.leave(p,function(){s.splice(l,1)})}c.length=0,u.length=0,(a=o.cases["!"+n]||o.cases["?"])&&(t.$eval(r.change),i(a,function(n){var r=t.$new();u.push(r),n.transclude(r,function(t){var r=n.element;c.push(t),e.enter(t,r.parent(),r)})}))})}}}],Lr=Pt({transclude:"element",priority:800,require:"^ngSwitch",link:function(e,t,n,r,o){r.cases["!"+n.ngSwitchWhen]=r.cases["!"+n.ngSwitchWhen]||[],r.cases["!"+n.ngSwitchWhen].push({transclude:o,element:t})}}),Vr=Pt({transclude:"element",priority:800,require:"^ngSwitch",link:function(e,t,n,r,o){r.cases["?"]=r.cases["?"]||[],r.cases["?"].push({transclude:o,element:t})}}),Ur=Pt({link:function(e,t,n,o,i){if(!i)throw r("ngTransclude")("orphan",R(t));i(function(e){t.empty(),t.append(e)})}}),Fr=["$templateCache",function(e){return{restrict:"E",terminal:!0,compile:function(t,n){"text/ng-template"==n.type&&e.put(n.id,t[0].text)}}}],Br=r("ngOptions"),Hr=h({terminal:!0}),Wr=["$compile","$parse",function(e,r){var o=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/,c={$setViewValue:f};return{restrict:"E",require:["select","?ngModel"],controller:["$element","$scope","$attrs",function(e,t,n){var r,o=this,i={},a=c;o.databound=n.ngModel,o.init=function(e,t,n){a=e,r=n},o.addOption=function(t){Y(t,'"option value"'),i[t]=!0,a.$viewValue==t&&(e.val(t),r.parent()&&r.remove())},o.removeOption=function(e){this.hasOption(e)&&(delete i[e],a.$viewValue==e&&this.renderUnknownOption(e))},o.renderUnknownOption=function(t){t="? "+pe(t)+" ?",r.val(t),e.prepend(r),e.val(t),r.prop("selected",!0)},o.hasOption=function(e){return i.hasOwnProperty(e)},t.$on("$destroy",function(){o.renderUnknownOption=f})}],link:function(c,s,u,l){if(l[1]){var d=l[0];l=l[1];var p,f=u.multiple,m=u.ngOptions,h=!1,y=Dt(t.createElement("option")),C=Dt(t.createElement("optgroup")),E=y.clone();u=0;for(var S=s.children(),T=S.length;u<T;u++)if(""===S[u].value){p=h=S.eq(u);break}d.init(l,h,E),f&&(l.$isEmpty=function(e){return!e||0===e.length}),m?function(t,i,c){function s(){var e,n,r,o,s,u={"":[]},m=[""];r=c.$modelValue,o=S(t)||[];var w,b,P,A,$,I=p?a(o):o;if(b={},P=!1,f)if(n=c.$modelValue,T&&Gt(n))for(P=new fe([]),e={},s=0;s<n.length;s++)e[d]=n[s],P.put(T(t,e),n[s]);else P=new fe(n);for(s=P,P=0;P<(w=I.length);P++){if(n=P,p){if("$"===(n=I[P]).charAt(0))continue;b[p]=n}b[d]=o[n],(n=u[e=g(t,b)||""])||(n=u[e]=[],m.push(e)),f?e=v(s.remove(T?T(t,b):E(t,b))):(T?((e={})[d]=r,e=T(t,e)===T(t,b)):e=r===E(t,b),s=s||e),A=v(A=l(t,b))?A:"",n.push({id:T?T(t,b):p?I[P]:P,label:A,selected:e})}for(f||(h||null===r?u[""].unshift({id:"",label:"",selected:!s}):s||u[""].unshift({id:"?",label:"",selected:!0})),b=0,I=m.length;b<I;b++){for(n=u[e=m[b]],_.length<=b?(o=[r={element:C.clone().attr("label",e),label:n.label}],_.push(o),i.append(r.element)):(r=(o=_[b])[0]).label!=e&&r.element.attr("label",r.label=e),A=null,P=0,w=n.length;P<w;P++)e=n[P],(s=o[P+1])?(A=s.element,s.label!==e.label&&A.text(s.label=e.label),s.id!==e.id&&A.val(s.id=e.id),A[0].selected!==e.selected&&(A.prop("selected",s.selected=e.selected),xt&&A.prop("selected",s.selected))):(""===e.id&&h?$=h:($=y.clone()).val(e.id).prop("selected",e.selected).attr("selected",e.selected).text(e.label),o.push({element:$,label:e.label,id:e.id,selected:e.selected}),A?A.after($):r.element.append($),A=$);for(P++;o.length>P;)o.pop().element.remove()}for(;_.length>b;)_.pop()[0].element.remove()}var u;if(!(u=m.match(o)))throw Br("iexp",m,R(i));var l=r(u[2]||u[1]),d=u[4]||u[6],p=u[5],g=r(u[3]||""),E=r(u[2]?u[1]:d),S=r(u[7]),T=u[8]?r(u[8]):null,_=[[{element:i,label:""}]];h&&(e(h)(t),h.removeClass("ng-scope"),h.remove()),i.empty(),i.on("change",function(){t.$apply(function(){var e,r,o,a,u,l,m,h,g=S(t)||[],v={};if(f){for(o=[],u=0,m=_.length;u<m;u++)for(a=1,l=(e=_[u]).length;a<l;a++)if((r=e[a].element)[0].selected){if(r=r.val(),p&&(v[p]=r),T)for(h=0;h<g.length&&(v[d]=g[h],T(t,v)!=r);h++);else v[d]=g[r];o.push(E(t,v))}}else if("?"==(r=i.val()))o=n;else if(""===r)o=null;else if(T){for(h=0;h<g.length;h++)if(v[d]=g[h],T(t,v)==r){o=E(t,v);break}}else v[d]=g[r],p&&(v[p]=r),o=E(t,v);c.$setViewValue(o),s()})}),c.$render=s,t.$watchCollection(S,s),f&&t.$watchCollection(function(){return c.$modelValue},s)}(c,s,l):f?function(e,t,n){var r;n.$render=function(){var e=new fe(n.$viewValue);i(t.find("option"),function(t){t.selected=v(e.get(t.value))})},e.$watch(function(){k(r,n.$viewValue)||(r=I(n.$viewValue),n.$render())}),t.on("change",function(){e.$apply(function(){var e=[];i(t.find("option"),function(t){t.selected&&e.push(t.value)}),n.$setViewValue(e)})})}(c,s,l):function(e,t,n,r){n.$render=function(){var e=n.$viewValue;r.hasOption(e)?(E.parent()&&E.remove(),t.val(e),""===e&&p.prop("selected",!0)):g(e)&&p?t.val(""):r.renderUnknownOption(e)},t.on("change",function(){e.$apply(function(){E.parent()&&E.remove(),n.$setViewValue(t.val())})})}(c,s,l,d)}}}}],qr=["$interpolate",function(e){var t={addOption:f,removeOption:f};return{restrict:"E",priority:100,compile:function(n,r){if(g(r.value)){var o=e(n.text(),!0);o||r.$set("value",n.text())}return function(e,n,r){var i=n.parent(),a=i.data("$selectController")||i.parent().data("$selectController");a&&a.databound?n.prop("selected",!1):a=t,o?e.$watch(o,function(e,t){r.$set("value",e),e!==t&&a.removeOption(t),a.addOption(e)}):a.addOption(r.value),n.on("$destroy",function(){a.removeOption(r.value)})}}}}],jr=h({restrict:"E",terminal:!0});e.angular.bootstrap?console.log("WARNING: Tried to load angular more than once."):((Mt=e.jQuery)&&Mt.fn.on?(Dt=Mt,l(Mt.fn,{scope:dn.scope,isolateScope:dn.isolateScope,controller:dn.controller,injector:dn.injector,inheritedData:dn.inheritedData}),Z("remove",!0,!0,!1),Z("empty",!1,!1,!1),Z("html",!1,!1,!0)):Dt=J,jt.element=Dt,function(t){l(t,{bootstrap:H,copy:$,extend:l,equals:k,element:Dt,forEach:i,injector:he,noop:f,bind:N,toJson:D,fromJson:M,identity:m,isUndefined:g,isDefined:v,isString:C,isFunction:T,isObject:y,isNumber:E,isElement:b,isArray:Gt,version:Jt,isDate:S,lowercase:Vt,uppercase:Ft,callbacks:{counter:0},$$minErr:r,$$csp:Kt}),Ot=function(e){var t=r("$injector"),n=r("ng");return(e=e.angular||(e.angular={})).$$minErr=e.$$minErr||r,e.module||(e.module=function(){var e={};return function(r,o,i){if("hasOwnProperty"===r)throw n("badname","module");return o&&e.hasOwnProperty(r)&&(e[r]=null),e[r]||(e[r]=function(){function e(e,t,r){return function(){return n[r||"push"]([e,t,arguments]),s}}if(!o)throw t("nomod",r);var n=[],a=[],c=e("$injector","invoke"),s={_invokeQueue:n,_runBlocks:a,requires:o,name:r,provider:e("$provide","provider"),factory:e("$provide","factory"),service:e("$provide","service"),value:e("$provide","value"),constant:e("$provide","constant","unshift"),animation:e("$animateProvider","register"),filter:e("$filterProvider","register"),controller:e("$controllerProvider","register"),directive:e("$compileProvider","directive"),config:c,run:function(e){return a.push(e),this}};return i&&c(i),s}())}}())}(e);try{Ot("ngLocale")}catch(e){Ot("ngLocale",[]).provider("$locale",Re)}Ot("ng",["ngLocale"],["$provide",function(e){e.provider({$$sanitizeUri:it}),e.provider("$compile",Te).directive({a:zn,input:ir,textarea:ir,form:Qn,script:Fr,select:Wr,style:jr,option:qr,ngBind:vr,ngBindHtml:Cr,ngBindTemplate:yr,ngClass:Er,ngClassEven:Tr,ngClassOdd:Sr,ngCloak:_r,ngController:wr,ngForm:Xn,ngHide:Mr,ngIf:Pr,ngInclude:Ar,ngInit:Ir,ngNonBindable:kr,ngPluralize:Nr,ngRepeat:xr,ngShow:Dr,ngStyle:Or,ngSwitch:Rr,ngSwitchWhen:Lr,ngSwitchDefault:Vr,ngOptions:Hr,ngTransclude:Ur,ngModel:dr,ngList:mr,ngChange:pr,required:fr,ngRequired:fr,ngValue:gr}).directive({ngInclude:$r}).directive(Kn).directive(br),e.provider({$anchorScroll:ge,$animate:En,$browser:Ce,$cacheFactory:Ee,$controller:be,$document:Pe,$exceptionHandler:Ae,$filter:mt,$interpolate:Me,$interval:Oe,$http:Ne,$httpBackend:De,$location:ze,$log:Ke,$parse:tt,$rootScope:ot,$q:nt,$sce:st,$sceDelegate:ct,$sniffer:ut,$templateCache:Se,$timeout:lt,$window:ft,$$rAF:rt,$$asyncCallback:ve})}])}(jt),Dt(t).ready(function(){!function(e,n){function r(e){e&&c.push(e)}var o,a,c=[e],s=["ng:app","ng-app","x-ng-app","data-ng-app"],u=/\sng[:\-]app(:\s*([\w\d_]+);?)?\s/;i(s,function(n){s[n]=!0,r(t.getElementById(n)),n=n.replace(":","\\:"),e.querySelectorAll&&(i(e.querySelectorAll("."+n),r),i(e.querySelectorAll("."+n+"\\:"),r),i(e.querySelectorAll("["+n+"]"),r))}),i(c,function(e){if(!o){var t=u.exec(" "+e.className+" ");t?(o=e,a=(t[2]||"").replace(/\s+/g,",")):i(e.attributes,function(t){!o&&s[t.name]&&(o=e,a=t.value)})}}),o&&n(o,a?[a]:[])}(t,H)}))}(window,document),!window.angular.$$csp()&&window.angular.element(document).find("head").prepend('<style type="text/css">@charset "UTF-8";[ng\\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide{display:none !important;}ng\\:form{display:block;}.ng-animate-block-transitions{transition:0s all!important;-webkit-transition:0s all!important;}.ng-hide-add-active,.ng-hide-remove{display:block!important;}</style>'),function(e,t,n){"use strict";function r(e){var t,n={};for(e=e.split(","),t=0;t<e.length;t++)n[e[t]]=!0;return n}function o(e){if(!e)return"";var t=A.exec(e);e=t[1];var n=t[3];return(t=t[2])&&(P.innerHTML=t.replace(/</g,"&lt;"),t="textContent"in P?P.textContent:P.innerText),e+t+n}function i(e){return e.replace(/&/g,"&amp;").replace(g,function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+((e=e.charCodeAt(1))-56320)+65536)+";"}).replace(v,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function a(e,n){var r=!1,o=t.bind(e,e.push);return{start:function(e,a,c){e=t.lowercase(e),!r&&T[e]&&(r=e),r||!0!==_[e]||(o("<"),o(e),t.forEach(a,function(r,a){var c=t.lowercase(a),s="img"===e&&"src"===c||"background"===c;!0!==b[c]||!0===w[c]&&!n(r,s)||(o(" "),o(a),o('="'),o(i(r)),o('"'))}),o(c?"/>":">"))},end:function(e){e=t.lowercase(e),r||!0!==_[e]||(o("</"),o(e),o(">")),e==r&&(r=!1)},chars:function(e){r||o(i(e))}}}var c=t.$$minErr("$sanitize"),s=/^<((?:[a-zA-Z])[\w:-]*)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*(>?)/,u=/^<\/\s*([\w:-]+)[^>]*>/,l=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,d=/^</,p=/^<\//,f=/\x3c!--(.*?)--\x3e/g,m=/<!DOCTYPE([^>]*?)>/i,h=/<!\[CDATA\[(.*?)]]\x3e/g,g=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,v=/([^\#-~| |!])/g,y=r("area,br,col,hr,img,wbr");e=r("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),n=r("rp,rt");var C=t.extend({},n,e),E=t.extend({},e,r("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul")),S=t.extend({},n,r("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var")),T=r("script,style"),_=t.extend({},y,E,S,C),w=r("background,cite,href,longdesc,src,usemap"),b=t.extend({},w,r("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,target,title,type,valign,value,vspace,width")),P=document.createElement("pre"),A=/^(\s*)([\s\S]*?)(\s*)$/;t.module("ngSanitize",[]).provider("$sanitize",function(){this.$get=["$$sanitizeUri",function(e){return function(n){var r=[];return function(e,n){function r(e,r,a,c){if(r=t.lowercase(r),E[r])for(;_.last()&&S[_.last()];)i(0,_.last());C[r]&&_.last()==r&&i(0,r),(c=y[r]||!!c)||_.push(r);var s={};a.replace(l,function(e,t,n,r,i){s[t]=o(n||r||i||"")}),n.start&&n.start(r,s,c)}function i(e,r){var o,i=0;if(r=t.lowercase(r))for(i=_.length-1;0<=i&&_[i]!=r;i--);if(0<=i){for(o=_.length-1;o>=i;o--)n.end&&n.end(_[o]);_.length=i}}"string"!=typeof e&&(e=null==e?"":""+e);var a,g,v,_=[],w=e;for(_.last=function(){return _[_.length-1]};e;){if(v="",g=!0,_.last()&&T[_.last()]?(e=e.replace(RegExp("(.*)<\\s*\\/\\s*"+_.last()+"[^>]*>","i"),function(e,t){return t=t.replace(f,"$1").replace(h,"$1"),n.chars&&n.chars(o(t)),""}),i(0,_.last())):(0===e.indexOf("\x3c!--")?0<=(a=e.indexOf("--",4))&&e.lastIndexOf("--\x3e",a)===a&&(n.comment&&n.comment(e.substring(4,a)),e=e.substring(a+3),g=!1):m.test(e)?(a=e.match(m))&&(e=e.replace(a[0],""),g=!1):p.test(e)?(a=e.match(u))&&(e=e.substring(a[0].length),a[0].replace(u,i),g=!1):d.test(e)&&((a=e.match(s))?(a[4]&&(e=e.substring(a[0].length),a[0].replace(s,r)),g=!1):(v+="<",e=e.substring(1))),g&&(v+=0>(a=e.indexOf("<"))?e:e.substring(0,a),e=0>a?"":e.substring(a),n.chars&&n.chars(o(v)))),e==w)throw c("badparse",e);w=e}i()}(n,a(r,function(t,n){return!/^unsafe/.test(e(t,n))})),r.join("")}}]}),t.module("ngSanitize").filter("linky",["$sanitize",function(e){var n=/((ftp|https?):\/\/|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>]/,r=/^mailto:/;return function(o,i){function c(e){e&&f.push(function(e){var n=[];return a(n,t.noop).chars(e),n.join("")}(e))}function s(e,n){f.push("<a "),t.isDefined(i)&&(f.push('target="'),f.push(i),f.push('" ')),f.push('href="'),f.push(e),f.push('">'),c(n),f.push("</a>")}if(!o)return o;for(var u,l,d,p=o,f=[];u=p.match(n);)l=u[0],u[2]==u[3]&&(l="mailto:"+l),d=u.index,c(p.substr(0,d)),s(l,u[0].replace(r,"")),p=p.substring(d+u[0].length);return c(p),e(f.join(""))}}])}(window,window.angular),function(){"use strict";var e="placeholder"in document.createElement("input"),t=angular.module("html5.placeholder",[]),n=function(e,t){var n=e.getAttributeNode(t);return n?n.nodeValue:n};t.factory("placeholder",function(){var t;if(e)t=function(e,t){t&&t({back:function(){}})};else{var r="placeholderTmp"+ +new Date,o={commit:function(e){angular.forEach(e,function(e){var t,o=angular.element(e);t=n(e,"placeholder"),o.val()==t&&(o.data(r,o.val()),o.val(""))})},doRollback:function(e){angular.forEach(e,function(e){var t,n=angular.element(e);(t=n.data(r))&&(n.val(t),n.data(r,null))})}};t=function(e,t){var n;e.length&&"form"==e[0].tagName.toLowerCase()?(n=e.find("input"),n=function(e,t){return angular.forEach(t,function(t){e.push(t)}),e}(e.find("textarea"),n)):n=e,o.commit(n),t&&t({back:function(){o.doRollback(n)}})}}return{ensure:t}}),e||t.directive("placeholder",[function(){var e,t,r,o,i="_placeholder_"+ +new Date,a="focus",c="blur",s=/msie 9/i.test(navigator.userAgent);return r=function(e){"password"==e.data(i).type&&e.attr("type","text")},o=function(e){"password"==e.data(i).type&&e.attr("type","password")},e=function(){var e=angular.element(this);e.val()==n(this,"placeholder")&&(e.val(""),o(e))},t=function(){var e=angular.element(this);""==e.val()&&(e.val(n(this,"placeholder")),r(e))},{link:function(n,u,l){n.$watch("ready",function(){return"password"!=u.attr("type")||s?(u.val(l.placeholder).data(i,{type:(u.attr("type")||"").toLowerCase()}).bind(a,e).bind(c,t),r(u),void n.$on("$destroy",function(){u.unbind(a,e).unbind(c,t),o(u)})):{}})}}}])}(),function(e,t,n){"use strict";t.module("ngCookies",["ng"]).factory("$cookies",["$rootScope","$browser",function(e,n){var r,o={},i={},a=!1,c=t.copy,s=t.isUndefined;return n.addPollFn(function(){var t=n.cookies();r!=t&&(r=t,c(t,i),c(t,o),a&&e.$apply())})(),a=!0,e.$watch(function(){var e,r,a;for(e in i)s(o[e])&&n.cookies(e,void 0);for(e in o)r=o[e],t.isString(r)||(r=""+r,o[e]=r),r!==i[e]&&(n.cookies(e,r),a=!0);if(a)for(e in r=n.cookies(),o)o[e]!==r[e]&&(s(r[e])?delete o[e]:o[e]=r[e])}),o}]).factory("$cookieStore",["$cookies",function(e){return{get:function(n){return(n=e[n])?t.fromJson(n):n},put:function(n,r){e[n]=t.toJson(r)},remove:function(t){delete e[t]}}}])}(window,window.angular),function(e,t){"function"==typeof define&&define.amd?define([],function(){return t()}):"object"==typeof exports?module.exports=t():t()}(0,function(){"use strict";return angular.module("tmh.dynamicLocale",[]).config(["$provide",function(e){function t(e){return e.$stateful=!0,e}e.decorator("dateFilter",["$delegate",t]),e.decorator("numberFilter",["$delegate",t]),e.decorator("currencyFilter",["$delegate",t])}]).constant("tmhDynamicLocale.STORAGE_KEY","tmhDynamicLocale.locale").provider("tmhDynamicLocale",["tmhDynamicLocale.STORAGE_KEY",function(e){function t(e,t,n,i,a,u,l){function d(e,t){o===n&&(angular.forEach(e,function(n,r){t[r]?angular.isArray(t[r])&&(e[r].length=t[r].length):delete e[r]}),angular.forEach(t,function(n,r){angular.isArray(t[r])||angular.isObject(t[r])?(e[r]||(e[r]=angular.isArray(t[r])?[]:{}),d(e[r],t[r])):e[r]=t[r]}))}if(s[n])return s[n];var p,f=a.defer();return n===o?f.resolve(t):(p=u.get(n))?(o=n,i.$evalAsync(function(){d(t,p),r.put(c,n),i.$broadcast("$localeChangeSuccess",n,t),f.resolve(t)})):(o=n,s[n]=f.promise,function(e,t,n,r){var o=document.createElement("script"),i=document.getElementsByTagName("body")[0],a=!1;o.type="text/javascript",o.readyState?o.onreadystatechange=function(){("complete"===o.readyState||"loaded"===o.readyState)&&(o.onreadystatechange=null,r(function(){a||(a=!0,i.removeChild(o),t())},30,!1))}:(o.onload=function(){a||(a=!0,i.removeChild(o),t())},o.onerror=function(){a||(a=!0,i.removeChild(o),n())}),o.src=e,o.async=!1,i.appendChild(o)}(e,function(){var e=angular.injector(["ngLocale"]).get("$locale");d(t,e),u.put(n,e),delete s[n],i.$apply(function(){r.put(c,n),i.$broadcast("$localeChangeSuccess",n,t),f.resolve(t)})},function(){delete s[n],i.$apply(function(){o===n&&(o=t.id),i.$broadcast("$localeChangeError",n),f.reject(n)})},l)),f.promise}var n,r,o,i="angular/i18n/angular-locale_{{locale}}.js",a="tmhDynamicLocaleStorageCache",c=e,s={};this.localeLocationPattern=function(e){return e?(i=e,this):i},this.useStorage=function(e){a=e},this.useCookieStorage=function(){this.useStorage("$cookieStore")},this.defaultLocale=function(e){n=e},this.storageKey=function(e){return e?(c=e,this):c},this.$get=["$rootScope","$injector","$interpolate","$locale","$q","tmhDynamicLocaleCache","$timeout",function(e,s,u,l,d,p,f){function m(n){return t(h({locale:n}),l,n,e,d,p,f)}var h=u(i);return r=s.get(a),e.$evalAsync(function(){var e;(e=r.get(c)||n)&&m(e)}),{set:m,get:function(){return o}}}]}]).provider("tmhDynamicLocaleCache",function(){this.$get=["$cacheFactory",function(e){return e("tmh.dynamicLocales")}]}).provider("tmhDynamicLocaleStorageCache",function(){this.$get=["$cacheFactory",function(e){return e("tmh.dynamicLocales.store")}]}).run(["tmhDynamicLocale",angular.noop]),"tmh.dynamicLocale"}),angular.module("tp.i18n",["ajaxServices","ngCookies","tmh.dynamicLocale","tinypassServices"]).config(["tmhDynamicLocaleProvider",function(e){e.localeLocationPattern("/libs/angular-1.2.22/i18n/angular-locale_{{locale | replaceUnderscoreToDash}}.js")}]).run(["lang",function(e){var t=TPParam.TRANSLATION_CONFIG&&TPParam.TRANSLATION_CONFIG.initialLocaleId||"en_US";e.update(t)}]).directive("autoFocus",["$timeout",function(e){return{restrict:"AC",link:function(t,n){var r=n[0];e(function(){var e=r.value;r.value="",r.focus(),r.value=e},100)}}}]).directive("t",["$compile","lang","getTextFromLocales",function(e,t,n){var r=/^arg(\d+)$/i;return{restrict:"AE",compile:function(o,i){var a=o.html(),c=[];return angular.forEach(i,function(e,t){var n=t.match(r);n&&n[1]&&(c[n[1]]=e)}),function(r,o,i){var s=TPParam.TRANSLATION_CONFIG&&TPParam.TRANSLATION_CONFIG.templateContext||"",u=i.context?i.context:s;function l(i,s,l){if(i){var d=n(i,s,l);o.empty().append(t.formatString(d(u,a),c)),e(o.contents())(r)}}l(),t.on(l),r.$on("$destroy",function(){t.off(l)})}}}}]).directive("languageSelector",["lang",function(e){return{restrict:"E",scope:{},template:'<div ng-show="areLanguagesAvailable()" class="language-selector">   <div id="language-label" class="language-selector__label" ng-click="toggleMenu()">{{locale | shortLocale}}</div>   <ul id="language-list" class="language-selector__list" ng-class="{\'show\': opened === true, \'hide\': opened === false}">       <li class="language-selector__list-item" ng-repeat="(index, value) in languages | filter:showAvailableLanguage" ng-click="changeLanguage(value.locale)">           <div class="language-selector__country" ng-class="{\'selected\': value.locale === locale}">{{value.localized}}             <span class="language-selector__country-image language-selector__country-image--{{value.locale | getCountryCode}}"></span>           </div>       </li>   </ul></div>',link:function(e,t){function n(n){jQuery(n.target)[0]!==t.find("#language-label")[0]&&(e.opened=!1,jQuery(window).off("click"),e.$apply())}e.toggleMenu=function(){e.opened=!e.opened,jQuery(window).off("click"),jQuery(window).on("click",n)},e.opened=!1},controller:["$scope",function(t){function n(e){t.locale=e}function r(e){t.languages=e.sort(function(e,t){return e.localized.toLowerCase()===t.localized.toLowerCase()?0:e.localized.toLowerCase()>t.localized.toLowerCase()?1:-1})}t.languages=[],t.locale=null,t.showAvailableLanguage=function(e){return!!e.isEnabled&&e},t.changeLanguage=function(n){t.locale=n,e.update(t.locale)},t.isLanguagesEnabled=TPParam.TRANSLATION_CONFIG.isEnabled,e.on(n),t.$on("$destroy",function(){e.off(n)}),e.list().then(r),t.areLanguagesAvailable=function(){return t.isLanguagesEnabled&&t.languages.length>1}}]}}]).filter("shortLocale",function(){return function(e){var t=e.toUpperCase().split("_");return t[0]+"-"+t[1]}}).filter("t",["lang",function(e){return function(t,n){var r=TPParam.TRANSLATION_CONFIG&&TPParam.TRANSLATION_CONFIG.templateContext||"";return e.trc(r,t,n)}}]).filter("tc",["lang",function(e){return function(t,n,r){return e.trc(n,t,r)}}]).filter("replaceUnderscoreToDash",function(){return function(e){return e.toString().toLowerCase().replace("_","-")}}).filter("replaceDashToUnderscore",function(){return function(e){var t;return null===e.match(/\-/g)?e:((t=e.toUpperCase().split("-"))[0]=t[0].toLowerCase(),t.join("_"))}}).filter("getCountryCode",function(){return function(e){return e.match(/\w{2}$/)[0].toLowerCase()}}).factory("getTextFromLocales",[function(){return function(e,t,n){return function(r,o){var i,a=(r=r?r+"":"")+o,c=n&&n[t],s=n&&n[e],u=s&&(s[a]||s[o]);return void 0===u&&(i=c&&(c[a]||c[o])),u||i||o}}}]).factory("lang",["tpHTTP","$q","$locale","$cookies","tmhDynamicLocale","resolveLocale","cookieLang","$rootScope","$filter","getTextFromLocales",function(e,t,n,r,o,i,a,c,s,u){var l,d=i(),p=!1,f=[],m=null,h=TPParam.TRANSLATION_CONFIG&&TPParam.TRANSLATION_CONFIG.systemDefaultLocale||"en_US",g={translationMapStatic:{},translationMapDynamic:{}},v={},y={};return c.$on("CHECK_UPDATED_LANGUAGE",_),S(),k(),{update:$,on:function(e,t){f.push(e),t||e(d,h,v)},off:function(e){var t=f.indexOf(e);-1!==t&&f.splice(t,1)},tr:function(e){for(var t=new Array(arguments.length-1),n=0;n<t.length;++n)t[n]=arguments[n+1];return w(u(d,h,v)(null,e),t)},trc:function(e,t,n){var r;if(angular.isArray(n))r=n;else{r=new Array(arguments.length-2);for(var o=0;o<r.length;++o)r[o]=arguments[o+2]}return w(u(d,h,v)(e,t),r)},list:function(){if(!TPParam.TRANSLATION_CONFIG.isEnabled)return t.when([]);m||(m=t.when(TPParam.TRANSLATION_CONFIG.languages).then(function(e){return e,$(d),e}));return m},formatString:w,getLang:C,getLanguageTag:E};function C(){return p&&d||""}function E(){return(C()||d).replace("_","-")}function S(){T(),l=setInterval(_,500)}function T(){l&&clearInterval(l)}function _(){var e=a.getCookie("LANG_CHANGED");e&&e!==d&&'""'!==e&&$(e)}function w(e,t){return angular.isUndefined(e)||null===e?e:e.replace(/<t([^>]+)?>|<\/t>/g,"").replace(/{(\d+)}/g,function(e,n){return void 0!==t[n]?t[n]:e})}function b(e){v[d]=e,f.forEach(function(e){e(d,h,v)})}function P(e,n){var r,o,i,a=t.defer();return e&&((r=document.querySelector('script[src*="'+e+'"]'))||(o=document.getElementsByTagName("head"))&&o.length&&(i=o[0])&&((r=document.createElement("script")).onload=function(){return window["translation"+n]?a.resolve(window["translation"+n]):a.reject("Unable to load")},r.setAttribute("src",e),r.setAttribute("type","text/javascript"),r.setAttribute("charset","utf-8"),i.appendChild(r))),a.promise}function A(e){var n="/ng/common/i18n/platform-translation-map_"+e+".js?version="+TPParam.TRANSLATION_CONFIG.version,r=TPParam.TRANSLATION_CONFIG.loadTranslationUrl+"&language="+e,o=window["translation_static_"+e];return TPParam.TRANSLATION_CONFIG.isStatic?o?t.when(o):P(n,"_static_"+e).then(function(){return t.when(window["translation_static_"+e])}):t.all({translationMapStatic:P(n,"_static_"+e).then(function(e){return e}),translationMapDynamic:P(r,"_dynamic_"+e).then(function(e){return e})}).then(function(e){return g.translationMapStatic=e.translationMapStatic,g.translationMapDynamic=e.translationMapDynamic,t.when(angular.extend({},e.translationMapStatic,e.translationMapDynamic))}).catch(function(t){v=function(e,t){var n=[],r={};"string"==typeof t&&(n=[t]);angular.isArray(t)&&(n=[].concat(t));angular.isArray(e)&&e.forEach(function(e,t){r[t]=e});angular.isObject(e)&&!angular.isArray(e)&&(r=angular.extend({},e));return n.forEach(function(e){delete r[e]}),r}(v,e)})}function $(e){if(T(),!TPParam.TRANSLATION_CONFIG||!TPParam.TRANSLATION_CONFIG.isEnabled)return a.removeCookie("LANG"),void a.removeCookie("LANG_CHANGED");angular.isUndefined(e)&&(e=a.getCookie("LANG")||h),function(e){d=e,p=!0,a.setCookie("LANG",d,1500),a.setCookie("LANG_CHANGED",d,1);var t=s("replaceUnderscoreToDash")(e);y[t]||n.id!==t||(y[t]=angular.copy(n));y[t]&&function e(t,n){angular.forEach(t,function(e,r){n[r]?angular.isArray(n[r])&&(t[r].length=n[r].length):delete t[r]});angular.forEach(n,function(r,o){angular.isArray(n[o])||angular.isObject(n[o])?(t[o]||(t[o]=angular.isArray(n[o])?[]:{}),e(t[o],n[o])):t[o]=n[o]})}(n,y[t]);e!==TPParam.TRANSLATION_CONFIG.initialLocaleId&&(y[t]||o.set(t).then(function(e){y[e.id]=angular.copy(e)}),function(e){window.TPParam.TRANSLATION_CONFIG&&window.TPParam.TRANSLATION_CONFIG.initialLocaleId&&(window.TPParam.TRANSLATION_CONFIG.initialLocaleId=e)}(d))}(e),k(),S(),function(e){if(void 0===v[h])return t.all(I(e),I(h));return I(e)}(e).then(b).then(function(){c.$broadcast("EVENT_I18N_LOCALE_CHANGED")})}function I(e){var n=window["translation_static_"+e],r=window["translation_dynamic_"+e];return v[e]?t.when(v[e]):n||r?(v[e]=angular.extend({},n,r),t.when(v[e])):A(e).then(function(t){return v[e]=t,t})}function k(){if("undefined"!=typeof moment)try{var e=E();switch(e){case"zz-ZZ":e="x-pseudo";break;case"sr-RS":e="sr-cyrl"}moment.locale?moment.locale(e):moment.lang(e)}catch(e){}}}]).factory("resolveLocale",["$cookies","$locale","tmhDynamicLocale","$filter","cookieLang",function(e,t,n,r,o){return function(){o.getCookie("LANG");return"en_US"}}]).factory("cookieLang",["TinypassService",function(e){return{getCookie:t,setCookie:function(t,n,r){var o,i=new Date;i.setTime(i.getTime()+24*r*60*60*1e3),o="expires="+i.toUTCString(),document.cookie=t+"="+n+"; "+o+"; domain="+e.getTopDomain()+"; path=/;"+e.getCookieSameSiteAndSecureAttrString()},removeCookie:function(t){var n="expires="+new Date("February 02, 1972 02:02:02").toUTCString();document.cookie=t+"=; "+n+"; domain="+e.getTopDomain()+"; path=/;"+e.getCookieSameSiteAndSecureAttrString()},getCountryCode:function(){if(null===t("LANG")||void 0===t("LANG")||""===t("LANG"))return"us";return t("LANG").split("_")[1].toLowerCase()},getLanguageCode:function(){if(null===t("LANG")||void 0===t("LANG")||""===t("LANG"))return"en";return t("LANG").split("_")[0]}};function t(e){var t=("; "+document.cookie).split("; "+e+"=");if(t.length>1)return t.pop().split(";").shift()}}]),function(){var dateServices=angular.module("dateServices",[]),withoutSpinnerHeaderName="Piano-request-without-spinner";function isIncludesWithoutSpinnerHeader(e){return!!(e&&e.config&&e.config.headers||{})[withoutSpinnerHeaderName]}dateServices.factory("fromIsoToJsDate",function(){return function(e,t){if(t.length){for(var n=t.length-1;n>=0;n--)t[n][e]&&(t[n][e]=moment(t[n][e]).format());return t}return t[e]&&(t[e]=moment(t[e]).format()),t[e]}}),dateServices.factory("timeStampToDate",function(){return function(e){return e?e&&e<1e10?new Date(1e3*e):new Date(e):e}}),dateServices.factory("TimezoneService",function(){return{SEND_DATETIME_FORMAT:"YYYY-MM-DDTHH:mm:ssZZ",dateToTimezonedMoment:function(e){return moment.tz(e,TPParam.CLIENT_TIMEZONE)},dateToClientTimezoneMoment:function(e){return moment.tz({year:e.getFullYear(),month:e.getMonth(),date:e.getDate(),hour:e.getHours(),minute:e.getMinutes(),second:e.getSeconds(),millisecond:e.getMilliseconds()},TPParam.CLIENT_TIMEZONE)},datesToTimezonedStringsRange:function(e,t){return{from:this.dateToClientTimezoneMoment(e).startOf("day").format(this.SEND_DATETIME_FORMAT),to:this.dateToClientTimezoneMoment(t).endOf("day").format(this.SEND_DATETIME_FORMAT)}},momentToDate:function(e){return new Date(e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second())}}});var ajaxServices=angular.module("ajaxServices",[]);ajaxServices.config(["$httpProvider",function(e){e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",e.defaults.headers.common["Ng-Request"]="1",e.interceptors.push("tpHttpInterceptor");e.defaults.transformRequest.push(function(e,t){var n=t&&t();return n&&n[withoutSpinnerHeaderName]||tinypass.withoutWaitPanel?e:(tinypass.showWaitPanel(),e)})}]),ajaxServices.factory("tpHttpInterceptor",["$q",function(e){return{response:function(e){return e.data&&(e.data.models&&(e.models=e.data.models),e.data.errors&&(e.errors=e.data.errors)),tinypass.updateMetaRefresh(),isIncludesWithoutSpinnerHeader(e)||tinypass.hideWaitPanel(),e},responseError:function(t){return t.data&&(t.data.models&&(t.models=t.data.models),t.data.errors&&(t.errors=t.data.errors)),isIncludesWithoutSpinnerHeader(t)||tinypass.hideWaitPanel(),e.reject(t)}}}]),ajaxServices.factory("repeatHTTP",["$q",function(e){var t=function(n,r){var o=(r=r||{}).defer,i=r.attempt||0,a=r.times||1,c=r.cancelConfig||{};return o?(n().then(function(e){o.resolve(e)}).catch(function(e){c.cancel||(i>=a?o.reject(e):t(n,_.assign(r,{attempt:i+1})))}),o.promise):(Log.info("defer is required"),e.reject())};return t}]),ajaxServices.factory("tpHTTP",["$http","$window","$q","$rootScope",function($http,$window,$q,$rootScope){var f=function(e,t){!t&&(e.url=$window.TPConfig.PATH+e.url);var n=$http(e);return n.then(f.processHeaders),n};return f.get=function(e,t){e=$window.TPConfig.PATH+e;var n=$http.get(e,t);return n.then(f.processHeaders),n},f.post=function(e,t,n){e=$window.TPConfig.PATH+e;var r=$http.post(e,t,n);return r.then(f.processHeaders),r},f.jsonp=function(e,t){return(t=t||{}).callback=t.callback||"JSON_CALLBACK",$http.jsonp(e,{params:t}).then(function(e){return e.data})},f.processResponse=function(e){return e.data&&e.data.models&&(e.models=e.data.models),e.data&&e.data.errors&&(e.errors=e.data.errors),e},f.processResponseCatch=function(e){return e.data&&e.data.models&&(e.models=e.data.models),e.data&&e.data.errors&&(e.errors=e.data.errors),$q.reject(e)},f.processHeaders=function(response){var headers=response.headers();if(headers.execute_js_after)try{eval(headers.execute_js_after)}catch(e){}return response},f.extractErrors=function(e,t,n){e&&(e.errors||e.modalErrors)&&(n.formErrors=e.errors&&e.errors.length?e.errors:e.modalErrors,angular.forEach(n.formErrors,function(e){var n=e.field,r=(e.key,e.msg);t&&t[n]&&(angular.element("#"+n).focus(),t[n].$setValidity("error",!1),t[n].$error.msg=r)}))},f.resetFormErrors=function(e,t,n){try{n&&(n.errors=[],n.modalErrors=[]),angular.forEach(t.formErrors,function(t){e[t.field].$setValidity("error",!0),e[t.field].$setPristine()}),delete t.formErrors,e.$setPristine(),t.$$phase||t.$apply()}catch(e){Log.info("Could not reset form errors!",e)}},f.setFieldsValid=function(e,t){try{angular.forEach(e,function(e,t){0!=t.indexOf("$")&&(e.$setValidity("error",!0),e.$setPristine())}),e.$setPristine(),t.$$phase||t.$apply()}catch(e){Log.info("Could not reset form errors!",e)}},f.extractModels=function(e,t){if(e&&e.models)for(var n in e.models)t[n]=e.models[n];if(e&&e.routes)for(var r in void 0===t.routes&&(t.routes={}),e.routes)t.routes[r]=e.routes[r]},f.promiseResponse=function(e,t){var n=$q.defer();return t.errors=[],e.then(function(e){if(e&&e.errors&&angular.copy(e.errors,t.errors),e&&e.models)for(var r in e.models)e.models.hasOwnProperty(r)&&(t[r]=e.models[r]);n.resolve()}).catch(function(e){e&&e.errors&&angular.copy(e.errors,t.errors),n.reject()}),n.promise},f.extractModelsTo=function(e){return function(t){f.extractModels(t.data,e)}},f.successHander=function(e){return function(t){e.resolve({data:t,ok:!0})}},f.errorHander=function(e){return function(t){e.resolve({data:t,ok:!1})}},f.promiser=function(e){var t=$q.defer();return e.then(f.successHander(t)).catch(f.errorHander(t)),t.promise},f.buildUrl=function(e,t){if(!t)return e;var n=[];return function(e,t,n){for(var r=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t.sort()}(e),o=0;o<r.length;o++)t.call(n,e[r[o]],r[o])}(t,function(e,t){null!=e&&null!=e&&(angular.isObject(e)&&(e=angular.toJson(e)),n.push(encodeURIComponent(t)+"="+encodeURIComponent(e)))}),e+(-1==e.indexOf("?")?"?":"&")+n.join("&")},f}]);var tinypassService=angular.module("tinypassServices",[]);function _setCookie(e,t,n,r,o,i,a){var c=new Date;c.setTime(c.getTime());var s=new Date(c.getTime()+n);document.cookie=e+"="+t+(n?";expires="+s.toGMTString():"")+(r?";path="+r:"")+(o?";domain="+o:"")+(i?";secure":"")+(a?";samesite="+a:"none")}function _getCookie(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0}tinypassService.factory("TinypassService",["$q",function(e){var t;function n(){return t||(t=function(){try{return window.self!==window.top}catch(e){return!0}}()?" samesite=none; ":" samesite=lax; ","https:"===window.location.protocol&&(t+=" secure;"),t)}function r(){var e,t,r="weird_get_top_level_domain=cookie",o=document.location.hostname.split(".");if(1===o.length)return o[0];if(4===o.length&&!isNaN(o[0])&&!isNaN(o[3]))return document.location.hostname;for(e=o.length-1;e>=0;e--){t="."+o.slice(e).join(".");var i=n();if(document.cookie=r+";domain="+t+";"+i,document.cookie.indexOf(r)>-1)return document.cookie=r.split("=")[0]+"=;domain="+t+";expires=Thu, 01 Jan 1970 00:00:01 GMT;"+i,t}}return{setMessage:function(e,t){tinypass.setMessageDashboard(e,t)},hideMessage:function(){tinypass.hideMessage()},cropImage:function(e,t,n,r,o,i,a,c,s){tinypass.cropImage(e,t,n,r,o,i,a,c,s)},getISODate:function(e,t){var n,r;return n=new Date(e.getFullYear(),e.getMonth(),e.getDate()),r=new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59),{from:moment(n).format("YYYY-MM-DDTHH:mm:ssZZ"),to:moment(r).format("YYYY-MM-DDTHH:mm:ssZZ")}},reduceZeros:function(e){var t=(e=Math.round(e))/1e3+"";return 0!=e&&(t=(t=(t=(t+(t.indexOf(".")<0?".":"")+"000").replace(/(\..{3}).*$/,"$1")).substring(0,t.length-Math.min(3,(e+"").length-2)).replace(/[.]$/,"")).split("").reverse().join("").replace(/((\d{3})(?!($|-|.*[.])))/g,"$1,").split("").reverse().join("")),t},generateRandomString:function(e){e=e||10;for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t},generateSuccessMessage:function(e){return function(){tinypass.setMessage("success",e)}},generateErrorMessage:function(t){return function(){return tinypass.setMessage("error",t),e.reject()}},showRequestError:function(t){return tinypass.setMessage("error",t.data.errors[0].msg),e.reject(t)},showRequestErrorDashboard:function(t){return tinypass.setMessageDashboard("error",t.data.errors[0].msg),e.reject(t)},getInMinorUnits:function(e){return e?Math.round(100*e):0},getCurrencyByCode:function(e){if(""==e)return"$";var t;switch(e){case"USD":t="$";break;case"EUR":t="€";break;case"AUD":t="$";break;case"GBP":t="£";break;case"JPY":t="¥";break;default:t=e}return t},setCookie:function(e,t,o){var i=new Date;i.setTime(i.getTime()+24*o*60*60*1e3);var a="expires="+i.toUTCString();document.cookie=e+"="+t+"; "+a+"; domain= "+r()+"; path=/;"+n()},getCookie:function(e){var t=("; "+document.cookie).split("; "+e+"=");if(t.length>1)return t.pop().split(";").shift()},getTopDomain:r,getCookieSameSiteAndSecureAttrString:n}}]),tinypassService.factory("LangUtils",[function(){return{getPersonalName:function(e,t,n){var r=e.getLang();return!["zz_ZZ","ja_JP"].some(function(e){return e===r})?[t,n].filter(function(e){return!!e}).join(" "):[n,t].filter(function(e){return!!e}).join(" ")}}}]),tinypassService.factory("modalConfirm",["$rootScope","$modal",function(e,t){return function(n,r,o,i){var a=e.$new();a.title=n,a.msg=r;var c={scope:a,templateUrl:"/libs/tinypass/_confirm_popup.shtml"},s=t.open(c);function u(e){s.close(e)}return a.onOk=function(){_.isFunction(i)?i().then(u):u(o)},s.result}}]),tinypassService.factory("UpdatePerfectScrollbar",["UpdateSpecificScrollbar",function(e){return function(t){if(t&&t.target&&t.target.nodeName){var n,r,o=$(t.target);if("input"==t.target.nodeName.toLowerCase()){var i=o.parents(".tp-dropdown__container"),a=o.parents(".dropdown-menu");return void(a.length>0?a:i).find(".ps-container").each(function(){var e=$(this);e.is(":visible")&&e.scrollTop(0)})}n=o.parent().outerHeight(!0),r=o.parents(".ps-container"),e(r,n)}}}]),tinypassService.factory("UpdateSpecificScrollbar",function(){return function(e,t){var n=e.children().height(),r=e.height(),o=e.scrollTop();o+r+t>=n&&n>=r&&e.scrollTop(o-t)}}),tinypassService.factory("iframeService",["$rootElement",function(e){return{injectHiddenIframe:t,injectHiddenIframeWithTimeout:function(e,n,r,o){var i=t(e,n),a=window.setTimeout(function(){angular.element("#"+e).remove(),o&&o()},r||15e3);return{iframe:i,cancel:function(){window.clearTimeout(a)}}},injectIframe:function(e,t,r){var o=t?' src="'+t+'" ':"";return n(angular.element("<iframe "+o+"></iframe>"),e,r,{backgroundColor:"transparent",border:"0",width:"100%",height:"100%",position:"relative",zIndex:4})},injectRealIframe:function(e,t,r){return n(angular.element(t),e,r,{backgroundColor:"#ffffff",border:"0",width:"100%",height:"100%",position:"relative",zIndex:1})},injectHungTimeoutIframe:function(e,n){return window.setTimeout(function(){var r=t(e),o=r.contentWindow?r.contentWindow.document:r.contentDocument;o.open("text/html","replace"),o.write('<html>    <head>        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">        <script type="text/javascript">            function submitform() {                document.forms["page_return"].submit();            }        <\/script>    </head>    <body onload="submitform()">        <form name="page_return" method="post" action="'+n+'">            <input type="hidden" name="resultCode" value="999">            <input type="hidden" name="message" value="Request timeout">        </form>    </body></html>'),o.close()},15e3)},appendContentToIframe:function(e,t){var n=e.contentWindow?e.contentWindow.document:e.contentDocument;n.open("text/html","replace"),n.write(t),n.close()}};function t(t,n){var r=n?' src="'+n+'" ':"";angular.element("#"+t).remove();var o=angular.element('<iframe id="'+t+'"'+r+' style="display: none"></iframe>')[0];return e.append(o),o}function n(e,t,n,r){angular.element("#"+t).remove(),e.attr({allowtransparency:"true",id:t}).css(r);var o=e[0];return n.append(o),o}}]);var selectFactory=angular.module("selectFactory",["ajaxServices"]);selectFactory.factory("selectServiceFactory",["tpHTTP","$timeout",function(e,t){return function(n){var r={},o=!!n.invalidateUpdate,i={search:function(n){var a=r[n];a&&!i.instantUpdate||(a=function(n){r[n]=function(t){var n=i.buildParams(t);return e.post(i.endpoint,n).then(i.extractItems).catch(function(e){})}(n),i.instantUpdate=!1,o&&t(function(){delete r[n]},1e3);return r[n]}(n));return a}};return angular.extend(i,n),i}}]),selectFactory.factory("selectDirectiveFactory",["$timeout","UpdatePerfectScrollbar","$perfectScrollBarService",function(e,t,n){return function(r){return{restrict:"AE",replace:!0,transclude:!0,scope:{ngModel:"=",item:"=",clickFn:"=?",searchFn:"=?",clickOnClose:"=?"},require:"ngModel",templateUrl:r.templateUrl,link:function(o,i,a,c){var s,u={};if(o.disabled="true"==a.ngDisabled,o.disabled)return;o.closeOnSelect=void 0!==a.closeOnSelect,o.multiple=void 0!==a.multiple,o.excludeSelected=void 0!==a.excludeSelected,o.showCheckbox=o.multiple&&!o.excludeSelected,o.model={filter:"",list:[],selected:{}},o.onSearch=l,o.searchItems=f,o.updateScrollBar=p,o.cancelClick=function(e){e.stopPropagation(),e.preventDefault()},o.closeDropdown=function(){$(".dropdown.open",i).removeClass("open")},o.setItem=function(e,t){if(_.isUndefined(e.disabled)||!e.disabled){if(o.multiple){var n=angular.copy(o.ngModel||[]),r=d(e,n);null===r?n.push(e):n.splice(r,1),o.ngModel=n,c.$setViewValue(o.ngModel)}else o.ngModel=e,c.$setViewValue(o.ngModel);o.closeOnSelect&&(o.closeDropdown(),o.clickOnClose&&o.clickOnClose(o.ngModel)),p(t)}},o.modelContains=function(e){return null!==d(e,o.ngModel||[])},o.setFocusAfterClick=function(){$("input:first",i).focus()},o.onOpen=function(e){o.clickFn&&o.clickFn(f),function(e){e&&!u[e]&&(u[e]=!0,n.notify("update-perfect-scrollbar"))}(e)},o.selectAll=function(){if(o.multiple){var e=o.ngModel||[],t=[];e.length||(t=angular.copy(o.model.list)),o.ngModel=t,c.$setViewValue(o.ngModel)}},l(),o.multiple&&o.$watch("ngModel",function(){!function(){var e={};if(!o.multiple)return;if(!o.ngModel||!Array.isArray(o.ngModel)||o.ngModel.length<=0)return void(o.model.selected=null);o.ngModel.forEach(function(t){e[t[r.idProperty]]=!0}),o.model.selected=e}()},!0);function l(t){s&&e.cancel(s);var n=o.model.filter?300:0;s=e(function(){f(t)},n)}function d(e,t){for(var n=t.length,o=0;o<n;o++)if(t[o][r.idProperty]===e[r.idProperty])return o;return null}function p(e){t(e)}function f(e){var t=o.searchFn||r.searchService.search;t&&t(o.model.filter).then(function(t){t.forEach(function(e){e.id=e[r.idProperty]}),o.model.list=t,e&&o.updateScrollBar(e)})}}}}}]);var loggingModule=angular.module("loggingModule",["ajaxServices"]);loggingModule.factory("loggingService",["tpHTTP",function(e){var t={logToServer:function(t){try{var n=new Error;e.post(TPParam.LOG_ERROR,{description:t,url:window.location.href,trace:n.stack})}catch(e){}}};return t}]),angular.module("paymentFormModule",[]).factory("loaderService",function(){return{showLoader:function(){var e=document.getElementById("pp-loader");e&&(e.style.display="block")},hideLoader:function(){var e=document.getElementById("pp-loader");e&&(e.style.display="none")}}})}(),String.prototype.format=function(){for(var e=this,t=0;t<arguments.length;t++){var n="{"+t+"}";e=e.replace(n,arguments[t])}return e},angular.module("ui.event",[]).directive("uiEvent",["$parse",function(e){return function(t,n,r){var o=t.$eval(r.uiEvent);angular.forEach(o,function(r,o){var i=e(r);n.bind(o,function(e){var n=Array.prototype.slice.call(arguments);n=n.splice(1),i(t,{$event:e,$params:n}),t.$$phase||t.$apply()})})}}]),angular.module("ui.format",[]).filter("format",function(){return function(e,t){var n=e;if(angular.isString(n)&&void 0!==t)if(angular.isArray(t)||angular.isObject(t)||(t=[t]),angular.isArray(t)){var r=t.length;n=n.replace(/\$([0-9]+)/g,function(e,n){return(n=parseInt(n,10))>=0&&r>n?t[n]:e})}else angular.forEach(t,function(e,t){n=n.split(":"+t).join(e)});return n}}),angular.module("ui.highlight",[]).filter("highlight",function(){return function(e,t,n){return t||angular.isNumber(t)?(e=e.toString(),t=t.toString(),n?e.split(t).join('<span class="ui-match">'+t+"</span>"):e.replace(new RegExp(t,"gi"),'<span class="ui-match">$&</span>')):e}}),angular.module("ui.include",[]).directive("uiInclude",["$http","$templateCache","$anchorScroll","$compile",function(e,t,n,r){return{restrict:"ECA",terminal:!0,compile:function(o,i){var a=i.uiInclude||i.src,c=i.fragment||"",s=i.onload||"",u=i.autoscroll;return function(o,i){function l(){var l=++p,m=o.$eval(a),h=o.$eval(c);m?e.get(m,{cache:t}).success(function(e){var t;l===p&&(d&&d.$destroy(),d=o.$new(),t=h?angular.element("<div/>").html(e).find(h):angular.element("<div/>").html(e).contents(),i.html(t),r(t)(d),!angular.isDefined(u)||u&&!o.$eval(u)||n(),d.$emit("$includeContentLoaded"),o.$eval(s))}).error(function(){l===p&&f()}):f()}var d,p=0,f=function(){d&&(d.$destroy(),d=null),i.html("")};o.$watch(c,l),o.$watch(a,l)}}}}]),angular.module("ui.indeterminate",[]).directive("uiIndeterminate",[function(){return{compile:function(e,t){return t.type&&"checkbox"===t.type.toLowerCase()?function(e,t,n){e.$watch(n.uiIndeterminate,function(e){t[0].indeterminate=!!e})}:angular.noop}}}]),angular.module("ui.inflector",[]).filter("inflector",function(){function e(e){return e.replace(/^([a-z])|\s+([a-z])/g,function(e){return e.toUpperCase()})}function t(e,t){return e.replace(/[A-Z]/g,function(e){return t+e})}var n={humanize:function(n){return e(t(n," ").split("_").join(" "))},underscore:function(e){return e.substr(0,1).toLowerCase()+t(e.substr(1),"_").toLowerCase().split(" ").join("_")},variable:function(t){return t.substr(0,1).toLowerCase()+e(t.split("_").join(" ")).substr(1).split(" ").join("")}};return function(e,t){return!1!==t&&angular.isString(e)?n[t=t||"humanize"](e):e}}),angular.module("ui.jq",[]).value("uiJqConfig",{}).directive("uiJq",["uiJqConfig","$timeout",function(e,t){return{restrict:"A",compile:function(n,r){if(!angular.isFunction(n[r.uiJq]))throw new Error('ui-jq: The "'+r.uiJq+'" function does not exist');var o=e&&e[r.uiJq];return function(e,n,r){function i(){t(function(){n[r.uiJq].apply(n,a)},0,!1)}var a=[];r.uiOptions?(a=e.$eval("["+r.uiOptions+"]"),angular.isObject(o)&&angular.isObject(a[0])&&(a[0]=angular.extend({},o,a[0]))):o&&(a=[o]),r.ngModel&&n.is("select,input,textarea")&&n.bind("change",function(){n.trigger("input")}),r.uiRefresh&&e.$watch(r.uiRefresh,function(){i()}),i()}}}}]),angular.module("ui.keypress",[]).factory("keypressHelper",["$parse",function(e){var t={8:"backspace",9:"tab",13:"enter",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete"};return function(n,r,o,i){var a,c=[];a=r.$eval(i["ui"+function(e){return e.charAt(0).toUpperCase()+e.slice(1)}(n)]),angular.forEach(a,function(t,n){var r,o;o=e(t),angular.forEach(n.split(" "),function(e){r={expression:o,keys:{}},angular.forEach(e.split("-"),function(e){r.keys[e]=!0}),c.push(r)})}),o.bind(n,function(e){var o=!(!e.metaKey||e.ctrlKey),i=!!e.altKey,a=!!e.ctrlKey,s=!!e.shiftKey,u=e.keyCode;"keypress"===n&&!s&&u>=97&&122>=u&&(u-=32),angular.forEach(c,function(n){var c=n.keys[t[u]]||n.keys[u.toString()],l=!!n.keys.meta,d=!!n.keys.alt,p=!!n.keys.ctrl,f=!!n.keys.shift;c&&l===o&&d===i&&p===a&&f===s&&r.$apply(function(){n.expression(r,{$event:e})})})})}}]),angular.module("ui.keypress").directive("uiKeydown",["keypressHelper",function(e){return{link:function(t,n,r){e("keydown",t,n,r)}}}]),angular.module("ui.keypress").directive("uiKeypress",["keypressHelper",function(e){return{link:function(t,n,r){e("keypress",t,n,r)}}}]),angular.module("ui.keypress").directive("uiKeyup",["keypressHelper",function(e){return{link:function(t,n,r){e("keyup",t,n,r)}}}]),angular.module("ui.mask",[]).value("uiMaskConfig",{maskDefinitions:{9:/\d/,A:/[a-zA-Z]/,"*":/[a-zA-Z0-9]/}}).directive("uiMask",["uiMaskConfig",function(e){return{priority:100,require:"ngModel",restrict:"A",compile:function(){var t=e;return function(e,n,r,o){function i(){return $=!1,I&&(n.unbind("blur",l),n.unbind("mousedown",d),n.unbind("mouseup",d),n.unbind("input",f),n.unbind("keyup",f),n.unbind("click",f),n.unbind("focus",f),I=!1),angular.isDefined(k)?n.attr("placeholder",k):n.removeAttr("placeholder"),angular.isDefined(N)?n.attr("maxlength",N):n.removeAttr("maxlength"),n.val(o.$modelValue),o.$viewValue=o.$modelValue,!1}function a(e){return!e.length||e.length>=E}function c(e){var t="",n=v.slice();return e=e.toString(),angular.forEach(C,function(t){e=e.replace(t,"")}),angular.forEach(e.split(""),function(e){n.length&&n[0].test(e)&&(t+=e,n.shift())}),t}function s(e){var t="",n=g.slice();return angular.forEach(y.split(""),function(r,o){e.length&&o===n[0]?(t+=e.charAt(0)||"_",e=e.substr(1),n.shift()):t+=r}),t}function u(e){var t=r.placeholder;return void 0!==t&&t[e]?t[e]:"_"}function l(){P=0,A=0,_&&0!==S.length||(T="",n.val(""),e.$apply(function(){o.$setViewValue("")}))}function d(e){"mousedown"===e.type?n.bind("mouseout",p):n.unbind("mouseout",p)}function p(){A=h(this),n.unbind("mouseout",p)}function f(t){var r=(t=t||{}).which,i=t.type;if(16!==r&&91!==r){var a,u=n.val(),l=w,d=c(u),p=b,f=!1,v=function(e){if(void 0!==e.selectionStart)return e.selectionStart;if(document.selection){e.focus();var t=document.selection.createRange();return t.moveStart("character",-e.value.length),t.text.length}return 0}(this)||0,y=P||0,C=v-y,E=g[0],S=g[d.length]||g.slice().shift(),T=A||0,_=h(this)>0,$=T>0,I=u.length>l.length||T&&u.length>l.length-T,k=u.length<l.length||T&&u.length===l.length-T,N=r>=37&&40>=r&&t.shiftKey,x=8===r||"keyup"!==i&&k&&-1===C,D=46===r||"keyup"!==i&&k&&0===C&&!$,M=(37===r||x||"click"===i)&&v>E;if(A=h(this),!N&&(!_||"click"!==i&&"keyup"!==i)){if("input"===i&&k&&!$&&d===p){for(;x&&v>E&&!m(v);)v--;for(;D&&S>v&&-1===g.indexOf(v);)v++;var O=g.indexOf(v);d=d.substring(0,O)+d.substring(O+1),f=!0}for(a=s(d),w=a,b=d,n.val(a),f&&e.$apply(function(){o.$setViewValue(d)}),I&&E>=v&&(v=E+1),M&&v--,v=v>S?S:E>v?E:v;!m(v)&&v>E&&S>v;)v+=M?-1:1;(M&&S>v||I&&!m(y))&&v++,P=v,function(e,t){if(0!==e.offsetWidth&&0!==e.offsetHeight)if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var n=e.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",t),n.select()}}(this,v)}}}function m(e){return g.indexOf(e)>-1}function h(e){return void 0!==e.selectionStart?e.selectionEnd-e.selectionStart:document.selection?document.selection.createRange().text.length:0}var g,v,y,C,E,S,T,_,w,b,P,A,$=!1,I=!1,k=r.placeholder,N=r.maxlength,x={};r.uiOptions?(x=e.$eval("["+r.uiOptions+"]"),angular.isObject(x[0])&&(x=function(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]?angular.extend(t[n],e[n]):t[n]=angular.copy(e[n]));return t}(t,x[0]))):x=t,r.$observe("uiMask",function(e){return angular.isDefined(e)?(function(e){var t=0;if(g=[],v=[],y="","string"==typeof e){E=0;var n=!1,r=e.split("");angular.forEach(r,function(e,r){x.maskDefinitions[e]?(g.push(t),y+=u(r),v.push(x.maskDefinitions[e]),t++,n||E++):"?"===e?n=!0:(y+=e,t++)})}g.push(g.slice().pop()+1),C=y.replace(/[_]+/g,"_").replace(/([^_]+)([a-zA-Z0-9])([^_])/g,"$1$2_$3").split("_"),$=g.length>1}(e),$?(function(){S=b=c(o.$modelValue||""),T=w=s(S);var e=(_=a(S))&&S.length?T:"";r.maxlength&&n.attr("maxlength",2*g[g.length-1]),n.attr("placeholder",y),n.val(e),o.$viewValue=e}(),I||(n.bind("blur",l),n.bind("mousedown mouseup",d),n.bind("input keyup click focus",f),I=!0),!0):i()):i()}),r.$observe("placeholder",function(e){angular.isDefined(e)&&(y=e,$&&f())}),o.$formatters.push(function(e){return $?(S=c(e||""),_=a(S),o.$setValidity("mask",_),_&&S.length?s(S):void 0):e}),o.$parsers.push(function(e){return $?(S=c(e||""),_=a(S),o.$viewValue=S.length?s(S):"",o.$setValidity("mask",_),""===S&&void 0!==o.$error.required&&o.$setValidity("required",!1),_?S:void 0):e}),n.bind("mousedown mouseup",d),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){"use strict";if(null===this)throw new TypeError;var t=Object(this),n=t.length>>>0;if(0===n)return-1;var r=0;if(arguments.length>1&&((r=Number(arguments[1]))!=r?r=0:0!==r&&1/0!==r&&r!==-1/0&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=n)return-1;for(var o=r>=0?r:Math.max(n-Math.abs(r),0);n>o;o++)if(o in t&&t[o]===e)return o;return-1})}}}}]),angular.module("ui.reset",[]).value("uiResetConfig",null).directive("uiReset",["uiResetConfig",function(e){var t=null;return void 0!==e&&(t=e),{require:"ngModel",link:function(e,n,r,o){var i;i=angular.element('<a class="ui-reset" />'),n.wrap('<span class="ui-resetwrap" />').after(i),i.bind("click",function(n){n.preventDefault(),e.$apply(function(){r.uiReset?o.$setViewValue(e.$eval(r.uiReset)):o.$setViewValue(t),o.$render()})})}}}]),angular.module("ui.route",[]).directive("uiRoute",["$location","$parse",function(e,t){return{restrict:"AC",scope:!0,compile:function(n,r){var o;if(r.uiRoute)o="uiRoute";else if(r.ngHref)o="ngHref";else{if(!r.href)throw new Error("uiRoute missing a route or href property on "+n[0]);o="href"}return function(n,r,i){function a(t){var r=t.indexOf("#");r>-1&&(t=t.substr(r+1)),(u=function(){s(n,e.path().indexOf(t)>-1)})()}function c(t){var r=t.indexOf("#");r>-1&&(t=t.substr(r+1)),(u=function(){var r=new RegExp("^"+t+"$",["i"]);s(n,r.test(e.path()))})()}var s=t(i.ngModel||i.routeModel||"$uiRoute").assign,u=angular.noop;switch(o){case"uiRoute":i.uiRoute?c(i.uiRoute):i.$observe("uiRoute",c);break;case"ngHref":i.ngHref?a(i.ngHref):i.$observe("ngHref",a);break;case"href":a(i.href)}n.$on("$routeChangeSuccess",function(){u()}),n.$on("$stateChangeSuccess",function(){u()})}}}}]),angular.module("ui.scrollfix",[]).directive("uiScrollfix",["$window",function(e){"use strict";return{require:"^?uiScrollfixTarget",link:function(t,n,r,o){function i(){var t;angular.isDefined(e.pageYOffset)?t=e.pageYOffset:t=(document.compatMode&&"BackCompat"!==document.compatMode?document.documentElement:document.body).scrollTop;!n.hasClass("ui-scrollfix")&&t>r.uiScrollfix?n.addClass("ui-scrollfix"):n.hasClass("ui-scrollfix")&&t<r.uiScrollfix&&n.removeClass("ui-scrollfix")}var a=n[0].offsetTop,c=o&&o.$element||angular.element(e);r.uiScrollfix?"string"==typeof r.uiScrollfix&&("-"===r.uiScrollfix.charAt(0)?r.uiScrollfix=a-parseFloat(r.uiScrollfix.substr(1)):"+"===r.uiScrollfix.charAt(0)&&(r.uiScrollfix=a+parseFloat(r.uiScrollfix.substr(1)))):r.uiScrollfix=a,c.on("scroll",i),t.$on("$destroy",function(){c.off("scroll",i)})}}}]).directive("uiScrollfixTarget",[function(){"use strict";return{controller:["a",function(e){this.$element=e}]}}]),angular.module("ui.showhide",[]).directive("uiShow",[function(){return function(e,t,n){e.$watch(n.uiShow,function(e){e?t.addClass("ui-show"):t.removeClass("ui-show")})}}]).directive("uiHide",[function(){return function(e,t,n){e.$watch(n.uiHide,function(e){e?t.addClass("ui-hide"):t.removeClass("ui-hide")})}}]).directive("uiToggle",[function(){return function(e,t,n){e.$watch(n.uiToggle,function(e){e?t.removeClass("ui-hide").addClass("ui-show"):t.removeClass("ui-show").addClass("ui-hide")})}}]),angular.module("ui.unique",[]).filter("unique",["$parse",function(e){return function(t,n){if(!1===n)return t;if((n||angular.isUndefined(n))&&angular.isArray(t)){var r=[],o=angular.isString(n)?e(n):function(e){return e},i=function(e){return angular.isObject(e)?o(e):e};angular.forEach(t,function(e){for(var t=!1,n=0;n<r.length;n++)if(angular.equals(i(r[n]),i(e))){t=!0;break}t||r.push(e)}),t=r}return t}}]),angular.module("ui.validate",[]).directive("uiValidate",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,r){var o,i={},a=e.$eval(n.uiValidate);a&&(angular.isString(a)&&(a={validator:a}),angular.forEach(a,function(t,n){o=function(o){var i=e.$eval(t,{$value:o});return angular.isObject(i)&&angular.isFunction(i.then)?(i.then(function(){r.$setValidity(n,!0)},function(){r.$setValidity(n,!1)}),o):i?(r.$setValidity(n,!0),o):void r.$setValidity(n,!1)},i[n]=o,r.$formatters.push(o),r.$parsers.push(o)}),n.uiValidateWatch&&function(t){angular.isString(t)?e.$watch(t,function(){angular.forEach(i,function(e){e(r.$modelValue)})}):angular.isArray(t)?angular.forEach(t,function(t){e.$watch(t,function(){angular.forEach(i,function(e){e(r.$modelValue)})})}):angular.isObject(t)&&angular.forEach(t,function(t,n){angular.isString(t)&&e.$watch(t,function(){i[n](r.$modelValue)}),angular.isArray(t)&&angular.forEach(t,function(t){e.$watch(t,function(){i[n](r.$modelValue)})})})}(e.$eval(n.uiValidateWatch)))}}}),angular.module("ui.utils",["ui.event","ui.format","ui.highlight","ui.include","ui.indeterminate","ui.inflector","ui.jq","ui.keypress","ui.mask","ui.reset","ui.route","ui.scrollfix","ui.showhide","ui.unique","ui.validate"]),function(e,t){var n=(e.ieShivDebug,["ngInclude","ngPluralize","ngView","ngSwitch","uiCurrency","uiCodemirror","uiDate","uiEvent","uiKeypress","uiKeyup","uiKeydown","uiMask","uiMapInfoWindow","uiMapMarker","uiMapPolyline","uiMapPolygon","uiMapRectangle","uiMapCircle","uiMapGroundOverlay","uiModal","uiReset","uiScrollfix","uiSelect2","uiShow","uiHide","uiToggle","uiSortable","uiTinymce"]);e.myCustomTags=e.myCustomTags||[],n.push.apply(n,e.myCustomTags);for(var r=function(e){var t=[],n=e.replace(/([A-Z])/g,function(e){return" "+e.toLowerCase()}).split(" ");if(1===n.length){var r=n[0];t.push(r),t.push("x-"+r),t.push("data-"+r)}else{var o=n[0],i=n.slice(1).join("-");t.push(o+":"+i),t.push(o+"-"+i),t.push("x-"+o+"-"+i),t.push("data-"+o+"-"+i)}return t},o=0,i=n.length;i>o;o++)for(var a=r(n[o]),c=0,s=a.length;s>c;c++){var u=a[c];t.createElement(u)}}(window,document),void 0!==module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="ui.router"),function(e,t,n){"use strict";function r(e,t){return I(new(I(function(){},{prototype:e})),t)}function o(e){return $(arguments,function(t){t!==e&&$(t,function(t,n){e.hasOwnProperty(n)||(e[n]=t)})}),e}function i(e,t){if(Array.prototype.indexOf)return e.indexOf(t,Number(arguments[2])||0);var n=e.length>>>0,r=Number(arguments[2])||0;for(0>(r=0>r?Math.ceil(r):Math.floor(r))&&(r+=n);n>r;r++)if(r in e&&e[r]===t)return r;return-1}function a(e,t,n,r){var o,a=function(e,t){var n=[];for(var r in e.path){if(e.path[r]!==t.path[r])break;n.push(e.path[r])}return n}(n,r),c={},s=[];for(var u in a)if(a[u].params&&a[u].params.length)for(var l in o=a[u].params)i(s,o[l])>=0||(s.push(o[l]),c[o[l]]=e[o[l]]);return I({},c,t)}function c(e,t){var n={};return $(e,function(e){var r=t[e];n[e]=null!=r?String(r):null}),n}function s(e,t,n){if(!n)for(var r in n=[],e)n.push(r);for(var o=0;o<n.length;o++){var i=n[o];if(e[i]!=t[i])return!1}return!0}function u(e,t){var r=1,i=2,a={},c=[],s=a,u=I(e.when(a),{$$promises:a,$$values:a});this.study=function(a){function l(e){return P(e)&&e.then&&e.$$promises}if(!P(a))throw new Error("'invocables' must be an object");var d=[],p=[],f={};return $(a,function e(n,o){if(f[o]!==i){if(p.push(o),f[o]===r)throw p.splice(0,p.indexOf(o)),new Error("Cyclic dependency: "+p.join(" -> "));if(f[o]=r,b(n))d.push(o,[function(){return t.get(n)}],c);else{var s=t.annotate(n);$(s,function(t){t!==o&&a.hasOwnProperty(t)&&e(a[t],t)}),d.push(o,n,s)}p.pop(),f[o]=i}}),a=p=f=null,function(r,i,a){function c(){--y||(C||o(v,i.$$values),h.$$values=v,h.$$promises=!0,m.resolve(v))}function p(e){h.$$failure=e,m.reject(e)}function f(n,o,i){function s(e){l.reject(e),p(e)}function u(){if(!_(h.$$failure))try{l.resolve(t.invoke(o,a,v)),l.promise.then(function(e){v[n]=e,c()},s)}catch(e){s(e)}}var l=e.defer(),d=0;$(i,function(e){g.hasOwnProperty(e)&&!r.hasOwnProperty(e)&&(d++,g[e].then(function(t){v[e]=t,--d||u()},s))}),d||u(),g[n]=l.promise}if(l(r)&&a===n&&(a=i,i=r,r=null),r){if(!P(r))throw new Error("'locals' must be an object")}else r=s;if(i){if(!l(i))throw new Error("'parent' must be a promise returned by $resolve.resolve()")}else i=u;var m=e.defer(),h=m.promise,g=h.$$promises={},v=I({},r),y=1+d.length/3,C=!1;if(_(i.$$failure))return p(i.$$failure),h;i.$$values?(C=o(v,i.$$values),c()):(I(g,i.$$promises),i.then(c,p));for(var E=0,S=d.length;S>E;E+=3)r.hasOwnProperty(d[E])?c():f(d[E],d[E+1],d[E+2]);return h}},this.resolve=function(e,t,n,r){return this.study(e)(t,n,r)}}function l(e,t,n){this.fromConfig=function(e,t,n){return _(e.template)?this.fromString(e.template,t):_(e.templateUrl)?this.fromUrl(e.templateUrl,t):_(e.templateProvider)?this.fromProvider(e.templateProvider,t,n):null},this.fromString=function(e,t){return w(e)?e(t):e},this.fromUrl=function(n,r){return w(n)&&(n=n(r)),null==n?null:e.get(n,{cache:t}).then(function(e){return e.data})},this.fromProvider=function(e,t,r){return n.invoke(e,null,r||{params:t})}}function d(e){function t(t){if(!/^\w+(-+\w+)*$/.test(t))throw new Error("Invalid parameter name '"+t+"' in pattern '"+e+"'");if(s[t])throw new Error("Duplicate parameter name '"+t+"' in pattern '"+e+"'");s[t]=!0,p.push(t)}function n(e){return e.replace(/[\\\[\]\^$*+?.()|{}]/g,"\\$&")}var r,o,i,a,c=/([:*])(\w+)|\{(\w+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,s={},u="^",l=0,d=this.segments=[],p=this.params=[];for(this.source=e;(r=c.exec(e))&&(o=r[2]||r[3],i=r[4]||("*"==r[1]?".*":"[^/]*"),!((a=e.substring(l,r.index)).indexOf("?")>=0));)u+=n(a)+"("+i+")",t(o),d.push(a),l=c.lastIndex;var f=(a=e.substring(l)).indexOf("?");if(f>=0){var m=this.sourceSearch=a.substring(f);a=a.substring(0,f),this.sourcePath=e.substring(0,l+f),$(m.substring(1).split(/[&?]/),t)}else this.sourcePath=e,this.sourceSearch="";u+=n(a)+"$",d.push(a),this.regexp=new RegExp(u),this.prefix=d[0]}function p(e){function t(e){var t=/^\^((?:\\[^a-zA-Z0-9]|[^\\\[\]\^$*+?.()|{}]+)*)/.exec(e.source);return null!=t?t[1].replace(/\\(.)/g,"$1"):""}function n(e,t,n){if(!n)return!1;var r=e.invoke(t,t,{$match:n});return!_(r)||r}var r=[],o=null;this.rule=function(e){if(!w(e))throw new Error("'rule' must be a function");return r.push(e),this},this.otherwise=function(e){if(b(e)){var t=e;e=function(){return t}}else if(!w(e))throw new Error("'rule' must be a function");return o=e,this},this.when=function(r,o){var i,a=b(o);if(b(r)&&(r=e.compile(r)),!a&&!w(o)&&!A(o))throw new Error("invalid 'handler' in when()");var c={matcher:function(t,r){return a&&(i=e.compile(r),r=["$match",function(e){return i.format(e)}]),I(function(e,o){return n(e,r,t.exec(o.path(),o.search()))},{prefix:b(t.prefix)?t.prefix:""})},regex:function(e,r){if(e.global||e.sticky)throw new Error("when() RegExp must not be global or sticky");return a&&(i=r,r=["$match",function(e){return function(e,t){return e.replace(/\$(\$|\d{1,2})/,function(e,n){return t["$"===n?0:Number(n)]})}(i,e)}]),I(function(t,o){return n(t,r,e.exec(o.path()))},{prefix:t(e)})}},s={matcher:e.isMatcher(r),regex:r instanceof RegExp};for(var u in s)if(s[u])return this.rule(c[u](r,o));throw new Error("invalid 'what' in when()")},this.$get=["$location","$rootScope","$injector",function(e,t,n){function i(t){function i(t){var r=t(n,e);return!!r&&(b(r)&&e.replace().url(r),!0)}if(!t||!t.defaultPrevented){var a,c=r.length;for(a=0;c>a;a++)if(i(r[a]))return;o&&i(o)}}return t.$on("$locationChangeSuccess",i),{sync:function(){i()}}}]}function f(e,o,i){function u(e,t){var r=b(e),o=r?e:e.name;if(function(e){return 0===e.indexOf(".")||0===e.indexOf("^")}(o)){if(!t)throw new Error("No reference point given for path '"+o+"'");for(var i=o.split("."),a=0,c=i.length,s=t;c>a;a++)if(""!==i[a]||0!==a){if("^"!==i[a])break;if(!s.parent)throw new Error("Path '"+o+"' not valid for state '"+t.name+"'");s=s.parent}else s=t;i=i.slice(a).join("."),o=s.name+(s.name&&i?".":"")+i}var u=m[o];return!u||!r&&(r||u!==e&&u.self!==e)?n:u}function l(t){var n=(t=r(t,{self:t,resolve:t.resolve||{},toString:function(){return this.name}})).name;if(!b(n)||n.indexOf("@")>=0)throw new Error("State must have a valid name");if(m.hasOwnProperty(n))throw new Error("State '"+n+"'' is already defined");var o=-1!==n.indexOf(".")?n.substring(0,n.lastIndexOf(".")):b(t.parent)?t.parent:"";if(o&&!m[o])return function(e,t){h[e]||(h[e]=[]),h[e].push(t)}(o,t.self);for(var i in v)w(v[i])&&(t[i]=v[i](t,v.$delegates[i]));if(m[n]=t,!t[g]&&t.url&&e.when(t.url,["$match","$stateParams",function(e,n){f.$current.navigable==t&&s(e,n)||f.transitionTo(t,e,{location:!1})}]),h[n])for(var a=0;a<h[n].length;a++)l(h[n][a]);return t}function d(e,o,l,d,h,v,y,C,E){function S(){y.url()!==M&&(y.url(M),y.replace())}function T(e,n,r,i,a){var c=r?n:function(e,t){var n={};return $(e,function(e){n[e]=t[e]}),n}(e.params,n),s={$stateParams:c};a.resolve=h.resolve(e.resolve,s,a.resolve,e);var u=[a.resolve.then(function(e){a.globals=e})];return i&&u.push(i),$(e.views,function(n,r){var o=n.resolve&&n.resolve!==e.resolve?n.resolve:{};o.$template=[function(){return l.load(r,{view:n,locals:s,params:c,notify:!1})||""}],u.push(h.resolve(o,s,a.resolve,e).then(function(i){if(w(n.controllerProvider)||A(n.controllerProvider)){var c=t.extend({},o,s);i.$$controller=d.invoke(n.controllerProvider,null,c)}else i.$$controller=n.controller;i.$$state=e,i.$$controllerAs=n.controllerAs,a[r]=i}))}),o.all(u).then(function(){return a})}var P=o.reject(new Error("transition superseded")),N=o.reject(new Error("transition prevented")),x=o.reject(new Error("transition aborted")),D=o.reject(new Error("transition failed")),M=y.url(),O=E.baseHref();return p.locals={resolve:null,globals:{$stateParams:{}}},(f={params:{},current:p.self,$current:p,transition:null}).reload=function(){f.transitionTo(f.current,v,{reload:!0,inherit:!1,notify:!1})},f.go=function(e,t,n){return this.transitionTo(e,t,I({inherit:!0,relative:f.$current},n))},f.transitionTo=function(t,n,i){n=n||{},i=I({location:!0,inherit:!1,relative:null,notify:!0,reload:!1,$retry:!1},i||{});var l,m=f.$current,h=f.params,C=m.path,E=u(t,i.relative);if(!_(E)){var w={to:t,toParams:n,options:i};if((l=e.$broadcast("$stateNotFound",w,m.self,h)).defaultPrevented)return S(),x;if(l.retry){if(i.$retry)return S(),D;var b=f.transition=o.when(l.retry);return b.then(function(){return b!==f.transition?P:(w.options.$retry=!0,f.transitionTo(w.to,w.toParams,w.options))},function(){return x}),S(),b}if(t=w.to,n=w.toParams,i=w.options,E=u(t,i.relative),!_(E)){if(i.relative)throw new Error("Could not resolve '"+t+"' from state '"+i.relative+"'");throw new Error("No such state '"+t+"'")}}if(E[g])throw new Error("Cannot transition to abstract state '"+t+"'");i.inherit&&(n=a(v,n||{},f.$current,E));var A,$,O=(t=E).path,R=p.locals,L=[];for($=O[A=0];$&&$===C[A]&&s(n,h,$.ownParams)&&!i.reload;$=O[++A])R=L[A]=$.locals;if(function(e,t,n,r){return e===t&&(n===t.locals&&!r.reload||!1===e.self.reloadOnSearch)||void 0}(t,m,R,i))return!1!==t.self.reloadOnSearch&&S(),f.transition=null,o.when(f.current);if(n=c(t.params,n||{}),i.notify&&(l=e.$broadcast("$stateChangeStart",t.self,n,m.self,h)).defaultPrevented)return S(),N;for(var V=o.when(R),U=A;U<O.length;$=O[++U])R=L[U]=r(R),V=T($,n,$===t,V,R);var F=f.transition=V.then(function(){var r,o,a;if(f.transition!==F)return P;for(r=C.length-1;r>=A;r--)(a=C[r]).self.onExit&&d.invoke(a.self.onExit,a.self,a.locals.globals),a.locals=null;for(r=A;r<O.length;r++)(o=O[r]).locals=L[r],o.self.onEnter&&d.invoke(o.self.onEnter,o.self,o.locals.globals);if(f.transition!==F)return P;f.$current=t,f.current=t.self,f.params=n,k(f.params,v),f.transition=null;var c=t.navigable;return i.location&&c&&(y.url(c.url.format(c.locals.globals.$stateParams)),"replace"===i.location&&y.replace()),i.notify&&e.$broadcast("$stateChangeSuccess",t.self,n,m.self,h),M=y.url(),f.current},function(r){return f.transition!==F?P:(f.transition=null,e.$broadcast("$stateChangeError",t.self,n,m.self,h,r),S(),o.reject(r))});return F},f.is=function(e,r){var o=u(e);return _(o)?f.$current===o&&(!_(r)||null===r||t.equals(v,r)):n},f.includes=function(e,r){if(b(e)&&function(e){return e.indexOf("*")>-1}(e)){if(!function(e){var t=e.split("."),n=f.$current.name.split(".");if("**"===t[0]&&(n=n.slice(n.indexOf(t[1]))).unshift("**"),"**"===t[t.length-1]&&(n.splice(n.indexOf(t[t.length-2])+1,Number.MAX_VALUE),n.push("**")),t.length!=n.length)return!1;for(var r=0,o=t.length;o>r;r++)"*"===t[r]&&(n[r]="*");return n.join("")===t.join("")}(e))return!1;e=f.$current.name}var o=u(e);if(!_(o))return n;if(!_(f.$current.includes[o.name]))return!1;var i=!0;return t.forEach(r,function(e,t){_(v[t])&&v[t]===e||(i=!1)}),i},f.href=function(e,t,n){var r=u(e,(n=I({lossy:!0,inherit:!1,absolute:!1,relative:f.$current},n||{})).relative);if(!_(r))return null;t=a(v,t||{},f.$current,r);var o=r&&n.lossy?r.navigable:r,s=o&&o.url?o.url.format(c(r.params,t||{})):null;return!i.html5Mode()&&s&&(s="#"+i.hashPrefix()+s),"/"!==O&&(i.html5Mode()?s=O.slice(0,-1)+s:n.absolute&&(s=O.slice(1)+s)),n.absolute&&s&&(s=y.protocol()+"://"+y.host()+(80==y.port()||443==y.port()?"":":"+y.port())+(!i.html5Mode()&&s?"/":"")+s),s},f.get=function(e,t){if(!_(e)){var n=[];return $(m,function(e){n.push(e.self)}),n}var r=u(e,t);return r&&r.self?r.self:null},f}var p,f,m={},h={},g="abstract",v={parent:function(e){if(_(e.parent)&&e.parent)return u(e.parent);var t=/^(.+)\.[^.]+$/.exec(e.name);return t?u(t[1]):p},data:function(e){return e.parent&&e.parent.data&&(e.data=e.self.data=I({},e.parent.data,e.data)),e.data},url:function(e){var t=e.url;if(b(t))return"^"==t.charAt(0)?o.compile(t.substring(1)):(e.parent.navigable||p).url.concat(t);if(o.isMatcher(t)||null==t)return t;throw new Error("Invalid url '"+t+"' in state '"+e+"'")},navigable:function(e){return e.url?e:e.parent?e.parent.navigable:null},params:function(e){if(!e.params)return e.url?e.url.parameters():e.parent.params;if(!A(e.params))throw new Error("Invalid params in state '"+e+"'");if(e.url)throw new Error("Both params and url specicified in state '"+e+"'");return e.params},views:function(e){var t={};return $(_(e.views)?e.views:{"":e},function(n,r){r.indexOf("@")<0&&(r+="@"+e.parent.name),t[r]=n}),t},ownParams:function(e){if(!e.parent)return e.params;var t={};$(e.params,function(e){t[e]=!0}),$(e.parent.params,function(n){if(!t[n])throw new Error("Missing required parameter '"+n+"' in state '"+e.name+"'");t[n]=!1});var n=[];return $(t,function(e,t){e&&n.push(t)}),n},path:function(e){return e.parent?e.parent.path.concat(e):[]},includes:function(e){var t=e.parent?I({},e.parent.includes):{};return t[e.name]=!0,t},$delegates:{}};(p=l({name:"",url:"^",views:null,abstract:!0})).navigable=null,this.decorator=function(e,t){return b(e)&&!_(t)?v[e]:w(t)&&b(e)?(v[e]&&!v.$delegates[e]&&(v.$delegates[e]=v[e]),v[e]=t,this):this},this.state=function(e,t){return P(e)?t=e:t.name=e,l(t),this},this.$get=d,d.$inject=["$rootScope","$q","$view","$injector","$resolve","$stateParams","$location","$urlRouter","$browser"]}function m(){function e(e,t){return{load:function(n,r){var o;return(r=I({template:null,controller:null,view:null,locals:null,notify:!0,async:!0,params:{}},r)).view&&(o=t.fromConfig(r.view,r.params,r.locals)),o&&r.notify&&e.$broadcast("$viewContentLoading",r),o}}}this.$get=e,e.$inject=["$rootScope","$templateFactory"]}function h(e,n,r){function o(e,t){if(c)return{enter:function(e,t,n){c.enter(e,null,t,n)},leave:function(e,t){c.leave(e,t)}};if(a){var n=a&&a(t,e);return{enter:function(e,t,r){n.enter(e,null,t),r()},leave:function(e,t){n.leave(e),t()}}}return{enter:function(e,t,n){t.after(e),n()},leave:function(e,t){e.remove(),t()}}}var i=n.has?function(e){return n.has(e)?n.get(e):null}:function(e){try{return n.get(e)}catch(e){return null}},a=i("$animator"),c=i("$animate");return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",compile:function(n,i,a){return function(n,i,c){function s(){l&&(l.remove(),l=null),p&&(p.$destroy(),p=null),d&&(g.leave(d,function(){l=null}),l=d,d=null)}function u(o){var c=n.$new(),u=d&&d.data("$uiViewName"),l=u&&e.$current&&e.$current.locals[u];if(o||l!==f){var v=a(c,function(e){g.enter(e,i,function(){(t.isDefined(h)&&!h||n.$eval(h))&&r(e)}),s()});f=e.$current.locals[v.data("$uiViewName")],d=v,(p=c).$emit("$viewContentLoaded"),p.$eval(m)}}var l,d,p,f,m=c.onload||"",h=c.autoscroll,g=o(c,n);n.$on("$stateChangeSuccess",function(){u(!1)}),n.$on("$viewContentLoading",function(){u(!1)}),u(!0)}}}}function g(e,t,n){return{restrict:"ECA",priority:-400,compile:function(r){var o=r.html();return function(r,i,a){var c=a.uiView||a.name||"",s=i.inheritedData("$uiView");c.indexOf("@")<0&&(c=c+"@"+(s?s.state.name:"")),i.data("$uiViewName",c);var u=n.$current,l=u&&u.locals[c];if(l){i.data("$uiView",{name:c,state:l.$$state}),i.html(l.$template?l.$template:o);var d=e(i.contents());if(l.$$controller){l.$scope=r;var p=t(l.$$controller,l);l.$$controllerAs&&(r[l.$$controllerAs]=p),i.data("$ngControllerController",p),i.children().data("$ngControllerController",p)}d(r)}}}}}function v(e){var t=e.parent().inheritedData("$uiView");return t&&t.state&&t.state.name?t.state:void 0}function y(e,n){var r=["location","inherit","reload"];return{restrict:"A",require:"?^uiSrefActive",link:function(o,i,a,c){var s=function(e){var t=e.replace(/\n/g," ").match(/^([^(]+?)\s*(\((.*)\))?$/);if(!t||4!==t.length)throw new Error("Invalid state ref '"+e+"'");return{state:t[1],paramExpr:t[3]||null}}(a.uiSref),u=null,l=v(i)||e.$current,d="FORM"===i[0].nodeName,p=d?"action":"href",f=!0,m={relative:l},h=o.$eval(a.uiSrefOpts)||{};t.forEach(r,function(e){e in h&&(m[e]=h[e])});var g=function(t){if(t&&(u=t),f){var n=e.href(s.state,u,m);return c&&c.$$setStateInfo(s.state,u),n?void(i[0][p]=n):(f=!1,!1)}};s.paramExpr&&(o.$watch(s.paramExpr,function(e){e!==u&&g(e)},!0),u=o.$eval(s.paramExpr)),g(),d||i.bind("click",function(t){(t.which||t.button)>1||t.ctrlKey||t.metaKey||t.shiftKey||i.attr("target")||(n(function(){e.go(s.state,u,m)}),t.preventDefault())})}}}function C(e,t,n){return{restrict:"A",controller:["$scope","$element","$attrs",function(r,o,i){function a(){e.$current.self!==c||u&&!s(u,t)?o.removeClass(l):o.addClass(l)}var c,u,l;l=n(i.uiSrefActive||"",!1)(r),this.$$setStateInfo=function(t,n){c=e.get(t,v(o)),u=n,a()},r.$on("$stateChangeSuccess",a)}]}}function E(e){return function(t){return e.is(t)}}function S(e){return function(t){return e.includes(t)}}function T(e,t){function o(e){this.locals=e.locals.globals,this.params=this.locals.$stateParams}function i(){this.locals=null,this.params=null}function a(e,t,r){function o(e){return""!==e.name?e:n}var i={routes:c,params:r,current:n};return t.$on("$stateChangeStart",function(e,n,r,i){t.$broadcast("$routeChangeStart",o(n),o(i))}),t.$on("$stateChangeSuccess",function(e,n,r,a){i.current=o(n),t.$broadcast("$routeChangeSuccess",o(n),o(a)),k(r,i.params)}),t.$on("$stateChangeError",function(e,n,r,i,a,c){t.$broadcast("$routeChangeError",o(n),o(i),c)}),i}var c=[];o.$inject=["$$state"],this.when=function(n,a){if(null!=a.redirectTo){var s,u=a.redirectTo;if(b(u))s=u;else{if(!w(u))throw new Error("Invalid 'redirectTo' in when()");s=function(e,t){return u(e,t.path(),t.search())}}t.when(n,s)}else e.state(r(a,{parent:null,name:"route:"+encodeURIComponent(n),url:n,onEnter:o,onExit:i}));return c.push(a),this},this.$get=a,a.$inject=["$state","$rootScope","$routeParams"]}var _=t.isDefined,w=t.isFunction,b=t.isString,P=t.isObject,A=t.isArray,$=t.forEach,I=t.extend,k=t.copy;t.module("ui.router.util",["ng"]),t.module("ui.router.router",["ui.router.util"]),t.module("ui.router.state",["ui.router.router","ui.router.util"]),t.module("ui.router",["ui.router.state"]),t.module("ui.router.compat",["ui.router"]),u.$inject=["$q","$injector"],t.module("ui.router.util").service("$resolve",u),l.$inject=["$http","$templateCache","$injector"],t.module("ui.router.util").service("$templateFactory",l),d.prototype.concat=function(e){return new d(this.sourcePath+e+this.sourceSearch)},d.prototype.toString=function(){return this.source},d.prototype.exec=function(e,t){var n=this.regexp.exec(e);if(!n)return null;var r,o=this.params,i=o.length,a=this.segments.length-1,c={};if(a!==n.length-1)throw new Error("Unbalanced capture group in route '"+this.source+"'");for(r=0;a>r;r++)c[o[r]]=n[r+1];for(;i>r;r++)c[o[r]]=t[o[r]];return c},d.prototype.parameters=function(){return this.params},d.prototype.format=function(e){var t=this.segments,n=this.params;if(!e)return t.join("");var r,o,i,a=t.length-1,c=n.length,s=t[0];for(r=0;a>r;r++)null!=(i=e[n[r]])&&(s+=encodeURIComponent(i)),s+=t[r+1];for(;c>r;r++)null!=(i=e[n[r]])&&(s+=(o?"&":"?")+n[r]+"="+encodeURIComponent(i),o=!0);return s},t.module("ui.router.util").provider("$urlMatcherFactory",function(){this.compile=function(e){return new d(e)},this.isMatcher=function(e){return P(e)&&w(e.exec)&&w(e.format)&&w(e.concat)},this.$get=function(){return this}}),p.$inject=["$urlMatcherFactoryProvider"],t.module("ui.router.router").provider("$urlRouter",p),f.$inject=["$urlRouterProvider","$urlMatcherFactoryProvider","$locationProvider"],t.module("ui.router.state").value("$stateParams",{}).provider("$state",f),m.$inject=[],t.module("ui.router.state").provider("$view",m),t.module("ui.router.state").provider("$uiViewScroll",function(){var e=!1;this.useAnchorScroll=function(){e=!0},this.$get=["$anchorScroll","$timeout",function(t,n){return e?t:function(e){n(function(){e[0].scrollIntoView()},0,!1)}}]}),h.$inject=["$state","$injector","$uiViewScroll"],g.$inject=["$compile","$controller","$state"],t.module("ui.router.state").directive("uiView",h),t.module("ui.router.state").directive("uiView",g),y.$inject=["$state","$timeout"],C.$inject=["$state","$stateParams","$interpolate"],t.module("ui.router.state").directive("uiSref",y).directive("uiSrefActive",C),E.$inject=["$state"],S.$inject=["$state"],t.module("ui.router.state").filter("isState",E).filter("includedByState",S),T.$inject=["$stateProvider","$urlRouterProvider"],t.module("ui.router.compat").provider("$route",T).directive("ngView",h)}(window,window.angular),function(e,t){"object"==typeof exports&&void 0!==module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.anime=t()}(this,function(){"use strict";var e={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0},t={duration:1e3,delay:0,endDelay:0,easing:"easeOutElastic(1, .5)",round:0},n=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective"],r={CSS:{},springs:{}};function o(e,t,n){return Math.min(Math.max(e,t),n)}function i(e,t){return e.indexOf(t)>-1}function a(e,t){return e.apply(null,t)}var c={arr:function(e){return Array.isArray(e)},obj:function(e){return i(Object.prototype.toString.call(e),"Object")},pth:function(e){return c.obj(e)&&e.hasOwnProperty("totalLength")},svg:function(e){return e instanceof SVGElement},inp:function(e){return e instanceof HTMLInputElement},dom:function(e){return e.nodeType||c.svg(e)},str:function(e){return"string"==typeof e},fnc:function(e){return"function"==typeof e},und:function(e){return void 0===e},hex:function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},rgb:function(e){return/^rgb/.test(e)},hsl:function(e){return/^hsl/.test(e)},col:function(e){return c.hex(e)||c.rgb(e)||c.hsl(e)},key:function(n){return!e.hasOwnProperty(n)&&!t.hasOwnProperty(n)&&"targets"!==n&&"keyframes"!==n}};function s(e){var t=/\(([^)]+)\)/.exec(e);return t?t[1].split(",").map(function(e){return parseFloat(e)}):[]}function u(e,t){var n=s(e),i=o(c.und(n[0])?1:n[0],.1,100),a=o(c.und(n[1])?100:n[1],.1,100),u=o(c.und(n[2])?10:n[2],.1,100),l=o(c.und(n[3])?0:n[3],.1,100),d=Math.sqrt(a/i),p=u/(2*Math.sqrt(a*i)),f=p<1?d*Math.sqrt(1-p*p):0,m=1,h=p<1?(p*d-l)/f:-l+d;function g(e){var n=t?t*e/1e3:e;return n=p<1?Math.exp(-n*p*d)*(m*Math.cos(f*n)+h*Math.sin(f*n)):(m+h*n)*Math.exp(-n*d),0===e||1===e?e:1-n}return t?g:function(){var t=r.springs[e];if(t)return t;for(var n=0,o=0;;)if(1===g(n+=1/6)){if(++o>=16)break}else o=0;var i=n*(1/6)*1e3;return r.springs[e]=i,i}}function l(e){return void 0===e&&(e=10),function(t){return Math.round(t*e)*(1/e)}}var d,p,f=function(){var e=11,t=1/(e-1);function n(e,t){return 1-3*t+3*e}function r(e,t){return 3*t-6*e}function o(e){return 3*e}function i(e,t,i){return((n(t,i)*e+r(t,i))*e+o(t))*e}function a(e,t,i){return 3*n(t,i)*e*e+2*r(t,i)*e+o(t)}return function(n,r,o,c){if(0<=n&&n<=1&&0<=o&&o<=1){var s=new Float32Array(e);if(n!==r||o!==c)for(var u=0;u<e;++u)s[u]=i(u*t,n,o);return function(e){return n===r&&o===c?e:0===e||1===e?e:i(l(e),r,c)}}function l(r){for(var c=0,u=1,l=e-1;u!==l&&s[u]<=r;++u)c+=t;var d=c+(r-s[--u])/(s[u+1]-s[u])*t,p=a(d,n,o);return p>=.001?function(e,t,n,r){for(var o=0;o<4;++o){var c=a(t,n,r);if(0===c)return t;t-=(i(t,n,r)-e)/c}return t}(r,d,n,o):0===p?d:function(e,t,n,r,o){for(var a,c,s=0;(a=i(c=t+(n-t)/2,r,o)-e)>0?n=c:t=c,Math.abs(a)>1e-7&&++s<10;);return c}(r,c,c+t,n,o)}}}(),m=(d={linear:function(){return function(e){return e}}},p={Sine:function(){return function(e){return 1-Math.cos(e*Math.PI/2)}},Circ:function(){return function(e){return 1-Math.sqrt(1-e*e)}},Back:function(){return function(e){return e*e*(3*e-2)}},Bounce:function(){return function(e){for(var t,n=4;e<((t=Math.pow(2,--n))-1)/11;);return 1/Math.pow(4,3-n)-7.5625*Math.pow((3*t-2)/22-e,2)}},Elastic:function(e,t){void 0===e&&(e=1),void 0===t&&(t=.5);var n=o(e,1,10),r=o(t,.1,2);return function(e){return 0===e||1===e?e:-n*Math.pow(2,10*(e-1))*Math.sin((e-1-r/(2*Math.PI)*Math.asin(1/n))*(2*Math.PI)/r)}}},["Quad","Cubic","Quart","Quint","Expo"].forEach(function(e,t){p[e]=function(){return function(e){return Math.pow(e,t+2)}}}),Object.keys(p).forEach(function(e){var t=p[e];d["easeIn"+e]=t,d["easeOut"+e]=function(e,n){return function(r){return 1-t(e,n)(1-r)}},d["easeInOut"+e]=function(e,n){return function(r){return r<.5?t(e,n)(2*r)/2:1-t(e,n)(-2*r+2)/2}}}),d);function h(e,t){if(c.fnc(e))return e;var n=e.split("(")[0],r=m[n],o=s(e);switch(n){case"spring":return u(e,t);case"cubicBezier":return a(f,o);case"steps":return a(l,o);default:return a(r,o)}}function g(e){try{return document.querySelectorAll(e)}catch(e){return}}function v(e,t){for(var n=e.length,r=arguments.length>=2?arguments[1]:void 0,o=[],i=0;i<n;i++)if(i in e){var a=e[i];t.call(r,a,i,e)&&o.push(a)}return o}function y(e){return e.reduce(function(e,t){return e.concat(c.arr(t)?y(t):t)},[])}function C(e){return c.arr(e)?e:(c.str(e)&&(e=g(e)||e),e instanceof NodeList||e instanceof HTMLCollection?[].slice.call(e):[e])}function E(e,t){return e.some(function(e){return e===t})}function S(e){var t={};for(var n in e)t[n]=e[n];return t}function T(e,t){var n=S(e);for(var r in e)n[r]=t.hasOwnProperty(r)?t[r]:e[r];return n}function _(e,t){var n=S(e);for(var r in t)n[r]=c.und(e[r])?t[r]:e[r];return n}function w(e){var t=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(e);if(t)return t[1]}function b(e,t){return c.fnc(e)?e(t.target,t.id,t.total):e}function P(e,t){return e.getAttribute(t)}function A(e,t,n){if(E([n,"deg","rad","turn"],w(t)))return t;var o=r.CSS[t+n];if(!c.und(o))return o;var i=document.createElement(e.tagName),a=e.parentNode&&e.parentNode!==document?e.parentNode:document.body;a.appendChild(i),i.style.position="absolute",i.style.width=100+n;var s=100/i.offsetWidth;a.removeChild(i);var u=s*parseFloat(t);return r.CSS[t+n]=u,u}function $(e,t,n){if(t in e.style){var r=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),o=e.style[t]||getComputedStyle(e).getPropertyValue(r)||"0";return n?A(e,o,n):o}}function I(e,t){return c.dom(e)&&!c.inp(e)&&(P(e,t)||c.svg(e)&&e[t])?"attribute":c.dom(e)&&E(n,t)?"transform":c.dom(e)&&"transform"!==t&&$(e,t)?"css":null!=e[t]?"object":void 0}function k(e){if(c.dom(e)){for(var t,n=e.style.transform||"",r=/(\w+)\(([^)]*)\)/g,o=new Map;t=r.exec(n);)o.set(t[1],t[2]);return o}}function N(e,t,n,r){switch(I(e,t)){case"transform":return function(e,t,n,r){var o,a=i(t,"scale")?1:0+(i(o=t,"translate")||"perspective"===o?"px":i(o,"rotate")||i(o,"skew")?"deg":void 0),c=k(e).get(t)||a;return n&&(n.transforms.list.set(t,c),n.transforms.last=t),r?A(e,c,r):c}(e,t,r,n);case"css":return $(e,t,n);case"attribute":return P(e,t);default:return e[t]||0}}function x(e,t){var n=/^(\*=|\+=|-=)/.exec(e);if(!n)return e;var r=w(e)||0,o=parseFloat(t),i=parseFloat(e.replace(n[0],""));switch(n[0][0]){case"+":return o+i+r;case"-":return o-i+r;case"*":return o*i+r}}function D(e,t){if(c.col(e))return function(e){return c.rgb(e)?(n=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(t=e))?"rgba("+n[1]+",1)":t:c.hex(e)?(r=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,n,r){return t+t+n+n+r+r}),o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r),"rgba("+parseInt(o[1],16)+","+parseInt(o[2],16)+","+parseInt(o[3],16)+",1)"):c.hsl(e)?function(e){var t,n,r,o=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(e)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(e),i=parseInt(o[1],10)/360,a=parseInt(o[2],10)/100,c=parseInt(o[3],10)/100,s=o[4]||1;function u(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}if(0==a)t=n=r=c;else{var l=c<.5?c*(1+a):c+a-c*a,d=2*c-l;t=u(d,l,i+1/3),n=u(d,l,i),r=u(d,l,i-1/3)}return"rgba("+255*t+","+255*n+","+255*r+","+s+")"}(e):void 0;var t,n,r,o}(e);if(/\s/g.test(e))return e;var n=w(e),r=n?e.substr(0,e.length-n.length):e;return t?r+t:r}function M(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function O(e){for(var t,n=e.points,r=0,o=0;o<n.numberOfItems;o++){var i=n.getItem(o);o>0&&(r+=M(t,i)),t=i}return r}function R(e){if(e.getTotalLength)return e.getTotalLength();switch(e.tagName.toLowerCase()){case"circle":return i=e,2*Math.PI*P(i,"r");case"rect":return 2*P(o=e,"width")+2*P(o,"height");case"line":return M({x:P(r=e,"x1"),y:P(r,"y1")},{x:P(r,"x2"),y:P(r,"y2")});case"polyline":return O(e);case"polygon":return n=(t=e).points,O(t)+M(n.getItem(n.numberOfItems-1),n.getItem(0))}var t,n,r,o,i}function L(e,t){var n=t||{},r=n.el||function(e){for(var t=e.parentNode;c.svg(t)&&c.svg(t.parentNode);)t=t.parentNode;return t}(e),o=r.getBoundingClientRect(),i=P(r,"viewBox"),a=o.width,s=o.height,u=n.viewBox||(i?i.split(" "):[0,0,a,s]);return{el:r,viewBox:u,x:u[0]/1,y:u[1]/1,w:a/u[2],h:s/u[3]}}function V(e,t){function n(n){void 0===n&&(n=0);var r=t+n>=1?t+n:0;return e.el.getPointAtLength(r)}var r=L(e.el,e.svg),o=n(),i=n(-1),a=n(1);switch(e.property){case"x":return(o.x-r.x)*r.w;case"y":return(o.y-r.y)*r.h;case"angle":return 180*Math.atan2(a.y-i.y,a.x-i.x)/Math.PI}}function U(e,t){var n=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,r=D(c.pth(e)?e.totalLength:e,t)+"";return{original:r,numbers:r.match(n)?r.match(n).map(Number):[0],strings:c.str(e)||t?r.split(n):[]}}function F(e){return v(e?y(c.arr(e)?e.map(C):C(e)):[],function(e,t,n){return n.indexOf(e)===t})}function B(e){var t=F(e);return t.map(function(e,n){return{target:e,id:n,total:t.length,transforms:{list:k(e)}}})}function H(e,t){var n=S(t);if(/^spring/.test(n.easing)&&(n.duration=u(n.easing)),c.arr(e)){var r=e.length;2!==r||c.obj(e[0])?c.fnc(t.duration)||(n.duration=t.duration/r):e={value:e}}var o=c.arr(e)?e:[e];return o.map(function(e,n){var r=c.obj(e)&&!c.pth(e)?e:{value:e};return c.und(r.delay)&&(r.delay=n?0:t.delay),c.und(r.endDelay)&&(r.endDelay=n===o.length-1?t.endDelay:0),r}).map(function(e){return _(e,n)})}function W(e,t){var n=[],r=t.keyframes;for(var o in r&&(t=_(function(e){for(var t=v(y(e.map(function(e){return Object.keys(e)})),function(e){return c.key(e)}).reduce(function(e,t){return e.indexOf(t)<0&&e.push(t),e},[]),n={},r=function(r){var o=t[r];n[o]=e.map(function(e){var t={};for(var n in e)c.key(n)?n==o&&(t.value=e[n]):t[n]=e[n];return t})},o=0;o<t.length;o++)r(o);return n}(r),t)),t)c.key(o)&&n.push({name:o,tweens:H(t[o],e)});return n}var q={css:function(e,t,n){return e.style[t]=n},attribute:function(e,t,n){return e.setAttribute(t,n)},object:function(e,t,n){return e[t]=n},transform:function(e,t,n,r,o){if(r.list.set(t,n),t===r.last||o){var i="";r.list.forEach(function(e,t){i+=t+"("+e+") "}),e.style.transform=i}}};function j(e,t){B(e).forEach(function(e){for(var n in t){var r=b(t[n],e),o=e.target,i=w(r),a=N(o,n,i,e),c=x(D(r,i||w(a)),a),s=I(o,n);q[s](o,n,c,e.transforms,!0)}})}function Y(e,t){return v(y(e.map(function(e){return t.map(function(t){return function(e,t){var n=I(e.target,t.name);if(n){var r=function(e,t){var n;return e.tweens.map(function(r){var o=function(e,t){var n={};for(var r in e){var o=b(e[r],t);c.arr(o)&&1===(o=o.map(function(e){return b(e,t)})).length&&(o=o[0]),n[r]=o}return n.duration=parseFloat(n.duration),n.delay=parseFloat(n.delay),n}(r,t),i=o.value,a=c.arr(i)?i[1]:i,s=w(a),u=N(t.target,e.name,s,t),l=n?n.to.original:u,d=c.arr(i)?i[0]:l,p=w(d)||w(u),f=s||p;return c.und(a)&&(a=l),o.from=U(d,f),o.to=U(x(a,d),f),o.start=n?n.end:0,o.end=o.start+o.delay+o.duration+o.endDelay,o.easing=h(o.easing,o.duration),o.isPath=c.pth(i),o.isColor=c.col(o.from.original),o.isColor&&(o.round=1),n=o,o})}(t,e),o=r[r.length-1];return{type:n,property:t.name,animatable:e,tweens:r,duration:o.end,delay:r[0].delay,endDelay:o.endDelay}}}(e,t)})})),function(e){return!c.und(e)})}function G(e,t){var n=e.length,r=function(e){return e.timelineOffset?e.timelineOffset:0},o={};return o.duration=n?Math.max.apply(Math,e.map(function(e){return r(e)+e.duration})):t.duration,o.delay=n?Math.min.apply(Math,e.map(function(e){return r(e)+e.delay})):t.delay,o.endDelay=n?o.duration-Math.max.apply(Math,e.map(function(e){return r(e)+e.duration-e.endDelay})):t.endDelay,o}var z,K=0,Z=[],J=[],Q=function(){function e(){z=requestAnimationFrame(t)}function t(t){var n=Z.length;if(n){for(var r=0;r<n;){var o=Z[r];if(o.paused){var i=Z.indexOf(o);i>-1&&(Z.splice(i,1),n=Z.length)}else o.tick(t);r++}e()}else z=cancelAnimationFrame(z)}return e}();function X(n){void 0===n&&(n={});var r,i=0,a=0,c=0,s=0,u=null;function l(e){var t=window.Promise&&new Promise(function(e){return u=e});return e.finished=t,t}var d,p,f,m,h,g,y,C,E=(p=T(e,d=n),m=W(f=T(t,d),d),y=G(g=Y(h=B(d.targets),m),f),C=K,K++,_(p,{id:C,children:[],animatables:h,animations:g,duration:y.duration,delay:y.delay,endDelay:y.endDelay}));function S(){var e=E.direction;"alternate"!==e&&(E.direction="normal"!==e?"normal":"reverse"),E.reversed=!E.reversed,r.forEach(function(e){return e.reversed=E.reversed})}function w(e){return E.reversed?E.duration-e:e}function b(){i=0,a=w(E.currentTime)*(1/X.speed)}function P(e,t){t&&t.seek(e-t.timelineOffset)}function A(e){for(var t=0,n=E.animations,r=n.length;t<r;){var i=n[t],a=i.animatable,c=i.tweens,s=c.length-1,u=c[s];s&&(u=v(c,function(t){return e<t.end})[0]||u);for(var l=o(e-u.start-u.delay,0,u.duration)/u.duration,d=isNaN(l)?1:u.easing(l),p=u.to.strings,f=u.round,m=[],h=u.to.numbers.length,g=void 0,y=0;y<h;y++){var C=void 0,S=u.to.numbers[y],T=u.from.numbers[y]||0;C=u.isPath?V(u.value,d*S):T+d*(S-T),f&&(u.isColor&&y>2||(C=Math.round(C*f)/f)),m.push(C)}var _=p.length;if(_){g=p[0];for(var w=0;w<_;w++){p[w];var b=p[w+1],P=m[w];isNaN(P)||(g+=b?P+b:P+" ")}}else g=m[0];q[i.type](a.target,i.property,g,a.transforms),i.currentValue=g,t++}}function $(e){E[e]&&!E.passThrough&&E[e](E)}function I(e){var t=E.duration,n=E.delay,d=t-E.endDelay,p=w(e);E.progress=o(p/t*100,0,100),E.reversePlayback=p<E.currentTime,r&&function(e){if(E.reversePlayback)for(var t=s;t--;)P(e,r[t]);else for(var n=0;n<s;n++)P(e,r[n])}(p),!E.began&&E.currentTime>0&&(E.began=!0,$("begin")),!E.loopBegan&&E.currentTime>0&&(E.loopBegan=!0,$("loopBegin")),p<=n&&0!==E.currentTime&&A(0),(p>=d&&E.currentTime!==t||!t)&&A(t),p>n&&p<d?(E.changeBegan||(E.changeBegan=!0,E.changeCompleted=!1,$("changeBegin")),$("change"),A(p)):E.changeBegan&&(E.changeCompleted=!0,E.changeBegan=!1,$("changeComplete")),E.currentTime=o(p,0,t),E.began&&$("update"),e>=t&&(a=0,E.remaining&&!0!==E.remaining&&E.remaining--,E.remaining?(i=c,$("loopComplete"),E.loopBegan=!1,"alternate"===E.direction&&S()):(E.paused=!0,E.completed||(E.completed=!0,$("loopComplete"),$("complete"),!E.passThrough&&"Promise"in window&&(u(),l(E)))))}return l(E),E.reset=function(){var e=E.direction;E.passThrough=!1,E.currentTime=0,E.progress=0,E.paused=!0,E.began=!1,E.loopBegan=!1,E.changeBegan=!1,E.completed=!1,E.changeCompleted=!1,E.reversePlayback=!1,E.reversed="reverse"===e,E.remaining=E.loop,r=E.children;for(var t=s=r.length;t--;)E.children[t].reset();(E.reversed&&!0!==E.loop||"alternate"===e&&1===E.loop)&&E.remaining++,A(E.reversed?E.duration:0)},E.set=function(e,t){return j(e,t),E},E.tick=function(e){c=e,i||(i=c),I((c+(a-i))*X.speed)},E.seek=function(e){I(w(e))},E.pause=function(){E.paused=!0,b()},E.play=function(){E.paused&&(E.completed&&E.reset(),E.paused=!1,Z.push(E),b(),z||Q())},E.reverse=function(){S(),b()},E.restart=function(){E.reset(),E.play()},E.reset(),E.autoplay&&E.play(),E}function ee(e,t){for(var n=t.length;n--;)E(e,t[n].animatable.target)&&t.splice(n,1)}return"undefined"!=typeof document&&document.addEventListener("visibilitychange",function(){document.hidden?(Z.forEach(function(e){return e.pause()}),J=Z.slice(0),X.running=Z=[]):J.forEach(function(e){return e.play()})}),X.version="3.1.0",X.speed=1,X.running=Z,X.remove=function(e){for(var t=F(e),n=Z.length;n--;){var r=Z[n],o=r.animations,i=r.children;ee(t,o);for(var a=i.length;a--;){var c=i[a],s=c.animations;ee(t,s),s.length||c.children.length||i.splice(a,1)}o.length||i.length||r.pause()}},X.get=N,X.set=j,X.convertPx=A,X.path=function(e,t){var n=c.str(e)?g(e)[0]:e,r=t||100;return function(e){return{property:e,el:n,svg:L(n),totalLength:R(n)*(r/100)}}},X.setDashoffset=function(e){var t=R(e);return e.setAttribute("stroke-dasharray",t),t},X.stagger=function(e,t){void 0===t&&(t={});var n=t.direction||"normal",r=t.easing?h(t.easing):null,o=t.grid,i=t.axis,a=t.from||0,s="first"===a,u="center"===a,l="last"===a,d=c.arr(e),p=d?parseFloat(e[0]):parseFloat(e),f=d?parseFloat(e[1]):0,m=w(d?e[1]:e)||0,g=t.start||0+(d?p:0),v=[],y=0;return function(e,t,c){if(s&&(a=0),u&&(a=(c-1)/2),l&&(a=c-1),!v.length){for(var h=0;h<c;h++){if(o){var C=u?(o[0]-1)/2:a%o[0],E=u?(o[1]-1)/2:Math.floor(a/o[0]),S=C-h%o[0],T=E-Math.floor(h/o[0]),_=Math.sqrt(S*S+T*T);"x"===i&&(_=-S),"y"===i&&(_=-T),v.push(_)}else v.push(Math.abs(a-h));y=Math.max.apply(Math,v)}r&&(v=v.map(function(e){return r(e/y)*y})),"reverse"===n&&(v=v.map(function(e){return i?e<0?-1*e:-e:Math.abs(y-e)}))}return g+(d?(f-p)/y:p)*(Math.round(100*v[t])/100)+m}},X.timeline=function(e){void 0===e&&(e={});var n=X(e);return n.duration=0,n.add=function(r,o){var i=Z.indexOf(n),a=n.children;function s(e){e.passThrough=!0}i>-1&&Z.splice(i,1);for(var u=0;u<a.length;u++)s(a[u]);var l=_(r,T(t,e));l.targets=l.targets||e.targets;var d=n.duration;l.autoplay=!1,l.direction=n.direction,l.timelineOffset=c.und(o)?d:x(o,d),s(n),n.seek(l.timelineOffset);var p=X(l);s(p),a.push(p);var f=G(a,e);return n.delay=f.delay,n.endDelay=f.endDelay,n.duration=f.duration,n.seek(0),n.reset(),n.autoplay&&n.play(),n},n},X.easing=h,X.penner=m,X.random=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},X});var pnErrorWatcher=function(){function e(){this.message=null,this.stack=null,this.userAgent=null}return new function(){var t=[];function n(n){var r,o=new e,i=n,a="error"in i&&i.error;o.stack=a?i.error.stack:"n/a",o.message=a?i.error.message:"n/a",o.userAgent=navigator.userAgent,r=o,-1===t.map(JSON.stringify).indexOf(JSON.stringify(r))&&t.push(o)}function r(e){try{n(e)}catch(e){console.warn("Can not log an error, something went wrong: ",e)}}this.watchUnhandled=function(){window.addEventListener&&window.addEventListener("error",r)},this.reset=function(){window.removeEventListener("error",r)},this.getErrors=function(){return t.map(function(e){return Object.assign({},e)})}}}(),errorHandler=function(e){function t(){this.sender=null,this.event=null,this.params=null}var n=1e4;try{return new function(){var r={whitelistUrls:[]};function o(){try{var n=e.getErrors().filter(function(e){return r.whitelistUrls.some(function(t){return e.stack&&e.stack.match(t)})});if(0===n.length)return;!function(e){try{var n=window.opener||window.parent,r=Object.assign(new t,{sender:getParameterByName("iframeId"),event:"EVENT_TP_ERROR_HANDLER",params:e});n&&n.postMessage(JSON.stringify(r),"*")}catch(e){console.warn("Can not post message errors to parent: ",e)}}(n)}catch(e){console.warn("Errors can not be sent: ",e)}}function i(){e.watchUnhandled(),setTimeout(function(){o(),e.reset()},n)}this.setConfig=function(e){r=Object.assign(r,e)},this.start=function(){try{i()}catch(e){console.warn("Error logger can not be started: ",e)}}}}catch(e){console.warn("Can't initiate errorHandler: ",e)}}(pnErrorWatcher);function tpDatepickerService(){return{buildCalendarSkeleton:function(r,o,i,a){var c=[],s=null,u=null,l=new Date;l.setHours(0,0,0),i.innerFromDateStart&&i.innerFromDateStart.setHours(0,0,0,0);i.innerFromDateEnd&&i.innerFromDateEnd.setHours(0,0,0,0);a.innerToDateStart&&a.innerToDateStart.setHours(0,0,0,0);a.innerToDateEnd&&a.innerToDateEnd.setHours(0,0,0,0);for(var d=!1,p=r.numColumn*r.numRow;p>0;p--){var f=null,m=null,h=!1,g=!1;switch(r.unit){default:case"d":f=new Date(o.viewDateStart.getFullYear(),o.viewDateStart.getMonth(),p*r.unitRange-(r.unitRange-1),0,0,0,0),m=new Date(o.viewDateEnd.getFullYear(),o.viewDateEnd.getMonth(),p*r.unitRange,0,0,0);break;case"m":f=new Date(o.viewDateStart.getFullYear(),p*r.unitRange-(r.unitRange-1)-1,1),m=new Date(o.viewDateStart.getFullYear(),p*r.unitRange,0)}i.innerFromDateStart>=f&&i.innerFromDateEnd<=m&&(g=!0),f>=i.innerFromDateEnd&&m<=a.innerToDateStart&&(g=!0),a.innerToDateStart>=f&&a.innerToDateEnd<=m&&(g=!0),f>=i.innerFromDateStart&&m<=a.innerToDateEnd&&(g=!0),f>o.viewDateEnd&&(h=!0),d=e(f,l),c.unshift({currentDateStart:f,currentDateOver:m,selectRange:g,disabled:t(f,r),out:h,today:d,selectToday:d&&r.currentDayHighlight,firstSelectDay:!1,lastSelectDay:!1})}if("d"===r.unit&&1===r.unitRange&&7===r.numColumn)for(var v=c[0].currentDateStart.getDay(),p=v>=r.startDay?v-r.startDay:7-(r.startDay-v);p--;){var y=new Date(c[0].currentDateStart.getTime());y.setDate(c[0].currentDateStart.getDate()-1),f=new Date(y.getTime()),m=new Date(f.getTime());var g=!1;i.innerFromDateStart&&a.innerToDateEnd&&(s=new Date(i.innerFromDateStart.getTime()).setHours(0,0,0,0),u=new Date(a.innerToDateEnd.getTime()).setHours(0,0,0,0),f>=s&&m<=u&&(g=!0)),c.unshift({currentDateStart:f,currentDateOver:m,selectRange:g,disabled:t(f,r),out:!0,today:!1,firstSelectDay:!1,lastSelectDay:!1}),c.pop()}var C=null;for(p=c.length;p--;)c[p].index=p,C&&c[p].selectRange&&!C.selectRange&&(c[p].lastSelectDay=!0),!C&&c[p].selectRange&&c[p].currentDateOver>=a.innerToDateEnd&&(c[p].lastSelectDay=!0),C&&!c[p].selectRange&&C.selectRange&&(c[p+1].firstSelectDay=!0),!c[p-1]&&c[p].selectRange&&c[p].currentDateStart<=i.innerFromDateStart&&(c[p].firstSelectDay=!0),C=c[p];for(var E=[],S=0;S<r.numRow;S++){E[S]=[];for(var T=0;T<r.numColumn;T++){if(E[S][T]=c[T+S*r.numColumn],r.markerColumn)for(var _=r.markerColumn.length;_--;)r.markerColumn[_].numb-1===T&&(E[S][T].markerColumn=r.markerColumn[_].name||"marker-column");if(r.markerRow)for(var _=r.markerRow.length;_--;)r.markerRow[_].numb-1===S&&(E[S][T].markerRow=r.markerRow[_].name||"marker-row");E[S][T].markerDay=n(E[S][T],r.markerDays)}}return c=null,E},isSameDay:e};function e(e,t){return e.getDate()<=t.getDate()&&e.getMonth()<=t.getMonth()&&e.getFullYear()<=t.getFullYear()&&e.getDate()>=t.getDate()&&e.getMonth()>=t.getMonth()&&e.getFullYear()>=t.getFullYear()}function t(e,t){var n=t.limitDateNotBefore,r=t.limitDateNotAfter;return n&&r?n>e||e>r:n?n>e:!!r&&r<e}function n(e,t){var n=!1;if(t){var r=new Date(e.currentDateStart.getFullYear(),0,0),o=Math.floor((e.currentDateStart-r)/864e5);r=new Date(e.currentDateOver.getFullYear(),0,0);for(var i=Math.floor((e.currentDateOver-r)/864e5),a=t.length;a--;)if(t[a]>=o&&t[a]<=i){n=!0;break}}return n}}!function(e){try{e.setConfig({whitelistUrls:[/\w*\.tinypass\.com/,/localhost/]}),e.start()}catch(e){console.warn("Can't configure errorHandler: ",e)}}(errorHandler),angular.module("tp.ui.datepicker",["tp.ui.timepicker","tp.i18n","datetime","ngInputDate"]).directive("tpDatepicker",tpDatepicker).directive("tpDatepickerInline",tpDatepickerInline).factory("tpDatepickerService",tpDatepickerService).run(tpTemplates);var datepickerScope={openCalendar:"=?openCalendar",disable:"=?disable",changeState:"&?changeState",fromDate:"=fromDate",toDate:"=toDate",pickClick:"&?pickClick",applyClick:"&?applyClick",changeTab:"&?changeTab",options:"=?options",activeTab:"=?activeTab",openTab:"=?openTab",initialEmpty:"&?initialEmpty"},datepickerInlineScope={fromDate:"=fromDate",toDate:"=toDate",pickClick:"&?pickClick",options:"=?options",currentFromDate:"=",currentToDate:"="};function tpDatepickerInline(){return{scope:datepickerInlineScope,controller:["$scope","$timeout","tpDatepickerService","lang","datetimePlaceholder",function(e,t,n,r,o){datepickerController(e,t,n,r,o),e.$watch(function(){return e.getSelectedFromDate()},function(t){e.currentFromDate=t}),e.$watch(function(){return e.getSelectedToDate()},function(t){e.currentToDate=new Date(t.getTime()+e.activeCalendar.diffDateEnd)})}],templateUrl:"template/datepicker/datepicker-inline.html",restrict:"A"}}function tpDatepicker(e,t,n,r){return{scope:datepickerScope,link:function(r,o,i){r.openCalendar=!!r.openCalendar,o.find("input[type=date]").prop("type","text"),n(function(){r.contentLoaded=!0}),r.showCalendar=function(){if(r.openCalendar=!r.openCalendar,!0===r.disable)r.openCalendar=!1,a();else if(r.openCalendar){if(r.positionUpdated=!1,r.fromDate){var i=new Date(r.fromDate).getHours(),u=new Date(r.fromDate).getMinutes();r.$broadcast("time-updated",{hours:i,minutes:u})}n(function(){var n=o.find(".calendar"),i=o.find(".extended"),a=n.offset().top+n.innerHeight()>t.innerHeight,u=i.offset().top<n.innerHeight(),l=1;if(u&&a){var d=n.innerHeight(),p=t.innerHeight-(i.offset().top+i.innerHeight()),f=i.offset().top,m=p>f;l=((m?p:f)-10)/(n.innerHeight()+19);var h=(d-d*l)/2-19*l;n[0].style.setProperty("transform","scale("+l+")"),n[0].style.setProperty("margin-top","-"+h+"px")}else if(a){var h=n.offset().top-i.offset().top+n.innerHeight()+9;n[0].classList.add("top"),n[0].style.setProperty("top","-"+h+"px")}if(i.offset().left+i.innerWidth()/2<n.innerWidth()*l/2)n.offset({left:20});else if(i.offset().left+n.innerWidth()*l/2+i.innerWidth()/2>t.innerWidth)n.offset({left:t.innerWidth-n.innerWidth()*l-20});else{var g=n.innerWidth()*l,v=(i.innerWidth()-g)/2,y=(n.innerWidth()-g)/2,C=-y+v;n[0].style.setProperty("left",C+"px")}e.bind("click",c),e.bind("keyup",s),r.positionUpdated=!0},10),n(function(){r.changeState&&r.changeState()},10)}else a(),n(function(){r.changeState&&r.changeState()},10)},r.openCalendar&&(r.openCalendar=!1,r.showCalendar());function a(){e.unbind("click",c),e.unbind("keyup",s)}function c(e){r.$apply(function(){r.showCalendar()})}function s(e){switch(e.keyCode){case 27:r.$apply(function(){r.showCalendar()});break;case 37:r.$apply(function(){r.changeLeft(-1),r.changeRight(-1)});break;case 39:r.$apply(function(){r.changeRight(1),r.changeLeft(1)})}}r.updatePosition=function(){n(function(){var e=o.find(".calendar"),n=o.find(".extended");o.find(".dtpicker-input");n.offset().left+n.innerWidth()/2<e.innerWidth()/2?e.offset({left:20}):n.offset().left+e.innerWidth()/2+n.innerWidth()/2>t.innerWidth?e.offset({left:t.innerWidth-e.innerWidth()-20}):e.offset({left:n.offset().left+n.innerWidth()/2-e.innerWidth()/2})},10)},(o.find(".calendar").length?o.find(".calendar"):o).click(function(e){e.stopPropagation()})},controller:["$scope","$timeout","tpDatepickerService","lang","datetimePlaceholder",datepickerController],templateUrl:"template/datepicker/datepicker-custom.html",restrict:"A",transclude:!0}}function datepickerController(e,t,n,r,o){o.year="yyyy",o.month="mm",o.day="dd",o.date="dd",function(){e.options||(e.options={});e.options.mainOptions||(e.options.mainOptions={});"boolean"!=typeof e.options.mainOptions.showPanelTab&&(e.options.mainOptions.showPanelTab=!1);"boolean"!=typeof e.options.mainOptions.instantChanges&&(e.options.mainOptions.instantChanges=!1);"boolean"!=typeof e.options.mainOptions.showPanelCustomButton&&(e.options.mainOptions.showPanelCustomButton=!1);e.options.mainOptions.customPanel||(e.options.mainOptions.customPanel={});e.options.mainOptions.customPanel.dateFormat||(e.options.mainOptions.customPanel.dateFormat="MMM d, yyyy");e.options.mainOptions.startTab||(e.options.mainOptions.startTab=0);e.options.mainOptions.applyButton||(e.options.mainOptions.applyButton={});"string"!=typeof e.options.mainOptions.applyButton.title&&(e.options.mainOptions.applyButton.title=r.tr("Apply selected dates"));"boolean"!=typeof e.options.mainOptions.applyButton.enable&&(e.options.mainOptions.applyButton.enable=!0);e.options.mainOptions.closeButton||(e.options.mainOptions.closeButton={});"string"!=typeof e.options.mainOptions.closeButton.title&&(e.options.mainOptions.closeButton.title="Cancel");"boolean"!=typeof e.options.mainOptions.applyClose&&(e.options.mainOptions.applyClose=!0);e.options.mainOptions.time||(e.options.mainOptions.time={});"boolean"!=typeof e.options.mainOptions.time.enabled&&(e.options.mainOptions.time.enabled=!1);"boolean"!=typeof e.options.mainOptions.time.timeFormat12hours&&(e.options.mainOptions.time.timeFormat12hours=!0);e.options.mainOptions.time.minutesStep||(e.options.mainOptions.time.minutesStep=15);"boolean"!=typeof e.options.mainOptions.time.showTimezone&&(e.options.mainOptions.time.showTimezone=!0);e.options.calendarOptions||(e.options.calendarOptions=[{}]);for(var t=e.options.calendarOptions.length;t--;)e.options.calendarOptions[t].calendarUnitTitle||(e.options.calendarOptions[t].calendarUnitTitle="MMM d, yyyy"),"boolean"!=typeof e.options.calendarOptions[t].calendarUnitTitleRange&&(e.options.calendarOptions[t].calendarUnitTitleRange=!1),e.options.calendarOptions[t].calendarUnit||(e.options.calendarOptions[t].calendarUnit="m"),e.options.calendarOptions[t].calendarUnitCount||(e.options.calendarOptions[t].calendarUnitCount=1),e.options.calendarOptions[t].oneCanvasCalendar||(e.options.calendarOptions[t].oneCanvasCalendar=!1),e.options.calendarOptions[t].unit||(e.options.calendarOptions[t].unit="d"),e.options.calendarOptions[t].unitTitle||(e.options.calendarOptions[t].unitTitle={},e.options.calendarOptions[t].unitTitle.type="date"),"date"===e.options.calendarOptions[t].unitTitle.type&&"string"!=typeof e.options.calendarOptions[t].unitTitle.title&&(e.options.calendarOptions[t].unitTitle.title="d"),"boolean"!=typeof e.options.calendarOptions[t].unitTitleRange&&(e.options.calendarOptions[t].unitTitleRange=!1),("number"!=typeof e.options.calendarOptions[t].startDay||e.options.calendarOptions[t].startDay<0||e.options.calendarOptions[t].startDay>6)&&(e.options.calendarOptions[t].startDay=0),"number"!=typeof e.options.calendarOptions[t].unitRange&&(e.options.calendarOptions[t].unitRange=1),"string"!=typeof e.options.calendarOptions[t].unitSelectRange&&"boolean"!=typeof e.options.calendarOptions[t].unitSelectRange&&(e.options.calendarOptions[t].unitSelectRange=!1),"boolean"!=typeof e.options.calendarOptions[t].enableOneClickRange&&(e.options.calendarOptions[t].enableOneClickRange=!1),"boolean"!=typeof e.options.calendarOptions[t].viewDayOfWeek&&(e.options.calendarOptions[t].viewDayOfWeek="d"===e.options.calendarOptions[t].unit),"number"!=typeof e.options.calendarOptions[t].numColumn&&(e.options.calendarOptions[t].numColumn=7),"number"!=typeof e.options.calendarOptions[t].numRow&&(e.options.calendarOptions[t].numRow=6),e.options.calendarOptions[t].customButtonSelect||(e.options.calendarOptions[t].customButtonSelect=[]),e.options.calendarOptions[t].customButtonCallback||(e.options.calendarOptions[t].customButtonCallback=[]),"boolean"!=typeof e.options.calendarOptions[t].showArrow&&(e.options.calendarOptions[t].showArrow=!0),"boolean"!=typeof e.options.calendarOptions[t].showExtraArrow&&(e.options.calendarOptions[t].showExtraArrow=!1),e.options.calendarOptions[t].limitDateNotBefore instanceof Date?e.options.calendarOptions[t].limitDateNotBefore.setHours(0,0,0,0):e.options.calendarOptions[t].limitDateNotBefore=void 0,e.options.calendarOptions[t].limitDateNotAfter instanceof Date?e.options.calendarOptions[t].limitDateNotAfter.setHours(0,0,0,0):e.options.calendarOptions[t].limitDateNotAfter=void 0,e.options.calendarOptions[t].diffDateEnd||(e.options.calendarOptions[t].diffDateEnd=0),"boolean"!=typeof e.options.calendarOptions[t].currentDayHighlight&&(e.options.calendarOptions[t].currentDayHighlight=!0),"boolean"!=typeof e.options.calendarOptions[t].selectYear&&(e.options.calendarOptions[t].selectYear=!1)}();var i;new Date;function a(){if(e.activeCalendar.startDay>=0){e.dayNames=[];for(var t=7;t--;){var n=new Date,r=n.getDay(),o=e.activeCalendar.startDay-r;n.setDate(n.getDate()+o+6-t),e.dayNames.push(n)}}}e.dirtyDate=!1,e.hideArrow=!1,e.activeTab=e.options.mainOptions.startTab?e.options.mainOptions.startTab:0,e.dayNames=[],e.options.calendarOptions&&(e.activeCalendar=angular.copy(e.options.calendarOptions[e.activeTab]),e.openTab=e.activeCalendar,a()),e.years=[],e.yearInputName="year_hash"+(new Date).getTime(),i=(new Date).getFullYear(),e.years=Array.apply(null,new Array(100)).map(function(e,t){return i-t}),e.$watch("fromDate",function(){v(),S()}),e.$watch("toDate",function(){v(),S()});var c=null,s=null,u=null,l=null,d=null,p=null,f=null,m=null;function h(t){return function(e,t,n){var r=null,o=null,i=null;switch(t){default:case"m":(r=g(e)).setDate(1),o=g(r),r.setMonth(r.getMonth()*n+1),r.setDate(r.getDate()-1),i=g(r);break;case"y":r=g(e),o=new Date(r.getFullYear(),0,1),i=new Date(r.getFullYear()+(n-1),11,31)}return o.setHours(0,0,0,0),i.setHours(0,0,0,0),{dateStart:o,dateOver:i}}(t,e.activeCalendar.calendarUnit,e.activeCalendar.calendarUnitCount)}function g(e){return e?e instanceof Date?new Date(e.getTime()):"string"==typeof e?new Date(e):null:null}function v(){c=s=g(e.fromDate),u=l=g(e.toDate),function(){d=null,p=null,f=null,m=null;var t=null;e.fromDate?(t=g(e.fromDate),d=h(t).dateStart,p=h(t).dateOver):e.toDate?(t=g(e.toDate),d=h(t).dateStart,p=h(t).dateOver):(d=h(new Date).dateStart,p=h(new Date).dateOver);var n=g(d);switch(e.activeCalendar.calendarUnit){default:case"m":n.setMonth(n.getMonth()+e.activeCalendar.calendarUnitCount);break;case"y":n.setFullYear(n.getFullYear()+e.activeCalendar.calendarUnitCount)}e.toDate&&e.toDate>=n?(t=new Date(e.toDate.getTime()),f=h(t).dateStart,m=h(t).dateOver):(f=h(n).dateStart,m=h(n).dateOver);var r=new Date(p.getTime());r.setDate(r.getDate()+1),r.setHours(0,0,0,0),e.hideArrow=r>=f,e.activeCalendar.oneCanvasCalendar&&(e.hideArrow=!1),e.viewDateLeftStart=d,e.viewDateLeftEnd=p,e.viewDateRightStart=f,e.viewDateRightEnd=m}()}function y(t){var n=h(t);f=n.dateStart,m=n.dateOver;var r=new Date(p.getTime());r.setDate(r.getDate()+1),e.hideArrow=r>=f,e.viewDateRightStart=f,e.viewDateRightEnd=m,S()}function C(t){d=h(t).dateStart,p=h(t).dateOver;var n=new Date(p.getTime());n.setDate(n.getDate()+1),e.hideArrow=n>=f,e.activeCalendar.oneCanvasCalendar&&(e.hideArrow=!1),e.viewDateLeftStart=d,e.viewDateLeftEnd=p,S()}function E(e,t,n){var r;return(r=new Date(n>0?t:e)).setDate(r.getDate()+n),r.setDate(1),r}v(),e.clickTab=function(n){e.activeTab=n,e.activeCalendar=e.options.calendarOptions[n],v(),S(),a(),e.dirtyDate=!1,e.updatePosition(),e.openTab=e.activeCalendar,t(function(){e.changeTab&&e.changeTab()},10)},e.clickDate=function(n){if(e.activeCalendar.unitSelectRange)switch(e.activeCalendar.unitSelectRange){default:case"w":("d"!==e.activeCalendar.unit||"d"===e.activeCalendar.unit&&1===e.activeCalendar.unitRange)&&(n.currentDateStart.getDay()>=e.activeCalendar.startDay?n.currentDateStart.setDate(n.currentDateStart.getDate()-(n.currentDateStart.getDay()-e.activeCalendar.startDay)):n.currentDateStart.setDate(n.currentDateStart.getDate()-(7-(e.activeCalendar.startDay-n.currentDateStart.getDay()))),n.currentDateOver.getDay()>=e.activeCalendar.startDay?n.currentDateOver.setDate(n.currentDateOver.getDate()+(6+e.activeCalendar.startDay-n.currentDateOver.getDay())):e.activeCalendar.startDay>n.currentDateOver.getDay()&&n.currentDateOver.setDate(n.currentDateOver.getDate()+(e.activeCalendar.startDay-n.currentDateOver.getDay()-1)));break;case"m":1!==n.currentDateStart.getDate()&&n.currentDateStart.setDate(1);var r=new Date;r.setMonth(r.getMonth()-1),r.setDate(0),n.currentDateOver.getDate()!==r.getDate()&&n.currentDateOver.setDate(r.getDate());break;case"y":0!==n.currentDateStart.getMonth()&&(n.currentDateStart.setMonth(0),n.currentDateStart.setDate(1)),11!==n.currentDateOver.getMonth()&&(n.currentDateOver.setMonth(12),n.currentDateOver.setDate(0))}if(n.disabled)return!1;n.selectRange||!c||!s||c.getTime()!==u.getTime()||s.getTime()!==l.getTime()||e.activeCalendar.enableOneClickRange?(c=new Date(n.currentDateStart.getTime()),s=new Date(n.currentDateOver.getTime()),u=new Date(n.currentDateStart.getTime()),l=new Date(n.currentDateOver.getTime())):n.currentDateStart>=c||n.currentDateOver>=s?(u=new Date(n.currentDateStart.getTime()),l=new Date(n.currentDateOver.getTime())):(c=new Date(n.currentDateStart.getTime()),s=new Date(n.currentDateOver.getTime())),e.options.mainOptions.instantChanges?e.applySelect():(S(),e.dirtyDate=!0),t(function(){e.pickClick&&e.pickClick()},0)},e.changeLeft=function(t){e.activeCalendar.oneCanvasCalendar&&e.changeRight(t);var n=E(d,p,t);new Date(n)>=f&&(n=new Date(f)).setDate(n.getDate()-1),C(n)},e.changeRight=function(e){var t=E(f,m,e);t<=p&&(t=new Date(p)).setDate(t.getDate()+1),y(t)},e.changeLeftInterim=function(t,n){e.activeCalendar.oneCanvasCalendar&&e.changeRightInterim(t,n);var r=new Date(d);r.setYear(r.getFullYear()+t),new Date(r)>=f&&((r=new Date(p)).setDate(1),r.setMonth(f.getMonth()-1),r.setYear(f.getFullYear())),C(r)},e.changeRightInterim=function(e){var t=new Date(m);t.setYear(t.getFullYear()+e),t<=p&&(t=new Date(p)).setDate(t.getDate()+1),y(t)},e.onYearChange=function(t){var n=e.viewDateLeftStart.getFullYear(),r=parseInt(t.year)-n;e.changeLeftInterim(r,"y")},e.customSelectButton=function(t){function n(e,t){var n={};return n.fromDate=e,n.toDate=t,n}switch(t){case"today":t=n(new Date,new Date);break;case"yesterday":var r=new Date,o=(a=-1,(c=new Date(r)).setDate(c.getDate()+a),c);t=n(o,o);break;case"week":t=n(new Date,new Date);var i=new Date;i.getDay()>=e.activeCalendar.startDay?t.fromDate.setDate(i.getDate()-(i.getDay()-e.activeCalendar.startDay)):t.fromDate.setDate(i.getDate()-(7-(e.activeCalendar.startDay-i.getDay()))),i.getDay()>=e.activeCalendar.startDay?t.toDate.setDate(i.getDate()+(6+e.activeCalendar.startDay-i.getDay())):e.activeCalendar.startDay>i.getDay()&&t.toDate.setDate(i.getDate()+(e.activeCalendar.startDay-i.getDay()-1));break;case"7days":(t=n(new Date,new Date)).fromDate.setDate(t.toDate.getDate()-6);break;case"month":(t=n(new Date,new Date)).fromDate.setMonth(t.fromDate.getMonth()-1),t.fromDate.setDate(1),t.toDate.setDate(0);break;case"30days":(t=n(new Date,new Date)).fromDate.setDate(t.fromDate.getDate()-29);break;case"year":(t=n(new Date,new Date)).toDate.setDate(0),t.fromDate.setDate(t.fromDate.getDate()-364);break;case"365days":(t=n(new Date,new Date)).fromDate.setFullYear(t.fromDate.getFullYear()-1)}var a,c;e.fromDate=new Date(t.fromDate.getTime()),e.toDate=new Date(t.toDate.getTime()),e.clickDate({currentDateStart:e.fromDate,currentDateOver:e.fromDate,selectRange:!0}),e.clickDate({currentDateStart:e.toDate,currentDateOver:e.toDate,selectRange:!1}),v(),S(),e.dirtyDate=!1},e.customButtonClick=function(t){t(function(t,n){e.fromDate=t,e.toDate=n})&&e.showCalendar()},e.applySelect=function(n){!n||n.target.className.indexOf("dtpicker-cancel")?(e.options.mainOptions.time.enabled?("[object Date]"===Object.prototype.toString.call(c)&&(e.fromDate=new Date(c.setHours(e.hours,e.minutes,0,0))),"[object Date]"===Object.prototype.toString.call(l)&&(e.toDate=new Date(l.setHours(e.hours,e.minutes,0,0)))):(e.fromDate=c?new Date(c.getTime()):null,e.toDate=l?new Date(l.getTime()+e.activeCalendar.diffDateEnd):null),e.dirtyDate=!1,v(),S(),t(function(){e.applyClick&&e.applyClick()},0),e.options.mainOptions.applyClose&&e.openCalendar&&e.showCalendar()):e.openCalendar&&e.showCalendar()};var S=function(){e.skeletonLeft=n.buildCalendarSkeleton(e.activeCalendar,{viewDateEnd:p,viewDateStart:d},{innerFromDateStart:c,innerFromDateEnd:s},{innerToDateStart:u,innerToDateEnd:l}),e.skeletonRight=n.buildCalendarSkeleton(e.activeCalendar,{viewDateEnd:m,viewDateStart:f},{innerFromDateStart:c,innerFromDateEnd:s},{innerToDateStart:u,innerToDateEnd:l})};S(),e.getSelectedFromDate=function(){return c},e.getSelectedToDate=function(){return l}}function tpTemplates(e){var t='<div class="dtpicker-content">\t<div class="calendar-canva">\t\t<div class="dtpicker-head">\t\t\t<div class="dtpicker-title">\t\t\t\t<div class="dtpicker-pager dtpicker-pager-left">\t\t\t\t\t<div ng-if="activeCalendar.showExtraArrow"  ng-click="changeLeftInterim(-1,\'y\')"  class="dtpicker-prev-year"><i class="icon-arrow-double-datepicker-left"></i></div>\t\t\t\t\t<div ng-if="activeCalendar.showArrow" ng-click="changeLeft(-1)" class="dtpicker-prev-month"><i class="icon-arrow-datepicker-left"></i></div>\t\t\t\t</div>\t\t\t\t<div class="dtpicker-month">\t\t\t\t\t<span>{{viewDateLeftStart | date:activeCalendar.calendarUnitTitle}}</span> \t\t\t\t\t<span ng-if="activeCalendar.calendarUnitTitleRange"> &mdash; {{viewDateLeftEnd | date:activeCalendar.calendarUnitTitle}}</span>\t\t\t\t\t<div class="dtpicker-year" ng-if="activeCalendar.selectYear">\t\t\t\t\t\t<select ng-change="onYearChange(activeCalendar)" ng-model="activeCalendar.year">\t\t\t\t\t\t\t<option ng-repeat="year in years">{{ year }}</option>\t\t\t\t\t\t</select>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t\t<div class="dtpicker-pager dtpicker-pager-right">\t\t\t\t\t<div \t\t\t\t\t\tng-hide="hideArrow"\t\t\t\t\t\tng-if="activeCalendar.showArrow"\t\t\t\t\t\tng-click="changeLeft(1)"\t\t\t\t\t\tclass="dtpicker-next-month">\t\t\t\t\t\t<i class="icon-arrow-datepicker-right"></i>\t\t\t\t\t</div>\t\t\t\t\t<div ng-if="activeCalendar.showExtraArrow"  ng-hide="hideArrow" ng-click="changeLeftInterim(1,\'y\')" class="dtpicker-next-year"><i class="icon-arrow-double-datepicker-right"></i></div>\t\t\t\t</div>\t\t\t</div>\t\t\t<div ng-if="activeCalendar.viewDayOfWeek" class="dtpicker-dayname clearfix">\t\t\t\t<div ng-repeat="dayname in dayNames track by $index" class="dayname-list">{{dayname | date:"EEE" | limitTo: 1}}</div>\t\t\t</div>\t\t</div>\t\t<table class="dtpicker-body">\t\t\t<tr class="dtpicker-row" ng-repeat="str in skeletonLeft">\t\t\t\t<td  \t\t\t\t\tng-class="\t\t\t\t\t{\'out-day\': day.out, \t\t\t\t\t\'select-day\': day.selectRange, \t\t\t\t\t\'today\': day.today, \t\t\t\t\t\'select-today\':  day.selectToday, \t\t\t\t\t\'range-day\': day.selectRange, \t\t\t\t\t\'change-date\': dirtyDate, \t\t\t\t\t\'first-select-day\': (day.firstSelectDay), \t\t\t\t\t\'last-select-day\': (day.lastSelectDay), \t\t\t\t\t\'disabled-day\': (day.disabled), \t\t\t\t\t\'marker-day\': (day.markerDay), \t\t\t\t\t\'marker-column\': (day.markerColumn), \t\t\t\t\t\'marker-row\': (day.markerRow)}" \t\t\t\t\tng-click="clickDate(day)"\t\t\t\t\tclass="calendar-day {{day.markerColumn}} {{day.markerRow}}"\t\t\t\t\tng-repeat="day in str track by $index">\t\t\t\t\t<div ng-if="activeCalendar.unitTitle.type === \'date\'">\t\t\t\t\t\t<span>\t\t\t\t\t\t\t{{day.currentDateStart | date:activeCalendar.unitTitle.title}} <em class="inline" ng-if="activeCalendar.unitTitleRange">- {{day.currentDateOver | date:activeCalendar.unitTitle.title}}</em>\t\t\t\t\t\t</span>\t\t\t\t\t</div>\t\t\t\t\t<div ng-if="activeCalendar.unitTitle.type === \'index\'">\t\t\t\t\t\t<span>\t\t\t\t\t\t\t<span>{{activeCalendar.unitTitle.Ltitle}}</span>\t\t\t\t\t\t\t<span>{{day.index + 1}}</span>\t\t\t\t\t\t\t<span>{{activeCalendar.unitTitle.Rtitle}}</span>\t\t\t\t\t\t</span>\t\t\t\t\t</div>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t</div>\t<div ng-if="!activeCalendar.oneCanvasCalendar" class="calendar-canva">\t\t<div class="dtpicker-head">\t\t\t<div class="dtpicker-title">\t\t\t\t<div class="dtpicker-pager dtpicker-pager-left">\t\t\t\t\t<div ng-if="activeCalendar.showExtraArrow"  ng-hide="hideArrow" ng-click="changeRightInterim(-1,\'y\')" class="dtpicker-prev-year"><i class="icon-arrow-double-datepicker-left"></i></div>\t\t\t\t\t<div \t\t\t\t\t\tng-hide="hideArrow"\t\t\t\t\t\tng-if="activeCalendar.showArrow"\t\t\t\t\t\tng-click="changeRight(-1)"\t\t\t\t\t\tclass="dtpicker-prev-month">\t\t\t\t\t\t\t<i class="icon-arrow-datepicker-left"></i>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t\t<div class="dtpicker-month">\t\t\t\t\t<span>{{viewDateRightStart | date:activeCalendar.calendarUnitTitle}}</span> \t\t\t\t\t<span ng-if="activeCalendar.calendarUnitTitleRange"> &mdash; {{viewDateRightEnd | date:activeCalendar.calendarUnitTitle}}</span>\t\t\t\t</div>\t\t\t\t<div class="dtpicker-pager dtpicker-pager-right">\t\t\t\t\t<div ng-if="activeCalendar.showArrow" ng-click="changeRight(1)" class="dtpicker-next-month"><i class="icon-arrow-datepicker-right"></i></div>\t\t\t\t\t<div ng-if="activeCalendar.showExtraArrow"  ng-click="changeRightInterim(1,\'y\')" class="dtpicker-next-year"><i class="icon-arrow-double-datepicker-right"></i></div>\t\t\t\t</div>\t\t\t</div>\t\t\t<div ng-if="activeCalendar.viewDayOfWeek" class="dtpicker-dayname clearfix">\t\t\t\t<div ng-repeat="dayname in dayNames track by $index" class="dayname-list">{{dayname | date:"EEE" | limitTo: 1}}</div>\t\t\t</div>\t\t</div>\t\t<table class="dtpicker-body">\t\t\t<tr class="dtpicker-row" ng-repeat="str in skeletonRight">\t\t\t\t<td  \t\t\t\tng-class="\t\t\t\t{\'out-day\': day.out, \t\t\t\t\'select-day\': day.selectRange, \t\t\t\t\'today\': day.today, \t\t\t\t\'select-today\':  day.selectToday, \t\t\t\t\'range-day\': day.selectRange, \t\t\t\t\'change-date\': dirtyDate, \t\t\t\t\'first-select-day\': (day.firstSelectDay), \t\t\t\t\'last-select-day\': (day.lastSelectDay), \t\t\t\t\'disabled-day\': (day.disabled), \t\t\t\t\'marker-day\': (day.markerDay), \t\t\t\t\'marker-column\': (day.markerColumn), \t\t\t\t\'marker-row\': (day.markerRow)}" \t\t\t\tng-click="clickDate(day)"\t\t\t\tclass="calendar-day {{day.markerColumn}} {{day.markerRow}}"\t\t\t\tng-repeat="day in str track by $index">\t\t\t\t\t<div ng-if="activeCalendar.unitTitle.type === \'date\'">\t\t\t\t\t\t<span>\t\t\t\t\t\t\t{{day.currentDateStart | date:activeCalendar.unitTitle.title}} <em class="inline" ng-if="activeCalendar.unitTitleRange">- {{day.currentDateOver | date:activeCalendar.unitTitle.title}}</em>\t\t\t\t\t\t</span>\t\t\t\t\t</div>\t\t\t\t\t<div ng-if="activeCalendar.unitTitle.type === \'index\'">\t\t\t\t\t\t<span>\t\t\t\t\t\t\t<span>{{activeCalendar.unitTitle.Ltitle}}</span>\t\t\t\t\t\t\t<span>{{day.index + 1}}</span>\t\t\t\t\t\t\t<span>{{activeCalendar.unitTitle.Rtitle}}</span>\t\t\t\t\t\t</span>\t\t\t\t\t</div>\t\t\t\t</td>\t\t\t</tr>\t\t</table>\t</div>\t<div ng-if="options.mainOptions.showPanelCustomButton && (activeCalendar.customButtonSelect.length || activeCalendar.customButtonCallback.length)" class="calendar-canva additional-canva">\t\t<div class="dtpicker-head">\t\t\t<div class="dtpicker-title">\t\t\t\t<div class="dtpicker-month">{{options.mainOptions.customPanel.title}}</div>\t\t\t</div>\t\t\t<div class="dtpicker-dayname clearfix">\t\t\t\t<div class="dtpicker-daterange">{{fromDate | date:options.mainOptions.customPanel.dateFormat}} - {{toDate | date:options.mainOptions.customPanel.dateFormat}}</div>\t\t\t</div>\t\t</div>\t\t<div class="dtpicker-body">\t\t\t<div class="dtpicker-buttons clearfix">\t\t\t\t<button ng-repeat="customButton in activeCalendar.customButtonSelect" class="btn btn-small btn-uppercased custom-select" ng-click="customSelectButton(customButton.diff())">{{ customButton.buttonName || customButton.butttonName }}</button>\t\t\t\t<button ng-repeat="customButton in activeCalendar.customButtonCallback" class="btn btn-small btn-uppercased custom-select" ng-click="customButtonClick(customButton.callback)">{{customButton.buttonName}}</button>\t\t\t</div>\t\t</div>\t</div></div>';e.put("template/datepicker/datepicker-inline.html",'<div class="tp-datepicker extended custom inline">'+t+"</div>"),e.put("template/datepicker/datepicker-custom.html",'<div class="tp-datepicker extended custom">\t<div ng-click="showCalendar()" class="dtpicker-input">\t\t<div ng-transclude></div>\t</div>\t<div ng-show="openCalendar" class="calendar" ng-animate="\'animate\'" ng-animate-children  animate="animate" ng-class="{\'tabs-on\': options.mainOptions.showPanelTab, \'hidden-on-load\': !contentLoaded, \'hidden-on-position-updated\': !positionUpdated}">\t\t<div class="dtpicker-tabs" ng-if="options.mainOptions.showPanelTab">\t\t\t<div ng-click="clickTab($index)" ng-class="{active: activeTab === $index}" ng-repeat="optionItem in options.calendarOptions" ng-if="options.mainOptions.showPanelTab" class="dtpicker-tab">\t\t\t\t{{optionItem.calendarCaption || optionItem.calendarTitle}}\t\t\t</div>\t\t</div>   <div ng-class="{\'datepicker-body\': true, \'initial-empty\': initialEmpty}" ng-if="openCalendar || !initialEmpty">'+t+'   </div>\t\t<div ng-show="options.mainOptions.time.enabled" id="dtpicker-time" class="dtpicker-time">\t\t\t<tp-time options="options.mainOptions.time" hours="hours" minutes="minutes"></tp-time>\t\t</div>\t\t<div ng-show="!options.mainOptions.hideApplySelect" ng-click="applySelect($event)" class="dtpicker-submit">\t\t\t<div ng-if="options.mainOptions.applyButton.enable">{{options.mainOptions.applyButton.title}}</div>\t\t\t<div ng-if="options.mainOptions.closeButton.enable" class="dtpicker-cancel">{{options.mainOptions.closeButton.title}}</div>\t\t</div>\t</div></div>')}function tpTime(){return{scope:{hours:"=?",minutes:"=?",options:"=?"},controller:"tpTimeController",restrict:"AE",replace:!0,template:'<div id="time-wrapper" class="time-wrapper" ng-show="options.enabled"><div class="time-inputs-wrapper"><input type="text" ng-model="viewHours" id="hours" maxlength="2" ng-blur="onBlurHours($event)" ng-keydown="onKeyDownHours($event)" ng-keyup="onKeyUpHours($event)" /><input type="text" ng-model="viewMinutes" id="minutes" maxlength="2" ng-blur="onBlurMinutes($event)" ng-keydown="onKeyDownMinutes($event)" ng-keyup="onKeyUpMinutes($event)" /></div><div ng-show="options.timeFormat12hours" class="meridian-select-wrapper"><select ng-model="meridiem" ng-change="updateTime()" ng-options="key for (key, value) in meridiems" class="light"></select></div><div ng-show="options.showTimezone" class="timezone-wrapper">GMT {{timezone}}</div></div>'}}function tpTimeController(e){var t,n,r;if(e.options=angular.extend({enabled:!0,timeFormat12hours:!0,minutesStep:15,showTimezone:!0},e.options),e.options.enabled){var o,i=new Date;e.meridiems={AM:1,PM:2};var a,c,s=46,u=8,l=9,d=37,p=38,f=39,m=40,h=16,g=48,v=57,y=_.isUndefined(e.hours)?i.getHours():e.hours,C=_.isUndefined(e.minutes)?i.getMinutes():e.minutes,E=e.options.timeFormat12hours?12:24,S=60,T=e.options.minutesStep,w=!1;e.$on("time-updated",function(e,t){y=t.hours,C=t.minutes,b()}),b(),e.onKeyDownHours=function(t){R(t),_.isNaN(e.viewHours)||""===e.viewHours||(a=e.viewHours);switch(t.keyCode){case p:$();break;case m:I()}},e.onKeyUpHours=function(t){D(t),function(t){var n=N(e.viewHours,a),r=t.which||t.keyCode;e.options.timeFormat12hours&&0===n&&(e.viewHours=E);O("hours",n)&&(e.viewHours=A(n));(n>E||M(a,r))&&(e.viewHours="");n===E&&(e.viewHours=function(t){return t!==E||e.options.timeFormat12hours?t:A(0)}(E))}(t),L(),x(t)},e.onKeyDownMinutes=function(t){R(t),_.isNaN(e.viewMinutes)||""===e.viewMinutes||(c=e.viewMinutes);switch(t.keyCode){case p:n=N(e.viewMinutes,c),(n+=T||1)>S-1?($(),e.viewMinutes=A(n-S)):e.viewMinutes=A(n);break;case m:!function(){var t=N(e.viewMinutes,c);(t-=T||1)<0?(I(),e.viewMinutes=A(t+S)):e.viewMinutes=A(t)}()}var n},e.onKeyUpMinutes=function(t){D(t),function(t){var n=_.parseInt(e.viewMinutes,10),r=t.which||t.keyCode;O("minutes",n)&&(e.viewMinutes=A(n));(n>S||M(c,r))&&(e.viewMinutes="")}(t),L(),x(t)},e.onBlurHours=function(){var t=parseInt(e.viewHours,10),n=e.options.timeFormat12hours?12:23;!_.isNaN(e.viewHours)&&t>n&&(P(n),e.hours=n)},e.onBlurMinutes=function(){var t=parseInt(e.viewMinutes,10);!_.isNaN(e.viewHours)&&t>59&&(e.viewMinutes=A(59),e.minutes=59)},e.updateTime=L,e.timezone=(t=i.getTimezoneOffset(),n=Math.abs(t),r=Math.floor(n/S),(t<0?"+":"-")+r)}function b(){P(y),e.viewMinutes=A(C),e.hours=_.parseInt(y,10),e.minutes=_.parseInt(C,10)}function P(t){if(e.options.timeFormat12hours){var n=angular.copy(function(t){var n=t,r=e.meridiems.AM;t>12&&(n=t-12);t>=12&&(r=e.meridiems.PM);0===t&&(n=12);return[n,r]}(t));e.viewHours=A(n[0]),e.meridiem=n[1]}else e.viewHours=A(t)}function A(e){return 1===e.toString().length?"0"+e:e}function $(){o=N(e.viewHours,a),e.options.timeFormat12hours?(o===E-1&&(e.meridiem=k()),o>=E&&(o=0)):o===E-1&&(o=-1),e.viewHours=A(o+1)}function I(){o=N(e.viewHours,a),e.options.timeFormat12hours?(o===E&&(e.meridiem=k()),o<=1&&(o=E+1)):o<=0&&(o=E),e.viewHours=A(o-1)}function k(){return e.meridiem===e.meridiems.AM?e.meridiems.PM:e.meridiems.AM}function N(e,t){var n=_.parseInt(e,10);return(_.isNaN(n)||""===n)&&(n=_.parseInt(t,10)),n}function x(e){switch(e.which||e.keyCode){case d:case f:e.preventDefault(),e.stopPropagation()}}function D(e){(e.which||e.keyCode)===h&&(w=!1)}function M(e,t){return e<10&&(t===u||t===s)}function O(t,n){return"hours"===t?1===n.toString().length&&(e.options.timeFormat12hours?n>1:n>2||0===n):1===n.toString().length&&n>5}function R(e){var t=e.which||e.keyCode;(t<g&&t!=l&&t!=u&&t!=d&&t!=f&&t!=s||t>v||w&&t!=d&&w&&t!=f)&&e.preventDefault(),t===h&&(w=!0)}function L(){var t=N(e.viewHours,a),n=N(e.viewMinutes,c);e.hours=function(t){var n=t;(e.meridiem===e.meridiems.AM&&t>12||e.meridiem===e.meridiems.AM&&12===t)&&(n=t-12);e.meridiem===e.meridiems.PM&&t<12&&(n=t+12);return n}(t),e.minutes=n}}function tpTimepicker(e,t,n,r){return{scope:{time:"=?",options:"=?"},link:function(o,i,a){function c(){o.$apply(function(){o.closeWidget()})}function s(e){switch(e.keyCode){case 27:o.$apply(function(){o.closeWidget()})}}o.texts={title:r.trc("publisher.dashboard","Set time"),apply:r.trc("publisher.dashboard","Apply"),cancel:r.trc("publisher.dashboard","Cancel")},o.model={openWidget:!1},o.model.openWidget=!1,"undefined"!=typeof moment?o.model.time=moment(o.time).zone(0):o.model.time=o.model.time.utc().valueOf(),o.tpTimeValues={hours:o.model.time.hour(),minutes:o.model.time.minutes()},o.$broadcast("time-updated",o.tpTimeValues),o.showWidget=function(){o.model.openWidget=!o.model.openWidget,o.model.openWidget&&(n(function(){var n=i.find(".tp-timepicker-wrapper"),r=i.find(".tp-timepicker");r.offset().left+r.innerWidth()/2<n.innerWidth()/2?n.offset({left:20}):r.offset().left+n.innerWidth()/2+r.innerWidth()/2>e.innerWidth?n.offset({left:e.innerWidth-n.innerWidth()-20}):n.offset({left:r.offset().left+r.innerWidth()/2-n.innerWidth()/2}),t.bind("click",c),t.bind("keyup",s)},10),o.$broadcast("time-updated",o.tpTimeValues))},o.closeWidget=function(){o.model.openWidget=!1,t.unbind("click",c),t.unbind("keyup",s)},o.setNewTime=function(){o.model.time.hour(o.tpTimeValues.hours),o.model.time.minutes(o.tpTimeValues.minutes),o.time=o.model.time.utc().valueOf(),o.closeWidget(),o.$broadcast("time-updated",o.tpTimeValues)},i.find(".tp-timepicker-wrapper").click(function(e){e.stopPropagation()})},controller:["$scope",function(e){e.tpTimeOptions={showTimezone:!1}}],restrict:"AE",template:'<div class="tp-timepicker">   <div class="tp-timepicker-handler" ng-click="showWidget()">      {{model.time | tpDateMoment:"hh:mm A":0}}   </div>   <div ng-hide="!model.openWidget" class="tp-timepicker-wrapper">       <div class="tp-timepicker-header">{{texts.title}}</div>       <div class="tp-timepicker-body"><tp-time hours="tpTimeValues.hours" minutes="tpTimeValues.minutes" options="tpTimeOptions"></tp-time></div>       <div class="tp-timepicker-footer"><div class="tp-timepicker-footer-btn tp-timepicker-btn-cancel" ng-click="closeWidget()">{{texts.cancel}}</div><div class="tp-timepicker-footer-btn tp-timepicker-btn-apply" ng-click="setNewTime()">{{texts.apply}}</div></div>   </div></div>'}}tpDatepicker.$inject=["$document","$window","$timeout","$q"],tpTemplates.$inject=["$templateCache"],function(e,t){"use strict";var n="yyyy-MM-dd";function r(e){return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate())}t.module("ngInputDate",["ng"]).factory("inputDate",function(){return{ExtractDate:r}}).directive("input",["dateFilter","$timeout",function(e,t){return{restrict:"EA",require:"?ngModel",link:function(t,r,o,i){if(void 0!==o.type&&"date"===o.type&&i){var a=void 0!==o.time&&void 0!==o.timeFormat?o.timeFormat:o.dateFormat||n;i.$formatters.unshift(function(t){return e(t,a)}),i.$parsers.unshift(function(e){return function(e,t){if(void 0===e||""===e)return null;var r,o,i;if(t===n){var a=e.split("-");if(3!==a.length)return null;r=parseInt(a[0],10),o=parseInt(a[1],10),i=parseInt(a[2],10)}else if("function"==typeof moment){var c=moment(e,t.toUpperCase());r=c.year(),o=c.month()+1,i=c.date()}return o&&r&&i?new Date(r,o-1,i):null}(e,a)})}}}}])}(window,angular),function(e){"use strict";e.module("datetime",[]),e.module("datetime").constant("datetimePlaceholder",{year:"(year)",yearShort:"(year)",month:"(month)",date:"(date)",day:"(day)",hour:"(hour)",hour12:"(hour12)",minute:"(minute)",second:"(second)",millisecond:"(millisecond)",ampm:"(AM/PM)",week:"(week)"});var t={exports:{}};!function(e){void 0!==t&&(t.exports=e);var n="listeners",r={on:function(e,t){return a(this,e).push(t),this},once:function(e,t){var n=this;return r.originalListener=t,a(n,e).push(r),n;function r(){i.call(n,e,r),t.apply(this,arguments)}},off:i,emit:function(e,t){var n=this,r=a(n,e,!0);if(!r)return!1;var o=arguments.length;if(1===o)r.forEach(function(e){e.call(n)});else if(2===o)r.forEach(function(e){e.call(n,t)});else{var i=Array.prototype.slice.call(arguments,1);r.forEach(function(e){e.apply(n,i)})}return!!r.length}};function o(e){for(var t in r)e[t]=r[t];return e}function i(e,t){var r,o=this;if(arguments.length){if(t){if(r=a(o,e,!0)){if(!(r=r.filter(function(e){return e!==t&&e.originalListener!==t})).length)return i.call(o,e);o[n][e]=r}}else if((r=o[n])&&(delete r[e],!Object.keys(r).length))return i.call(o)}else delete o[n];return o}function a(e,t,r){if(!r||e[n]){var o=e[n]||(e[n]={});return o[t]||(o[t]=[])}}o(e.prototype),e.mixin=o}(function e(){if(!(this instanceof e))return new e});var n=t.exports,r=function(e,t,n){var r;if((e=""+e).length>n)e=e.substr(e.length-n);else if(e.length<t)for(r=e.length;r<t;r++)e="0"+e;return e},o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},a=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},c=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t};function s(e,t,n){for(var r=0,o=e.toUpperCase(),i=n.toUpperCase();o[t+r]&&o[t+r]==i[r];)r++;return e.substr(t,r)}function u(e,t,n){var o=function(e,t,n){var o,i,a,c;if("static"==t.type)return e.startsWith(t.value,n)?{viewValue:t.value}:{err:2,code:"TEXT_MISMATCH",message:"Pattern value mismatch"};if("number"==t.type)return null==(a=function(e,t){var n=(e=e.substring(t)).match(/^\d+/);return n&&n[0]}(e,n))?{err:1,code:"NUMBER_MISMATCH",message:"Invalid number",viewValue:""}:a.length<t.minLength?{err:1,code:"NUMBER_TOOSHORT",message:"The length of number is too short",value:+a,viewValue:a,properValue:r(+a,t.minLength,t.maxLength)}:(a.length>t.maxLength&&(a=a.substr(0,t.maxLength)),+a<t.min?{err:1,code:"NUMBER_TOOSMALL",message:"The number is too small",value:+a,viewValue:a,properValue:r(t.min,t.minLength,t.maxLength)}:a.length>t.minLength&&"0"==a[0]?{err:1,code:"LEADING_ZERO",message:"The number has too many leading zero",value:+a,viewValue:a,properValue:r(+a,t.minLength,t.maxLength)}:+a>t.max?{err:1,code:"NUMBER_TOOLARGE",message:"The number is too large",value:+a,viewValue:a,properValue:r(t.max,t.minLength,t.maxLength)}:{value:+a,viewValue:a});if("select"==t.type){for(i="",c=0;c<t.select.length;c++)(o=s(e,n,t.select[c]))&&o.length>i.length&&(a=c,i=o);return i?i!=t.select[a]?{err:1,code:"SELECT_INCOMPLETE",message:"Incomplete select",value:a+1,viewValue:i,selected:t.select[a]}:{value:a+1,viewValue:i}:{err:1,code:"SELECT_MISMATCH",message:"Invalid select",viewValue:""}}throw"Unknown token type: "+t.type}(e,t,n);return o.err&&"static"!=t.type&&e.startsWith(t.placeholder,n)&&(1<o.err||o.viewValue.length<=t.placeholder.length)?{empty:!0,viewValue:t.placeholder}:o}function l(e,t){var n,r,o=0,i=[],a=e,c=Array.isArray(a),s=0;for(a=c?a:a[Symbol.iterator]();;){if(c){if(s>=a.length)break;n=a[s++]}else{if((s=a.next()).done)break;n=s.value}if((r=u(t,n.token,o)).node=n,r.pos=o,r.token=n.token,2<=r.err)throw r.text=t,r;o+=r.viewValue.length,i.push(r)}var l=i[i.length-1];if(l.pos+l.viewValue.length<t.length)throw{code:"TEXT_TOOLONG",message:"Text is too long",text:t};return i}function d(e,t){if("static"==t.type)return{viewValue:t.value};var n=t.extract(e);if("number"==t.type)return{value:n,viewValue:r(n,t.minLength,t.maxLength)};if("select"==t.type)return{value:n,viewValue:t.select[n-1]};throw"Unknown type to format: "+t.type}function p(e,t,n){var r,o,i=[],a=t,c=Array.isArray(a),s=0;for(a=c?a:a[Symbol.iterator]();;){if(c){if(s>=a.length)break;o=a[s++]}else{if((s=a.next()).done)break;o=s.value}r=d(e,o.token),"static"!=o.token.type&&o.empty&&!n&&(r.value=null,r.viewValue=o.token.placeholder),i.push(r)}return i}var f=function(){function e(t,n){i(this,e),this.parser=t,this.token=n,this.value=null,this.viewValue=n.value,this.offset=0,this.next=null,this.prev=null,this.nextEdit=null,this.prevEdit=null,this.empty=!0}return e.prototype.unset=function(){"static"==this.token.type||this.parser.noEmpty||(this.empty=!0,this.parser.setValue(this.parser.value,!1))},e.prototype.parse=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=u(e,this.token,t);if(n.err)throw n.node=this,n.token=this.token,n;if(this.parser.noEmpty&&n.empty)throw{code:"NOT_INIT_FORBIDDEN",message:"Empty node is forbidden",node:this};if(n.empty)this.unset();else{this.empty=!1;var r=h(this.parser.copyValue(this.parser.value),this.token,n.value,this.parser);this.parser.setValue(r,!1)}},e.prototype.add=function(e){var t,n,r,o=this.parser.copyValue(this.parser.value);this.empty=!1,o=m(o,this.token,e,this.parser),t=this.token.extract(o),"number"==this.token.type?(n=this.token.min,r=this.token.max):"select"==this.token.type&&(n=1,r=this.token.select.length),t<n&&(o=h(o,this.token,n,this.parser)),r<t&&(o=h(o,this.token,r,this.parser)),this.parser.setValue(o,!1)},e}();function m(e,t,n,r){return"object"==(void 0===e?"undefined":o(e))?(t.add(e,n,r),e):t.add(e,n,r)}function h(e,t,n,r){return"object"==(void 0===e?"undefined":o(e))?(t.restore(e,n,r),e):t.restore(e,n,r)}function g(e){return e}var v=function(e){function t(){i(this,t);var n=c(this,e.call(this));return n._constructor.apply(n,arguments),n.initialize(),n}return a(t,e),t.prototype._constructor=function(e){var t=e.tokens,n=e.noEmpty,r=void 0!==n&&n,o=e.value,i=e.text,a=e.copyValue,c=void 0===a?g:a;if(!t||!t.length)throw new Error("option.tokens is required");this.tokens=t,this.nodes=function(e,t){var n,r,o,i=[],a=t,c=Array.isArray(a),s=0;for(a=c?a:a[Symbol.iterator]();;){if(c){if(s>=a.length)break;n=a[s++]}else{if((s=a.next()).done)break;n=s.value}i.push(new f(e,n))}for(r=0;r<i.length;r++)i[r].next=i[r+1]||null,i[r].prev=i[r-1]||null;for(o=null,r=0;r<i.length;r++)i[r].prevEdit=o,"static"!=i[r].token.type&&(o=i[r]);for(o=null,r=i.length-1;0<=r;r--)i[r].nextEdit=o,"static"!=i[r].token.type&&(o=i[r]);return i}(this,t),this.nameMap=function(e){var t=new Map,n=e,r=Array.isArray(n),o=0;for(n=r?n:n[Symbol.iterator]();;){var i;if(r){if(o>=n.length)break;i=n[o++]}else{if((o=n.next()).done)break;i=o.value}var a=i,c=t.get(a.token.name);c||(c=[],t.set(a.token.name,c)),c.push(a)}return t}(this.nodes),this.value=o,this.text=i,this.noEmpty=r,this.copyValue=c,this.err=!1},t.prototype.initialize=function(){this.setValue(this.value)},t.prototype.parse=function(e){if(!e)throw{code:"EMPTY",message:"The input is empty",oldText:this.text};var t,n;t=l(this.nodes,e);var r,o=[];for(r=this.err?l(this.nodes,this.text):this.nodes,n=0;n<t.length;n++)t[n].empty||t[n].viewValue==r[n].viewValue||(t[n].token=this.nodes[n].token,o.push(t[n]));var i=t.filter(function(e){return e.empty}),a=t.filter(function(e){return e.err});for(n=0;n<t.length;n++)this.nodes[n].value=t[n].value,this.nodes[n].viewValue=t[n].viewValue,this.nodes[n].offset=t[n].pos,this.nodes[n].empty=t[n].empty;if(a.length)throw this.err=!0,a[0];this.err=!1,o.sort(function(e,t){return t.empty?-1:e.empty?1:(t.token.prior||0)-(e.token.prior||0)});var c,s=this.copyValue(this.value),u=o,d=Array.isArray(u),f=0;for(u=d?u:u[Symbol.iterator]();;){if(d){if(f>=u.length)break;c=u[f++]}else{if((f=u.next()).done)break;c=f.value}s=h(s,c.token,c.value,this)}var m=p(s,t).map(function(e){return e.viewValue}).join("");if(e!=m)throw this.err=!0,{code:"INCONSISTENT_INPUT",message:"Successfully parsed but the output text doesn't match the input",text:e,oldText:this.text,properText:m};if(this.text=e,this.value=s,this.emit("change",this.value),i.length)throw{code:"NOT_INIT",message:"Some nodes are empty",text:e,node:i[0]};return this},t.prototype.setValue=function(e){var t,n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],r=p(e,this.nodes,n),o=0,i="";for(t=0;t<r.length;t++)this.nodes[t].value=r[t].value,this.nodes[t].viewValue=r[t].viewValue,this.nodes[t].offset=o,this.nodes[t].empty=!n&&this.nodes[t].empty,o+=this.nodes[t].viewValue.length,i+=this.nodes[t].viewValue;return this.value=e,this.text=i,this.emit("change",this.value),this},t.prototype.isEmpty=function(e){var t,n;if(e)try{t=l(this.nodes,e)}catch(e){return!1}else t=this.nodes;for(n=0;n<t.length;n++)if("static"!=this.nodes[n].token.type&&!t[n].empty)return!1;return!0},t.prototype.isInit=function(){var e,t=this.nodes,n=Array.isArray(t),r=0;for(t=n?t:t[Symbol.iterator]();;){if(n){if(r>=t.length)break;e=t[r++]}else{if((r=t.next()).done)break;e=r.value}if("static"!=e.token.type&&e.empty)return!1}return!0},t.prototype.unset=function(){var e,t=this.nodes,n=Array.isArray(t),r=0;for(t=n?t:t[Symbol.iterator]();;){if(n){if(r>=t.length)break;e=t[r++]}else{if((r=t.next()).done)break;e=r.value}e.empty=!0}return this.setValue(this.value,!1),this},t.prototype.getText=function(){return this.text},t.prototype.getValue=function(){return this.value},t.prototype.getNodes=function(e){return e?this.nameMap.get(e):this.nodes},t}(n);function y(e,t){if(t.length){var n=C(t,e).map(function(e){return e.node}),r=n[0],o=n[1];return r==o?r:e-r.offset-r.viewValue.length<=o.offset-e?r:o}}function C(e,t){var n,r,o,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:t,a=e,c=Array.isArray(a),s=0;for(a=c?a:a[Symbol.iterator]();;){if(c){if(s>=a.length)break;n=a[s++]}else{if((s=a.next()).done)break;n=s.value}n.offset<=t&&(r={node:n,pos:t-n.offset}),n.offset+n.viewValue.length>=i&&!o&&(o={node:n,pos:i-n.offset})}if(!o){var u=e[e.length-1];o={node:u,pos:u.viewValue.length}}return r||(r={node:e[0],pos:0}),r.pos>r.node.viewValue.length&&(r.pos=r.node.viewValue.length),[r,o]}var E=function(){function e(t,n){i(this,e),this.el=t,this.nodes=n,this.range={node:y(0,this.nodes),start:0,end:"end"}}return e.prototype.selectNearestNode=function(){var e=this.el.getSelection();e&&this.select({node:y(e.start,this.nodes),start:0,end:"end"})},e.prototype.select=function(e){(e=Object.assign(this.range,e)).node&&this.el.setSelection(e.node.offset+e.start,e.node.offset+("end"==e.end?e.node.viewValue.length:e.end))},e.prototype.hasNext=function(){if(this.range.node)return this.range.node.nextEdit},e.prototype.hasPrev=function(){if(this.range.node)return this.range.node.prevEdit},e.prototype.selectNext=function(){var e=this.hasNext(),t={start:0,end:"end"};e&&(t.node=e),this.select(t)},e.prototype.selectPrev=function(){var e=this.hasPrev(),t={start:0,end:"end"};e&&(t.node=e),this.select(t)},e.prototype.get=function(){if(this.nodes.length){var e=this.el.getSelection();if(e){var t=C(this.nodes,e.start,e.end),n=t[0],r=t[1];n.node==r.node&&(this.range={node:n.node,start:n.pos,end:r.pos})}}},e.prototype.atNodeEnd=function(){if(this.range.node){this.get();var e=this.range.node.viewValue.length,t=this.range.node.token.maxLength,n="end"==this.range.start?e:this.range.start;return n==("end"==this.range.end?e:this.range.end)&&n==(null!=t?t:e)||!e}},e.prototype.atNodeStart=function(){if(this.range.node){this.get();var e=this.range.node.viewValue.length,t="end"==this.range.start?e:this.range.start;return t==("end"==this.range.end?e:this.range.end)&&0==t}},e}(),S=function(e){function t(){i(this,t);var n=c(this,e.call(this));return n._constructor.apply(n,arguments),n.initialize(),n}return a(t,e),t.prototype._constructor=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";this.el=e,this.tp=t,this.separators=n,this.sel=new E(e,t.getNodes().filter(function(e){return"static"!=e.token.type}))},t.prototype.initialize=function(){var e=this;this.el.on("mousedown",function(){e.mousedown=!0}),this.el.on("focus",function(){e.mousedown||setTimeout(function(){e.sel.select({start:0,end:"end"})})}),this.el.on("click",function(){e.mousedown=!1,e.sel.selectNearestNode()}),this.el.on("input",function(){e.digest(null,e.el.val())}),this.el.on("keydown",function(t){t.altKey||t.ctrlKey||(37==t.keyCode||9==t.keyCode&&t.shiftKey&&e.sel.hasPrev()?(t.preventDefault(),e.tryFixingError(),e.sel.selectPrev()):39==t.keyCode||9==t.keyCode&&!t.shiftKey&&e.sel.hasNext()?(t.preventDefault(),e.tryFixingError(),e.sel.selectNext()):38==t.keyCode?(t.preventDefault(),e.sel.selectNearestNode(),e.sel.range.node&&e.sel.range.node.add(1),e.val(e.tp.getText()),e.sel.select({start:0,end:"end"})):40==t.keyCode?(t.preventDefault(),e.sel.selectNearestNode(),e.sel.range.node&&e.sel.range.node.add(-1),e.val(e.tp.getText()),e.sel.select({start:0,end:"end"})):36==t.keyCode||35==t.keyCode?setTimeout(function(){return e.sel.selectNearestNode()}):46==t.keyCode?e.sel.atNodeEnd()&&(t.preventDefault(),e.tryFixingError(),e.sel.selectNext()):8==t.keyCode&&e.sel.atNodeStart()&&(t.preventDefault(),e.tryFixingError(),e.sel.selectPrev()))}),this.el.on("keypress",function(t){var n=null==t.charCode?t.keyCode:t.charCode,r=String.fromCharCode(n),o=e.separators,i=e.sel.range.node;if(i&&i.next&&"static"==i.next.token.type&&(o+=i.next.viewValue[0]),o.includes(r))return t.preventDefault(),e.tryFixingError(),void e.sel.selectNext();setTimeout(function(){e.sel.atNodeEnd()&&e.sel.range.node.viewValue&&(e.tryFixingError(),e.sel.selectNext())})}),this.el.on("blur",function(){setTimeout(function(){e.tryFixingError()})}),this.tp.on("change",function(){e.err||e.inDigest||(e.val(e.tp.getText()),e.sel.select())});var t=this.el.val();t?this.digest(null,t,!0):this.val(this.tp.getText())},t.prototype.errorViewLength=function(){return this.err&&null!=this.err.viewValue?this.err.viewValue.length:void 0},t.prototype.val=function(e){this.el.val()!=e&&this.el.val(e),this.err=null},t.prototype.tryFixingError=function(){this.err&&(this.err.properValue?this.digest(this.err.node,this.err.properValue,!0):this.err.node&&(this.err.node.unset(),this.digest(null,this.tp.getText())))},t.prototype.digest=function(e,t,n){var r,o=10;for(this.inDigest=!0;o--;){this.err=null;try{e?e.parse(t):this.tp.parse(t)}catch(o){if(this.emit("digest",o),this.sel.get(),"NOT_INIT"==o.code)break;if(this.err=o,!n&&("NUMBER_TOOSHORT"==o.code||"NUMBER_TOOSMALL"==o.code||"NUMBER_MISMATCH"==o.code||"SELECT_MISMATCH"==o.code||"LEADING_ZERO"==o.code))break;if("SELECT_INCOMPLETE"==o.code){e=o.node,t=o.selected,r={end:"end"};continue}null!=o.properValue?(e=o.node,t=o.properValue):null!=o.properText?(e=null,t=o.properText):("EMPTY"==o.code&&this.tp.unset(),o.node&&o.node.unset(),e=null,t=this.tp.getText(),r={start:0,end:"end"});continue}break}if(this.err||(this.val(this.tp.getText()),o<9&&this.sel.select(r)),this.inDigest=!1,o<0)throw new Error("InputMask.digest crashed! Infinite loop on "+t)},t}(n),T=v,_=S;function w(t,n){var o=t.DATETIME_FORMATS,a=/yyyy|yy|y|M{1,4}|dd?|EEEE?|HH?|hh?|mm?|ss?|([.,])sss|a|Z{1,2}|ww|w|'(([^']+|'')*)'/g,c={y:{minLength:1,maxLength:4,max:9999,min:0,name:"year",type:"number"},yy:{minLength:2,maxLength:2,name:"yearShort",type:"number"},yyyy:{minLength:4,maxLength:4,max:9999,min:0,name:"year",type:"number"},MMMM:{name:"month",type:"select",select:o.MONTH},MMM:{name:"month",type:"select",select:o.SHORTMONTH},MM:{minLength:2,maxLength:2,name:"month",type:"number"},M:{minLength:1,maxLength:2,name:"month",type:"number",min:1},dd:{minLength:2,maxLength:2,name:"date",type:"number"},d:{minLength:1,maxLength:2,name:"date",type:"number",min:1},EEEE:{name:"day",type:"select",select:S(o.DAY)},EEE:{name:"day",type:"select",select:S(o.SHORTDAY)},HH:{minLength:2,maxLength:2,name:"hour",type:"number"},H:{minLength:1,maxLength:2,name:"hour",type:"number"},hh:{minLength:2,maxLength:2,name:"hour12",type:"number"},h:{minLength:1,maxLength:2,name:"hour12",type:"number"},mm:{minLength:2,maxLength:2,name:"minute",type:"number"},m:{minLength:1,maxLength:2,name:"minute",type:"number"},ss:{minLength:2,maxLength:2,name:"second",type:"number"},s:{minLength:1,maxLength:2,name:"second",type:"number"},sss:{minLength:3,maxLength:3,name:"millisecond",type:"number"},a:{name:"ampm",type:"select",select:o.AMPMS},ww:{minLength:2,maxLength:2,max:53,name:"week",type:"number"},w:{minLength:1,maxLength:2,max:53,name:"week",type:"number"},Z:{name:"timezone",type:"static"},ZZ:{name:"timezone",type:"static",colon:!0},string:{name:"string",type:"static"}},s={year:{extract:function(e){var t=e.getFullYear()%1e4;return 0<=t?t:0},restore:function(e,t){return e.setFullYear(t)},add:function(e,t){return e.setFullYear(e.getFullYear()+t)},prior:7},yearShort:{extract:function(e){var t=e.getFullYear()%100;return 0<=t?t:t+100},restore:function(e,t){return e.setFullYear(t)},add:function(e,t){return e.setFullYear(e.getFullYear()+t)},prior:7},month:{extract:function(e){return e.getMonth()+1},restore:function(e,t){e.setMonth(t-1),e.getMonth()==t&&e.setDate(0)},add:function(e,t){t=e.getMonth()+t,e.setMonth(t),e.getMonth()==t+1&&e.setDate(0)},prior:5},date:{extract:function(e){return e.getDate()},restore:function(e,t,n){var r=e.getMonth();if(e.setDate(t),e.getMonth()!=r&&t<=31){var o=n.getNodes("month");o&&o.every(function(e){return e.empty})&&e.setDate(t)}},add:function(e,t,n){this.restore(e,e.getDate()+t,n)},prior:4},day:{extract:function(e){return e.getDay()||7},restore:function(e,t){var n=e.getMonth(),r=t-(e.getDay()||7);e.setDate(e.getDate()+r),e.getMonth()!=n&&(0<r?e.setDate(e.getDate()-7):e.setDate(e.getDate()+7))},add:function(e,t){return e.setDate(e.getDate()+t)},prior:4},hour:{extract:function(e){return e.getHours()},restore:function(e,t){return e.setHours(t)},add:function(e,t){return e.setHours(e.getHours()+t)},prior:2},hour12:{extract:function(e){return e.getHours()%12||12},restore:function(e,t){t%=12,12<=e.getHours()&&(t+=12),e.setHours(t)},add:function(e,t){return e.setHours(e.getHours()+t)},prior:2},ampm:{extract:function(e){return e.getHours()<12?1:2},restore:function(e,t){var n=e.getHours();n<12==1<t&&e.setHours((n+12)%24)},add:function(e,t){return e.setHours(e.getHours()+12*t)},prior:3},minute:{extract:function(e){return e.getMinutes()},restore:function(e,t){return e.setMinutes(t)},add:function(e,t){return e.setMinutes(e.getMinutes()+t)},prior:0},second:{extract:function(e){return e.getSeconds()},restore:function(e,t){return e.setSeconds(t)},add:function(e,t){return e.setSeconds(e.getSeconds()+t)},prior:1},millisecond:{extract:function(e){return e.getMilliseconds()},restore:function(e,t){return e.setMilliseconds(t)},add:function(e,t){return e.setMilliseconds(e.getMilliseconds()+t)},prior:1},week:{extract:w,restore:function(e,t){return e.setDate(e.getDate()+7*(t-w(e)))},add:function(e,t){return e.setDate(e.getDate()+7*t)},prior:6}};for(var u in s)s[u].placeholder=n[u];var l=Object.values(c),d=Array.isArray(l),p=0;for(l=d?l:l[Symbol.iterator]();;){var f;if(d){if(p>=l.length)break;f=l[p++]}else{if((p=l.next()).done)break;f=p.value}var m=f;s[m.name]&&e.extend(m,s[m.name])}var h,g,v,y,C,E=(g=0<=(h=-(new Date).getTimezoneOffset())?"+":"-",v=Math.abs(h),y=Math.floor(v/60),C=v%60,g+r(y,2,2)+r(C,2,2));function S(e){var t,n=[];for(t=1;t<e.length;t++)n.push(e[t]);return n.push(e[0]),n}function _(t){for(var n,r=[],o=0;n=a.exec(t);)if(n.index>o&&(r.push(e.extend({value:t.substring(o,n.index)},c.string)),o=n.index),n.index==o){if(n[1])r.push(e.extend({value:n[1]},c.string)),r.push(c.sss);else if(n[2])r.push(e.extend({value:n[2].replace("''","'")},c.string));else if("timezone"==c[n[0]].name){var i=E;c[n[0]].colon&&(i=b(i)),r.push(e.extend({value:i},c[n[0]]))}else r.push(c[n[0]]);o=a.lastIndex}return o<t.length&&r.push(e.extend({value:t.substring(o)},c.string)),r}function w(e){var t=new Date(e.getFullYear(),0,1),n=new Date(t.getTime());4<n.getDay()?n.setDate(n.getDate()+(1-n.getDay())+7):n.setDate(n.getDate()+(1-n.getDay()));var r=e.getTime()-n.getTime();return Math.floor(r/6048e5)}function b(e){return":"==e[3]?e:e.substr(0,3)+":"+e.substr(3,2)}function P(e){return":"!=e[3]?e:e.substr(0,3)+e.substr(4,2)}var A=function(){function e(t){i(this,e),this.tp=t,this.timezone=E,this.timezoneNodes=this.tp.nodes.filter(function(e){return"timezone"==e.token.name})}return e.prototype.parse=function(e){return this.tp.parse(e),this},e.prototype.getText=function(){return this.tp.getText()},e.prototype.setDate=function(e,t){return this.tp.setValue(function(e,t){var n=(60*+(t=P(t)).substr(1,2)+ +t.substr(3,2))*(t[0]+"1");return new Date(e.getTime()+60*(n- -e.getTimezoneOffset())*1e3)}(e,this.timezone),t),this},e.prototype.getDate=function(){return e=this.tp.getValue(),t=this.timezone,n=(60*+(t=P(t)).substr(1,2)+ +t.substr(3,2))*(t[0]+"1"),new Date(e.getTime()+60*(-e.getTimezoneOffset()-n)*1e3);var e,t,n},e.prototype.setTimezone=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:E;if(e!=this.timezone){var t=this.getDate();this.timezone=e;var n=this.timezoneNodes,r=Array.isArray(n),o=0;for(n=r?n:n[Symbol.iterator]();;){var i;if(r){if(o>=n.length)break;i=n[o++]}else{if((o=n.next()).done)break;i=o.value}var a=i;a.token.colon?a.token.value=b(e):a.token.value=P(e)}return this.setDate(t,!1)}},e.prototype.isEmpty=function(){return this.tp.isEmpty.apply(this.tp,arguments)},e.prototype.isInit=function(){return this.tp.isInit.apply(this.tp,arguments)},e.prototype.unset=function(){return this.tp.unset(),this},e}();return function(e){var t,n=_(o[e]||e);t=n.some(function(e){return"yearShort"==e.name})?function(e){return function(t){e.apply(this,arguments);var n=t.getFullYear();n<0&&t.setFullYear(n+100)}}:function(e){return function(t){e.apply(this,arguments);var n=t.getFullYear();n<0&&t.setFullYear(0),9999<n&&t.setFullYear(9999)}};var r=n,i=Array.isArray(r),a=0;for(r=i?r:r[Symbol.iterator]();;){var c;if(i){if(a>=r.length)break;c=r[a++]}else{if((a=r.next()).done)break;c=a.value}var s=c;s.add&&(s.add=t(s.add)),s.restore&&(s.restore=t(s.restore))}var u=new T({tokens:n,value:new Date,copyValue:function(e){return new Date(e.getTime())}});return new A(u)}}function b(t,n,r){var o=function(){function t(e,n){i(this,t),this.el=e,this.doc=n}return t.prototype.on=function(e,t){if("input"!=e)return this.el.on(e,t)},t.prototype.getSelection=function(){var t=this.el[0];if(this.doc.activeElement==t){var n=t.selectionStart,r=t.selectionEnd;return e.isDefined(n)&&e.isDefined(r)?{start:n,end:r}:this.getSelectionIE()}},t.prototype.getSelectionIE=function(){var e=this.el[0],t=this.doc.selection.createRange().getBookmark(),n=e.createTextRange(),r=n.duplicate();n.moveToBookmark(t),r.setEndPoint("EndToStart",n);var o=r.text.length;return{start:o,end:o+n.text.length}},t.prototype.setSelection=function(e,t){var n=this.el[0];this.doc.activeElement==n&&(n.setSelectionRange?n.setSelectionRange(e,t):this.setSelectionIE(e,t))},t.prototype.setSelectionIE=function(e,t){var n=this.el[0].createTextRange();n.moveStart("character",e),n.collapse(),n.moveEnd("character",t-e),n.select()},t.prototype.val=function(){var e;return(e=this.el).val.apply(e,arguments)},t}();return{restrict:"A",require:"?ngModel",link:function(n,i,a,c){if(!c)return!1;a.ngTrim="false";var s,u=t(a.datetime),l=a.datetimeModel&&t(a.datetimeModel),d=new o(i,r[0]),p=new _(d,u.tp,a.datetimeSeparator);function f(e){e&&!s?(s=!0,u.setTimezone("+0000"),l&&l.setTimezone("+0000")):!e&&s&&(s=!1,u.setTimezone(),l&&l.setTimezone())}function m(e){u.setTimezone(e),l&&l.setTimezone(e)}function h(t){return!(!c.$isEmpty(t)&&!c.$isEmpty(a.min))||(e.isDate(t)||(t=l.getDate()),t>=new Date(a.min))}function g(t){return!(!c.$isEmpty(t)&&!c.$isEmpty(a.max))||(e.isDate(t)||(t=l.getDate()),t<=new Date(a.max))}function v(e){return c.$validate?c.$validate():(c.$setValidity("min",h(e)),c.$setValidity("max",g(e))),!c.$error.min&&!c.$error.max}p.on("digest",function(e){"NOT_INIT"!=e.code&&c.$setValidity("datetime",!1)}),u.tp.on("change",function(){n.$evalAsync(function(){p.err?c.$setValidity("datetime",!1):(u.isInit()||u.isEmpty()?c.$setValidity("datetime",!0):c.$setValidity("datetime",!1),u.getText()!=c.$viewValue&&c.$setViewValue(u.getText()))})}),e.isDefined(a.datetimeUtc)&&(0<a.datetimeUtc.length?n.$watch(a.datetimeUtc,f):f(!0)),e.isDefined(a.datetimeTimezone)&&(/^[+-]\d{2}:?\d{2}$/.test(a.datetimeTimezone)?m(a.datetimeTimezone):n.$watch(a.datetimeTimezone,m)),c.$validators&&(c.$validators.min=h,c.$validators.max=g),a.$observe("min",function(){v(u.getDate())}),a.$observe("max",function(){v(u.getDate())}),c.$render=function(){},c.$isEmpty=function(e){return!e||"string"==typeof e&&u.isEmpty(e)},c.$parsers.unshift(function(t){if(e.isUndefined(t)&&(t=u.getText()),!e.isString(t))return t;if(p.digest(null,t),u.isInit()){var n=u.getDate();return c.$validate||v(n)?l?l.setDate(n).getText():new Date(n.getTime()):void 0}}),c.$formatters.push(function(t){return c.$setValidity("datetime",!0),t?function(t){return!(!e.isDate(t)||l)||!(!e.isString(t)||!l)}(t)?(l&&(t=l.parse(t).getDate()),c.$validate||v(t),u.setDate(t).getText()):t:(u.unset(),n.$evalAsync(function(){c.$setViewValue(u.getText())}),u.getText())})},priority:100}}e.module("datetime").factory("datetime",w),w.$inject=["$locale","datetimePlaceholder"],e.module("datetime").directive("datetime",b),b.$inject=["datetime","$log","$document"]}(angular),angular.module("tp.ui.timepicker",[]).directive("tpTime",tpTime).controller("tpTimeController",tpTimeController).directive("tpTimepicker",tpTimepicker),tpTimeController.$inject=["$scope"],tpTimepicker.$inject=["$window","$document","$timeout","lang"];var module=angular.module("authModule",["userServiceModule","condeProviderModule","pianoIdProviderModule","generalModule","containerServiceModule","tp.i18n"]);module.factory("auth",["$q","condeProvider","$rootScope","errorService","containerService","utilsService",function(e,t,n,r,o,i){var a={},c={},s={register:function(){throw new Exception("Should be implement")},login:function(){throw new Exception("Should be implement")},resetPassword:function(){throw new Exception("Should be implement")}};return a.input={},a.currentState={name:null},a.registerState=function(e){a.currentState.name||(a.currentState.name=e.name),e.currentState=a.currentState,e.input=a.input,c[e.name]=e,e.close=a.close;var t=i.map(c,function(e){var t,o=e.name,i={};return i["goto"+(t=e.name,t.charAt(0).toUpperCase()+t.slice(1))]=function(){var e;e=o,r(n).reset(),a.currentState.name=e},i});i.forEach(c,function(e){i.forEach(t,function(t){i.forEach(t,function(t,n){e[n]||(e[n]=t)})})})},a.close=function(){o.close({})},a.register=function(e){return r(n).reset(),a.getProvider().register(e)},a.login=function(e){return r(n).reset(),a.getProvider().login(e)},a.resetPassword=function(e){return r(n).reset(),a.getProvider().resetPassword(e)},a.getProvider=function(){return"conde"===(window.TPParam&&window.TPParam.config&&window.TPParam.config.app.userProvider)?t:s},a}]),module.directive("authComponent",function(){return{restrict:"A",templateUrl:"/widget/checkout/component/partials/auth-component.html",link:function(e,t){e.$watch(function(){return t.is(":visible")},function(t){e.isVisible=t})}}}),module.directive("authCustomLogin",function(){return{restrict:"E",replace:!0,transclude:!0,template:'<div>            <div ng-if="isCondeUserProvider() && !isUserValid()">              <div ng-transclude></div>            </div>            <piano-id ng-if="isPianoId || isPianoIdLite"></piano-id>             <div passwordless-login ng-if="isGigyaPasswordlessLogin()"></div>             <div ng-show="isAfterLogin()" class="auth-state-valid"></div>          </div>',controller:["$scope","auth","userService","viewService","checkout",function(e,t,n,r,o){e.isPasswordlessLogin=function(){return o.isPasswordlessCheckoutEnabled()&&!n.isUserValid()&&(n.isPianoIdUserProvider()&&!o.config.isExistPasswordlessUser||!n.isPianoIdUserProvider())},e.isGigyaPasswordlessLogin=function(){return e.isPasswordlessLogin()&&!e.isPianoId&&!e.isCondeUserProvider()},e.isPianoId=n.isPianoIdUserProvider(),e.isPianoIdLite=n.isPianoIdLiteUserProvider(),e.isCondeUserProvider=n.isCondeUserProvider,e.isUserValid=n.isUserValid,e.isAfterLogin=function(){return"auth"===r.getActiveState()&&n.isUserValid()}}]}}),module.directive("authState",function(){return{restrict:"E",require:"^authCustomLogin",transclude:!0,replace:!0,scope:{},template:'<div ng-class="isVisible()" class="auth-{{name}} auth-state auth-state-hidden"></div>',link:function(e,t,n,r,o){o(e,function(e,n){t.append(e)})},controller:["$scope","$attrs","auth","userService","errorService","$rootScope","lang","checkout",function(e,t,n,r,o,i,a,c){function s(e){var t=e.data.errors;o(i).reset(),o(i).global(t&&t[0]&&t[0].msg?t[0].msg:"Unknown error")}e.currentState=null,e.name=t.name,e.isVisible=function(){return{"auth-state-visible":e.currentState.name===e.name}},n.registerState(e),e.doLogin=function(e){n.login(n.input).then(function(e){return r.onExternalLogin({token_list:e.data.models.token_list,cookie_domain:e.data.models.cookie_domain,user_token:e.data.models.user_token,params:e.data.models.auth}).then(function(){c.reload()})}).catch(s)},e.doForgotPassword=function(){n.resetPassword(n.input).then(function(t){t.data.models.succeeded&&e.gotoForgotPasswordHasSent()},s)},e.doRegister=function(e){!e||n.input.password&&n.input.confirmPassword&&n.input.confirmPassword===n.input.password?n.register(n.input).then(function(e){return r.onExternalLogin({token_list:e.data.models.token_list,cookie_domain:e.data.models.cookie_domain,user_token:e.data.models.user_token,params:e.data.models.auth}).then(function(){c.reload()})}).catch(s):o(i).global(a.tr("Password and confirm password are not equal"))}}]}});var metricModule=angular.module("performanceMetricsModule",["generalModule"]);metricModule.factory("performanceMetricsService",["$window","stateService","integrationEventsService","eventLogger","eventService","ngEventService","appConfigService",function(e,t,n,r,o,i,a){var c={},s=!1,u=[],l=a.performanceMetrics().trackAid,d={loadtime:200,rendering:{total:200,scripting:200}},p="EVENT_TP_PERFORMANCE_DATA",f="EVENT_LOGGER_READY",m=[{resourceRegExp:new RegExp("/checkout/offer/show"),label:"showOffer"},{resourceRegExp:new RegExp("/api/tinypass.min.js$"),label:"tinypassMinJS"},{resourceRegExp:new RegExp("/xbuilder/experience/execute"),label:"experienceExecute"}],h={};function g(e){var t=function(e){if(v(e))return{loadtime:"resource"===e.entryType?e.responseEnd-e.startTime:e.duration,dnsLookup:e.domainLookupEnd-e.domainLookupStart,tcp:e.connectEnd-e.connectStart,ttfb:e.responseStart-e.startTime,fetchStart:e.fetchStart,initiatorType:e.initiatorType,resource:e.name,responseEnd:e.responseEnd}}(e),n=function(e){var t=e.name,n=m.find(function(e){return t.match(e.resourceRegExp)});return n&&n.label}(e);t.loadtime<d.loadtime||(y("fetchStart",t.fetchStart,e.initiatorType,n),y("load",t.loadtime,e.initiatorType,n))}function v(e){return"script"===e.initiatorType||"iframe"===e.initiatorType}function y(e,t,n,r){if(!0===l){var o={metricName:e,metricValue:t,metricType:n,metricLabel:r};s?(u.push(o),u.forEach(function(e){var t;t=e,ga("performanceTracker.send",{hitType:"timing",timingCategory:t.metricType,timingVar:t.metricName,timingValue:Math.round(t.metricValue),timingLabel:t.metricLabel})}),u=[]):u.push(o)}}return n.listenExternal("ga.performance.tracker.created",function(){s=!0,o.postMessage(f,{})}),i.subscribe(p,function(e,t){g(t.entry)}),window.performance&&"function"==typeof performance.getEntries&&performance.getEntries().forEach(function(e){!function(e){(function(e){return m.some(function(t){return e.name.match(t.resourceRegExp)})&&v(e)})(e)&&g(e)}(e)}),c.onViewRendered=function(e){var t,n;"offer"!==e||h.offer||(h[e]=Date.now(),t=h[e]-TPPerformance.documentParseStart,n=h[e]-TPPerformance.domContentLoaded,t>d.rendering.total&&y("rendering",t,"viewRendering","offerScreen:totalTime"),n>d.rendering.scripting&&y("rendering",n,"viewRendering","offerScreen:scripting"))},c}]);var module=angular.module("condeProviderModule",[]);module.factory("condeProvider",["tpHTTP",function(e){var t={},n=function(t,n){var r=n||{};return r.aid=window.TPParam.config.app.aid,r.url=window.TPParam.params.url,e({method:"post",url:t,data:r})};return t.register=function(e){return n(window.TPParam.CONDE_REGISTER,e)},t.login=function(e){return n(window.TPParam.CONDE_LOGIN,e)},t.resetPassword=function(e){return n(window.TPParam.CONDE_RESET_PASSWORD,e)},t}]),angular.module("pianoIdProviderModule",["generalModule"]).factory("pianoIdProvider",["$q","eventService","ngEventService","userService","containerService","checkout",function(e,t,n,r,o,i){var a=!1,c={register:function(){},login:function(){},resetPassword:function(){},onLoginSuccess:function(e){var t=e.user;t.firstName=t.given_name,t.lastName=t.family_name,t.valid=!0,t.confirmed=!(e.user&&e.user.email_confirmation_required),t.uid=t.sub,a=!!e.registration;var n=i.getAid(),c=o.getOriginUrl();r.checkUser({aid:n,url:c,userToken:e.token,fromUserIdentity:!0}).then(function(e){return e.models.token_list}).catch(function(){return null}).then(function(n){r.onExternalLogin({token_list:n,cookie_domain:e.cookie_domain,user_token:e.token,params:e.user,user:t,registration:a,extendExpiredAccessEnabled:e.extendExpiredAccessEnabled})})},isNewUser:function(){return a}};return c}]).directive("pianoId",["userService","viewService","checkout","pianoIdProvider",function(e,t,n,r){return{restrict:"EA",require:"^view",template:'<div id="piano-id-container">  <auth-piano-id ng-if="authIsExist()"></auth-piano-id>  <form-piano-id ng-if="formIsExist()"></form-piano-id></div>',link:function(o,i,a,c){o.formIsExist=function(){return!!n.getCustomFormParams().formName&&e.isUserValid()&&n.isPaymentMethodRequired()&&(n.canSelectPaymentMethod()||n.isPaymentMethodSelected())&&!r.isNewUser()},o.authIsExist=function(){return t.isActive(c.stateName)&&!(e.isUserValid()&&e.isUserConfirmed())},o.isUserValid=e.isUserValid}}}]).directive("emailConfirmationRequired",["errorService","ngEventService","viewService","eventService","checkout","$sce","$window","containerService","pianoIdProvider","lang",function(e,t,n,r,o,i,a,c,s,u){return{restrict:"EA",scope:{},require:"^view",template:'<iframe id="{{id}}" ng-src="{{url}}" style="width:100%;"></iframe>',link:function(e,s,l,d){if(n.isActive(d.stateName)){e.id="piano-id-"+_randomString(5);var p,f=o.params.pianoIdUrl||"https://id.tinypass.com/id/",m=function(e){return 0===e.indexOf("http")?e:document.location.origin||document.location.href}(f);u.on(S);var h,g,v,y,C=(h=f,g=e.id,v=c.rootElement.width(),y={aid:o.getAid(),sender:g,origin:document.location.origin||document.location.href,site:a.TPParam.params.url,screen:"email_confirmation_required",checkout:1,width:v,lang:p||"",passwordless:o.isPasswordlessCheckoutEnabled()},[h,$.param(y)].join("?"));e.url=i.trustAsResourceUrl(C),t.subscribe(e.id+"-resize",function(e,t){!function(e){if(0===e.height)return;s.find("#piano-id-container, iframe").css({height:e.height+"px"}),c.resize()}(t)}),t.subscribe(e.id+"-loaded",function(e,t){var n=s.find("iframe");t={width:n.width(),center:c.getCenterScreen(),originUrl:c.getOriginUrl()};r.customPostMessage("resize",t,m,n[0].contentWindow),S(),o.getDoubleOptInParams().then(function(e){var t=s.find("iframe")[0];if(t){var n={tbc:e.tbc,termId:e.params.termId,showOfferParams:JSON.stringify(e.params)};r.customPostMessage("setupDoubleOptInParams",n,m,t.contentWindow)}})});var E=o.getCustomFormParams();t.subscribe(e.id+"-pianoIdEvent",function(e,t){var n={trackingId:E.trackingId},o={event:t.event,params:$.extend({},t.params,n),iframeId:getParameterByName("iframeId")};r.postMessage("pianoIdEvent",o)})}else s.remove();function S(e){p=e||p;var t=s.find("iframe")[0];t&&r.customPostMessage("lang",{lang:p},m,t.contentWindow)}}}}]).directive("authPianoId",["errorService","ngEventService","viewService","eventService","checkout","$sce","$window","containerService","pianoIdProvider","lang","userService","passwordlessService",function(e,t,n,r,o,i,a,c,s,u,l,d){return{restrict:"EA",scope:{},require:"^view",template:'<iframe id="{{id}}" ng-src="{{url}}" style="width:100%;"></iframe>',link:function(n,p,f,m){n.id="piano-id-"+_randomString(5);var h,g,v=["G18rIJWQ2G","45L2BaS6pu"],y=o.params.pianoIdUrl||"https://id.tinypass.com/id/",C=function(e){return 0===e.indexOf("http")?e:document.location.origin||document.location.href}(y);u.on(_);var E=o.getCustomFormParams();n.formName=E.formName,w(),n.error_msg=u.trc("checkout.platform","You should sign in or sign up first"),t.subscribe(n.id+"-loginSuccess",function(e,t){s.onLoginSuccess(t)}),t.subscribe(n.id+"-resize",function(e,t){!function(e){if(0===e.height)return;p.find("#piano-id-container, iframe").css({height:e.height+"px"}),c.resize()}(t)}),t.subscribe(n.id+"-customEvent",function(e,t){r.customEvent("customEvent",t)}),t.subscribe("initGaWithOptions",function(e,t){var n=p.find("iframe");r.customPostMessage("initGaWithOptions",t,C,n[0].contentWindow)}),t.subscribe(n.id+"-loginResponse",function(e,n){t.fire("pianoIdSingleStepLoginResponse",n)}),t.subscribe("submitPianoIdLoginForm",function(){var e=p.find("iframe");r.customPostMessage("submitLoginForm",null,C,e[0].contentWindow)}),t.subscribe("updatePianoIdAuthIframeUrl",function(){w()}),t.subscribe(n.id+"-loaded",function(e,t){var n=p.find("iframe");t={width:n.width(),center:c.getCenterScreen(),originUrl:c.getOriginUrl()};r.customPostMessage("resize",t,C,n[0].contentWindow),_(),o.getDoubleOptInParams().then(function(e){var t=p.find("iframe")[0];if(t){var n={tbc:e.tbc,termId:e.params.termId,showOfferParams:JSON.stringify(e.params)};r.customPostMessage("setupDoubleOptInParams",n,C,t.contentWindow)}})}),t.subscribe(n.id+"-pianoIdEvent",function(e,t){var n={trackingId:E.trackingId,formName:t.params.formName},o={event:t.event,params:$.extend({},t.params,n),iframeId:getParameterByName("iframeId")};r.postMessage("pianoIdEvent",o)}),t.subscribe(n.id+"-passwordlessEmailSent",function(e,t){d.saveCheckoutParams(o,t)});var S={preventExternalLogin:!0};function T(){return v.indexOf(o.getAid())>=0?"index3.html":""}function _(e){h=e||h;var t=p.find("iframe")[0];t&&r.customPostMessage("lang",{lang:h},C,t.contentWindow)}function w(){g=function(e,t){e+=T();var r=c.rootElement.width(),i={aid:o.getAid(),sender:t,origin:document.location.origin||document.location.href,site:a.TPParam.params.url,screen:l.isUserValid()&&!l.isUserConfirmed()?"email_is_not_confirmed":o.config.isSentLoginEmail?"passwordless_confirmation":o.isPasswordlessCheckoutEnabled()?"login":"register",checkout:1,width:r,lang:h||"",create_passwordless_user:o.isPasswordlessCheckoutEnabled()&&!o.config.preventPasswordlessLogin,single_step:o.isSingleStepEnabled()&&"auth"!==m.stateName,display_mode:"inline"};return n.formName?i.form_name=n.formName:o.config.userLoginEmail&&(i.email=o.config.userLoginEmail,d.setPaymentEmail(o)),[e,$.param(i)].join("?")}(y,n.id),n.url=i.trustAsResourceUrl(g)}l.getConfig().fillLoginRequiredEventParams(S),r.loginRequiredEvent(S),"auth"!==m.stateName&&(m.registerComponentController(n,{passwordlessLoginForm:o.isPasswordlessCheckoutEnabled()}),n._isValid=function(){return e(n).reset(),!!o.isSingleStepEnabled()||(e(n).global(n.error_msg),!1)},p.on("$destroy",function(){e(n).reset(),m.unregisterComponentController(n)}))}}}]).directive("formPianoId",["$q","$sce","checkout","ngEventService","eventService","$window","containerService","pianoIdProvider","lang",function(e,t,n,r,o,i,a,c,s){return{restrict:"EA",require:"^view",scope:{},template:'<iframe ng-hide="isFormHidden" id="{{id}}" ng-src="{{url}}" style="width:100%;"></iframe>',link:function(i,u,l,d){if("auth"!==d.stateName){var p,f=e.defer(),m=!1;i.isFormHidden=!0,i.id="piano-id-"+_randomString(5);var h=n.getCustomFormParams();i.formName=h.formName,i.hideIfComplete=h.hideCompletedFields,i.registerForm=c.registerForm,i.unregisterForm=c.unregisterForm;var g,v=n.params.pianoIdUrl||"https://id.tinypass.com/id/",y=function(e){return 0===e.indexOf("http")?e:document.location.origin||document.location.href}(v);s.on(E);var C=function(e,t){var r=a.rootElement.width(),o={aid:n.getAid(),form_name:i.formName,hide_if_complete:i.hideIfComplete,sender:t,origin:document.location.origin||document.location.href,checkout:1,width:r,lang:g||"",passwordless:n.isPasswordlessCheckoutEnabled()};n.params.userToken&&(o.access_token=n.params.userToken);return[e,$.param(o)].join("?")}(v+"form",i.id);r.subscribe(i.id+"-profileUpdated",function(e,t){m=!0,p&&p.resolve(!0)}),r.subscribe(i.id+"-change",function(e,t){m=!1}),r.subscribe(i.id+"-profileUpdatedError",function(e,t){m=!1,p&&p.resolve(!1)}),r.subscribe(i.id+"-pianoIdEvent",function(e,t){"cfFormImpression"===t.event&&i.$apply(function(){i.isFormHidden=!1});var n={trackingId:h.trackingId,formName:t.params.formName},r={event:t.event,params:$.extend({},t.params,n),iframeId:getParameterByName("iframeId")};o.postMessage("pianoIdEvent",r)}),r.subscribe(i.id+"-resize",function(e,t){!function(e){if(0===e.height)return;var t=u.find("#piano-id-container, iframe");e.animate?t.animate({height:e.height+"px"},200):t.css({height:e.height+"px"});a.resize()}(t)}),r.subscribe(i.id+"-loaded",function(e,t){var n=u.parent(),r=u.find("iframe");t={width:n.width(),center:a.getCenterScreen(),originUrl:a.getOriginUrl()};o.customPostMessage("resize",t,y,r[0].contentWindow),E(),f.resolve()}),r.subscribe(i.id+"-stateReady",function(e,t){var r=u.find("iframe");o.customPostMessage("setToken",n.params.userToken,y,r[0].contentWindow)}),d.registerComponentController(i),i.url=t.trustAsResourceUrl(C),i._isValid=function(){return f.promise.then(function(){if(i.isFullFilled||m)return!0;var t=u.find("iframe");return m||(p=e.defer(),o.customPostMessage("submit",{},y,t[0].contentWindow)),p.promise})},u.on("$destroy",function(){i.isFullFilled=!0,d.unregisterComponentController(i)})}else u.remove();function E(e){g=e||g;var t=u.find("iframe")[0];t&&o.customPostMessage("lang",{lang:g},y,t.contentWindow)}}}}]);var datesModule=angular.module("datesModule",["generalModule"]);datesModule.service("dateUtils",function(){var e=6e4,t=36e5,n=this;this.isDate=function(e){return e instanceof Date},this.parse=function(r,o){var i=2,a=/[T ]/,c=/:/,s=/^(\d{2})$/,u=[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],l=/^(\d{4})/,d=[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],p=/^-(\d{2})$/,f=/^-?(\d{3})$/,m=/^-?(\d{2})-?(\d{2})$/,h=/^-?W(\d{2})$/,g=/^-?W(\d{2})-?(\d{1})$/,v=/^(\d{2}([.,]\d*)?)$/,y=/^(\d{2}):?(\d{2}([.,]\d*)?)$/,C=/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,E=/([Z+-].*)$/,S=/^(Z)$/,T=/^([+-])(\d{2})$/,_=/^([+-])(\d{2}):?(\d{2})$/;function w(e,t,n){t=t||0,n=n||0;var r=new Date(0);r.setUTCFullYear(e,0,4);var o=7*t+n+1-(r.getUTCDay()||7);return r.setUTCDate(r.getUTCDate()+o),r}return function(r,o){if(n.isDate(r))return new Date(r.getTime());if("string"!=typeof r)return new Date(r);var b=(o||{}).additionalDigits;b=null===b?i:Number(b);var P=function(e){var t,n={},r=e.split(a);if(c.test(r[0])?(n.date=null,t=r[0]):(n.date=r[0],t=r[1]),t){var o=E.exec(t);o?(n.time=t.replace(o[1],""),n.timezone=o[1]):n.time=t}return n}(r),A=function(e,t){var n,r=u[t],o=d[t];if(n=l.exec(e)||o.exec(e)){var i=n[1];return{year:parseInt(i,10),restDateString:e.slice(i.length)}}if(n=s.exec(e)||r.exec(e)){var a=n[1];return{year:100*parseInt(a,10),restDateString:e.slice(a.length)}}return{year:null}}(P.date,b),$=A.year,I=function(e,t){if(null===t)return null;var n,r,o,i;if(0===e.length)return(r=new Date(0)).setUTCFullYear(t),r;if(n=p.exec(e))return r=new Date(0),o=parseInt(n[1],10)-1,r.setUTCFullYear(t,o),r;if(n=f.exec(e)){r=new Date(0);var a=parseInt(n[1],10);return r.setUTCFullYear(t,0,a),r}if(n=m.exec(e)){r=new Date(0),o=parseInt(n[1],10)-1;var c=parseInt(n[2],10);return r.setUTCFullYear(t,o,c),r}if(n=h.exec(e))return i=parseInt(n[1],10)-1,w(t,i);if(n=g.exec(e)){i=parseInt(n[1],10)-1;var s=parseInt(n[2],10)-1;return w(t,i,s)}return null}(A.restDateString,$);if(I){var k,N=I.getTime(),x=0;return P.time&&(x=function(n){var r,o,i;if(r=v.exec(n))return(o=parseFloat(r[1].replace(",",".")))%24*t;if(r=y.exec(n))return o=parseInt(r[1],10),i=parseFloat(r[2].replace(",",".")),o%24*t+i*e;if(r=C.exec(n)){o=parseInt(r[1],10),i=parseInt(r[2],10);var a=parseFloat(r[3].replace(",","."));return o%24*t+i*e+1e3*a}return null}(P.time)),P.timezone?(D=P.timezone,k=(M=S.exec(D))?0:(M=T.exec(D))?(O=60*parseInt(M[2],10),"+"===M[1]?-O:O):(M=_.exec(D))?(O=60*parseInt(M[2],10)+parseInt(M[3],10),"+"===M[1]?-O:O):0):(k=new Date(N+x).getTimezoneOffset(),k=new Date(N+x+k*e).getTimezoneOffset()),new Date(N+x+k*e)}var D,M,O;return new Date(r)}(r,o)},this.getTime=function(e){return this.parse(e).getTime()},this.unixTime=function(e){return Math.floor(this.getTime(e)/1e3)},this.startOfDay=function(e){var t=this.parse(e);return t.setHours(0,0,0,0),t},this.getDayOfYear=function(e){var t=this.parse(e);return this.differenceInCalendarDays(t,this.startOfYear(t))+1},this.differenceInCalendarDays=function(t,n){var r=this.startOfDay(t),o=this.startOfDay(n),i=r.getTime()-r.getTimezoneOffset()*e,a=o.getTime()-o.getTimezoneOffset()*e;return Math.round((i-a)/864e5)},this.getISOYear=function(e){var t=this.parse(e),n=t.getFullYear(),r=new Date(0);r.setFullYear(n+1,0,4),r.setHours(0,0,0,0);var o=this.startOfISOWeek(r),i=new Date(0);i.setFullYear(n,0,4),i.setHours(0,0,0,0);var a=this.startOfISOWeek(i);return t.getTime()>=o.getTime()?n+1:t.getTime()>=a.getTime()?n:n-1},this.startOfISOYear=function(e){var t=this.getISOYear(e),n=new Date(0);return n.setFullYear(t,0,4),n.setHours(0,0,0,0),this.startOfISOWeek(n)},this.getISOWeek=function(e){var t=this.parse(e),n=this.startOfISOWeek(t).getTime()-this.startOfISOYear(t).getTime();return Math.round(n/6048e5)+1},this.startOfISOWeek=function(e){return this.startOfWeek(e,{weekStartsOn:1})},this.startOfYear=function(e){var t=this.parse(e),n=new Date(0);return n.setFullYear(t.getFullYear(),0,1),n.setHours(0,0,0,0),n},this.startOfWeek=function(e,t){var n=t&&Number(t.weekStartsOn)||0,r=this.parse(e),o=r.getDay(),i=(o<n?7:0)+o-n;return r.setDate(r.getDate()-i),r.setHours(0,0,0,0),r},this.isValid=function(e){if(this.isDate(e))return!isNaN(e);throw new TypeError(toString.call(e)+" is not an instance of Date")},this.format=function(e,t,r){var o={M:function(e){return e.getMonth()+1},MM:function(e){return a(e.getMonth()+1,2)},Q:function(e){return Math.ceil((e.getMonth()+1)/3)},D:function(e){return e.getDate()},DD:function(e){return a(e.getDate(),2)},DDD:function(e){return n.getDayOfYear(e)},DDDD:function(e){return a(n.getDayOfYear(e),3)},d:function(e){return e.getDay()},E:function(e){return e.getDay()||7},W:function(e){return n.getISOWeek(e)},WW:function(e){return a(n.getISOWeek(e),2)},YY:function(e){return a(e.getFullYear(),4).substr(2)},YYYY:function(e){return a(e.getFullYear(),4)},GG:function(e){return String(n.getISOYear(e)).substr(2)},GGGG:function(e){return n.getISOYear(e)},H:function(e){return e.getHours()},HH:function(e){return a(e.getHours(),2)},h:function(e){var t=e.getHours();return 0===t?12:t>12?t%12:t},hh:function(e){return a(o.h(e),2)},m:function(e){return e.getMinutes()},mm:function(e){return a(e.getMinutes(),2)},s:function(e){return e.getSeconds()},ss:function(e){return a(e.getSeconds(),2)},S:function(e){return Math.floor(e.getMilliseconds()/100)},SS:function(e){return a(Math.floor(e.getMilliseconds()/10),2)},SSS:function(e){return a(e.getMilliseconds(),3)},Z:function(e){return i(e.getTimezoneOffset(),":")},ZZ:function(e){return i(e.getTimezoneOffset())},X:function(e){return Math.floor(e.getTime()/1e3)},x:function(e){return e.getTime()}};function i(e,t){t=t||"";var n=e>0?"-":"+",r=Math.abs(e),o=r%60;return n+a(Math.floor(r/60),2)+t+a(o,2)}function a(e,t){for(var n=Math.abs(e).toString();n.length<t;)n="0"+n;return n}return function(e,t,r){var i=t?String(t):"YYYY-MM-DDTHH:mm:ss.SSSZ",a=(r||{}).locale,c=n.enLocale().format.formatters,s=n.enLocale().format.formattingTokensRegExp;a&&a.format&&a.format.formatters&&(c=a.format.formatters,a.format.formattingTokensRegExp&&(s=a.format.formattingTokensRegExp));var u=n.parse(e);return n.isValid(u)?function(e,t,n){var r,i,a,c=e.match(n),s=c.length;for(r=0;r<s;r++)i=t[c[r]]||o[c[r]],c[r]=i||((a=c[r]).match(/\[[\s\S]/)?a.replace(/^\[|]$/g,""):a.replace(/\\/g,""));return function(e){for(var t="",n=0;n<s;n++)c[n]instanceof Function?t+=c[n](e,o):t+=c[n];return t}}(i,c,s)(u):"Invalid Date"}(e,t,r)},this.enLocale=function(){return{distanceInWords:(l={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},{localize:function(e,t,n){var r;return n=n||{},r="string"==typeof l[e]?l[e]:1===t?l[e].one:l[e].other.replace("{{count}}",t),n.addSuffix?n.comparison>0?"in "+r:r+" ago":r}}),format:(e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],t=["January","February","March","April","May","June","July","August","September","October","November","December"],r=["Su","Mo","Tu","We","Th","Fr","Sa"],o=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],i=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],a=["AM","PM"],c=["am","pm"],s=["a.m.","p.m."],u={MMM:function(t){return e[t.getMonth()]},MMMM:function(e){return t[e.getMonth()]},dd:function(e){return r[e.getDay()]},ddd:function(e){return o[e.getDay()]},dddd:function(e){return i[e.getDay()]},A:function(e){return e.getHours()/12>=1?a[1]:a[0]},a:function(e){return e.getHours()/12>=1?c[1]:c[0]},aa:function(e){return e.getHours()/12>=1?s[1]:s[0]}},["M","D","DDD","d","Q","W"].forEach(function(e){u[e+"o"]=function(t,n){return function(e){var t=e%100;if(t>20||t<10)switch(t%10){case 1:return e+"st";case 2:return e+"nd";case 3:return e+"rd"}return e+"th"}(n[e](t))}}),{formatters:u,formattingTokensRegExp:n.buildFormattingTokensRegExp(u)})};var e,t,r,o,i,a,c,s,u,l},this.buildFormattingTokensRegExp=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);var r=["M","MM","Q","D","DD","DDD","DDDD","d","E","W","WW","YY","YYYY","GG","GGGG","H","HH","h","hh","m","mm","s","ss","S","SS","SSS","Z","ZZ","X","x"].concat(t).sort().reverse();return new RegExp("(\\[[^\\[]*\\])|(\\\\)?("+r.join("|")+"|.)","g")}}),angular.module("country.selector",["ngSanitize","generalModule"]).directive("dynamicHtml",["$compile",function(e){return{restrict:"A",replace:!0,link:function(t,n,r){t.$watch(r.dynamicHtml,function(r){n.html(r),e(n.contents())(t)})}}}]).directive("tpCallingCodeSelector",["CountrySelectorCtrl",function(e){return{restrict:"A",scope:{selectorOptions:"=",selectorLabel:"@",dropdownStyles:"=",side:"=",dropdownClasses:"=?",clickOnSelect:"=?"},templateUrl:"/widget/checkout/component/partials/calling-code-selector.html",link:function(t,n){e(t,n)}}}]).directive("tpCountrySelector",["CountrySelectorCtrl",function(e){return{restrict:"A",scope:{selectorOptions:"=",selectorLabel:"@",dropdownStyles:"=",side:"=",clickOnSelect:"=?",countryType:"=?",defaultCountry:"=?"},templateUrl:"/widget/checkout/component/partials/country-selector.html",link:function(t,n){e(t,n)}}}]).factory("CountrySelectorCtrl",["tpDrop","$rootScope","utilsService",function(e,t,n){return function(t,r){var o,i,a={scope:t,templateUrl:"/widget/checkout/component/partials/select-selector.html",centerOn:r,controller:["$scope",function(e){e.currentCategoryModel="",e.searchItemModel="",e.options=angular.copy(e.selectorOptions.items),e.update=o,e.countryListHtml="";var t="",r="";function o(){var o;e.countryListHtml=(o=e.searchItemModel,r="",n.forEach(e.options,function(e,n){-1!==e.name.toLowerCase().indexOf(o.toLowerCase())&&(e.name.replace(/'/g,"\\'"),t=""===o?e.name:function(e,t){return e.replace(new RegExp(t.replace(/\+/g,"\\+"),"gi"),function(e){return'<span class="tp-dropdown__text-highlight">'+e+"</span>"})}(e.name,o),r+='<a class="tp-dropdown__link dropdown-link-group clearfix" ng-click="select('+n+')"><div class="country-icon country-icon-'+e.countryCode.toLowerCase()+'"></div> <span>'+t+"</span></a>")}),r)}o(),e.select=function(t){e.$close(e.options[t])}}],style:t.dropdownStyles||{width:580,zIndex:1004},cl:t.dropdownClasses||null,side:t.side||"top"};function c(e){var r;return n.forEach(t.selectorOptions.items,function(t){t.countryCode===e&&(r=t)}),r}function s(e){t.selectorOptions.selectorModel={label:e.name,item:e},t.clickOnSelect&&t.clickOnSelect(e)}t.$on("selectCountry",function(e,n){if(n[0]===t.countryType){var r=c(n[1]);r&&s(r)}}),t.confirm=s,r.click(function(n){n.preventDefault(),n.stopPropagation(),e(angular.extend({},a)).then(t.confirm,t.reject)}),t.defaultCountry&&(o=t.defaultCountry,(i=c(o))&&(t.selectorOptions.selectorModel.label=i.name,t.selectorOptions.selectorModel.item=i))}}]).directive("tpStateSelector",["StateSelectorCtrl",function(e){return{restrict:"A",scope:{selectorOptions:"=",selectorLabel:"@",dropdownStyles:"=",side:"=",clickOnSelect:"=?",defaultState:"=?"},templateUrl:"/widget/checkout/component/partials/country-selector.html",link:function(t,n){e(t,n)}}}]).factory("StateSelectorCtrl",["tpDrop","$rootScope","utilsService",function(e,t,n){return function(t,r){var o={scope:t,templateUrl:"/widget/checkout/component/partials/select-selector.html",centerOn:r,controller:["$scope",function(e){e.currentCategoryModel="",e.searchItemModel="",e.options=angular.copy(e.selectorOptions.items),e.update=o,e.countryListHtml="";var t="",r="";function o(){var o;e.countryListHtml=(o=e.searchItemModel,r="",n.forEach(e.options,function(e,n){-1!==e.name.toLowerCase().indexOf(o.toLowerCase())&&(e.name.replace(/'/g,"\\'"),t=""===o?e.name:function(e,t){return e.replace(new RegExp(t.replace(/\+/g,"\\+"),"gi"),function(e){return'<span class="tp-dropdown__text-highlight">'+e+"</span>"})}(e.name,o),r+='<a class="tp-dropdown__link dropdown-link-group clearfix" ng-click="select('+n+')"><span>'+t+"</span></a>")}),r)}o(),e.select=function(t){e.$close(e.options[t])}}],style:t.dropdownStyles||{width:580,zIndex:1004},cl:t.dropdownClasses||null,side:t.side||"top"};function i(e){var r=function(e){var r;return n.forEach(t.selectorOptions.items,function(t){t.stateCode===e&&(r=t)}),r}(e);r&&(t.selectorOptions.selectorModel.label=r.name,t.selectorOptions.selectorModel.item=r)}t.confirm=function(e){t.selectorOptions.selectorModel={label:e.name,item:e},t.clickOnSelect&&t.clickOnSelect(e)},r.click(function(n){n.preventDefault(),n.stopPropagation(),e(angular.extend({},o)).then(t.confirm,t.reject)}),t.defaultState&&i(t.defaultState)}}]);var passwordless=angular.module("passwordlessModule",["checkoutModule"]);passwordless.factory("passwordlessService",["tpHTTP","ngEventService","viewService","containerService","userService","eventService","$q","errorService","$rootScope","lang","$window","checkoutGoTo",function(e,t,n,r,o,i,a,c,s,u,l,d){var p,f,m={email:"",error:""};function h(l){if(0===m.email.length)return c(s).global(u.trc("checkout.platform","Email format is not valid")),l.reject(),l.promise;var d=t.subscribe("gigyaHide",function(e,t){d(),t.afterLogin||l.reject()});f.getDoubleOptInParams().then(function(e){return{tbc:e.tbc,termId:e.params.termId,showOfferParams:JSON.stringify(e.params),url:r.getOriginUrl()}}).then(function(t){return function(t){var r={aid:TPParam.params.aid,email:m.email,"g-recaptcha-response":p};return Object.assign(r,t),m.error="",e.post(TPParam.LOGIN_PASSWORDLESS_USER,r).then(function(e){var t,r=e.models.user||{};"auth"===n.getActiveState()&&n.viewStack.pop(),r.userExist?(t=r.sentLoginEmail,f.config.isExistPasswordlessUser=!0,o.isPianoIdUserProvider()?f.config.isSentLoginEmail=t:o.isGigyaUserProvider()?(o.onLoginSuccess(function(){g()},!0),o.login()):util.log("[PASSWORDLESS] Unsupported user provider")):function(e){if(o.isPianoIdUserProvider()){var t={};Object.assign(t,e.userModel,{rememberMe:!1}),o.onExternalLogin({token_list:e.tokenList,cookie_domain:e.cookieDomain,user_token:e.accessToken,user:t,params:t,registration:!0}).then(function(){g()})}else o.isGigyaUserProvider()?(o.onLoginSuccess(function(){g()},!0),i.gigyaPasswordlessLoginEvent({accessTokenName:e.accessToken,accessToken:e.accessToken})):util.log("[PASSWORDLESS] Unsupported user provider")}(r)}).catch(function(e){return m.error=e&&e.errors&&e.errors.length&&e.errors[0].msg,"auth"!==n.getActiveState()&&c(s).global(m.error),a.reject(m.error)})}(t)}).catch(function(){l.reject()})}function g(){f.reload()}return{data:m,onCaptchaResolve:function(e){p=e},onCaptchaReady:function(e){e},loginUser:function(e){f=e;var r=a.defer(),i=o.isGigyaUserProvider()&&f.isPasswordlessCheckoutEnabled()&&!o.isUserValid(),l=o.isPianoIdUserProvider()&&f.isSingleStepEnabled()&&!o.isUserValid();return(i||l)&&n.isPasswordlessFormState(n.getActiveState())?(f.onUserChanged().then(function(){r.resolve()}),l&&function(e,n){c(s).reset(),f.config.isSentLoginEmail=!1,f.config.preventPasswordlessLogin=!1,t.fire("submitPianoIdLoginForm");var r=t.subscribe("pianoIdSingleStepLoginResponse",function(t,o){if(r(),o.loggedIn||o.userCreated)return f.onUserChanged().then(function(){n.resolve()});o.usual_user?c(s).global(u.tr("Enter your password, please")):o.email_sent&&(f.config.isSentLoginEmail=!0,f.config.preventPasswordlessLogin=!0,d.gotoAuthState(e)),n.reject()})}(e,r),i&&h(r)):r.resolve(),r.promise},saveCheckoutParams:function(t,n){t.getDoubleOptInParams().then(function(r){r.paymentMethodNonce=t.input.paymentMethodNonce||"",r.paymentMethodInstrumentId=t.input.paymentMethodInstrumentId||"",function(t,n,r){var o={loginTokenId:t,oid:n.params.oid,termId:n.params.termId,tbc:n.tbc,nonce:n.paymentMethodNonce,instrumentId:n.paymentMethodInstrumentId,showOfferParams:JSON.stringify(n.params)};(function(e,t){e.input&&"boolean"==typeof e.input.areTaxesCalculated&&(t.areTaxesCalculated=e.input.areTaxesCalculated)})(r,o),function(e,t){"boolean"==typeof t.areTaxesCalculated?t.autoComplete=!(!e.paymentMethodNonce&&!e.paymentMethodInstrumentId&&t.areTaxesCalculated):t.autoComplete=!(!e.paymentMethodNonce&&!e.paymentMethodInstrumentId)}(n,o),e({method:"post",url:l.TPParam.SAVE_CHECKOUT_PARAMS,data:o})}(n,r,t)}).catch(function(e){console.error(e)})},updatePianoIdIframe:function(){t.fire("updatePianoIdAuthIframeUrl")},setPaymentEmail:function(e,t){e.config.userLoginEmail=t||""}}}]),passwordless.directive("passwordlessSingleStepCaptcha",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/passwordless-single-step-captcha.html",scope:{},controller:["$scope","passwordlessService","checkout","userService",function(e,t,n,r){angular.extend(e,BaseComponentController),e.data=t.data,e.recaptchaKey=TPParam.RECAPTCHA_SITE_KEY,e.onCaptchaResolve=t.onCaptchaResolve,e.onCaptchaReady=t.onCaptchaReady,e.isCaptchaVerificationRequired=function(){return n.isSingleStepEnabled()&&n.config.passwordlessCaptchaEnabled&&!r.isUserValid()}}],link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e)}}}),passwordless.directive("passwordlessLogin",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/passwordless-login.html",scope:{},controller:["$scope","passwordlessService","checkout","viewService",function(e,t,n,r){angular.extend(e,BaseComponentController),e.data=t.data,e.recaptchaKey=TPParam.RECAPTCHA_SITE_KEY,e.onCaptchaResolve=t.onCaptchaResolve,e.onCaptchaReady=t.onCaptchaReady,e.isSingleStepEnabled=function(){return n.isSingleStepEnabled()&&"auth"!==r.getActiveState()},e.loginUser=function(){return t.loginUser(n)}}],link:function(e,t,n,r){r.registerComponentController(e,{passwordlessLoginForm:!0}),r.extendScope(e)}}}),passwordless.directive("passwordlessPaymentMethods",function(){return{restrict:"A",template:'<div ng-if="isUsedForTerm(paymentMethodIds.applePayBt)" class="pn-passwordless-offer-boilerplate__applepay-btn" apple-pay-through-braintree-form-component term-id="{{termId}}"></div>\n<new-flow-components-c-h ng-if="isUsedForTerm(paymentMethodIds.applePayStripe)" payment-source="paymentMethodIds.applePayStripe" term-id="{{termId}}" class="pn-passwordless-offer--applepay-button-container"></new-flow-components-c-h>\n<new-flow-components-c-h ng-if="isUsedForTerm(paymentMethodIds.applePayPayWay)" payment-source="paymentMethodIds.applePayPayWay" term-id="{{termId}}" class="pn-passwordless-offer--applepay-button-container"></new-flow-components-c-h>',scope:{termId:"@"},controller:["$scope","checkout",function(e,t){e.paymentMethodIds={applePayBt:APPLE_PAY_BT,applePayStripe:STRIPE_APPLEPAY,applePayPayWay:PAYWAY_APPLEPAY},e.isUsedForTerm=function(n){var r=t._findTerm(e.termId);return!!r.subscriptionPaymentMethods&&r.subscriptionPaymentMethods.some(function(e){return e.id===n})}}]}});var billingConfigModule=angular.module("billingConfigModule",["checkoutModule"]);billingConfigModule.factory("billingConfig",["ngEventService","utilsService","lang",function(e,t,n){var r={countryCode:window.TPParam.GEO_COUNTRY_CODE,zipCode:window.TPParam.GEO_COUNTRY_POSTAL_CODE,needResidence:!1,sameResidence:!0,residenceCountryCode:null,vatLabel:n.tr("VAT"),taxIncludeBilling:!0,showVAT:!1,geoCountryCode:window.TPParam.GEO_COUNTRY_CODE,geoZipCode:window.TPParam.GEO_COUNTRY_POSTAL_CODE,renewBillingCountryCode:null,renewBillingZipCode:null,renewResidenceCountryCode:null,countryTaxSupport:window.TPParam.GEO_COUNTRY_TAX_SUPPORT,updateFromTaxRequest:function(t,n){t.isRefreshBillingInfoNeeded()&&n&&(r.countryCode=n.billingCountryCode,r.residenceCountryCode=n.residenceCountryCode,r.zipCode=n.residenceZipCode?n.residenceZipCode:n.billingZipCode,e.fire(EVENT_BILLING_FROM_TAX_REQUEST))},updateByCountryCode:function(e,n){var o=t.find(e.config.taxCountries,function(e){return e.countryCode===n});o&&(r.requiredZipCode=o.requireZipCode,r.vatLabel=o.vatLabel,r.needResidence=o.needResidence,r.taxIncludeBilling=o.taxIncludeBilling,r.countryCode=n,r.countryTaxSupport=o.taxSupport)},taxRequestFromUpi:function(e){var t=null;return e.tax_request&&(t=JSON.parse(e.tax_request)),t}};return r}]),billingConfigModule.directive("billingCountry",function(){return{restrict:"A",require:"^view",replace:!0,templateUrl:"/widget/checkout/component/partials/billing-country-component.html",link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e)},controller:["$scope","$q","checkout","$sce","$timeout","ngEventService","utilsService","billingConfig",function(e,t,n,r,o,i,a,c){var s=!1,u=null,l=!1,d=!1,p="Countries";function f(t){var r;e.selectorOptions.items=h(n.config.taxCountries,p);var o=c.countryCode||c.geoCountryCode;r=t&&c.countryCode===c.geoCountryCode&&c.renewBillingCountryCode?c.renewBillingCountryCode:e.selectorOptions.selectorModel.item.countryCode===o?e.selectorOptions.selectorModel.item.countryCode:c.countryCode||c.geoCountryCode;var i=a.find(e.selectorOptions.items,function(e){return e.countryCode===r});void 0!==i&&(e.selectorOptions.selectorModel.label=i.name,e.selectorOptions.selectorModel.item=i,c.requiredZipCode=i.requireZipCode,c.vatLabel=i.vatLabel,c.needResidence=i.needResidence,c.taxIncludeBilling=i.taxIncludeBilling,c.countryCode=r,c.countryTaxSupport=i.taxSupport),t&&c.requiredZipCode&&c.zipCode===c.geoZipCode&&c.renewBillingZipCode&&(c.zipCode=c.renewBillingZipCode);var s,u=null;e.selectorOptions.selectorModel.item.countryCode&&(u=e.selectorOptions.selectorModel.item),e.residenceOptions.items=h(n.config.taxCountries,p,u),s=t&&c.renewResidenceCountryCode?c.renewResidenceCountryCode:c.residenceCountryCode;var l=a.find(e.residenceOptions.items,function(e){return e.countryCode===s});void 0!==l&&(e.residenceOptions.selectorModel.label=l.name,e.residenceOptions.selectorModel.item=l,c.residenceCountryCode=s,c.residenceRequireZipCode=l.requireZipCode,c.sameResidence=!c.residenceCountryCode||c.countryCode===c.residenceCountryCode,c.sameResidence||(c.taxIncludeBilling=l.taxIncludeBilling,c.vatLabel=l.vatLabel))}function m(t){var r,a;function p(){i.fire("PAYMENT_BILLING_PLAN_TABLE_UPDATE"),u=o(function(){e._isValid()&&(t&&(tinypass.withoutWaitPanel=!0),l=!0,n.reload(void 0,!0).then(function(){tinypass.withoutWaitPanel=!1,l=!1,d&&d(),d=!1},function(){tinypass.withoutWaitPanel=!1,l=!1,d&&d(),d=!1}).finally(function(){i.fire("PAYMENT_BILLING_PLAN_TABLE_IS_UPDATED")}))},300)}e.selectorOptions.selectorModel&&e.selectorOptions.selectorModel.item&&(r=e.selectorOptions.selectorModel.item).countryCode&&(c.countryCode=r.countryCode,c.countryTaxSupport=r.taxSupport,c.requiredZipCode=r.requireZipCode,c.vatLabel=r.vatLabel,c.needResidence=r.needResidence,c.taxIncludeBilling=r.taxIncludeBilling),e.residenceOptions.selectorModel&&e.residenceOptions.selectorModel.item&&(a=e.residenceOptions.selectorModel.item,(r&&r.countryCode===a.countryCode||!c.needResidence)&&(c.sameResidence=!0)),c.sameResidence?(c.residenceCountryCode="",c.residenceRequireZipCode=!1,e.residenceOptions.selectorModel.label="",e.residenceOptions.selectorModel.item={}):e.residenceOptions.selectorModel&&e.residenceOptions.selectorModel.item&&(a=e.residenceOptions.selectorModel.item,c.residenceCountryCode=a.countryCode,c.residenceRequireZipCode=a.requireZipCode,c.residenceCountryCode&&(c.taxIncludeBilling=a.taxIncludeBilling,c.vatLabel=a.vatLabel)),o.cancel(u),s&&(l?d=function(){p()}:p())}function h(e,t,n){return a.filter(e,function(e){return!(n&&n.countryCode===e.countryCode)}).map(function(e){return{category:t,name:e.name,countryCode:e.countryCode,requireZipCode:e.requireZipCode,vatLabel:e.vatLabel,needResidence:e.needResidence,taxIncludeBilling:e.taxIncludeBilling,taxSupport:e.taxSupport,visibility:!0}})}angular.extend(e,BaseComponentController),e.selectorOptions={selectorModel:{label:"",item:{}},items:{}},e.residenceOptions=angular.copy(e.selectorOptions),e.onZipCodeChanged=function(){m(!0)},e.onChangeSameResidence=function(){m()},e.$watch("selectorOptions.selectorModel",function(){s&&c.sameResidence&&(c.zipCode=""),m()}),e.$watch("residenceOptions.selectorModel",function(){m(),i.fire(EVENT_BILLING_COUNTRY_SELECTED)}),t.when(n.config.taxCountries).then(function(e){f(),o(function(){s=!0})}),e._isValid=function(){return!0},i.subscribe(EVENT_BILLING_FROM_TAX_REQUEST,function(){n.isBillingCountryEnabled()&&(f(),o(m,0))}),i.subscribe(EVENT_BILLING_COUNTRY_SELECTED,function(){f()}),i.subscribe(EVENT_CHECKOUT_RELOADED,function(){n.isBillingCountryEnabled()&&f()}),i.subscribe(EVENT_USER_ACCESS_CHANGED,function(){n.isBillingCountryEnabled()&&f()})}]}});var consent=angular.module("consentModule",["checkoutModule","tp.i18n"]);consent.directive("consentsList",function(){return{restrict:"AE",require:"^view",templateUrl:"/widget/checkout/component/partials/consents-list.html",controller:["$scope","checkout","checkConsents","ngEventService",function(e,t,n,r){function o(){e.consents=n.isNeeded(t)?t.input.consents:[]}r.subscribe(EVENT_CHECKOUT_CONSENT_CHANGED,function(){o()}),o()}]}}),consent.directive("consentBox",function(){return{restrict:"AE",require:"^view",templateUrl:"/widget/checkout/component/partials/consent-box.html",scope:{consentId:"="},controller:["$scope","checkout","ngEventService",function(e,t,n){n.subscribe(EVENT_CHECKOUT_CONSENT_CHANGED,function(){angular.forEach(t.input.consents,function(t){t.fieldId===e.consentId&&(e.consent=t)})})}]}}),consent.factory("checkConsents",["$q","$window","tpHTTP",function(e,t,n){var r=function(e){return n({method:"post",url:t.TPParam.VALIDATE_CONSENTS,params:{aid:e.params.aid,consents:e.input.consents}})};return r.isNeeded=function(e){var t=e.getSelectedTerm();return e.input.consents&&e.input.consents.length&&!e.isRegistrationTerm(t)&&!e.isExternalTerm(t)},r}]);var module=angular.module("redemptionModule",["checkoutModule","datesModule","purchaseServiceDataModule"]);module.factory("redeemRedemptionCodeService",["$q","eventService","statsService","checkout","tpHTTP",function(e,t,n,r,o){return function(i){return n.getStats().then(function(n){return o({method:"post",url:TPParam.REDEEM_REDEMPTION_CODE,params:{aid:r.getAid(),redeemCode:i.form.redeemCode,url:r.params.url,zone:r.params.zone,userToken:r.params.userToken,userProvider:r.params.userProvider,userRef:r.params.userRef,janrainCaptureToken:r.params.janrainCaptureToken,experienceId:r.params.experienceId,templatePubId:r.params.templateId,offerPubId:r.params.offerId},data:{checkoutStats:n}}).then(function(e){i.state=i.STATE_DONE;var n=e.data.models.receipt;return r.input.termConversionId=n.termConversionId,r.input.sharedAccountCount=n.sharedAccountLimit,r.flags.selectedTerm={resource:{rid:n.rid}},t.completeEvent(n),r.mergeStats(e),n},function(t){var n=t.data.errors;return i.errors=n,e.reject(n)})})}}]),module.factory("redemptionService",["$q","checkout","tpHTTP","userService","eventService","statsService","ngEventService","viewService","containerService","$timeout","redeemRedemptionCodeService","purchaseServiceData","errorService","lang","passwordlessService","checkoutGoTo",function(e,t,n,r,o,i,a,c,s,u,l,d,p,f,m,h){var g={STATE_CODE:1,STATE_INFO:2,STATE_DONE:3,state:null,form:{redeemCode:null},voucher:null,errors:[],applyCode:function(){return i.getStats().then(function(r){return n({method:"post",url:TPParam.APPLY_REDEMPTION_CODE,params:{aid:t.getAid(),redeemCode:g.form.redeemCode,userToken:t.params.userToken,userProvider:t.params.userProvider,userRef:t.params.userRef,janrainCaptureToken:t.params.janrainCaptureToken},data:{checkoutStats:r}}).then(function(e){var n=e.data.models;return g.state=g.STATE_INFO,g.voucher=n,t.mergeStats(e),n},function(t){var n=t.data.errors;return g.errors=n,g.voucher=null,e.reject(n)})})},redeem:function(){var n=e.defer();return r.isUserValid()?i()?l(g):(t.params.redeemCode=g.form.redeemCode,c.gotoState("user-non-confirmed"),n.promise):t.isPasswordlessCheckoutEnabled()||r.isCondeUserProvider()||r.isPianoIdUserProvider()?function(){if(s.isModal){var r=g.form.redeemCode;t.params.redeemCode=r,t.createOrder(t.params.aid,t.params.offerId,t.params.templateId,t.params.userToken,null).then(function(t){return t.errors&&t.errors.length>0?e.reject(t):t}).then(function(e){t.input.oid=e.models.oid,t.isSingleStepEnabled()?m.loginUser(t).then(function(){a(r)}):h.gotoAuthState(t,null,function(){"auth"===c.getActiveState()&&i()?(c.gotoPreviousState(),a(r)):n.reject()},!0)}).catch(function(e){var r;"object"==typeof e&&(e.errors&&e.errors.length?r=e.errors[0].message||e.errors[0].msg:e.message&&(r=e.message)),r?getParameterByName("termId")?p().terminal(f.trc("service.error.codes",r)):p(t.$rootScope).global(f.trc("service.error.codes",r)):p().terminal(f.trc("checkout.platform","Create order failed")),n.reject()})}else n.reject(),o.startCheckoutEvent(t.params);return n.promise}():(t.redemptionLoginRequiredParams.state=g.state,t.redemptionLoginRequiredParams.form.redeemCode=g.form.redeemCode,t.login("register").then(function(){return l(g)}));function i(){return!r.isPianoIdUserProvider()||r.isUserConfirmed()}function a(e){g.form.redeemCode=e,g.applyCode().then(function(){return l(g)}).then(function(){n.resolve()})}},reset:function(){g.form.redeemCode=null,g.voucher=null,g.state=g.STATE_CODE},resetErrors:function(){g.errors=[]},isSingleStepEnabled:function(){return t.isSingleStepEnabled()||!t.isPasswordlessCheckoutEnabled()&&!t.config.checkoutAuthenticationInSeparateState}};return g.state=g.STATE_CODE,t.params.voucherCode&&(g.form.redeemCode=t.params.voucherCode,g.applyCode()),g}]),module.directive("redemptionComponent",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/redemption-component.html",link:function(e,t,n,r){r.registerComponentController(e,{redemptionForm:!0}),e.extendScope=function(){r.extendScope(e)},e.extendScope()},controller:["$scope",function(e){angular.extend(e,BaseComponentController)}]}}),module.directive("redemptionCodeAndInfo",["redemptionService","$compile","$http","$templateCache",function(e,t,n,r){var o="/widget/checkout/component/partials/redemption-code.html",i="/widget/checkout/component/partials/redemption-info.html";return{restrict:"A",require:"^redemptionComponent",replace:!1,scope:!0,link:function(a,c){a.$watch(function(){return e.state},function(s){var u=s===e.STATE_CODE?o:i;n.get(u,{cache:r}).then(function(e){c.html(e.data),t(c.contents())(a)})})},controller:["$scope","viewService","ngEventService","checkout","errorService","$filter","eventService","lang","checkoutGoTo",function(t,n,r,o,i,a,c,s,u){t.$watch(function(){return e.errors},function(e){var n=e.filter(function(e){return"redeemCode"!==e.field});n.length?i(t).global(n[0].msg):i(t).reset()}),t.$watch(function(){return e.voucher},function(e){t.voucher=e}),t.softReset=function(){o.config.isRedemption||(e.reset(),e.resetErrors())},t.cancel=function(){e.state===e.STATE_INFO?(e.reset(),c.checkoutStateChange("redemption")):o.config.isRedemption?o.close():n.gotoPreviousState()},t.applyCode=function(){e.resetErrors(),e.applyCode()},t.redeem=function(){e.resetErrors(),e.redeem().then(function(){null===o.input.sharedAccountCount?(r.fire(EVENT_CHECKOUT_REDEEM_DONE),u.gotoReceipt(o)):u.gotoSharedSubscriptionState()})},t.isSingleStepEnabled=function(){return e.isSingleStepEnabled()},t.redeemCode=function(){return e.form.redeemCode},t.voucherResource=function(){return t.voucher?t.voucher.resource.name:null},t.voucherDuration=function(){return t.voucher?t.voucher.duration:null},t.voucherStarting=function(){if(!t.voucher)return null;var e=new Date(t.voucher.startingDate),n=new Date;return e.getFullYear()===n.getFullYear()&&e.getMonth()===n.getMonth()&&e.getDate()===n.getDate()?s.trc("checkout.platform","Today"):a("date")(t.voucher.startingDate,s.tr("MMM dd, yyyy"))},t.voucherExpires=function(){return t.voucher?a("date")(t.voucher.expireDate,s.tr("MMM dd, yyyy")):null},t.voucherRedemptionStartDate=function(){return t.voucher&&t.voucher.redemptionStartDate?t.voucher.redemptionStartDate:null},t.voucherRedemptionEndDate=function(){return t.voucher&&t.voucher.redemptionEndDate?t.voucher.redemptionEndDate:null},t.voucherRedemptionAllowed=function(){return t.voucher&&t.voucher.redemptionAllowed?t.voucher.redemptionAllowed:null},r.subscribe(EVENT_VIEW_ACTIVATED,function(e,n){"redemption"===n.name&&t.softReset()})}]}}]),module.directive("redeemCodeInput",["redemptionService","eventService",function(e,t){return{restrict:"A",require:"^redemptionComponent",templateUrl:"/widget/checkout/component/partials/redeem-code-input.html",controller:["$scope",function(n){n.errors=[],n.form=e.form,n.$watch(function(){return e.errors},function(e){n.errors=e.filter(function(e){return"redeemCode"===e.field})}),n.redeemCodeIsInvalid=function(){return!!n.errors.length},n.redeemCodeErrorMessage=function(){return n.errors.map(function(e){return e.msg}).join("\n")},n.applyCode=function(){e.resetErrors(),e.applyCode().then(function(){t.checkoutStateChange("redemptionCodeApplied")})}}]}}]);var giftModule=angular.module("giftModule",["checkoutModule","tp.ui.datepicker","tp.i18n","datesModule"]),NOW_SEND_TYPE="now";giftModule.factory("giftService",["tpHTTP","$rootScope","$q","$window","checkout","userService","lang","dateUtils",function(e,t,n,r,o,i,a,c){var s={errors:[],form:{}};return s.resetForm=function(){angular.extend(s.form,{sendType:NOW_SEND_TYPE,sendTime:new Date,recipientName:null,recipientEmail:null,message:null,getRecipientName:function(){return s.form.recipientName?s.form.recipientName:s.form.recipientEmail}})},s.saveGiftParams=function(){var t={recipientName:s.form.recipientName,recipientEmail:s.form.recipientEmail,message:s.form.message,sendTime:s.form.sendTime},u=c.unixTime(c.startOfDay(Date.now()));if(s.form.sendType===NOW_SEND_TYPE?t.sendTime=u:t.sendTime=c.unixTime(t.sendTime),!t.sendTime||t.sendTime<u)return s.errors=[{key:null,field:null,msg:a.trc("checkout.platform","Send time may not be in past")}],n.reject();var l=i.getConfig(),d=l&&l.user&&l.user.uid||null,p=o.getSelectedTerm();return angular.extend(t,{aid:o.getAid(),oid:o.input.oid,uid:d,termId:p.termId}),e.promiseResponse(e.post(r.TPParam.SAVE_GIFT_PARAMS,t),s)},s.resetForm(),s}]),giftModule.directive("giftFormComponent",["viewService","lang",function(e,t){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/gift-form-component.html",link:function(e,t,n,r){r.registerComponentController(e),e.extendScope=function(){r.extendScope(e)},e.extendScope()},controller:["$scope","giftService","checkout","ngEventService","errorService","containerService","checkoutGoTo","purchaseService",function(t,n,r,o,i,a,c,s){angular.extend(t,BaseComponentController),o.subscribe(EVENT_CHECKOUT_RELOADED,function(){t.extendScope()}),o.subscribe(EVENT_VIEW_ACTIVATED,function(e,t){"giftParams"===t.name&&n.resetForm()}),t.cancel=function(){a.isOpenedFromInlineCheckout?r.close():(r.input.giftParamsFormFilled=!1,e.gotoPreviousState())},t.save=function(){i(r.$rootScope).reset(),n.saveGiftParams().then(function(){r.input.giftParamsFormFilled=!0,c.gotoNextState(r,s,!1,!0)}).catch(function(){n.errors&&n.errors.length&&(angular.forEach(n.errors,function(e){e.message=e.msg}),i(r.$rootScope).globals(n.errors))})}}]}}]),giftModule.directive("giftInputTime",["lang","$filter",function(e,t){return{restrict:"A",require:"^giftFormComponent",templateUrl:"/widget/checkout/component/partials/gift-input-time.html",scope:{},controller:["$scope","giftService","checkout",function(t,n,r){t.form=n.form,t.inputDisabled=function(){return t.form.sendType===NOW_SEND_TYPE},t.dateFormat="MMM d, yyyy",t.datePlaceholder="MMM d, yyyy",e.on(function(){t.form.sendTime=angular.copy(t.form.sendTime)});var o=new Date,i=null,a=r.getSelectedTerm();if(a){var c=a.giftEmailSendStartTime;c&&c>o.getTime()&&(o=new Date(c));var s=a.giftEmailSendEndTime;s&&(i=new Date(s))}t.optionsDatepicker={mainOptions:{instantChanges:!0,closeButton:{title:e.trc("checkout.platform","Cancel"),enable:!0},applyButton:{enable:!1}},calendarOptions:[{calendarUnitTitle:"MMMM yyyy",oneCanvasCalendar:!0,enableOneClickRange:!0,limitDateNotBefore:o,limitDateNotAfter:i}]}}]}}]),giftModule.directive("giftInputName",function(){return{restrict:"A",require:"^giftFormComponent",templateUrl:"/widget/checkout/component/partials/gift-input-name.html",controller:["$scope","giftService",function(e,t){e.form=t.form}]}}),giftModule.directive("giftInputEmail",function(){return{restrict:"A",require:"^giftFormComponent",templateUrl:"/widget/checkout/component/partials/gift-input-email.html",controller:["$scope","giftService",function(e,t){e.form=t.form}]}}),giftModule.directive("giftInputMessage",function(){return{restrict:"A",require:"^giftFormComponent",templateUrl:"/widget/checkout/component/partials/gift-input-message.html",controller:["$scope","giftService",function(e,t){e.form=t.form}]}}),angular.module("sharedSubscriptionModule",["checkoutModule","sharedSubscriptionCommonModule"]).directive("sharedSubscriptionComponent",["checkout","eventService","errorService","ssComponentController","checkoutGoTo",function(e,t,n,r,o){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/shared-subscription-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope",function(i){angular.extend(i,BaseComponentController);var a={aid:e.getAid(),rid:e.getSelectedTerm().resource.rid,sharedAccounts:e.input.sharedAccounts||[],sharedAccountLimit:e.input.sharedAccountCount,termConversionId:e.input.termConversionId,grantAccessUrl:window.TPParam.SHARED_SUBSCRIPTION_GRANT_ACCESS_ACCOUNTS};i.$on("SS_GRANT_ACCESS_SUCCESS",function(n,r){e.input.sharedAccounts=r.accounts,t.postMessage("sharedAccountsSuccessfullyAdded"),o.gotoReceipt(e)}),i.$on("SS_SKIP",function(){o.gotoReceipt(e)}),i.$on("SS_ERROR",function(e,t){n(i).reset(),n(i).global(t.message)}),i.$on("SS_CLEAR_ERROR",function(){n(i).reset()}),r(i,a)}]}}]).directive("sharedSubscriptionFormComponent",["checkout","errorService","ssFormComponentController",function(e,t,n){return{restrict:"A",require:"^sharedSubscriptionComponent",templateUrl:"/widget/checkout/component/partials/shared-subscription-form-component.html",scope:{storage:"="},controller:["$scope",function(t){var r={aid:e.getAid(),validateAccountUrl:window.TPParam.SHARED_SUBSCRIPTION_VALIDATE_ACCOUNT};n(t,r)}]}}]).directive("redeemSharedSubscriptionComponent",["checkout","errorService","ssComponentController","tpHTTP","userService",function(e,t,n,r,o){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/redeem-shared-subscription-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope",function(t){function n(){var n;(n={aid:window.TPParam.config.app.aid,code:e.params.shared_account_code,email:t.user.email},r.post(window.TPParam.SHARED_ACCOUNT_CODE_VALIDATE,n).then(function(e){return e.data.models})).then(function(n){t.hasNoErrors=!0,t.parentEmail=n.parentEmail,t.childEmail=n.childEmail,t.isRedeemedEmailMatches=n.isRedeemedEmailMatches,e.config.sharedAccountEmail=t.childEmail,t.isUserLoggedIn=e.isUserValid()}).catch(function(e){t.hasNoErrors=!1,t.errorMessage=e.errors[0].msg}).finally(function(){t.loaded=!0})}angular.extend(t,BaseComponentController),t.register=function(){e.register()},t.isUserLoggedIn=!1,t.parentEmail=null,t.childEmail=null,t.isRedeemedEmailMatches=!0,t.loaded=!1,t.hasNoErrors=!0,t.errorMessage="",t.businessUrl=window.TPParam.config.app.businessUrl,t.user=window.TPParam.config.user,t.close=function(){e.close()},o.onLoginSuccess(function(e){t.user=e.user,n()}),n()}]}}]),angular.module("sharedSubscriptionCommonModule",[]).factory("sharedSubscriptionService",["tpHTTP",function(e){return{validateUser:function(t,n){return e.post(t,n).then(function(e){return e.data})},grantAccess:function(t,n){return e.post(t,n).then(function(e){return e.data})},resendEmail:function(t,n){return e.post(t,n).then(function(e){return e.data})}}}]).factory("ssHelpers",function(){return{getCompleteName:function(t){return t.filter(e).join(" ")}};function e(e){return null!=e&&""!==e}}).factory("ssComponentController",["sharedSubscriptionService","ssHelpers",function(e,t){return function(t,n){function r(){return t.storage.isFormDirty}t.addUser=function(){t.storage.showForm=!0,t.storage.isFormDirty=!1,t.storage.user={}},t.editUser=function(e,n){t.storage.showForm=!0,t.storage.isFormDirty=!0,t.storage.user=e,t.storage.editableUserIndex=n},t.deleteUser=function(e){t.storage.sharedAccountsLimit++,t.storage.editableUserIndex=-1,t.storage.sharedAccountsDifference>=0&&t.storage.sharedAccountsDifference--;!function(e,t){for(var n=0,r=e.length;n<r;n++){var o=e[n];if(t(o)){e.splice(n,1);break}}}(t.storage.users,function(t){return t.email===e.email})},t.resendEmail=function(r){t.isResendEmailInProcess=!0;var o={aid:n.aid,sub_id:n.sub_id,account:r};e.resendEmail(n.resendEmailUrl,o).then(function(){t.$emit("SS_RESEND_EMAIL_SUCCESS")}).catch(function(e){t.$emit("SS_RESEND_EMAIL_FAIL",e)}).finally(function(){t.isResendEmailInProcess=!1})},t.next=function(){if(!c()&&!r()&&(t.isNextButtonDisabled||t.storage.sharedAccountsDifference>0&&!1===t.isReadonly))return;if((c()||!c()&&r())&&(r()||s()||t.isNextButtonDisabled||t.storage.sharedAccountsDifference>0&&!1===t.isReadonly))return;t.isNextButtonDisabled=!0,t.$broadcast("SS_CLEAR_ERROR");var o={aid:n.aid,accounts:t.isReadonly?[]:t.storage.users,sub_id:n.sub_id,term_change_option_id:n.term_change_option_id,termConversionId:n.termConversionId,user_address_id:n.user_address_id};o=Object.assign({},o,n.additionalParams),e.grantAccess(n.grantAccessUrl,o).then(function(){var e=o&&o.accounts||[];t.$broadcast("SS_GRANT_ACCESS_SUCCESS",{accounts:e})}).catch(function(e){t.$broadcast("SS_ERROR",{message:e.errors[0].msg})}).finally(function(){t.isNextButtonDisabled=!1})},t.skip=function(){t.$emit("SS_SKIP")},t.user=n.user||{},t.isEditingFormShown=s,t.isUsersExists=c,t.canAddUser=function(){return c()&&!s()&&0!==t.storage.sharedAccountsLimit&&t.storage.sharedAccountsDifference<=0},t.isEditingUser=function(){return void 0!==t.storage.user.email},t.isFormDirty=r,t.isResendEmailInProcess=!1,t.isNextButtonDisabled=!1,t.isReadonly=!!n.isReadonly;var o=angular.copy(n.sharedAccounts)||[],i=angular.copy(n.sharedAccountLimit)-o.length,a=0;function c(){return t.storage.users.length>0}function s(){return!0===t.storage.showForm}i<0&&(a=-i),o=o.map(function(e){return e.completeName=e.personalName,e}),t.storage={user:{},users:o,showForm:0===o.length,isFormDirty:!1,editableUserIndex:-1,sharedAccountsLimit:i,sharedAccountsDifference:a,rid:n.rid}}}]).factory("ssFormComponentController",["sharedSubscriptionService","lang","ssHelpers","LangUtils",function(e,t,n,r){return function(n,o){var i={},a={email:n.storage.user.email,firstName:n.storage.user.firstName,lastName:n.storage.user.lastName,personalName:n.storage.user.personalName},c={ENTER:13,ESCAPE:27};function s(){n.user={},n.storage.user={},n.storage.showForm=!1,n.storage.isFormDirty=!1,n.storage.editableUserIndex=-1}function u(){var c=n.user,u=n.storage.users;i={aid:o.aid,email:c.email,rid:n.storage.rid},function(e,t){for(var n=0,r=e.length;n<r;n++){var o=e[n];if(o.email===t.email)return!0}return!1}(u,{email:n.user.email})&&void 0===a.email?n.$emit("SS_ERROR",{message:t.tr("You have an identical email in the list")}):e.validateUser(o.validateAccountUrl,i).then(function(e){c.userId=e.models.account.userId,e.models.account.firstName&&(c.firstName=e.models.account.firstName),e.models.account.lastName&&(c.lastName=e.models.account.lastName),e.models.account.personalName?c.personalName=e.models.account.personalName:c.personalName=r.getPersonalName(t,c.firstName,c.lastName),c.completeName=c.personalName,n.$emit("SS_CLEAR_ERROR"),function(e,t){var r=function(e,t){for(var n=0,r=e.length;n<r;n++){var o=e[n];if(t(o))return n}return-1}(e,function(e){return e.email===a.email});r<0?(e.push(t),n.storage.sharedAccountsLimit--):e[r]=t}(u,c),s()}).catch(function(e){n.$emit("SS_ERROR",{message:e.errors[0].msg})})}n.user=Object.assign({},a),n.validateUser=u,n.cancelEditingUser=s,n.checkIsFormValid=function(){var e=!1;["email","firstName","lastName"].forEach(function(t){n.manageSharedUserForm[t].$viewValue&&(e=!0)}),n.storage.isFormDirty=e},n.onKeyDown=function(e){e.keyCode===c.ENTER&&u();e.keyCode===c.ESCAPE&&s()}}}]),angular.module("continueThreeDSPurchaseModule",["checkoutModule"]).directive("continueThreeDSPurchaseComponent",["$timeout","checkout","errorService","iframeService",function(e,t,n,r){return{restrict:"A",require:"^view",template:'<div class="continue-three-ds-purchase-component"></div>',scope:{},controller:["$scope",function(n){t.completePaymentThreeDS(),e(function(){r.injectHiddenIframe("skipPurchaseUrlFrame",t.params.rurl_3ds)},1e3)}]}}]),angular.module("tpConfirmModule",[]).directive("tpDropConfirm",["$document","$http","$templateCache","$window","$compile",function(e,t,n,r,o){var i;function a(t){t.target!==i&&t.target.offsetParent!==i&&(t&&(t.preventDefault(),t.stopPropagation()),$("#tp-drop-confirm").remove(),$(".button-with-confirm").removeClass("second-step"),e.off("click",a))}return{restrict:"A",scope:{confirmMessage:"@",confirmYes:"@?",confirmNo:"@?",confirm:"&",reject:"&?",confirmDisabled:"=?",confirmHeight:"=",cssClass:"@?"},link:function(t,n){var c,s,u,l,d,p,f,m,h,g=0,v=0,y=0,C=10,E=angular.element(r);function S(){d&&(_(),w())}function T(){p.append(d),e.off("click",a),e.on("click",a),n.addClass("second-step")}function _(){y=0,m="center",h="bottom",c=d.outerWidth(!0),s=d.outerHeight(!0),u=n.outerWidth(!1),l=n.outerHeight(!0),c>u&&(y-=parseInt((c-u)/2,10)),c<=u&&(y=parseInt((u-c)/2,10)),(g=parseInt(n[0].getBoundingClientRect().left+f.scrollLeft()+y,10))<0&&(g-=y,m="left"),g+c>E.width()&&(g+=y,m="right");var e=f.scrollTop();e>(v=parseInt(n[0].getBoundingClientRect().top+e,10))-s-C?(v+=l+C,h="top"):(v-=s+C,h="bottom")}function w(){d.css("left",g),d.css("top",v),d.css("opacity",1),d.removeClass("triangle-center-top triangle-center-bottom triangle-left-top triangle-left-bottom triangle-right-top triangle-right-bottom"),d.addClass("triangle-"+m+"-"+h)}E.bind("resize",S),t.close=function(){t.confirm&&t.confirm()},t.$on("$destroy",function(){E.unbind("resize",S)}),n.on("click",function(n){var r=$("body > .tp-modal"),c=$("#tp-drop-confirm");if(f=$(document),r.length){var s=$(r[r.length-1]);p=s,f=s}else p=$("body");d=o('<div id="tp-drop-confirm" class="tpdrop confirm-tooltip tooltip {{cssClass}}"><div class="tooltip-arrow"></div><div class="tooltip-inner"><div class="confirm-message">{{confirmMessage}}</div><div class="form-small"><button id="no-button" class="btn btn-uppercased btn-white padded">{{confirmNo || "No"}}</button><button id="yes-button" class="btn btn-uppercased btn-white padded" ng-click="close()">{{confirmYes || "Yes"}}</button></div></div></div>')(t),t.$apply(),i===n.currentTarget?c.is(":visible")?($(".button-with-confirm").removeClass("second-step"),c.remove(),e.off("click",a)):T():($(".button-with-confirm").removeClass("second-step"),c.remove(),T()),_(),w(),i=n.currentTarget})}}}]);var passThrough=angular.module("passThroughModule",["checkoutModule"]);passThrough.directive("passThroughFormComponent",["checkout",function(){return{restrict:"A",require:"^view",transclude:!0,templateUrl:"/widget/checkout/component/partials/pass-through-form-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope",function(e){angular.extend(e,BaseComponentController)}]}}]);var registrationService=angular.module("registrationServiceModule",["ajaxServices","checkoutModule","purchaseServiceDataModule"]);registrationService.factory("registrationService",["$rootScope","purchaseServiceData",function(e,t){var n={purchaseStarting:function(e,t){e.initPurchase()},initiatePurchase:function(e,n,r){var o={oid:e.input.oid,term_id:e.flags.selectedTerm.termId,userToken:e.params.userToken,aid:e.getAid()},i=function(t){t.errors&&t.errors.length>0?r&&r(t.errors):n&&(n(e),e.completePayment())};t.initiatePurchase(o,e).then(function(e){i(e)},function(e){i(e)})},processPurchase:function(e,n,r){var o={oid:e.input.oid},i=function(e){e.errors&&e.errors.length>0?r&&r(e):n&&n(e.models)};t.processPurchase(o,e).then(function(e){i(e)},function(e){i(e)})},completePurchase:function(e,n,r,o,i){r.oid=n;var a=function(e){e.errors&&e.errors.length>0?i&&i(e.errors):o&&o(e.models)};t.completePurchase(r,e).then(function(e){a(e)},function(e){a(e)})}};return n}]);var swgModule=angular.module("swgModule",["generalModule","tp.i18n"]);swgModule.factory("swgService",["tpHTTP","$q","$window","ngEventService","lang","eventService",function(e,t,n,r,o,i){var a,c={};return r.subscribe("swgCheckoutComplete",function(e,t){a&&a.resolve(t)}),c.isAvailableForTerm=function(e){return e.sku},c.startCheckout=function(e){return a&&a.reject(),a=t.defer(),i.postMessage("swgCheckoutStart",{sku:e.sku,termId:e.termId}),a.promise},c.getUiConfig=function(){return{name:"swg",class:"swg-button",title:o.trc("checkout.platform","Subscribe with Google")}},c}]);var promocode=angular.module("promocodeModule",["checkoutModule","tp.i18n"]),EVENT_PROMO_CODE_INIT="PROMO_CODE_INIT",EVENT_PROMO_CODE_STATUS_CHANGE="PROMO_CODE_STATUS_CHANGE",EVENT_PROMO_CODE_INPUT_CLICK="EVENT_PROMO_CODE_INPUT_CLICK",EVENT_REAPPLY_PROMO_CODE="EVENT_REAPPLY_PROMO_CODE",EVENT_RESET_PROMO_CODE="EVENT_RESET_PROMO_CODE";promocode.factory("promoCodeService",["tpHTTP","$rootScope","$q","$window","checkout","checkoutUpdatesService","statsService",function(e,t,n,r,o,i,a){return{data:{price:null,verified:!1,resultState:o.input.promoCodeId?"VALIDCODE":null,verifiedPromoCode:{},promoCode:{state:"PROMO_CODE_APPLY",loading:!1,validating:!1,visible:!0,code:""},term:{},isPromoCodeAnon:!1},verify:function(t,i,c,s){return a.getStats().then(function(a){var u=n.defer();return e({method:"post",url:r.TPParam.PROMO_CODE_VERIFY,params:{aid:t,code:i,termId:c,oid:s,zipCode:o.input.zipCode,countryCode:o.getBillingCountryCode(),billingZipCode:o.getBillingZipCode(),residenceCountryCode:o.getResidenceCountryCode(),userToken:o.params.userToken},data:{checkoutStats:a}}).then(function(e){o.mergeStats(e),u.resolve({data:e,ok:!0})}).catch(function(e){u.resolve({data:e,ok:!1})}),u.promise})},revert:function(t,i){return a.getStats().then(function(a){var c=n.defer();return e({method:"post",url:r.TPParam.PROMO_CODE_REVERT,params:{promoCodeId:t,oid:i},data:{checkoutStats:a}}).then(function(e){o.mergeStats(e),c.resolve({data:e,ok:!0})}).catch(function(e){c.resolve({data:e,ok:!1})}),c.promise})},isAnonPromoCode:function(t,i,c){return a.getStats().then(function(a){var s=n.defer();return e({method:"post",url:r.TPParam.PROMO_CODE_IS_ANON,params:{code:t,termId:i,aid:c},data:{checkoutStats:a}}).then(function(e){o.mergeStats(e),s.resolve({data:e,ok:!0})}).catch(function(e){s.resolve({data:e,ok:!1})}),s.promise})},handleZeroPrice:function(e){e&&(o.flags.selectedPaymentMethod={}||o.flags.selectedPaymentMethod,o.flags.selectedPaymentSource={}||o.flags.selectedPaymentSource,o.flags.selectedPaymentMethod.id=ZERO),i.updatePaymentMethods(!0,o)}}}]),promocode.directive("promoCodeComponent",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/promo-code-component.html",scope:{skipValidation:"@",term:"="},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","$element","promoCodeService","checkout","tpHTTP","ngEventService","modalService","errorService","$timeout","shakeService","lang","purchaseService","userService","passwordlessService","$q","checkoutGoTo",function(e,t,n,r,o,i,a,c,s,u,l,d,p,f,m,h){angular.extend(e,BaseComponentController),e.PROMO_CODE_APPLY="PROMO_CODE_APPLY",e.PROMO_CODE_RESULT="PROMO_CODE_RESULT",e.PROMO_CODE_RESULT_STATE={VALIDCODE:"VALIDCODE",INVALIDCODE:"INVALIDCODE",UNLOCKED:"UNLOCKED",ANOTHERTERM:"ANOTHERTERM",ANOTHERESOURCE:"ANOTHERESOURCE"};var g=!1,v=!1,y=function(){v=!1,c(e).reset(),e.price=n.data.price,e.verified=n.data.verified,e.input=r.input,e.promoCode=n.data.promoCode,e.selectedTerm=e.term||r.flags.selectedTerm,(null===e.input.promoCode||n.data.term.termId&&e.selectedTerm.termId!==n.data.term.termId)&&C(),angular.copy(e.selectedTerm,n.data.term),e.resultState=n.data.resultState,e.verifiedPromoCode=n.data.verifiedPromoCode,i.fire(EVENT_PROMO_CODE_INIT),s(function(){t.find(".promo-code-description-enter").show(),t.find(".promo-code-description-error").hide()},0)};function C(){v=!1,r.resetDiscount(),e.promoCode.state=e.PROMO_CODE_APPLY,e.promoCode.loading=!1,e.promoCode.validating=!1,e.promoCode.code="",e.resultState=null,n.data.resultState=null}e.isNeedApplyAfterReload=!1,i.subscribe(EVENT_RESET_PROMO_CODE,function(){v=!1}),e.apply=function(){if(v=!0,!e.input.promoCode)return e.resultState=e.PROMO_CODE_RESULT_STATE.INVALIDCODE,void(r.isSelectedTermLocked()||c(e).component({field:"promocode",message:l.trc("checkout.platform","Promo code is required")}));if(r.isPromoCodeApplyWithoutUserEnabled()){var t=e.term||r.getSelectedTerm();n.isAnonPromoCode(r.input.promoCode,t.termId,r.getAid()).then(function(e){e.ok?e.data.models.isPromoCodeAnon?s():f.loginUser(r).then(s):u()})}else f.loginUser(r).then(s);function s(){if(!r.isPromoCodeApplyWithoutUserEnabled()&&!r.isUserValid()){if(!r.isSelectedTermLocked())return void c(e).global(l.trc("checkout.platform","You should sign in or sign up first"));if(h.gotoAuthState(r,null,function(){e.isNeedApplyAfterReload&&(h.gotoLockedPromoCode(r),e.isNeedApplyAfterReload=!1,e.apply())},!0))return void(e.isNeedApplyAfterReload=!0)}e.selectedTerm=e.term||r.flags.selectedTerm,e.promoCode.validating=!0;var t=e.term||r.getSelectedTerm();(function(e){return r.createOrder(r.params.aid,r.params.offerId,r.params.templateId,r.params.userToken,e.termId).then(function(e){return e.errors&&e.errors.length>0?m.reject(e):e})})(t).then(function(s){r.input.oid=s.models.oid;var p=r.input.oid;g=!1,n.verify(r.getAid(),r.input.promoCode,t.termId,p).then(function(s){r.softResetDiscount().then(function(){if(c(e).reset(),s.ok){o.extractModels(s.data,e),o.extractModels(s.data,n.data),e.promoCode.state=e.PROMO_CODE_RESULT;var p=s.data.models;e.resultState===e.PROMO_CODE_RESULT_STATE.VALIDCODE?function(t,o){r.discountSelectedTerm(t.chargeAmount,t.chargeCurrency,t.chargeDisplayAmount,t.promotionBillingPlan,t.verifiedPromoCode.promoCodeId,o.termId),r.reload(void 0,!0).then(function(){r.sendGoogleAnalyticsEvent({eventAction:"promoApplied",eventLabel:"Promo applied",params:{offerId:r.config.offerId,templateId:r.config.offerTemplateId,templateVariantId:r.config.offerTemplateVariantId,promotionId:t.verifiedPromoCode.promotionId}}),n.handleZeroPrice(e.isZero),i.fire(EVENT_CHECKOUT_PRICE_CHANGED)})}(p,t):e.resultState===e.PROMO_CODE_RESULT_STATE.UNLOCKED?function(t,o){r.discountSelectedTerm(t.chargeAmount,t.chargeCurrency,t.chargeDisplayAmount,t.promotionBillingPlan,t.verifiedPromoCode.promoCodeId,o.termId),r.reload(void 0,!0).then(function(){r.input.validUnlockPromoCode=!0,h.gotoNextState(r,d,!1,!0,!0),r.sendGoogleAnalyticsEvent({eventAction:"promoApplied",eventLabel:"Promo applied",params:{offerId:r.config.offerId,templateId:r.config.offerTemplateId,templateVariantId:r.config.offerTemplateVariantId,promotionId:t.verifiedPromoCode.promotionId}}),n.handleZeroPrice(e.isZero),i.fire(EVENT_CHECKOUT_PRICE_CHANGED)})}(p,t):e.resultState===e.PROMO_CODE_RESULT_STATE.ANOTHERTERM?function(e){var t=e.otherTerms[0],n=e.verifiedPromoCode;a.openDialog({templateUrl:"/widget/checkout/component/partials/promo-code-another-term-dialog.html",controller:["$scope","$modalInstance",function(e,o){e.otherTerm=t,e.verifiedPromoCode=n,e.selectTerm=function(){o.close(),r.checkoutWithNewTerm(t)}}]})}(p):e.resultState===e.PROMO_CODE_RESULT_STATE.ANOTHERESOURCE?function(t){var n=e.otherTerms[0],o=e.otherTermOfferPubId,i=t.verifiedPromoCode;a.openDialog({templateUrl:"/widget/checkout/component/partials/promo-code-another-term-dialog.html",controller:["$scope","$modalInstance",function(e,t){e.otherTerm=n,e.verifiedPromoCode=i,e.selectTerm=function(){t.close(),r.checkoutWithNewTerm(n,o)}}]})}(p):e.resultState===e.PROMO_CODE_RESULT_STATE.INVALIDCODE&&(r.resetDiscount(),r.sendGoogleAnalyticsEvent({eventAction:"promoInvalid",eventLabel:"Promo invalid",params:{offerId:r.config.offerId,templateId:r.config.offerTemplateId,templateVariantId:r.config.offerTemplateVariantId,code:e.input.promoCode}}),r.isSelectedTermLocked()||c(e).component({field:"promocode",message:l.trc("checkout.platform","Your promo code is not valid")}))}else u();e.promoCode.validating=!1})})})}function u(){r.input.promoCode=null,e.promoCode.state=e.PROMO_CODE_APPLY,e.promoCode.loading=!1,e.promoCode.validating=!1,e.promoCode.code="",c(e).global(l.trc("checkout.platform","Can not validate promo code"))}},e.revert=function(){var t=r.input.oid;n.revert(e.verifiedPromoCode.promoCodeId,t).then(function(t){t.ok?C():c(e).global(l.trc("checkout.platform","Can not revert promo code"))})},e.isPromoCodeAvailable=function(){return r.isPromoCodeAvailable(e.term)},e.isPromoCodeValid=function(){return n.data.resultState===e.PROMO_CODE_RESULT_STATE.VALIDCODE},Helper.wrapMethod("isSelectedTermLocked",r,e),i.subscribe(EVENT_CHECKOUT_TERM_SELECTED,function(){y()}),i.subscribe(EVENT_REAPPLY_PROMO_CODE,function(){v&&e.apply()}),e.inputClick=function(){i.fire(EVENT_PROMO_CODE_INPUT_CLICK),t.find(".promo-code-description-enter").show(),t.find(".promo-code-description-error").hide()},e.$watch(function(){return e.resultState===e.PROMO_CODE_RESULT_STATE.INVALIDCODE&&!g},function(){e.resultState!==e.PROMO_CODE_RESULT_STATE.INVALIDCODE||g||(i.fire(EVENT_PROMO_CODE_STATUS_CHANGE),t.find(".promo-code-description-enter").hide(),t.find(".promo-code-description-error").show(),g=!0)}),y()}]}}),promocode.directive("animateLockedPromoCode",function(){return{scope:!1,controller:["$scope","$element","ngEventService","shakeService","$timeout","checkout","lang",function(e,t,n,r,o,i,a){n.subscribe(EVENT_PROMO_CODE_INIT,function(){o(function(){t.find(".promo-code-description-enter").show(),t.find(".promo-code-description-error").hide()},0)}),n.subscribe(EVENT_PROMO_CODE_INPUT_CLICK,function(){o(function(){t.find(".promo-code-description-enter").show(),t.find(".promo-code-description-error").hide(),t.find(".promo-code-apply").html(a.trc("checkout.platform","Apply"))},0)}),n.subscribe(EVENT_PROMO_CODE_STATUS_CHANGE,function(){i.isSelectedTermLocked()&&o(function(){var e=t.find(".promo-code-lock"),n=t.find(".promo-code-description-enter"),o=t.find(".promo-code-description-error");n.show(),o.hide(),n.css({position:"relative"}),o.css({position:"relative"}),r.shake(e),n.animate({top:-15,opacity:0},600,function(){n.hide(),n.animate({top:0,opacity:1},3),o.animate({top:-15,opacity:0},3,function(){o.show(),o.animate({top:0,opacity:1},600,function(){i.resize(),t.find(".promo-code-apply").html(a.trc("checkout.platform","Try again !"))})})})},0)})}]}}),angular.module("paymentProviderModule",[]),angular.module("paymentProviderModule").factory("creditCardUtils",function(){return{ccExpireDateValidate:function(e,t){if(!e||!t)return!1;var n=parseInt(e,10),r=parseInt(t,10);if(n<1||n>12)return!1;if(r<0)return!1;r<100&&(r+=2e3);var o=new Date;o.setDate(1),o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0);var i=new Date;return i.setDate(1),i.setMonth(n-1),i.setYear(r),i.setHours(0),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0),o.getTime()<=i.getTime()},ccLuhnCheck:function(e){if(!e.match(/^\d+$/))return!1;for(var t=e.length,n=1&t,r=0,o=0;o<t;o++){var i=parseInt(e.charAt(o));1&o^n||(i*=2)>9&&(i-=9),r+=i}return r%10==0},detectCardType:function(e){for(var t={shortName:"v",longName:"Visa"},n=[{type:t,rname:"electron",rgxp:/^(4026|417500|4405|4508|4844|4913|4917)\d+$/},{type:{shortName:"card",longName:"Credit card"},rname:"maestro",rgxp:/^(5018|5020|5038|5612|5893|6304|6759|6761|6762|6763|0604|6390)\d+$/},{type:{shortName:"card",longName:"Credit card"},rname:"dankort",rgxp:/^(5019)\d+$/},{type:{shortName:"card",longName:"Credit card"},rname:"interpayment",rgxp:/^(636)\d+$/},{type:{shortName:"card",longName:"Credit card"},rname:"unionpay",rgxp:/^(62|88)\d+$/},{type:t,rname:"visa",rgxp:/^4[0-9]{12}(?:[0-9]{3})?$/},{type:{shortName:"mc",longName:"MasterCard"},rname:"mastercard",rgxp:/^5[1-5][0-9]{2}|(222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)[0-9]{12}$/},{type:{shortName:"amex",longName:"American Express"},rname:"amex",rgxp:/^3[47][0-9]{13}$/},{type:{shortName:"dci",longName:"Diners Club"},rname:"diners",rgxp:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/},{type:{shortName:"d",longName:"Discover"},rname:"discover",rgxp:/^6(?:011|5[0-9]{2})[0-9]{12}$/},{type:{shortName:"card",longName:"Credit card"},rname:"jcb",rgxp:/^(?:2131|1800|35\d{3})\d{11}$/}],r=0;r<n.length;r++){var o=n[r];if(o.rgxp.test(e))return o.type}return{shortName:"card",longName:"Credit card"}},getUnknownCardType:e};function e(){return{shortName:"card",longName:"Credit card"}}});var paymentService=angular.module("paymentServiceModule",["ajaxServices","creditCardModule","checkoutModule","purchaseServiceDataModule","payPalBtModule","worldPayModule","worldPayHppModule","spreedlyModule","worldPayTokenModule","edgilPaywayProviderModule","paypalExpressCheckoutProviderModule","eigenProviderModule","applePayBtModule","easypayCheckoutModule","klarnaCheckoutModule","obiCheckoutModule","obiPaypalCheckoutModule","datatransCheckoutModule","datatransPostfinanceCheckoutModule","openpayCashModule","providersModuleCH"]);paymentService.factory("paymentService",["$rootScope","$window","$location","$rootElement","creditCard","payPal","dwolla","amazonmws","coinbase","mock","zero","errorService","purchaseServiceData","payPalBt","$q","lang","worldPayRxml","worldPayHpp","spreedly","worldPayToken","edgilPaywayProvider","paypalExpressCheckoutProvider","eigenProvider","applePayBt","klarnaProvider","openpayCashProvider","easypayMultibancoProvider","easypayMbwayProvider","easypayDirectDebitProvider","easypayBoletoProvider","obiProvider","obiPaypalProvider","datatransProvider","datatransPostfinanceProvider","providersServiceCH","checkoutUpdatesService",function(e,t,n,r,o,i,a,c,s,u,l,d,p,f,m,h,g,v,y,C,E,S,T,_,w,b,P,A,$,I,k,N,x,D,M,O){var R={},L={beforeInitiate:function(e){},initiateSucceed:function(e){},initiateFailed:function(e){},beforeProcess:function(e){},processSucceed:function(e){},processFailed:function(e){},confirmed:function(e){},declined:function(e){},completeSucceed:function(e){},completeFailed:function(e){},checkConsents:function(e){},beforeCallReturnAction:function(e){}};function V(e){var t={};for(var n in t.oid=e.input.oid,t.aid=e.params.aid,t.userToken=e.params.userToken,t.autoRenew=e.input.autoRenew,t.chargeDisplayAmount=e.input.chargeDisplayAmount,t.chargeAmount=e.input.chargeAmount,t.chargeCurrency=e.input.chargeCurrency,t.originalChargeAmount=e.input.originalChargeAmount,t.originalChargeCurrency=e.input.originalChargeCurrency,t.originalChargeDisplayAmount=e.input.originalChargeDisplayAmount,t.isTermLockedByPromocode=e.input.isTermLockedByPromocode,t.user_data=e.input.user_data,t.first_name=e.input.first_name,t.last_name=e.input.last_name,t.termId=e.input.termId,t.offerId=e.input.offerId,t.zipCode=e.input.zipCode,t.billingPlan=e.input.billingPlan,t.taxAmount=e.input.taxAmount,t.total=e.input.total,t.credit_card=e.input.credit_card,t.consents=e.input.consents,t.promoCode=e.input.promoCode,t.storeInVault=e.input.storeInVault,t.deviceSessionId=e.input.deviceSessionId,t.spreedlyPayULatamLanguage=e.input.spreedlyPayULatamLanguage,t){var r=t[n];null!=r&&""!==r||delete t[n]}return t}R.purchaseStarting=function(e,t){O.updatePaymentMethods(!0,e)},R.initiatePurchase=function(e,t,n){var r=e.isMockUsed()?MOCK:e.flags.selectedPaymentMethod.id;if(void 0===r)throw new Error("Provider has to be selected");R.setProvider(r);var o=V(e);o.oid=e.input.oid,void 0===e.input.storeInVault&&(e.input.storeInVault=!0),o.store_in_vault=e.input.storeInVault,o.term_id=e.flags.selectedTerm.termId,o.pm_type=r,L.beforeInitiate&&L.beforeInitiate(o),U(e,o,function(r){r.errors&&r.errors.length>0?(util.log("[PAYMENT SERVICE] Initiate error",r.errors),L.initiateFailed&&L.initiateFailed(r.errors),n&&n(r.errors)):(L.initiateSucceed&&L.initiateSucceed(r.models),t&&t(e))})},R.confirmPayment=function(t,n,r){if(!t)throw new Error("checkout is required");if(!L)throw new Error("provider has to be set first");var o;d(e).reset(),L.beforeConfirm&&(o=L.beforeConfirm(t));var i={};i.userToken=t.params.userToken,i.userProvider=t.params.userProvider,i.userRef=t.params.userRef,i.janrainCaptureToken=t.params.janrainCaptureToken,i.oid=t.input.oid,i.aid=t.getAid(),i.termId=t.getSelectedTerm().termId,i.zipCode=t.input.zipCode,i.countryCode=t.getBillingCountryCode(),i.billingZipCode=t.getBillingZipCode(),i.residenceCountryCode=t.getResidenceCountryCode(),i.upiId=t.getUpiId(),o&&angular.forEach(o,function(e){i[e]=t.input[e]}),B(t,i,function(e){e.errors&&e.errors.length>0?r&&r(e):n&&n(e)})},R.setListenerForResponse=function(e,t){return q(function(t){util.log("[PAYMENT SERVICE] Confirmed",t),L.confirmed&&L.confirmed(t),e&&e(t)},function(n,r){if((util.log("[PAYMENT SERVICE] Declined",n),L.declined)&&L.declined(n,r))return void R.setListenerForResponse(e,t);t&&t(n)})},R.processPurchase=function(t,n,r){if(!t)throw new Error("checkout is required");if(!L)throw new Error("provider has to be set first");function o(o){var i=V(t);i.oid=t.input.oid,i.auto_renew=t.input.autoRenew,i.zip_code=t.input.zipCode,i.store_in_vault=t.input.storeInVault,i.defaultPaymentMethodId=t.input.defaultPaymentMethodId,i.consents=t.input.consents,i.upi_id=t.getUpiId(),i.paymentMethodNonce=t.input.paymentMethodNonce,i.areTaxesCalculated=t.input.areTaxesCalculated,t.getBillingCountryCode()&&(i.country_code=t.getBillingCountryCode()),t.getBillingZipCode()&&(i.billing_zip_code=t.getBillingZipCode()),t.getResidenceCountryCode()&&(i.residence_country_code=t.getResidenceCountryCode()),o&&angular.forEach(o,function(e){i[e]=t.input[e]}),F(t,i,function(o){if(o.errorCode)d(e).global(t.SYSTEM_ERROR_CODES[o.errorCode]);else if(o.errors&&o.errors.length>0)util.log("[PAYMENT SERVICE] Process error",o.errors),L.processFailed&&L.processFailed(o.errors),o&&o.errors&&o.errors.length>0&&o.errors[0].msg?r?r(o):d(e).global(h.trc("service.error.codes",o.errors[0].msg)):(r&&r(),d().terminal(h.tr("Confirmation order failed")));else{if(util.log("[PAYMENT SERVICE] Process succeed",o.models),!L.processSucceed)throw new Error("processSucceed should be implemented");var i=R.setListenerForResponse(n,r),a=L.processSucceed(o.models);a&&a.catch(function(){i(),r&&r()})}})}d(e).reset(),L.beforeProcess?m.when(L.beforeProcess(t)).then(function(e){o(e)}).catch(function(e){r(e)}):o()},R.completePurchase=function(e,t,n,r,o){if(!n.q)throw new Error("You should pass the 'q' parameter that you've obtained on the confirmation step");n.oid=t,H(e,n,function(t){if(t.errorCode)d().terminal(e.SYSTEM_ERROR_CODES[t.errorCode]);else if(t.errors&&t.errors.length>0){if(e.params.rurl_3ds&&window.TPParam.FULL_REDIRECT_3DS_ENABLED)return void d().terminal(t.errors[0].message||t.errors[0].msg);util.log("[PAYMENT SERVICE] Complete error",t.errors),L.completeFailed&&L.completeFailed(t.errors),o&&o(t)}else util.log("[PAYMENT SERVICE] Complete succeed",t.models),L.completeSucceed?m.when(L.completeSucceed(t.models)).then(function(){r&&r(t.models)}).catch(function(e){o(e)}):r&&r(t.models)})},R.checkConsentsFunction=function(){return L.checkConsents},R.lock=null,R.getLock=function(){return(null===R.lock||(new Date).getTime()-R.lock>1e4)&&(R.lock=(new Date).getTime(),R.lock)},R.clearLock=function(){R.lock=null},R.beforeCallReturnAction=function(e){L.beforeCallReturnAction&&L.beforeCallReturnAction(e)},R.setProvider=function(e){if(e,e!==EDGIL_PAYWAY&&M.checkProviderInstanceById(e))return L=M.getProviderInstanceById(e),void util.log("[PAYMENT SERVICE] Set the provider",e,L);switch(e){case CREDIT_CARD:L=o;break;case PAYPAL:L=i;break;case DWOLLA:L=a;break;case AMAZON:L=c;break;case COINBASE:L=s;break;case MOCK:L=u;break;case ZERO:L=l;break;case PAYPAL_BT:L=f;break;case APPLE_PAY_BT:L=_;break;case WORLDPAY_HPP:L=v;break;case WORLDPAY_PAYPAL:case WORLDPAY_IDEAL:case WORLDPAY_ELV:L=g;break;case WORLDPAY_CC_TOKEN:L=C;break;case SPREEDLY_CC:case SPREEDLY_STRIPE_CC:case SPREEDLY_BEANSTREAM:case SPREEDLY_PAYU_LATAM:case SPREEDLY_OPENPAY:L=y;break;case EDGIL_PAYWAY:L=E;break;case EIGEN:L=T;break;case PAYPAL_EXPRESS_CHECKOUT:L=S;break;case OPENPAY_CASH:L=b;break;case EASYPAY_MULTIBANCO:L=P;break;case EASYPAY_MBWAY:L=A;break;case EASYPAY_DIRECT_DEBIT:L=$;break;case EASYPAY_BOLETO:L=I;break;case KLARNA:L=w;break;case OBI:L=k;break;case OBI_PAYPAL:L=N;break;case DATATRANS:L=x;break;case DATATRANS_POSTFINANCE:L=D;break;default:throw new Error("Provider isn't recognized: "+e)}util.log("[PAYMENT SERVICE] Set the provider",e,L)};var U=function(e,t,n){return p.initiatePurchase(t,e).then(function(e){n(e,t)},function(e){n(e,t)})},F=function(e,t,n){return p.processPurchase(t,e).then(function(e){n(e,t)},function(e){n(e,t)})},B=function(e,t,n){return p.confirmPayment(t,e).then(function(e){n(e,t)},function(e){n(e,t)})},H=function(e,t,n){return p.completePurchase(t,e).then(function(e){n(e,t)},function(e){n(e,t)})},W=function(e,t){d().terminal(e)},q=function(e,t){var n=function(){var e=m.defer(),t=function(t){try{var r=JSON.parse(t.data)}catch(e){return}void 0!==r&&r.event&&"string"==typeof r.event&&0===r.event.indexOf("payment-")&&(e.resolve(r),n())};return window.addEventListener("message",t,!1),{promise:e.promise,remove:n};function n(){window.removeEventListener("message",t)}}();return n.promise.then(function(n){try{"payment-complete"===n.event?(e(n.params),R.clearLock()):"payment-error"===n.event&&(t(n.error,n.params),R.clearLock())}catch(e){let t;t=n.error&&n.error.message?n.error.message:"Error occurred",W(t),R.clearLock()}},function(e){W("Error occurred"),R.clearLock()}),n.remove};return R}]);var propagatePaymentVars=function(e,t){Helper.wrapMethod("isPaymentMethod",e,t),Helper.wrapMethod("isMockUsed",e,t),Helper.wrapMethod("isPreviewMod",e,t),Helper.wrapMethod("isPaymentMethodSelected",e,t),Helper.wrapMethod("isSupportedWorldpayCcMethod",e,t),Helper.wrapMethod("isSupportedSpreedlyCcMethod",e,t),angular.extend(t,window.PP_LIST),t.input=e.input,t.isSubscription=function(){return e.getSelectedTerm().isSubscription},t.isConfirmStepEnabled=e.isConfirmStepEnabled,t.isSelectedTermAutoRenewChoiceAvailable=e.isSelectedTermAutoRenewChoiceAvailable,t.setAsDefaultPaymentMethod=function(n){var r={upiId:n.id,aid:e.getAid(),userToken:e.params.userToken};e.setAsDefaultPaymentMethod(r).then(function(e){e.updated>0&&(e.failed>0?t.cc.defaultPaymentMethodId=null:t.cc.defaultPaymentMethodId=r.upiId)})}},createPaymentPopUp=function(e,t,n,r){n=n||"payment provider",e=e&&e>0?e:800,t=t&&t>0?t:600;var o=r?r.trc("checkout.platform","Redirecting to <strong>{0}</strong>...",n):"Redirecting to <strong>"+n+"</strong>...";if(window.providerPopup)try{window.providerPopup.close()}catch(e){}return window.providerPopup=window.open("","payment_popup","scrollbars=1,popup=true,width="+e+",height="+t,!0),window.providerPopup.document.write("<html><body><STYLE type='text/css'>body {margin: 0}</STYLE><div style='font-family: Arial; background: #f5f5f5; height:100px; width: 100%; text-align: center;'><div style='display: inline-block;line-height: 100px;width: 50px;vertical-align:middle'><img alt='' src='data:image/gif;base64,R0lGODlhFgAWAIQAALS2tNze3MzKzPTy9MTCxOzq7NTW1Pz6/Ly+vOTm5NTS1Ly6vOTi5MzOzPT29MTGxOzu7Nza3Pz+/PX19QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQJAgATACwAAAAAFgAWAAAFkeAkjg6jPIgiScfovsxDIMsCrGv7ioMhyAjaDbdyvHqNH+HRUEyIOOMooEg2GFLR4QAdFQwGhWGw0xJbpYiaXDbjJoOAHNJ2cXOQBCNRdzmIAwUJbH0iRBAFEISFgAMDWYw4Bw5/hSNQb5Z3OZKakn9RfaArbkVtmyyXZy8OqBJ2mCyupn6xsTo7s6t9W5i4LiEAIfkECQIAEwAsAAAAABYAFgAABZDgJI5TESnPIygM6Y6F0qQPgiyAdLyiExgygYBgwzEkEseLEQE2GoamYIFAIpWwQCASKQxIjoMVORokEowWb+IY7xyQwhm7FlsnB4h+7bLrDg4DX3wjbW5hhCRjVjuJIotIjY6QZI4TlBKWB36cjpyGV4SgmXhjdH1uI4uSPX6VIq6MsaFgmJCsJLOphJu3PCEAIfkECQIAEwAsAAAAABYAFgAABY/gJI4OxARKo0SJM77vEERGKjwPQQQuPJWnmU1AQCAWgh5pkEgwIpHAyVA8AiRKEQRSSAxgMqtEMjo4BgNI9gU5jCWHH9wV95HeZPe4bi+/9WN9MA54eIIwhXuHL4lwiyONZI8TkZMHgJiPmIRva4OGE4BYfaJ8hXwiDqKSIqt7rqMvnJF4qC+wf4uXibYiIQAh+QQJAgATACwAAAAAFgAWAAAFluAkjs4EJUwQMNDovs6AMpGhNDjzksdQFIlA7SYQPBQtl0PicEB+v6Di8SAgBAOXRHI4TEquAaOKWAjAh+0WvBtYF4vAV83duSALAEAySW+9dncLBFx0gTBqfluHL3SJjFqOdZAikouUE5Z8lF2Jj5CKB0tqbHajl4pMgamAmXStIg6pmyKzf7aqSpqSsC64n4edjr0iIQAh+QQJAgATACwAAAAAFgAWAAAFmOAkjs7hOEVaQGPrHpIzQEUSBFFUuKTkH4NBIsGIGAyKyMDl8P1Os0IA2WgoliPnj1lQCAQPwwjmPPBEkMbjQWBMmuXzCCJAEB4TssQsHwUQCAsJWn0tA4ELCoSFIwIAAAZxjCIHCwtafJNai5qbPpN5eqKTonA+DoWmEpRaqGd6e1mYTLCrY557tadMuLiZL71bhQe6vyMhACH5BAkCABMALAAAAAAWABYAAAWU4CSOziGdhzOurGie0jENRVJArejAsAzVjECiteOhVLVAIBJQjYyylWOwNCgCoxcqN4soFI3CpLjlzhoNgWKijZonCcFDkOC9R4PHgxCx30UKBAgNPX8iBggED4WGBgsLizCGEwoAkH53OwAAA21/bWQSTlxaEi48oywHniJQLCVGK6U9syepY0a5jC21PG6ktb8jIQAh+QQJAgATACwAAAAAFgAWAAAFk+Akjs4hnegxrqyJpkfJkm8dD9DgsE6dSgdcIVFg2XgHSILBSIxcJ9Vs4igEAhEI9SWdirCRyATa9U4KBoUC8jKzFI0Go+0eReKGVH0UEDwUensTEQ8PDXR7DQQEhyiCAwgIBApkexELmAk9KDtmBxEACwQDYy+dMwcmAAAMI0crJTUrUFy0nDw+uUBetq+evWUjIQAh+QQJAgATACwAAAAAFgAWAAAFk+Akjs4hnegxrqyJvqfKig5sow5b2+57HLkRTDb6SQ4DyKp3nNEcyUJuF3OSIIVEYdIjWieDBIMxeH1XDkYgUDCfR4lIhJF6jwoGQ6BunyQUChFudhECDYIofQMCDwIBXXYBD41SL0FWEASaAiJMlywDBAijCUI+OgcMAAsIDZdMKT0Fqw8DOjcwabZOsENvRr4zIQAh+QQJAgATACwAAAAAFgAWAAAFkuAkjs4hnegxrqyJvqfKig5sow5b266djzDZ6NA7DV9CXUq1i81WtYMj10s+J4eBtim56gaQAtfLGiQKkBR5BUkwCuq1CBIIwFFyESMSSbzyEwYGfVVyCQqIEFw/VxACAg0GIkWMZY+PBUBIlQMBBAgED5JHPCYEC6AEDQNKNxIAC6irV0UoCwAIDKxeREEFuyshACH5BAkCABMALAAAAAAWABYAAAWT4CSOziGd6DGurIm+p8qKDmyjDlvbrp2PMNno0DsNX0IdcrKLzVZNyaSXfE5TL2sLi9KyJESqd3UYQMRjGgQyyaYng0Ji4B47GIw52gsJMAIDUT9WAxGGDCJFgywDBgoGBmwiQYwMDZcKiEc2BQoNDwQPAg0Ri0w2AAsICAQCAgammxIOCwCsoQljYRICCAIKczMhACH5BAkCABMALAAAAAAWABYAAAWL4CSOziGd6DGurIm+p8qKDmyjDlvfLpyPsIOM1juNikPdS7WLzVZNyaSXfE5TL2vrJtWueN6vrarlho9C2Hk6yKWdZwikHf1ZHYVEYSAq2nUMDAkJdkEzBRERAQwFK0ULCA0GEQYNCgqTDH8TOwIAkAQEAgKWBgxaQp8IoQ+kBo1hDAoPBA8KEbAsIQAh+QQJAgATACwAAAAAFgAWAAAFjeAkjs4hnegxrqyJvqfKig5sow5b266djzDZ6NA7DV9CHXKyi81WTcmkl3xOUy9r6ybVrm5VLdj7vZGB5jMR6ySvJYfoz5pbi6gQ6wEyGJTQAAsIDANQEAkFBRBJJguBCA8RAQwBkwwMCX4sAwSCBAQPAg0KEZIMEHNQEQSQoaMGkoVeAwkRCqMRCXkzIQAh+QQJAgATACwAAAAAFgAWAAAFj+Akjs4hnegxrqyJvqfKig5sow5b266djzDZ6NA7DV9CHXKyi81WTcmkl3xOUy9r6ybVrm5VLdj7vZGB5jMRS1hA1CkHBLBADLxRUWDBF7yfRUIPCAgEDwk6Kj0rAwSODwIKAQkFlRAQJRI/IxANkAINCgYBDJQQAwebUAENrQYRAZMFEGEsAwUMARGlmE8hACH5BAkCABMALAAAAAAWABYAAAWS4CSOziGd6DGurIm+p8qKDmyjDlvfLpyPMNno0DsNX0IdcrKLzVZNyaSXfE5TL2vrJtWueN5VcYGoal+NBaARBqLS5J+3yCAjGG3qAEEgPAZeUSIBfgIKgE9RMg4KDw8NCgU6RV0iAw2QCgYBBRADB1EScpYRDQYRAQwJnUQpVgURqKoFA58SZjoQBQUJEFOjIyEAIfkECQIAEwAsAAAAABYAFgAABY/gJI7OIZ3oMa6sib6nyooObKMOW9uunY8w2ejQOw1fQh1ysovNVk3JpJd8TlMQwEJqhb4IC0Cky3otzgbyqodoj9Wil4BASMMnLwPhIbhHE3wCCXBUAw0CDQYDZFEiCQ0KCgFdRUIRBgYRDItQRVw0AREBAQkQJZ4nPyMDDKQFBQMlPFYDCa+xQWo/RClPIQAh+QQJAgATACwAAAAAFgAWAAAFkOAkjs4hnegxrqyJvqfKig5sow5b266djzDZ6NA7jQILQGxGe6kGiGThx5wUJ4yFllFd9Q4NBIJA7e5ODQJB0WW9HvBIe/USPASBORClaOD1Ii8BfQaARCgFCgYGEHpfExEGAQxlM1cTBQGTU1VnEkIJDAwJA5UlMCwFCRADVp9FODoDrKc3n521PHMlsEIrIQAh+QQJAgATACwAAAAAFgAWAAAFlOAkjs4hnegxrqyJvqfKihDjwrDDDgQAvLfcaPBALBYTGSkoGQUICARhMBM5gBMiYQupjoKThOBBSHhXt0PkIRDoztaXodGIwFcvhZ5xH8kVBmZ9Ey8MBhGCfS8JAQF8fVcoAwwMCW9waQ4JCQUQl1VgEw6dAw6faGlDAwMmSlZMK6aRKUwnp7M4MK5ouSl3B7W7IiEAIfkECQIAEwAsAAAAABYAFgAABZXgJI5DIZ3oMa6rEyHAgs4qKw4CsizA7DuswYOA0BEOEqRPAhwpHkNCYNBSokYJgeAhgNhE1qRI0RA0qF/wbFJQkAvplfWQMNjjrRkjEkngVzMBgnB/InoJDF6FEzMQBQlohTMlEJF4DjMOAwMONXhzDqFITWmYVxMHVqQsYZ4+niKdPnlLqUtMrLe3sHK6J7w2tq9fIQA7' /></div><div style='display: inline-block; color: #b4b4b4; font-size: 18px;line-height: 100px;vertical-align:middle'>"+o+"</div></div></body></html>"),window.providerPopup},purchaseServiceData=angular.module("purchaseServiceDataModule",["ajaxServices"]);purchaseServiceData.factory("purchaseServiceData",["tpHTTP","statsService","ngEventService","$q","$timeout","$window",function(e,t,n,r,o,i){var a={checkWithLongPolling:function(t,n,r,o,i,c){function s(e){e&&e.models&&"waiting"!==e.models.pollStatus?c(e):o<=i.length?setTimeout(function(){a.checkWithLongPolling(t,n,r,o,i,c)},i[o-1]):c()}o++,e({method:"post",url:t,params:r,data:{checkoutStats:n.stats}}).then(s).catch(s)},initiatePurchase:function(o,c){return t.getStats().then(function(t){var s=r.defer();if(!o.oid)throw new Error("oid is required");if(!o.term_id)throw new Error("term_id is required");return c.disableCheckout(),e({method:"post",url:i.TPParam.INIT_PURCHASE,params:o,data:{checkoutStats:t}}).then(function(e){c.setCustomConfirmationUrl(e.models.confirmation),e.models.pollingEnabled?(o.processId=e.models.processId,a.checkWithLongPolling(i.TPParam.CHECK_PURCHASE,c,o,0,e.models.pollingTimeouts.timeouts,function(e){c.enabledCheckout(),!e||e.errors&&e.errors.length?(n.fire("PURCHASE_FAILED"),s.reject(e)):(c.mergeStats(e),s.resolve(e))})):(c.enabledCheckout(),c.mergeStats(e),s.resolve(e))}).catch(function(e){c.enabledCheckout(),s.reject(e)}),s.promise})},processPurchase:function(o,c){return t.getStats().then(function(t){var s=r.defer();if(o.uid=c.config.user.uid,!o.oid)throw new Error("oid is required");return c.disableCheckout(),e({method:"post",url:i.TPParam.PROCESS_PURCHASE,params:o,data:{checkoutStats:t}}).then(function(e){e.models.pollingEnabled?(o.processId=e.models.processId,a.checkWithLongPolling(i.TPParam.CHECK_PURCHASE,c,o,0,e.models.pollingTimeouts.timeouts,function(e){if(c.enabledCheckout(),void 0===e||e.errors&&e.errors.length)return n.fire("PURCHASE_FAILED"),void s.reject(e||{errorCode:100});c.mergeStats(e),s.resolve(e)})):(c.enabledCheckout(),c.mergeStats(e),s.resolve(e))}).catch(function(e){c.enabledCheckout(),s.reject(e)}),s.promise})},confirmPayment:function(n,o){return t.getStats().then(function(t){var a=r.defer();return e({method:"post",url:i.TPParam.CONFIRMATION,params:n,data:{checkoutStats:t}}).success(function(e){o.mergeStats(e),a.resolve(e)}).error(function(e){a.reject(e)}),a.promise})},completePurchase:function(o,c){return t.getStats().then(function(t){var s=r.defer();if(!o.oid)throw new Error("oid is required");if(!o.q)throw new Error("q is required");return c.disableCheckout(),e({method:"post",url:i.TPParam.COMPLETE_PURCHASE,params:o,data:{checkoutStats:t}}).then(function(e){e.models.pollingEnabled?(o.processId=e.models.processId,a.checkWithLongPolling(i.TPParam.CHECK_COMPLETE,c,o,0,e.models.pollingTimeouts.timeouts,function(e){if(c.enabledCheckout(),void 0===e||e.errors&&e.errors.length)return n.fire("PURCHASE_FAILED"),void s.reject(e||{errorCode:101});c.mergeStats(e),s.resolve(e)})):(c.enabledCheckout(),c.mergeStats(e),s.resolve(e))}).catch(function(e){c.enabledCheckout(),s.reject(e)}),s.promise})}};return a}]);var purchaseService=angular.module("purchaseServiceModule",["paymentServiceModule","termGateServiceModule","registrationServiceModule","purchaseServiceDataModule"]);function spreedlyIntegrationServiceFactory(e,t,n){var r=void 0,o=function(e){r.on("errors",function(t){if(e){var n=[];for(var r in t)n.push({error:r.message});e(n)}})},i=function(e,t,n,o){r.on("ready",function(){r.setFieldType("number","text"),e&&r.setPlaceholder("number",e),t&&r.setStyle("number",t),r.setFieldType("cvv","text"),n&&r.setPlaceholder("cvv",n),o&&r.setStyle("cvv",o)}),r.on("fieldEvent",function(e,t){var n=void 0;"number"===e?n=$("."+r.numberTarget):"cvv"===e&&(n=$("."+r.cvvTarget)),n&&("focus"===t?n.addClass("focus"):"blur"===t&&n.removeClass("focus"))})},a=function(e,t,n){r.init(e,{numberEl:t,cvvEl:n})};return{initForCreating:function(t,c,s,u,l,d,p,f){var m=e.defer();return r&&(r.removeHandlers(),r.isLoaded()&&r.unload(),r=void 0),n.loadJavaScript(TPParam.SPREEDLY_IFRAME_INTERGRATION_URL).then(function(){r=Spreedly,o(f),i(s,u,d,p),a(t,c,l),m.resolve()},function(e){m.reject("Cannot initialise Spreedly: "+e)}),m.promise},initForRecaching:function(t,c,s,u,l,d,p,f,m){var h=e.defer();return r&&(r.removeHandlers(),r.isLoaded()&&r.unload(),r=void 0),n.loadJavaScript(TPParam.SPREEDLY_IFRAME_INTERGRATION_URL).then(function(){r=Spreedly,o(m),i(s,u,d,p),function(e){r.on("ready",function(){r.setRecache(e.token,{card_type:e.type,last_four_digits:e.lastFourDigits})})}(f),a(t,c,l),h.resolve()},function(e){h.reject("Cannot initialise Spreedly: "+e)}),h.promise},validate:function(){var n=e.defer();return r.on("validation",function(e){var r=[];void 0!==e.maskedNumber||e.validNumber||r.push({error:t.trc("default","Invalid card number")}),e.validCvv||r.push({error:t.trc("default","Invalid CVV: it must be 4 digits for American Express or 3 digits for other cards")}),r.length>0?n.reject(r):n.resolve()}),r.validate(),n.promise}}}function utilsServiceFactory(e){return{loadJavaScript:function(t){var n=e.defer(),r=document.createElement("script");r.type="text/javascript",r.src=t,r.async=!1,r.onload=function(){n.resolve(t)},r.onerror=function(){n.reject("Cannot load "+t)};var o=document.getElementsByTagName("script")[0];return o?o.parentNode.insertBefore(r,o):document.head.appendChild(r),n.promise},lastFourDigitsOf:function(e){var t=void 0;return"string"==typeof e&&(t=e.substr(-4)),t},forEach:function(e,t){return angular.isArray(e)?(e.forEach(function(e,n){t(e,n)}),e):angular.isObject(e)?(Object.keys(e).forEach(function(n){t(e[n],n)}),e):e},find:function(e,t){if(angular.isArray(e))return e.find(t)},isIOS:function(){return!!navigator.platform&&/iP(ad|hone|od)/.test(navigator.platform)}}}purchaseService.factory("purchaseService",["$rootScope","$window","$location","$rootElement","paymentService","termGateService","registrationService","purchaseServiceData","errorService","$q","checkoutGoTo",function(e,t,n,r,o,i,a,c,s,u,l){var d={},p=0,f=null;d.createOrder=function(e,t,n,r,c,s){return e.createOrder(e.params.aid,n,r,e.params.userToken,t).then(function(e){if(e.errors&&e.errors.length>0)return s&&s(e.errors),u.reject(e.errors);switch(e.models.sourceTermType){case"payment":case"gift":f=o;break;case"external":f=i;break;case"registration":f=a;break;case"non_checkout":f=null;break;default:throw new Error("term type is not recognized: "+e.models.termType)}return void 0!==c&&c(e),e},function(e){throw void 0!==s&&s(e),e})},d.purchaseStarting=function(e,t){if(!e)throw new Error("Checkout has to be passed a parameter");if(!f)throw new Error("Appropriate strategy should be selected");f.purchaseStarting(e,t)};var m=null;return d.waitInitPurchase=function(){return m?m.promise:u.when(!0)},d.initiatePurchase=function(t,n,r){if(4===p)throw new Error("Purchase is already completed");if(!t)throw new Error("Checkout has to be passed as a second parameter");if(!f)throw new Error("Appropriate strategy should be selected");return m=u.defer(),function(){var e=u.defer();if(!t.access||!t.access.alreadyPurchased)return t.internal.checkAccessAndGotoAlreadyPurchaseScreen().then(function(n){n&&!t.access.canBeRenewed?e.reject(!1):e.resolve()});t.access.canBeRenewed?e.resolve():(t._showSubscriptionHasAlreadyRenewed(),e.reject());return e.promise}().then(function(){return f.initiatePurchase(t,function(){p=1,n&&n(),m.resolve()},function(t){r&&r(t),s(e).global(t[0].msg),m.reject()}),m.promise}).catch(function(){m.reject()})},d.completePurchaseThreeDS=function(e,t,n){if(!e)throw new Error("checkout is required");var r=e.params;if(r.providerId){f=o,p=3,d.setProvider(r.providerId),r.rurl_3ds=atob(decodeURIComponent(r.rurl_3ds)),r.thirdPartyParams=JSON.parse(atob(decodeURIComponent(r.thirdPartyParams)));var i=Object.keys(r.thirdPartyParams).map(function(e){return e+"="+r.thirdPartyParams[e]}).join("&");r.rurl_3ds+=(-1!==r.rurl_3ds.indexOf("?")?"&":"?")+i,o.setListenerForResponse(t,n)}},d.processPurchase=function(e,t,n){if(!e)throw new Error("checkout is required");if(p<1)throw new Error("You should initialize purchase first");if(4===p)throw new Error("Purchase is already completed");if(!f)throw new Error("Appropriate strategy should be selected");d.waitInitPurchase().then(function(){l.gotoAuthState(e,function(){n&&n("User is not valid")})||(f.processPurchase(e,function(e){p=3,t&&t(e)},function(e){n&&n(e)}),p=2)})},d.confirmPayment=function(e){if(!f)throw new Error("Appropriate strategy should be selected");var t=u.defer();return f.confirmPayment(e,function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},d.completePurchase=function(e,t,n,r,o){if(!t)throw new Error("oid is missing");if(!f)throw new Error("Appropriate strategy should be selected");f.completePurchase(e,t,n,function(e){p=4,r&&r(e)},function(e){o&&o(e)})},d.checkConsentsFunction=function(){return f.checkConsentsFunction&&f.checkConsentsFunction()},d.setProvider=function(e){o.setProvider(e)},d}]),angular.module("paymentProviders",["tp.i18n"]),angular.module("paymentProviders").factory("spreedlyIntegrationService",spreedlyIntegrationServiceFactory),angular.module("paymentProviders").factory("utilsService",utilsServiceFactory);var termGateService=angular.module("termGateServiceModule",["ajaxServices","checkoutModule","purchaseServiceDataModule"]);termGateService.factory("termGateService",["$rootScope","purchaseServiceData",function(e,t){var n={purchaseStarting:function(e,t){var n={id:0};e.input.paymentMethods=[n],e.selectPaymentMethod(n)},initiatePurchase:function(e,n,r){var o={oid:e.input.oid,term_id:e.flags.selectedTerm.termId,userToken:e.params.userToken,aid:e.getAid()},i=function(t){t.errors&&t.errors.length>0?r&&r(t.errors):(n&&n(e),e.completePayment())};t.initiatePurchase(o,e).then(function(e){i(e)},function(e){i(e)})},processPurchase:function(e,n,r){var o={oid:e.input.oid},i=function(e){e.errors&&e.errors.length>0?r&&r(e):n&&n(e.models)};t.processPurchase(o,e).then(function(e){i(e)},function(e){i(e)})},completePurchase:function(e,n,r,o,i){r.oid=n;var a=function(e){e.errors&&e.errors.length>0?i&&i(e.errors):o&&o(e.models)};t.completePurchase(r,e).then(function(e){a(e)},function(e){a(e)})}};return n}]);var userAccess=angular.module("alreadyHasAccessModule",["checkoutModule","datesModule"]);userAccess.directive("alreadyHasAccessComponent",["checkout","ngEventService","viewService","dateUtils",function(e,t,n,r){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/already-has-access-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope",function(o){angular.extend(o,BaseComponentController),Helper.wrapMethod("close",e,o);var i=function(e){return e?r.parse(e):null},a=function(){o.user=e.config.user,o.paymentName=e.access.name,o.termConversionId=e.access.termConversionId,o.paymentDetails=e.access.details,o.canBeRenewed=e.access.canBeRenewed,o.canBeRenewedUsingExistedUPI=e.access.canBeRenewedUsingExistedUPI,o.started=i(e.access.startedAt),o.renewsOn=i(e.access.renewsOn),o.expiresOn=i(e.access.expiresOn),o.selectedTerm=e.flags.selectedTerm};t.subscribe(EVENT_USER_ACCESS_CHANGED,function(){a()}),o.startRenewal=function(){e.startRenewal()},o.continue=function(){n.gotoPreviousState()},a(),t.subscribe(EVENT_CHECKOUT_RELOADED,function(){a()})}]}}]),angular.module("confirmationModule",["checkoutModule"]).directive("confirmationComponent",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/confirmation-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e),e.extendScope=function(){r.extendScope(e)},e.extendScope()},controller:["$scope","$element","checkout","ngEventService",function(e,t,n,r){angular.extend(e,BaseComponentController),r.subscribe(EVENT_CHECKOUT_RELOADED,function(){e.extendScope()})}]}}),function(){var e=angular.module("bankSecureModule",["checkoutModule"]);e.directive("bankSecureComponent",["checkout","iframeService","errorService","paymentProvider",function(e,t,n,r){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/bank-secure-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","$element","checkout","ngEventService","eventService","checkoutUpdatesService",function(e,t,n,o,i,a){angular.extend(e,BaseComponentController),e.gotoPreviousState=m;const c="bank-secure-form-component-iframe",s="container-with-buttons",u="bank-secure-loader";var l,d,p=r.getInstance();function f(){angular.element("#"+c).remove(),m()}function m(){document.getElementById(s).style.display="none",p&&p.goBackToPreviousState&&p.goBackToPreviousState(),angular.element("#bank-secure-form-component-iframe").remove(),document.getElementById(u).style.display="block"}o.subscribe("INIT_BANK_SECURE",function(){var e;d=o.subscribe("parentSize",function(e,t){!function(e){if(!l&&e&&"number"==typeof e.width&&"number"==typeof e.height){var t=document.getElementById("bank-secure-container"),r=t.getAttribute("width"),o=t.getAttribute("height");if(isNaN(m(r))&&null!==r)throw"You must specify correct value for width property. Must be a number.";if(isNaN(m(o))&&null!==o)throw"You must specify correct value for height property. Must be a number.";var i,c,s=parseInt(n.getPreferredWidth(),10)||400;if(null!==r)c=m(r);else{var u=e.width-80;c=Math.max(Math.min(1e3,u),s)}if((l=s)!==c&&a.updatePreferredWith(c,n),null!==o)i=m(o);else{var d=e.height-120,p=(document.querySelector("#view-bankSecure .account-popup-header")||{}).offsetHeight||0,f=t.offsetHeight;(i=Math.max(Math.min(d-p,1e3),f-p))<500&&(i=500)}t.style.height=i+"px"}function m(e){return parseInt(e,10)}}(t)}),i.getParentSize(),e=o.subscribe("EVENT_VIEW_ACTIVATED",function(){!function(){if(!l)return;a.updatePreferredWith(l,n),l=null}(),d(),e()}),p&&p.callbackOnInit&&p.callbackOnInit({iframeId:c,loaderWrapperId:u}),i.startThreeDBankSecure()}),o.subscribe("NEW_FLOW_EVENT_DECLINED",f),o.subscribe("NEW_FLOW_EVENT_PROCESS_FAILED",f),o.subscribe("NEW_FLOW_EVENT_COMPLETE_FAILED",f),o.subscribe("NEW_FLOW_EVENT_COMPLETE_SUCCEED",function(){document.getElementById(u).style.display="none"}),o.subscribe("EVENT_CC_DECLINED",function(){m()}),o.subscribe("EVENT_CC_FAILED",function(){m()}),o.fire("BANK_SECURE_COMPONENT_INIT_SUCCESS")}]}}]),e.factory("paymentProvider",function(){var e;return{setInstance:function(t){e=t},getInstance:function(){return e}}})}(),angular.module("paymentProviderModule").factory("passwordlessPaymentService",["viewService","checkout","tpHTTP","passwordlessService","userService","errorService","eventService","$q","ngEventService","checkoutGoTo","lang","billingConfig",function(e,t,n,r,o,i,a,c,s,u,l,d){var p,f,m=!1;function h(e){var t=document.getElementsByClassName("pn-passwordless-offer-boilerplate")[0];t&&(t.style.display=e?"none":"block"),a.postMessage("toggleIframeShadow",{isEnabled:!e}),a.postMessage("toggleLoadingContainer",{isEnabled:e})}function g(){return"state2"===e.getActiveState()}function v(){return t.isPasswordlessCheckoutEnabled()&&!g()}function y(e,t){if(t){if(!Array.isArray(t))return i(e).global(t.message);for(var n=0;n<t.length;n++){var r=t[n].msg||t[n].message;r&&""!==r.trim()&&i(e).global(r)}}}function C(e,n){t.config.isExistPasswordlessUser=!0,o.isPianoIdUserProvider()?(e.models.user.sentLoginEmail&&(t.config.isSentLoginEmail=e.models.user.sentLoginEmail,t.config.preventPasswordlessLogin=t.config.isSentLoginEmail,r.setPaymentEmail(t,p),p="",function(e){e.models.user.sentLoginEmail&&r.saveCheckoutParams(t,e.models.user.loginTokenId)}(e),n.resolve({isPasswordlessEmailSent:!0})),u.gotoAuthState(t,r.updatePianoIdIframe,function(){})):o.isGigyaUserProvider()&&t.login()}return s.subscribe("EVENT_ERRORS_CHANGED",function(){m&&h(!1)}),s.subscribe("EVENT_APPLE_PAY_BEFORE_PROCESS",function(){m=!0,v()&&h(!0)}),{isPaymentState:g,isPasswordlessApplePayUsed:v,displayErrors:y,proceedPasswordlessUser:function(e,i,s){var l,d=c.defer();return r.setPaymentEmail(t),o.isGigyaUserProvider()||o.isPianoIdUserProvider()?(o.onLoginSuccess(d.resolve,!0),(l=i,n({method:"post",url:TPParam.PROCESS_PASSWORDLESS_USER,params:l})).then(function(n){if(t.config.preventPasswordlessLogin=!1,n.errors.length)y(e,n.errors);else{if(n.models.hasAccess)return u.gotoAlreadyHasAccess(t);if(t.isTermRestrictedForNewCustomers(s,n.models.isNewCustomer))return d.reject();n.models.user.userExist?n.models.user.userExist&&(p=i.email,C(n,d)):function(e){o.isPianoIdUserProvider()?o.onExternalLogin({token_list:e.models.user.tokenList,cookie_domain:e.models.user.cookieDomain,user_token:e.models.user.accessToken,user:e.models.user.userModel,params:e.models.user.userModel,registration:!0}):o.isGigyaUserProvider()&&a.gigyaPasswordlessLoginEvent({accessTokenName:e.models.user.accessToken,accessToken:e.models.user.accessToken})}(n)}}).catch(function(t){y(e,t.errors),d.reject()}),d.promise):util.log("[PASSWORDLESS] Unsupported user provider")},completePasswordlessPayment:function(e,n){setTimeout(function(){e&&e(),t.completePayment().catch(function(e){e&&e.errors&&y(n,e.errors)})})},applyTax:function(e,r,o){var i=c.defer();return function(e){d.updateByCountryCode(t,e.countryCode),e.residenceCountryCode=d.needResidence?e.countryCode:null,t.input.zipCode=e.zipCode;var n={billingCountryCode:e.countryCode,residenceCountryCode:e.residenceCountryCode,residenceZipCode:e.zipCode,billingZipCode:e.billingZipCode};d.updateFromTaxRequest(t,n)}(r),n({method:"post",url:TPParam.APPLY_TAX_ACTION,params:{aid:t.getAid(),oid:t.input.oid,countryCode:t.getBillingCountryCode(),zipCode:t.getBillingZipCode(),billingZipCode:t.getBillingZipCode(),residenceCountryCode:t.getResidenceCountryCode()}}).then(function(){!o&&a.postMessage("applyTaxCompleted",r),i.resolve(r)}).catch(function(t){!o&&a.postMessage("applyTaxFailed"),y(e,t.errors),i.reject()}),i.promise},checkSelectedTerm:function(e){var n=0,r=c.defer(),o=setInterval(function(){++n>56?(clearInterval(o),i(e).global(l.trc("checkout.platform","Could not select term, try again")),r.reject()):!1===f?(clearInterval(o),i(e).global(l.trc("checkout.platform","Could not initiate purchase")),r.reject()):f&&t.getSelectedTerm().termId&&(r.resolve(),clearInterval(o))},500);return r.promise},setInitInProgress:function(e){t.flags.isPasswordlessApplePayBeingInitiated=e},setPurchaseInitiated:function(e){f=e},isSingleStepForm:function(){return t.isSingleStepEnabled()&&g()&&!t.isUserValid()}}}]);var eigenMiraSecureModule=angular.module("eigenMiraSecureModule",["paymentProviderModule"]);eigenMiraSecureModule.factory("eigenMiraSecure",["$q","iframeService",function(e,t){var n,r,o=null,i={};return window.addEventListener("message",function(e){if(null===o)return;if(e.origin&&e.origin.toLowerCase()===r)return void function(e){try{var t=JSON.parse(e.data);switch(t.Type){case"FormReady":return Object.getOwnPropertyNames(i).forEach(function(e){c({Type:"FieldSetValue",FieldName:e,Value:i[e]})}),void c({Type:"FormSubmit"});case"FormError":return void o.reject([{msg:"[MiraSecure] FormError"+t.Error}]);case"FormTimeout":o.reject([{msg:"[MiraSecure] FormTimeout"}])}}catch(t){o.reject([{msg:"[MiraSecure] Received message with parsing error: "+e.data}])}}(e);try{var t=JSON.parse(e.data);t&&t.event&&"eigen-mira-secure-tokenization-complete"===t.event&&function(e){switch(e.result){case"success":o.resolve(e.token);break;case"failed":o.reject([{msg:"[Piano] Internal error"}]);break;default:o.reject([{msg:"[Piano] Received unknown message: "+e.result}])}n.cancel(),o=null}(t.params)}catch(e){}}),{tokenize:function(c,s){i=s,r=function(e){var t=e.toLowerCase().split("/");return t[0]+"//"+t[2]}(c),o&&o.reject();return o=e.defer(),n=t.injectHiddenIframeWithTimeout("eigen-provider-mira-secure-iframe",c,15e3,a),o.promise}};function a(){o&&(n=null,o.reject([{msg:"Timeout"}]),o=null)}function c(e){if(n&&n.iframe.contentWindow){var t=JSON.stringify(e);n.iframe.contentWindow.postMessage(t,r)}}}]);var paypalExpressCheckoutProviderModule=angular.module("paypalExpressCheckoutProviderModule",["checkoutModule","tpComponentsModule","paypalExpressCheckout"]),EVENT_PREVIEW_PAYPAL_EXPRESS_CHECKOUT_TERM_COMPLETE="EVENT_PREVIEW_PAYPAL_EXPRESS_CHECKOUT_TERM_COMPLETE",EVENT_PAYPAL_EXPRESS_CHECKOUT_INITIATE_SUCCEED="EVENT_PAYPAL_EXPRESS_CHECKOUT_INITIATE_SUCCEED",EVENT_PAYPAL_EXPRESS_CHECKOUT_BEFORE_PROCESS="EVENT_PAYPAL_EXPRESS_CHECKOUT_BEFORE_PROCESS",EVENT_PAYPAL_EXPRESS_CHECKOUT_PROCESS_SUCCEED="EVENT_PAYPAL_EXPRESS_CHECKOUT_PROCESS_SUCCEED",EVENT_PAYPAL_EXPRESS_CHECKOUT_DECLINED="EVENT_PAYPAL_EXPRESS_CHECKOUT_DECLINED",EVENT_PAYPAL_EXPRESS_CHECKOUT_COMPLETE_FAILED="EVENT_PAYPAL_EXPRESS_CHECKOUT_COMPLETE_FAILED";paypalExpressCheckoutProviderModule.factory("paypalExpressCheckoutProvider",["$rootScope",function(e){var t={beforeInitiate:function(){},initiateSucceed:function(t){e.$broadcast(EVENT_PAYPAL_EXPRESS_CHECKOUT_INITIATE_SUCCEED,t)},initiateFailed:function(e){},beforeProcess:function(){e.$broadcast(EVENT_PAYPAL_EXPRESS_CHECKOUT_BEFORE_PROCESS)},processSucceed:function(t){e.$broadcast(EVENT_PAYPAL_EXPRESS_CHECKOUT_PROCESS_SUCCEED,t)},processFailed:function(e){},confirmed:function(e){},declined:function(t){e.$broadcast(EVENT_PAYPAL_EXPRESS_CHECKOUT_DECLINED,t)},completeSucceed:function(e){},completeFailed:function(t){e.$broadcast(EVENT_PAYPAL_EXPRESS_CHECKOUT_COMPLETE_FAILED,t)}};return t}]),paypalExpressCheckoutProviderModule.directive("paypalExpressCheckoutProviderFormComponent",[function(){return{restrict:"A",require:"^view",transclude:!0,templateUrl:"/widget/checkout/component/partials/paypal-express-checkout-provider-form-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","errorService","ngEventService","checkout","paypalExpressCheckoutService","lang","billingConfig","cookieService",function(e,t,n,r,o,i,a,c){angular.extend(e,BaseComponentController),h()&&(e.paypalFromRedirectLoading=!0);var s=-1,u=function(){e.stored=[],e.data={},e.data.selectedUpi=null,e.data.newUpi=null};function l(){e.stored.length>0&&(e.data.selectedUpi=e.stored[0])}function d(n){if(Array.isArray(n))for(var r=0;r<n.length;r++){var o=n[r].msg||n[r].message;o&&""!==o.trim()&&t(e).global(o)}else t(e).global(n.message)}function p(){e.data.newUpi=null,e.stored.splice(e.stored.length-1,1),e.data.selectedUpi.isNew&&(e.data.selectedUpi=null,l())}function f(){if(e.data.selectedUpi){var t=e.getTaxRequest();e.data.selectedUpi.id&&(r.setUpiId(e.data.selectedUpi.id),r.getUpiId()&&t&&a.updateFromTaxRequest(r,t))}}function m(t){e.data.newUpi={id:void 0,isNew:!0,number:t.email,token:t.token,payerId:t.payerId},e.stored.push(e.data.newUpi),e.data.selectedUpi=e.data.newUpi}function h(){return c.getCookie("paypal-express-checkout-complete")}e._isValid=function(){if(!0!==r.isPreviewMod()){if(t(e).reset(),!r.isPaymentMethod(PAYPAL_EXPRESS_CHECKOUT)||r.isMockUsed())return!0;if(!e.data.selectedUpi)return t(e).global(i.trc("checkout.platform","Please select one of your PayPal accounts or add new one")),!1}return!0},e.$on(EVENT_PREVIEW_PAYPAL_EXPRESS_CHECKOUT_TERM_COMPLETE,function(e,t){r._completeTerm({q:"q"})}),e.$on(EVENT_PAYPAL_EXPRESS_CHECKOUT_INITIATE_SUCCEED,function(t,n){s=r.getSelectedTerm().chargeAmount,e.stored=JSON.parse(n.stored),e.data.newUpi&&e.stored.push(e.data.newUpi),e.data.selectedUpi||l(),e.initUrl=n.init_url,e.storedRurl=n.stored_rurl,e.commonRurl=n.common_rurl,f()}),e.$on(EVENT_PAYPAL_EXPRESS_CHECKOUT_BEFORE_PROCESS,function(t,n){e.data.newUpi&&r.setUpiId(null)}),e.$on(EVENT_PAYPAL_EXPRESS_CHECKOUT_PROCESS_SUCCEED,function(t,n){r.disableCheckout(),o.processPurchase(e.data.selectedUpi,e.storedRurl,e.commonRurl)}),e.$on(EVENT_PAYPAL_EXPRESS_CHECKOUT_DECLINED,function(e,t){r.enabledCheckout()}),e.$on(EVENT_PAYPAL_EXPRESS_CHECKOUT_COMPLETE_FAILED,function(e,t){d(t)}),n.subscribe(EVENT_CHECKOUT_STARTED,function(){u()}),n.subscribe(EVENT_CHECKOUT_PRICE_CHANGED,function(){var t=r.input.chargeAmount;e.data.newUpi&&t!==s&&p(),s=t}),n.subscribe(EVENT_CHECKOUT_RELOADED,function(){var t=r.getSelectedTerm();e.data.newUpi&&t.chargeAmount!==s&&p(),s=t.chargeAmount;var n=h();n&&function(t){m(JSON.parse(t)),c.eraseCookie("paypal-express-checkout-complete"),e.paypalFromRedirectLoading=!1}(n)}),u(),propagatePaymentVars(r,e),e.addNewAccount=function(){var t=e.initUrl;t+="&zipCode="+r.input.zipCode,r.getBillingZipCode()&&(t+="&billingZipCode="+r.getBillingZipCode()),r.getBillingCountryCode()&&(t+="&countryCode="+r.getBillingCountryCode()),r.getResidenceCountryCode()&&(t+="&residenceCountryCode="+r.getResidenceCountryCode());var n={termId:r.flags.selectedTerm.termId,paySource:r.flags.selectedPaymentMethod.id};o.startExpressCheckout(t,n).then(m).catch(function(e){e&&d(e)})},e.$watch("data.selectedUpi ",function(){f()}),e.getTaxRequest=function(){if(e.data.selectedUpi)for(var t=0;t<e.stored.length;t++){var n=e.stored[t];if(n.id===e.data.selectedUpi.id)return a.taxRequestFromUpi(n)}return null},e.cancelNewAccount=p,e.canContinue=function(){return!!e.data.selectedUpi}}]}}]);var paypalExpressCheckoutModule=angular.module("paypalExpressCheckout",["tinypassServices"]);paypalExpressCheckoutModule.factory("paypalExpressCheckoutService",["$rootElement","$q","ngEventService","$window",function(e,t,n,r){var o=null,i=null,a={};return a.startExpressCheckout=function(e,n){return o&&o.reject(),o=t.defer(),i=window.open(function(e,t){t=t||{};var n=r.location!=r.parent.location?document.referrer:document.location.href;return e+"&publisherUrl="+n+"&termId="+t.termId+"&paySource="+t.paySource}(e,n),"payment_popup","scrollbars=1,popup=true,width=980,height=600",!0),o.promise},a.processPurchase=function(t,n,r){!function(t){var n=angular.element('<iframe name="paypal_express_checkout_frame" id="paypal_express_checkout_frame" style="display: none" src="'+t+'"></iframe>');e.append(n)}(t.isNew?r+"&token="+t.token+"&PayerID="+t.payerId:n+"&id="+t.id)},n.subscribe("paypal-express-checkout-complete",function(e,t){if(i&&i.close(),o){switch(t.result){case"return":o.resolve(t);break;case"cancel":o.reject();break;case"failed":o.reject({message:t.error});break;default:o.reject({message:"[PaypalExpressCheckout] Received unknown message: "+t.result})}o=null}}),a}]);var creditCard=angular.module("creditCardModule",["checkoutModule","tp.i18n","braintreeCommonModule"]),EVENT_CC_INITIATED="EVENT_CC_INITIATED",EVENT_CC_PROCESSING="EVENT_CC_PROCESSING",EVENT_CC_PROCESSED="EVENT_CC_PROCESSED",EVENT_CC_FAILED="EVENT_CC_FAILED",EVENT_CC_DECLINED="EVENT_CC_DECLINED",EVENT_CHECKOUT_STARTED="EVENT_CHECKOUT_STARTED";creditCard.factory("creditCard",["$rootScope","errorService","lang","$q",function(e,t,n,r){var o={initiateSucceed:function(t){e.$broadcast(EVENT_CC_INITIATED,t)},initiateFailed:function(e){t().terminal(e&&e[0]&&e[0].msg?e[0].msg+" "+n.trc("checkout.platform","Please contact support to get help."):n.trc("checkout.platform","Unknown error.")+" "+n.trc("checkout.platform","Please contact support to get help."))},beforeProcess:function(){e.$broadcast(EVENT_CC_PROCESSING)},processSucceed:function(t){var n=r.defer();return e.$broadcast(EVENT_CC_PROCESSED,t,n),n.promise},declined:function(t){e.$broadcast(EVENT_CC_DECLINED,t?t.message:n.trc("checkout.platform","Unknown error."))},completeFailed:function(t){e.$broadcast(EVENT_CC_FAILED,t&&t.length>0?t[0].msg:n.trc("checkout.platform","Unknown error."))}};return o}]),creditCard.factory("creditCardService",["tpHTTP","$q","$timeout","$window","checkout","errorService","lang",function(e,t,n,r,o,i,a){var c={payWithNew:!0,selectedUpiId:null,initiated:!1,defaultPaymentMethodId:null},s={store_in_vault:!0};return{cc:c,credit_card:s,processCC:function(e,t,n,r){o.disableCheckout();if(e.cc.payWithNew){var c=n.trData,s=n.trUrl;if(!function(e){if(!e)return!1;return/^(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/.test(e)}(s))return i(e).global(a.trc("checkout.platform","Redirect URL is not valid")),o.enabledCheckout(),void r.reject();angular.element("#bt_post_frame").remove(),angular.element("#bt_form").remove();var u=angular.element('<iframe name="bt_post_frame" id="bt_post_frame" style="display: none"></iframe>'),l=angular.element('<form id="bt_form" method="POST" target="bt_post_frame" action="'+s+'">'),d=[{name:"",btName:"tr_data",value:c},{name:"",btName:"transaction[options][add_billing_address_to_payment_method]",value:!0},{name:"num",btName:"transaction[credit_card][number]",value:""},{name:"expire_month",btName:"transaction[credit_card][expiration_month]",value:""},{name:"expire_year",btName:"transaction[credit_card][expiration_year]",value:""},{name:"cvv",btName:"transaction[credit_card][cvv]",value:""},{name:"store_in_vault",btName:"transaction[options][store_in_vault_on_success]",value:!0},{name:"postal_code",btName:"transaction[billing][postal_code]",value:""},{name:"email",btName:"transaction[customer][email]",value:o.config.user.email},{name:"first_name",btName:"transaction[customer][first_name]",value:o.input.user_data.first_name},{name:"last_name",btName:"transaction[customer][last_name]",value:o.input.user_data.last_name}],p=e.ccForm||{};angular.forEach(d,function(e){void 0!==p[e.name]&&(e.value=p[e.name].$modelValue);var t=angular.element("<input type='hidden'>");t.attr("name",e.btName),t.val(e.value),l.append(t)}),t.append(u),t.append(l),l.submit()}else{angular.element("#bt_form").remove();var f=e.cc.storedRurl+"&id="+e.cc.selectedUpiId,u=angular.element('<iframe name="bt_post_frame" id="bt_post_frame" style="display: none" src="'+f+'"></iframe>');t.append(u)}return angular.element(".checkout").removeClass("not-transparent-loading"),!0}}}]),creditCard.directive("ccFormComponent",["checkout","$rootElement","errorService","creditCardService","lang","braintreeFactory","viewService","$q","paymentProvider","iframeService","ccFieldsService","billingConfig","checkoutGoTo",function(e,t,n,r,o,i,a,c,s,u,l,d,p){return{restrict:"A",require:"^view",transclude:!0,templateUrl:"/widget/checkout/component/partials/cc-form-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","errorService","$timeout","ngEventService",function(n,f,m,h){angular.extend(n,BaseComponentController);var g=null;n.isBraintreeV3=function(){return"V3_3DS2"===g},n.PAYMENT_PROVIDER_ID=CREDIT_CARD;var v,y=!1,C=null,E=!1,S=null,T={};function _(){n.cc=r.cc,n.credit_card=r.credit_card}h.subscribe(EVENT_CHECKOUT_STARTED,function(){_()}),_();function w(e){if(f(n).reset(),Array.isArray(e))for(var t=0;t<e.length;t++){var r=e[t].msg||e[t].message;r&&""!==r.trim()&&f(n).global(r)}else f(n).global(e.message)}function b(t){i.getNonceData(C).then(function(t){var n={amount:e.getSelectedTermChargeAmount(S),nonce:t.nonce,threeDSecure:C.threeDSecureInstance,addFrameCallback:function(t,n){T.callbackOnInit=function(t){e.enabledCheckout(),document.getElementById(t.loaderWrapperId).style.display="none",u.injectRealIframe(t.iframeId,n,angular.element("#bank-secure-container"))},p.goToBankSecureState(e),h.fire("INIT_BANK_SECURE")}};return i.verifyCard(n)}).then(function(r){n.skipValidation=!0,E=!0,e.input.paymentMethodNonce=r.nonce,t.resolve(!0)}).catch(function(e){P(e,t)})}function P(t,n){E=!1,e.enabledCheckout(),w(t),n.reject(t.name)}n.$on(EVENT_CC_FAILED,function(t,r){e.enabledCheckout(),f(n).global(r)}),n.$on(EVENT_CC_DECLINED,function(t,n){e.enabledCheckout()}),n.$on(EVENT_CC_INITIATED,function(t,o){var a;n.cc.defaultPaymentMethodId=o.defaultPaymentMethodId,r.cc.stored=JSON.parse(o.stored),r.cc.storedRurl=o.stored_rurl,r.cc.payWithNew=0===n.cc.stored.length||r.cc.payWithNew&&r.cc.initiated,r.cc.selectedUpiId=r.cc.stored.length>0?r.cc.stored[0].id:null,r.cc.initiated=!0,n.updateUpiInfo(),g=o.version,S=o.authorization_amount,!1===y&&!0===n.isBraintreeV3()&&(angular.element(".checkout").addClass("not-transparent-loading"),o.isEditing=!1,a=o,e.disableCheckout(),i.initHostedFields(a).then(function(t){e.enabledCheckout(),y=!0,C=t}).catch(function(t){w(t),e.enabledCheckout()})),m(function(){n.$apply()})}),n.$on("BANK_SECURE_COMPONENT_INIT_SUCCESS",function(){h.fire("INIT_BANK_SECURE")}),n.$watch("cc.selectedUpiId ",function(){n.updateUpiInfo()}),n.updateUpiInfo=function(){e.input.credit_card=n.getCurrentCreditCardInfo(),e.setUpiId(r.cc.selectedUpiId),e.getUpiId()&&e.input.credit_card.taxRequest&&d.updateFromTaxRequest(e,e.input.credit_card.taxRequest)},n.$watch("credit_card.num ",function(){e.input.credit_card=n.getCurrentCreditCardInfo()}),n.$watch("credit_card.expire_month ",function(){e.input.credit_card=n.getCurrentCreditCardInfo()}),n.$watch("credit_card.expire_year ",function(){e.input.credit_card=n.getCurrentCreditCardInfo()}),n.$on(EVENT_CC_PROCESSED,function(o,a,c){!0===n.isBraintreeV3()?(a.payWithNew=n.cc.payWithNew,a.paymentMethodNonce=e.input.paymentMethodNonce,a.email=e.config.user.email,a.first_name=e.input.user_data.first_name,a.last_name=e.input.user_data.last_name,a.storedRurl=r.cc.storedRurl,a.selectedUpiId=n.cc.selectedUpiId,i.processCc(t,a)):r.processCC(n,t,a,c)}),T.goBackToPreviousState=function(){E=!1,a.gotoPreviousState(),v&&v.reject(),C.threeDSecureInstance.cancelVerifyCard(function(e,t){e&&w(e)})},n.customActionOnCompletePurchase=function(){return!1===n.isBraintreeV3()?c.when():(v=c.defer(),!0===E||!0!==n.cc.payWithNew?(n.skipValidation=!0,v.resolve(!0)):e.isConfirmStepEnabled()?"confirmation"===a.getActiveState()?b(v):(t=v,f(n).reset(),i.getNonceData(C).then(function(){t.resolve(!0)}).catch(function(e){P(e,t)})):b(v),v.promise);var t},n._isValid=function(){if(f(n).reset(),!e.isPaymentMethod(n.PAYMENT_PROVIDER_ID)||e.isMockUsed())return!0;if(!0===toBoolean(n.skipValidation)||!0===n.isBraintreeV3())return!0;if(r.cc.payWithNew){if(!1===n.ccForm.$valid){for(var t=[{name:"num",msg:o.trc("checkout.platform","Credit card number is required")},{name:"expire_month",msg:o.trc("checkout.platform","Expired month is required")},{name:"expire_year",msg:o.trc("checkout.platform","Expired year is required")},{name:"cvv",msg:o.trc("checkout.platform","CVV is required")},{name:"postal_code",msg:o.trc("checkout.platform","Postal code is required")}],i=0;i<t.length;i++){var a=t[i];if(n.ccForm[a.name])if(n.ccForm[a.name].$invalid){f(n).global(a.msg);break}}return!1}if(!A(n.credit_card.num))return f(n).global(o.trc("checkout.platform","Invalid credit card number")),!1;if(!function(e,t){if(!e||!t)return!1;var n=parseInt(e,10),r=parseInt(t,10);if(n<1||n>12)return!1;if(r<0)return!1;r<100&&(r+=2e3);var o=new Date;o.setDate(1),o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0);var i=new Date;return i.setDate(1),i.setMonth(n-1),i.setYear(r),i.setHours(0),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0),o.getTime()<=i.getTime()}(n.credit_card.expire_month,n.credit_card.expire_year))return f(n).global(o.trc("checkout.platform","Invalid expiration date")),!1}else if(!r.cc.selectedUpiId)return f(n).global(o.trc("checkout.platform","Please select one of your cards or add new one")),!1;return!0},n.$on(EVENT_CC_PROCESSING,function(){n.cc.payWithNew&&(n.cc.selectedUpiId=null,r.cc.selectedUpiId=null,e.setUpiId(null)),e.input.storeInVault=n.credit_card.store_in_vault,e.input.defaultPaymentMethodId=n.credit_card.store_in_vault&&n.cc.defaultPaymentMethodId});var A=function(e){if(!e.match(/^\d+$/))return!1;for(var t=e.length,n=1&t,r=0,o=0;o<t;o++){var i=parseInt(e.charAt(o));1&o^n||(i*=2)>9&&(i-=9),r+=i}return r%10==0};n.getCurrentCreditCardInfo=function(){if(r.cc.payWithNew)return{type:l.detectCardType(n.credit_card.num),ending:n.credit_card.num?n.credit_card.num.slice(-4):"",expireMonth:n.credit_card.expire_month,expireYear:n.credit_card.expire_year};if(r.cc.selectedUpiId)for(var e=0;e<r.cc.stored.length;e++){var t=r.cc.stored[e];if(t.id===r.cc.selectedUpiId)return{type:{shortName:t.identifier,longName:t.type},ending:t.ending_in,expireMonth:t.expire_month,expireYear:t.expire_year,taxRequest:d.taxRequestFromUpi(t)}}return{type:l.getUnknownCardType(),ending:n.credit_card.num?n.credit_card.num.slice(-4):"",expireMonth:n.credit_card.expire_month,expireYear:n.credit_card.expire_year}},n.expireYears=getYears(),n.expireMonths=getMonths(),s.setInstance&&s.setInstance(T),propagatePaymentVars(e,n)}]}}]);var payPal=angular.module("payPalModule",["checkoutModule"]);payPal.factory("payPal",function(){var e,t={};return t.beforeInitiate=function(){},t.initiateSucceed=function(e){},t.initiateFailed=function(e){},t.beforeProcess=function(){e=createPaymentPopUp(1200,800,"PayPal")},t.processSucceed=function(t){e.location.href=t.url},t.processFailed=function(e){},t.confirmed=function(t){e.close()},t.declined=function(t){e.close()},t.completeSucceed=function(e){},t.completeFailed=function(e){},t}),payPal.directive("paypalFormComponent",["checkout",function(e){return{restrict:"A",require:"^view",transclude:!0,templateUrl:"/widget/checkout/component/partials/paypal-form-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","errorService",function(t,n){angular.extend(t,BaseComponentController),t._isValid=function(){return n(t).reset(),!e.isPaymentMethod(PAYPAL)||e.isMockUsed(),!0},propagatePaymentVars(e,t)}]}}]);var dwolla=angular.module("dwollaModule",["checkoutModule"]),EVENT_PREVIEW_DWOLLA_TERM_COMPLETE="EVENT_PREVIEW_DWOLLA_TERM_COMPLETE",EVENT_DWOLLA_INIT="EVENT_DWOLLA_INIT",EVENT_DWOLLA_SUBMIT="EVENT_DWOLLA_SUBMIT",EVENT_DWOLLA_ERROR="EVENT_DWOLLA_ERROR";dwolla.factory("dwolla",["$rootScope","$rootElement",function(e,t){var n={initiateSucceed:function(t){var n={};n.loginUrl=t.loginUrl,n.isRecurring="true"===t.isRecurring,n.sources=angular.fromJson(t.sources),n.id=t.id,n.storePin=!0,e.$broadcast(EVENT_DWOLLA_INIT,n)},processSucceed:function(t){var n={};n.rurl=t.rurl,e.$broadcast(EVENT_DWOLLA_SUBMIT,n)},completeFailed:function(t){e.$broadcast(EVENT_DWOLLA_ERROR,t&&t.length>0?t[0].msg:"Unknown error")}};return n}]),dwolla.directive("dwollaFormComponent",["checkout","$rootElement",function(e,t){return{restrict:"A",require:"^view",transclude:!0,templateUrl:"/widget/checkout/component/partials/dwolla-form-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","$element","errorService",function(n,r,o){angular.extend(n,BaseComponentController),n.dwolla={},function(t,n){var r;t.dwolla.login=function(){(r=createPaymentPopUp(800,600,"Dwolla")).location.href=t.dwolla.loginUrl},t.$on(EVENT_PREVIEW_DWOLLA_TERM_COMPLETE,function(t,n){e._completeTerm({q:"q"})}),t.$on("dwolla-login-complete",function(e,n){t.dwolla.sources=angular.fromJson(n.sources),t.dwolla.id=n.id,t.$apply(),r.close()}),t.$on("dwolla-login-error",function(e,n){t.dwolla.error=n.error,t.$apply(),r.close()}),n.find("#dwolla_login_button").click(function(){t.dwolla.login()})}(n,r),n.$on(EVENT_DWOLLA_INIT,function(e,t){n.dwolla.loginUrl=t.loginUrl,n.dwolla.isRecurring=t.isRecurring,n.dwolla.sources=t.sources,n.dwolla.id=t.id,n.dwolla.storePin=!0,n.dwolla.sources&&n.dwolla.sources.length>0&&(n.dwolla.source=n.dwolla.sources[0],n.dwolla.sources.forEach(function(e){"true"===e.selected&&(n.dwolla.source=e)}))}),n.$on(EVENT_DWOLLA_SUBMIT,function(e,r){angular.element("#dwolla_frame").remove();var o=r.rurl+"&funding_source="+n.dwolla.source.id+"&pincode="+n.dwolla.pin+"&storePin="+n.dwolla.storePin+"&id="+n.dwolla.id,i=angular.element('<iframe name="dwolla_frame" id="dwolla_frame" style="display: none" src="'+o+'"></iframe>');t.append(i)}),n.$on(EVENT_DWOLLA_ERROR,function(e,t){o(n).reset(),o(n).global(t)}),n._isValid=function(){return o(n).reset(),!(e.isPaymentMethod(DWOLLA)&&!e.isMockUsed())||(o(n).reset(),n.dwolla.source?!(!n.dwolla.pin||""===n.dwolla.pin)||(o(n).global("Enter the pincode"),!1):(o(n).global("Select where to pay from"),!1))},propagatePaymentVars(e,n)}]}}]);var amazonmws=angular.module("amazonmwsModule",["checkoutModule"]),EVENT_PREVIEW_TERM_COMPLETE="EVENT_PREVIEW_TERM_COMPLETE",EVENT_AMAZON_INIT="EVENT_AMAZON_INIT",EVENT_AMAZON_SUBMIT="EVENT_AMAZON_SUBMIT";amazonmws.factory("amazonmws",["$rootScope",function(e){var t={initiateSucceed:function(t){e.$broadcast(EVENT_AMAZON_INIT,t)},processSucceed:function(t){e.$broadcast(EVENT_AMAZON_SUBMIT,t)}};return t}]),amazonmws.directive("amazonFormComponent",["$rootElement","errorService",function(e,t){return{restrict:"A",require:"^view",transclude:!0,templateUrl:"/widget/checkout/component/partials/amazon-form-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","checkout",function(n,r){angular.extend(n,BaseComponentController);var o=null,i=null,a=null;n.$on(EVENT_PREVIEW_TERM_COMPLETE,function(){r._completeTerm({q:"q"})}),n.$on(EVENT_AMAZON_INIT,function(e,t){o=t.sellerId,a=t.clientId,i="true"===t.isRecurring,n.amazon.isRecurring=i,window.onAmazonLoginReady=function(){amazon.Login.setClientId(a)},amazon.Login.setClientId(a),m.schedule(),p()}),n.$on(EVENT_AMAZON_SUBMIT,function(t,r){angular.element("#amazon_frame").remove();var o=r.rurl+"&order_reference_id="+encodeURIComponent(n.amazon.order)+"&resource="+encodeURIComponent(r.resource),i=angular.element('<iframe name="amazon_frame" id="amazon_frame" style="display: none" src="'+o+'"></iframe>');e.append(i)}),n._isValid=function(){return t(n).reset(),!(r.isPaymentMethod(AMAZON)&&!r.isMockUsed())||(!(i&&!n.amazon.buyerBillingAgreementConsentStatus)||(t(n).global("Please check the box below to allow Piano to auto renew your subscription."),!1))},propagatePaymentVars(r,n);n.amazon={},n.amazon.isRecurring=null,n.amazon.loggedIn=!1,n.amazon.loading=!0,n.amazon.techError=!1,n.amazon.order=null,n.amazon.buyerBillingAgreementConsentStatus=!1;var c,s,u,l=function(){util.log("[AMAZON] createButton"),h(),new OffAmazonPayments.Button("login_widget",o,{type:"LwA",agreementType:i?"BillingAgreement":void 0,useAmazonAddressBook:!1,authorization:function(e){util.log("[AMAZON] createButton:authorization",e),n.amazon.loading=!1,n.$apply(),loginOptions={scope:"payments:widget",popup:!0},authRequest=amazon.Login.authorize(loginOptions)},onSignIn:function(e){util.log("[AMAZON] createButton:onSignIn [isRecurring="+i+"]",e),n.amazon.order=i?e.getAmazonBillingAgreementId():e.getAmazonOrderReferenceId(),n.amazon.loggedIn=!0,n.$apply(),p()},onError:function(e){util.log("[AMAZON] createButton:onError",e),g("[AMAZON LOGIN UNKNOWN ERROR] "+e.getErrorCode())}})},d=function(){return!(i&&"C"!==n.amazon.order.substr(0,1)||!i&&"S"!==n.amazon.order.substr(0,1))||(util.log("[AMAZON] Wrong order for this type, relogin [order="+n.amazon.order+"]"),n.amazon.loggedIn=!1,n.amazon.loading=!0,n.amazon.order=null,n.$apply(),m.schedule(),l(),!1)},p=function(){util.log("[AMAZON] createWallet [isRecurring="+i+"]"),n.amazon.loading=!0,new OffAmazonPayments.Widgets.Wallet({sellerId:o,agreementType:i?"BillingAgreement":void 0,onBillingAgreementCreate:function(e){n.amazon.order=e.getAmazonBillingAgreementId(),util.log("[AMAZON] createWallet:onBillingAgreementCreate [order="+n.amazon.order+"]",e),d()&&(i&&f(n.amazon.order),m.cancel(),n.amazon.loggedIn=!0,n.amazon.loading=!1,n.$apply())},onOrderReferenceCreate:function(e){n.amazon.order=e.getAmazonOrderReferenceId(),util.log("[AMAZON] createWallet:onOrderReferenceCreate [order="+n.amazon.order+"]",e),d()&&(m.cancel(),n.amazon.loggedIn=!0,n.amazon.loading=!1,n.$apply())},design:{size:{width:r.getWidthTerm()-50+"px",height:"100px"}},onPaymentSelect:function(e){util.log("[AMAZON] createWallet:onPaymentSelect [order="+n.amazon.order+"]",e),d()&&(m.cancel(),n.amazon.loggedIn=!0,n.amazon.loading=!1,n.$apply())},onError:function(e){util.log("[AMAZON] createWallet:onError",e.getErrorCode(),e),"BuyerSessionExpired"===e.getErrorCode()?l():g("[AMAZON WALLET UNKNOWN ERROR]"+e.getErrorCode())}}).bind("wallet_widget")},f=function(e){i&&(util.log("[AMAZON] createConsent [billingAgreementId="+e+"]"),new OffAmazonPayments.Widgets.Consent({sellerId:o,amazonBillingAgreementId:e,design:{size:{width:r.getWidthTerm()-50+"",height:"260"}},onReady:function(e){n.amazon.buyerBillingAgreementConsentStatus="true"===e.getConsentStatus(),util.log("[AMAZON] createConsent:onReady: [buyerBillingAgreementConsentStatus="+n.amazon.buyerBillingAgreementConsentStatus+"]")},onConsent:function(e){n.amazon.buyerBillingAgreementConsentStatus="true"===e.getConsentStatus(),util.log("[AMAZON] createConsent:onConsent: [buyerBillingAgreementConsentStatus="+n.amazon.buyerBillingAgreementConsentStatus+"]")},onError:function(t){"InvalidBillingAgreementId"===t.getErrorCode()?(util.log("[AMAZON] createConsent:onError [InvalidBillingAgreementId="+e+"]"),n.amazon.loggedIn=!1,n.$apply(),l()):g("[AMAZON CONSENT UNKNOWN ERROR] "+t.getErrorCode())}}).bind("consent_widget"))},m=(s=!1,u=function(){c=setTimeout(function(){0===$("#login_widget").children().length&&0===$("#wallet_widget").children().length&&(s?(console.warn("[AMAZON] Loading failed, show the error screen"),n.amazon.techError=!0,n.$apply()):(s=!0,console.warn("[AMAZON] Loading failed, trying to clear the cookies"),document.cookie="amazon_Login_accessToken=",u(),l()))},1e4)},{schedule:function(){u()},cancel:function(){clearTimeout(c)}}),h=function(){var e=setInterval(function(){($("#login_widget").children().length>0||$("#wallet_widget").children().length>0)&&(util.log("[AMAZON] loading completed"),n.amazon.loading=!1,n.$apply(),clearInterval(e))},100)},g=function(e){n.techError=!0,n.$apply()}}]}}]);var EVENT_PREVIEW_COINBASE_TERM_COMPLETE="EVENT_PREVIEW_COINBASE_TERM_COMPLETE",coinbase=angular.module("coinbaseModule",["checkoutModule"]);coinbase.factory("coinbase",function(){var e,t={};return t.beforeProcess=function(){e=createPaymentPopUp(1200,700,"Coinbase")},t.processSucceed=function(t){e.location.href=t.url},t.confirmed=function(t){e.close()},t.declined=function(t){e.close()},t}),coinbase.directive("coinbaseFormComponent",["checkout",function(e){return{restrict:"A",require:"^view",transclude:!0,templateUrl:"/widget/checkout/component/partials/coinbase-form-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","errorService",function(t,n){angular.extend(t,BaseComponentController),t.$on(EVENT_PREVIEW_COINBASE_TERM_COMPLETE,function(){e._completeTerm({q:"q"})}),t._isValid=function(){return n(t).reset(),!e.isPaymentMethod(COINBASE)||e.isMockUsed(),!0},propagatePaymentVars(e,t)}]}}]);var mock=angular.module("mockModule",["checkoutModule"]),EVENT_MOCK_PROCESS_SUCCEED="EVENT_MOCK_PROCESS_SUCCEED",EVENT_MOCK_PROCESS_CONFIRMED="EVENT_MOCK_PROCESS_CONFIRMED";mock.factory("mock",["$rootScope",function(e){var t={beforeInitiate:function(){},initiateSucceed:function(e){},initiateFailed:function(e){},beforeProcess:function(){},processSucceed:function(t){e.$broadcast(EVENT_MOCK_PROCESS_SUCCEED,t)},processFailed:function(e){},confirmed:function(t){e.$broadcast(EVENT_MOCK_PROCESS_CONFIRMED,t)},declined:function(e){},completeSucceed:function(e){},completeFailed:function(e){}};return t}]),mock.directive("mockFormComponent",["checkout","tpHTTP",function(e,t){return{restrict:"A",require:"^view",transclude:!0,templateUrl:"/widget/checkout/component/partials/mock-form-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","$rootElement","checkout",function(e,n,r){angular.extend(e,BaseComponentController),e.mock={},e.mock.asyncProcessing=!1,e._isValid=function(){return!0},e.$on(EVENT_MOCK_PROCESS_SUCCEED,function(t,o){angular.element("#mock_frame").remove();var i=o.rurl+(o.rurl.indexOf("?")<0?"?":"&")+"async_processing="+e.mock.asyncProcessing+"&url="+r.input.url,a=angular.element('<iframe name="mock_frame" id="mock_frame" style="display: none" src="'+i+'"></iframe>');n.append(a)}),e.$on(EVENT_MOCK_PROCESS_CONFIRMED,function(e,n){t({method:"post",url:"/ipn/mock",params:{oid:r.input.oid},data:{type:"COMPLETE_SUCCESS"}}).then(function(e){util.log("Completed payment",e)}).catch(function(e){util.error("Failed completing payment",e)})}),propagatePaymentVars(r,e)}]}}]);var EVENT_PREVIEW_OPENPAY_CASH_TERM_COMPLETE="EVENT_PREVIEW_OPENPAY_CASH_TERM_COMPLETE";function openpayCashService(e){return{downloadBill:function(e){window.open(e)},resendBill:function(t,n){return e.post(TPParam.BILL_PAYMENTS_RESEND_BILL_URL,{billId:t,userToken:n})}}}function openpayCashProvider(e,t,n,r){var o={beforeInitiate:function(){},initiateSucceed:function(e){},initiateFailed:function(e){},beforeProcess:function(){},processSucceed:function(t){e(function(){var e={q:t.q};util.log("[OPENPAY_CASH] Firing payment-complete",e);var n={event:"payment-complete",params:e};window.postMessage(JSON.stringify(n),"*")},0)},processFailed:function(t){e(function(){util.log("[OPENPAY_CASH] Firing payment-error",t);var e={event:"payment-error",error:t};window.postMessage(JSON.stringify(e),"*")},0)},confirmed:function(e){},declined:function(e){},completeSucceed:function(e){},completeFailed:function(e){n(t).reset(),n(t).global(e&&e[0]&&e[0].msg?e[0].msg:r.trc("checkout.platform","Unknown error"))}};return o}function openpayCashFormComponent(e){return{restrict:"A",require:"^view",transclude:!0,templateUrl:"/widget/checkout/component/partials/openpay-cash-form-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope",function(t){angular.extend(t,BaseComponentController),t.$on(EVENT_PREVIEW_OPENPAY_CASH_TERM_COMPLETE,function(t,n){e._completeTerm({q:"q"})}),t.selectedTerm=e.flags.selectedTerm,t._isValid=function(){return!0},propagatePaymentVars(e,t)}]}}function openpayBillControls(e,t){return{restrict:"A",templateUrl:"/widget/checkout/component/partials/openpay-bill-controls.html",scope:{billUrl:"@",billId:"@"},controller:["$scope",function(n){n.isBillResent=!1,n.downloadBill=function(t){e.downloadBill(t)},n.resendBill=function(r){e.resendBill(r,t.params.userToken).then(function(){n.isBillResent=!0})}}]}}angular.module("openpayCashModule",["checkoutModule"]).factory("openpayCashService",openpayCashService).factory("openpayCashProvider",openpayCashProvider).directive("openpayCashFormComponent",openpayCashFormComponent).directive("openpayBillControls",openpayBillControls),openpayCashService.$inject=["tpHTTP"],openpayCashProvider.$inject=["$timeout","$rootScope","errorService","lang"],openpayCashFormComponent.$inject=["checkout"],openpayBillControls.$inject=["openpayCashService","checkout"];var zero=angular.module("zeroModule",["checkoutModule"]);zero.factory("zero",["$rootElement","eventService","$timeout","$rootScope","errorService",function(e,t,n,r,o){var i={beforeInitiate:function(){},initiateSucceed:function(e){},initiateFailed:function(e){},beforeProcess:function(){},processSucceed:function(e){n(function(){var t={q:e.q};util.log("[ZERO] Firing payment-complete",t);var n={event:"payment-complete",params:t};window.postMessage(JSON.stringify(n),"*")},0)},processFailed:function(e){n(function(){util.log("[ZERO] Firing payment-error",e);var t={event:"payment-error",error:e};window.postMessage(JSON.stringify(t),"*")},0)},confirmed:function(e){},declined:function(e){},completeSucceed:function(e){},completeFailed:function(e){o(r).reset(),o(r).global(e&&e[0]&&e[0].msg?e[0].msg:"Unknown error")}};return i}]),zero.directive("zeroFormComponent",["checkout","errorService","lang",function(e,t,n){return{restrict:"A",require:"^view",transclude:!0,templateUrl:"/widget/checkout/component/partials/zero-form-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope",function(t){angular.extend(t,BaseComponentController),propagatePaymentVars(e,t)}]}}]);var payWhatYouWant=angular.module("payWhatYouWantModule",["checkoutModule","tp.i18n"]);payWhatYouWant.factory("payWhatYouWantData",["tpHTTP","$window","$q","checkout","statsService",function(e,t,n,r,o){var i={getInitialData:function(i){return o.getStats().then(function(o){var a=n.defer();return e({method:"post",url:t.TPParam.CUSTOM_PRICE_INIT,params:{term_id:i},data:{checkoutStats:o}}).then(function(e){r.mergeStats(e),a.resolve(e)}).catch(function(){a.resolve()}),a.promise})},applyNewPrice:function(i,a,c){return o.getStats().then(function(o){var s=n.defer();return e({method:"post",url:t.TPParam.APPLY_NEW_PRICE,params:{term_id:i,oid:a,amount:c,aid:r.getAid(),zipCode:r.input.zipCode,countryCode:r.getBillingCountryCode(),billingZipCode:r.getBillingZipCode(),residenceCountryCode:r.getResidenceCountryCode(),userToken:r.params.userToken},data:{checkoutStats:o}}).then(function(e){r.mergeStats(e),s.resolve({ok:e})}).catch(function(e){s.resolve({errors:e.errors})}),s.promise})}};return i}]),payWhatYouWant.directive("payWhatYouWantFormComponent",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/pay-what-you-want-form-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","checkout","ngEventService","payWhatYouWantData","$element","errorService","lang",function(e,t,n,r,o,i,a){angular.extend(e,BaseComponentController),e.minPriceBase=0,e.maxPriceBase=0,e.currencyBase=0,e.minPrice=0,e.maxPrice=0,e.currency=0,e.currencyRate=0,e.amountBase=0,e.customAmount=0,e.loading=!0,e.validating=!1,e.validated=!0,e.validationError=null,e.applied=!1,e.currencyDefaultFractionDigits=2,Helper.wrapMethod("getSelectedTerm",t,e);var c=function(t,n){util.log("TERM EVENT:",n),n&&n.isCustomPriceAvailable&&r.getInitialData(n.termId).then(function(t){t?(e.minPriceBase=t.models.minPriceBase,e.maxPriceBase=t.models.maxPriceBase,e.currencyBase=t.models.currencyBase,e.minPrice=t.models.minPrice,e.maxPrice=t.models.maxPrice,e.currency=t.models.currency,e.currencyRate=t.models.currencyRate,e.amountBase=t.models.amountBase,e.customAmount=t.models.amount,e.currencyDefaultFractionDigits=t.models.currencyDefaultFractionDigits):i().terminal(a.trc("checkout.platform","Can't get data from service"))})},s=function(){e.customAmount=new String(e.customAmount).replace(/[^\d\.,]/g,"").substr(0,15);var t=e.customAmount.split(".");t.length>1&&t[1].length>e.currencyDefaultFractionDigits&&(e.customAmount=t[0]+"."+t[1].substring(0,e.currencyDefaultFractionDigits))};t.getSelectedTerm()&&c(0,t.getSelectedTerm()),n.subscribe(EVENT_CHECKOUT_TERM_SELECTED,c),o.find("input").keyup(function(){s(),e.amountBase=p(e.customAmount,e.currencyRate),e.$apply()}),o.find("input").focus(function(){e.$apply()}),e.edit=function(){e.applied=!1};var u=!1,l=0,d=function(){if(u){e.validating=!0,i(e).reset(),s();var o=++l;r.applyNewPrice(t.getSelectedTerm().termId,t.input.oid,e.customAmount).then(function(r){if(u=!1,o===l)if(r.ok)i(e).reset(),e.validated=!0,e.validating=!1,e.applied=!0,t.input.chargeAmount=r.ok.models.chargeAmount,t.input.chargeAmountInMinorUnit=r.ok.models.chargeAmountInMinorUnit,t.input.chargeCurrency=r.ok.models.chargeCurrency,t.input.chargeDisplayAmount=r.ok.models.chargeDisplayAmount,n.fire(EVENT_CHECKOUT_PRICE_CHANGED);else{var a=r.errors&&r.errors.length>0&&r.errors[0].msg?r.errors[0].msg:"Unknown error";e.validating=!1,e.validated=!1,e.validationError=a,i(e).component({field:"custom-amount",message:a})}})}};e.startValidating=function(){u=!0,d()};var p=function(e,t){try{if(!e||new String(e).match(/.*[^0-9.].*/))return"?.??";if(!t||new String(t).match(/.*[^0-9.].*/))return"?.??";var n=parseFloat(e)/parseFloat(t);return 0===n||isNaN(n)?"?.??":n=(Math.ceil(Math.round(1e4*n)/100)/100).toFixed(2).replace(/[.]00$/,"")}catch(e){return"?.??"}};e.isCustomPrice=function(){return t.getSelectedTerm()&&t.getSelectedTerm().isCustomPriceAvailable},e._isValid=function(){if(i(e).reset(),!e.isCustomPrice())return!0;var n=e.customAmount;return isNaN(parseFloat(n))?(i(e).component(a.trc("checkout.platform","Amount should be a number and greater then zero")),!1):(n=parseFloat(n),e.maxPrice&&n>parseFloat(e.maxPrice.replace(/^\D+/g,""))?(i(e).component(a.trc("checkout.platform","Amount should be less than {0} {1}",e.maxPrice,e.currency)),!1):n<parseFloat(e.minPrice.replace(/^\D+/g,""))?(i(e).component(a.trc("checkout.platform","Amount should be at least {0} {1}",e.minPrice,e.currency)),!1):(t.flags.selectedTerm.chargeAmount=n,e.validating?(i(e).component(a.trc("checkout.platform","Custom amount is not validated yet.")),!1):!!e.validated||(i(e).component(a.trc("checkout.platform","Custom amount validation failed: {0}",e.validationError)),!1)))},n.subscribe(EVENT_REAPPLY_PAY_WANT_YOU_WANT,function(){o.is(":visible")&&e.validated&&d()})}]}}),function(){var e="accepted",t=angular.module("externalVerificationModule",["checkoutModule","tp.ui.address","tp.i18n","generalModule"]);t.factory("externalVerificationService",["tpHTTP","$rootScope","$q","$window","ngEventService",function(e,t,n,r,o){var i={errors:[],externalVerificationError:null,externalVerificationSucceeded:!1,externalVerificationConversionId:null,applyPasswordlessEVFields:!0,passwordlessEVFields:null,check:function(t,n,o,a,c,s){var u={termId:a,oid:o,aid:t,userToken:s,externalApiConfigurationId:n.externalApiConfigurationId,fields:{}};return u.fields=i.getFields(n,c),i.externalVerificationError=null,i.externalVerificationSucceeded=!1,i.externalVerificationConversionId=null,e.promiseResponse(e.post(r.TPParam.EXTERNAL_VERIFICATION,u),i)},getFields:function(e,t){var n={};return t||(angular.forEach(e.externalApiFields,function(e){n[e.fieldName]=e.value}),n)},setExternalVerificationFields:function(e){i.applyPasswordlessEVFields&&e&&(e.countryId=e.country,i.passwordlessEVFields=e,o.fire("setPasswordlessEVFields",e))}};return i}]),t.directive("externalVerificationComponent",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/external-verification-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","$element","externalVerificationService","checkout","shakeService","errorService","ngEventService","lang","passwordlessService","checkoutGoTo","purchaseService",function(t,n,r,o,i,a,c,s,u,l,d){angular.extend(t,BaseComponentController),t.externalVerificationForm={},t.termGate=o.termGate,t.status=null,t.activeItem=null,t.validated=!1,Helper.wrapMethod("getSelectedTerm",o,t);var p={};function f(){t.status=null;var c=o.getSelectedTerm(),u=o.input.oid;r.check(o.getAid(),t.termGate,u,c.termId,t.activeItem,o.params.userToken).then(function(){o.termGate.externalVerificationError=r.externalVerificationError,o.termGate.externalVerificationSucceeded=r.externalVerificationSucceeded,o.termGate.externalVerificationErrorMessages=r.externalVerificationErrorMessages,t.accepted()?(o.termGate.externalVerificationStatus=e,o.termGate.externalVerificationConversionId=r.externalVerificationConversionId,l.gotoNextState(o,d,!1,!0)):i.shake(n.find(".shake-element"))}).catch(function(){a().terminal(s.trc("checkout.platform","Couldn't check external access"))})}this.onFormChange=function(e){p=e},t.check=function(){t.validated=!0,t.isAlreadyChecked=!1,t._isValid()?(o.isPasswordlessCheckoutEnabled()&&(r.passwordlessEVFields=r.getFields(t.termGate,t.activeItem)),o.isSingleStepEnabled()?u.loginUser(o).then(function(){o.isUserValid()?(!t.isAlreadyChecked&&f(),t.isAlreadyChecked=!0):a(t).global(s.trc("checkout.platform","Email format is not valid"))}):o.isUserValid()&&f()):i.shake(n.find(".shake-element"))},t._validateViewOnCompletePurchase=function(){return o.hasExternalVerificationGate()},t._isValid=function(){a(t).reset();var e=t.fields();if(!e||t.activeItem.infoModel)return!0;for(var n=0;n<e.length;n++){var r=e[n];if(r.mandatory&&!p[r.fieldName]&&!p[r.fieldName+"Name"])return a(t).global(r.fieldTitle+" "+s.tr("is required")),!1}return!0},t.isAuthFormShow=function(){return o.isSingleStepEnabled()||!o.isPasswordlessCheckoutEnabled()&&!o.config.checkoutAuthenticationInSeparateState},t.errorMessages=function(){return o.termGate.externalVerificationErrorMessages},t.failed=function(){return!o.termGate.externalVerificationSucceeded&&"failed"===o.termGate.externalVerificationError},t.accepted=function(){return o.termGate.externalVerificationSucceeded},t.rejected=function(){return!o.termGate.externalVerificationSucceeded&&"rejected"===o.termGate.externalVerificationError},t.externalApiTitle=function(){return t.termGate.externalApiTitle},t.externalApiVerifyNew=function(){return t.termGate.externalApiVerifyNew},t.externalApiApplyButtonName=function(){return t.termGate.externalApiApplyButtonName},t.externalApiSavedForms=function(){return t.termGate.externalApiSavedForms},t.externalApiPrepopulationForm=function(){return o.termGate.externalApiPrepopulationForm},t.externalApiSource=function(){return t.termGate.externalApiSource},t.externalApiFieldCountry=function(){return t.termGate.externalApiFieldCountry},t.fields=function(){return t.termGate.externalApiFields},t.countNotHiddenFields=function(){var e=0;return angular.forEach(t.termGate.externalApiFields,function(t){t.hidden||e++}),e}}]}}),t.controller("externalApiFieldsetCtrl",["$scope","checkout","utilsService","integrationEventsService","$timeout","externalVerificationService","ngEventService",function(e,t,n,r,o,i,a){var c=this;c.selected=e.selected,c.newItem={};var s=null;function u(e,t){n.forEach(e,function(e){var r;c.newItem[e.fieldName]=t[e.fieldName]||c.newItem[e.fieldName]||e.defaultValue,"COUNTRY_SELECTOR"===e.type&&t.countryId&&(r=t.countryId,c.country=n.find(c.countries,function(e){return e.pubId===r})),"STATE_AUTOCOMPLETE"===e.type&&t.regionCode&&function(e){if(!c.country||!c.country.regions)return;c.region=n.find(c.country.regions,{regionCode:e})}(t.regionCode)})}e.registerExtenralVerificationComponent=function(e){s=e},r.listenLocal("externalApiFieldset.change",function(e){var t=e.detail;if(i.applyPasswordlessEVFields&&i.passwordlessEVFields)return u(c.fields,i.passwordlessEVFields),void(i.applyPasswordlessEVFields=!1);t&&u(c.fields,t)});var l=a.subscribe("setPasswordlessEVFields",function(e,t){l(),r.dispatchLocal("externalApiFieldset.change",t),s.onFormChange(t)});e.$watch(function(){return t.termGate.externalApiFields},function(e){for(var r in c.fields=e,c.countVisibleFields=n.reduce(e,function(e,t){return e+(t.hidden?0:1)},0),c.newItem)delete c.newItem[r];c.country=null,c.region=null,c.countries=t.termGate.externalApiFieldCountry;var o=t.termGate.externalApiPrepopulationForm;n.forEach(e,function(e){o?(c.newItem[e.fieldName]=o[e.fieldName],"COUNTRY_SELECTOR"===e.type&&(c.country=n.find(c.countries,function(e){return e.pubId===o.countryId})),"STATE_AUTOCOMPLETE"===e.type&&(c.region={pubId:o.regionId,regionName:o.regionName,regionCode:o.regionCode})):c.newItem[e.fieldName]=e.defaultValue})}),e.$watch(function(){return t.termGate.externalApiSavedForms},function(e){c.savedForms=e||[],c.selected=c.savedForms.length?c.savedForms[0]:c.newItem}),e.$watch("$ctrl.newItem",function(e){r.dispatchLocal("externalApiFieldset.change",e),s.onFormChange(e)},!0),e.$watch(function(){return c.selected},function(t){e.selected=t,o(function(){s.onFormChange(t)},0)})}]),t.directive("externalApiFieldset",function(){return{restrict:"AE",require:"^^externalVerificationComponent",scope:{selected:"="},controller:"externalApiFieldsetCtrl",controllerAs:"$ctrl",link:function(e,t,n,r){e.registerExtenralVerificationComponent(r)}}}),t.directive("externalApiFieldsetList",function(){return{restrict:"AE",replace:!0,transclude:!0,require:"^externalApiFieldset",templateUrl:"/widget/checkout/component/partials/external-api-fieldset-list.html",link:function(e,t,n,r){e.$ctrl=r}}}),t.directive("externalApiFieldsetExists",["$compile",function(e){return{restrict:"AE",transclude:!0,require:"^externalApiFieldset",link:function(t,n,r,o,i){t.$ctrl=o,i(t,function(r){var o=angular.element("<div>").append(r).children().attr("ng-repeat","$item in $ctrl.savedForms track by $index").attr("ng-class","{'current': $item === $ctrl.selected}");n.html(o.data),e(n.contents())(t)})}}}]),t.directive("externalApiFieldsetNew",["$compile",function(e){return{restrict:"AE",transclude:!0,require:"^externalApiFieldset",link:function(t,n,r,o,i){t.$ctrl=o,t.$item=o.newItem,i(t,function(r){var o=angular.element("<div>").append(r).children().attr("ng-class","{'current': $item === $ctrl.selected}");n.html(o.data),e(n.contents())(t)})}}}]),t.directive("externalApiFieldsetForm",function(){return{restrict:"AE",transclude:!0,require:"^externalApiFieldset",templateUrl:"/widget/checkout/component/partials/external-api-fieldset-form.html"}}),t.directive("externalApiFieldsetField",function(){return{restrict:"AE",transclude:!0,require:"^externalApiFieldset",templateUrl:"/widget/checkout/component/partials/external-api-fieldset-field.html"}}),t.directive("externalApiFieldsetInput",["$compile","$http","$templateCache",function(e,t,n){var r={COUNTRY_SELECTOR:"/widget/checkout/component/partials/external-api-fieldset-field-country.html",STATE_AUTOCOMPLETE:"/widget/checkout/component/partials/external-api-fieldset-field-region.html",INPUT:"/widget/checkout/component/partials/external-api-fieldset-field-input.html"};return{restrict:"AE",replace:!0,require:"^externalApiFieldset",scope:{$field:"=externalApiFieldsetInput"},link:function(o,i,a,c){o.$ctrl=c,o.$item=c.newItem,o.$ctrl.showNoteByCountryCode=function(e){return!!e&&["US","UM","VI","AS"].indexOf(e)>-1};var s=r[o.$field.type]||r.INPUT;t.get(s,{cache:n}).then(function(t){i.html(t.data),e(i.contents())(o)})},controller:["$scope",function(e){"COUNTRY_SELECTOR"===e.$field.type&&e.$watch(function(){return e.$ctrl.country},function(t){e.$item[e.$field.fieldName]=t&&t.pubId}),"STATE_AUTOCOMPLETE"===e.$field.type&&e.$watch(function(){return e.$ctrl.region},function(t){e.$item[e.$field.fieldName]=t&&(t.pubId||t.regionName)})}]}}]),t.directive("externalApiFieldsetHint",["$compile","$http","$templateCache",function(e,t,n){return{restrict:"A",scope:{text:"=externalApiFieldsetHint"},link:function(r,o){t.get("/widget/checkout/component/partials/external-api-fieldset-hint.html",{cache:n}).then(function(t){o.append(t.data),e(o.contents())(r)})}}}]),t.directive("inject",function(){return{link:function(e,t,n,r,o){if(!o)throw angular.$$minErr("ngTransclude")("orphan","Illegal use of ngTransclude directive in the template! No parent directive that requires a transclusion found.");var i=e.$new();o(i,function(e){t.empty(),t.append(e),t.on("$destroy",function(){i.$destroy()})})}}})}(),angular.module("printAddressModule",["checkoutModule","tp.ui.address","tp.i18n","userServiceModule","generalModule"]).factory("printAddressService",["tpHTTP","$rootScope","$q","$window",function(e,t,n,r){var o={printAddressForm:{},form:{},errors:[],save:function(t,n,i,a,c){var s={termId:a,userToken:i,oid:n,aid:t};return s=angular.extend(s,c),e.promiseResponse(e.post(r.TPParam.ADDRESS_COLLECT,s),o)}};return o}]).directive("printAddressComponent",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/print-address-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","$element","checkout","shakeService","errorService","ngEventService","lang","printAddressService","userService","utilsService","checkoutGoTo","purchaseService",function(e,t,n,r,o,i,a,c,s,u,l,d){angular.extend(e,BaseComponentController),e.printAddressForm=c.printAddressForm,e.status=null,e.form=c.form,e.validated=!1,e.modalFormErrors=[],e.countryList=function(){return n.termGate.adrCollectionCountries},e.adrDefaultCountry=function(){return n.termGate.adrDefaultCountry?u.find(e.countryList(),function(e){return e.pubId===n.termGate.adrDefaultCountry.pubId}):null},e.model={country:e.adrDefaultCountry(),region:null,activeItem:null},Helper.wrapMethod("getSelectedTerm",n,e),i.subscribe(EVENT_VIEW_ACTIVATED,function(t,r){if(e.validated=!1,"printAddress"===r.name){var o=e.savedForms();e.validated=!1,o&&o.length?e.model.activeItem=o[0]:e.model.activeItem="add_new",e.model.country=e.model.country||e.adrDefaultCountry(),n.termGate.adrPrepopulationForm&&(angular.forEach(n.termGate.adrPrepopulationForm,function(t,n){t&&!e.form[n]&&(e.form[n]=t)}),e.model.country=u.find(e.countryList(),function(e){return e.pubId===n.termGate.adrPrepopulationForm.countryId}),e.model.region={pubId:n.termGate.adrPrepopulationForm.regionId,regionName:n.termGate.adrPrepopulationForm.regionName,regionCode:n.termGate.adrPrepopulationForm.regionCode})}}),e.save=function(){var i;e.validated=!0,e.modalFormErrors=[],o(e).reset(),e.model.activeItem&&"add_new"!==e.model.activeItem?i={pubId:e.model.activeItem.pubId}:(i=angular.copy(e.form),e.model.country&&(i.country=e.model.country.pubId),e.model.region&&(i.region=e.model.region.pubId||e.model.region.regionName));var s=n.getSelectedTerm(),u=n.input.oid,p=n.getAid(),f=n.params.userToken;c.save(p,u,f,s.termId,i).then(function(){n.termGate.adrCollectionSucceeded=!0,l.gotoNextState(n,d,!1,!1)}).catch(function(){r.shake(t.find(".shake-element"));for(var n=0;n<c.errors.length;n+=1)e.modalFormErrors.push({message:a.trc("checkout.platform",c.errors[n].msg)});o(e).globals(e.modalFormErrors)})},e.savedForms=function(){return n.termGate.adrCollectionAvailableAddresses}}]}}),function(){var e=angular.module("checkoutMockModule",["paymentServiceModule","externalVerificationModule","checkoutModule","tp.i18n"]),t={$provide:null,$q:null,$timeout:null,utils:{}};t.utils.sendPaymentComplete=function(e){e(function(){window.postMessage(JSON.stringify({event:"payment-complete",params:{q:"123"}}),"*")})},t.mockPromiserFunction=function(e,n,r){var o,i={},a=function(e,n){return function(){var n=arguments,r=t.$q.defer();return t.$timeout(function(){var t=e;angular.isFunction(e)&&(t=e.apply(this,n)),r.resolve(t)},0),r.promise}};for(o in n)n.hasOwnProperty(o)&&(i[o]=a(n[o]));for(o in e)e.hasOwnProperty(o)&&i[o]&&(e[o]=i[o])},t.mockDataServices=function(){t.mockPaymentServiceData(),t.mockPayWhatYouWantData(),t.mockPromocodeService(),t.mockRedemptionService(),t.mockGiftService(),t.mockRegistrationService(),t.mockExternalVerificationService(),t.mockCreditCardService(),t.mockworldPayRxml(),t.mockworldPayHpp(),t.mockspreedly(),t.mockedgilPaywayProvider(),t.mockworldPayToken(),t.mockeigenProvider(),t.mockopenpayCashProvider(),t.mockapplePayBt(),t.mockcoinbase(),t.mockamazonmws(),t.mockdwolla(),t.mockEdgilCreditCardService(),t.mockPaypalExpressCheckoutService(),t.mockPayPalBtService(),t.mockEigenCreditCardService(),t.mockIframeService(),t.mockEasyPay(),t.mockKlarna(),t.mockDatatrans(),t.mockDatatransPostfinance(),t.mockObiPaypal(),t.mockStripe()},t.mockPromocodeService=function(){t.$provide.decorator("promoCodeService",["$delegate","$q","$timeout","$injector",function(e,n,r,o){return t.$q=n,t.$timeout=r,t.mockPromiserFunction(e,{verify:function(e,t,n,r){var i=o.get("checkout"),a={};angular.forEach(i.config.terms,function(e){n!==e.termId&&(a=e)}),angular.forEach(i.config.terms,function(e){n===e.termId&&e});var c={ok:!0,data:{models:{chargeDisplayAmount:"$1.89",chargeAmount:1.89,chargeCurrency:"USD",isZero:!1,resultState:"VALIDCODE",verifiedPromoCode:{promoCodeId:"PCINOZVG8LXZ",discount:"5%"},otherTerms:[],otherTermOfferPubId:"C0oJlPFryA9wf8i1Pl5tCpt9ak7RGzfD"},routes:{},errors:[]}},s={ok:!0,data:{models:{chargeDisplayAmount:null,chargeAmount:null,chargeCurrency:null,isZero:!1,resultState:"ANOTHERTERM",verifiedPromoCode:{promoCodeId:"PC23BANC3TEC",discount:"5%"},otherTerms:[a],otherTermOfferPubId:"OFEQ1T527CF0"},routes:{},errors:[]}},u={ok:!0,data:{models:{chargeDisplayAmount:null,chargeAmount:null,chargeCurrency:null,isZero:!1,resultState:"ANOTHERESOURCE",verifiedPromoCode:{promoCodeId:"PCBTMCI6IY6G",discount:"5%"},otherTerms:[a],otherTermOfferPubId:"OF9Z32EMU4F1"},routes:{},errors:[]}};return t&&i.isSelectedTermLocked()?{data:{models:{chargeDisplayAmount:"$0.00",chargeAmount:0,chargeCurrency:"USD",isZero:!0,resultState:"UNLOCKED",promotionBillingPlan:[{cycles:"1",isTrial:"false",pricelessBillingPre:"free",isPayWhatYouWant:"false",isFreeTrial:"false",date:"Today",period:"month",billing:"free",duration:"1 month trial",pricelessBillingPost:"",billingPeriod:"1 month",price:"$0",originalPrice:"$1.66",isFree:"true",shortPeriod:" for month"}],verifiedPromoCode:{promoCodeId:"PCNM6JY5WUJO",discount:"100%"},otherTerms:[],otherTermOfferPubId:"C0d2JZnxih2q2OQ8syIGkp6ZYFPqzdum"},routes:{},errors:[]},ok:!0}:t&&"pc"===t.toLowerCase()?c:t&&"at"===t.toLowerCase()?s:t&&"ar"===t.toLowerCase()?u:c},revert:{ok:!0,data:{}}},"payWhatYouWantData"),e}])},t.mockRedemptionService=function(){t.$provide.decorator("redemptionService",["$delegate","$q","$timeout","$injector","eventService",function(e,n,r,o,i){return t.$q=n,t.$timeout=r,t.mockPromiserFunction(e,{applyCode:function(){e.voucher={checkoutStats:{content_author:null,offer_template_version_num:null,content_section:null,currency_src:null,promo_code:null,promotion_id:null,experience_execution_id:null,experience_id:null,amount_base:null,browser_id:null,pageview_id:"2018-01-19-17-31-08-722-2imrODV4baZ72bvp-b3406d5935fa88070f3a94c8e3e27277",campaigns:[],content_created:"null",AID:"MODETWOAPP",shown_terms:["TMREIHID1RCF","TMRJ09V9735W","TMG43Q953C17","TM38AVLRCYC5","TM2M1HQAQL8M","TM3Y7M8M4Q2W","TM6TMHNJM75U","TM2WAQFQXXEW","TMPS54R1G876","TMAG47IY5NLJ","TMWYNZ259VR7","TMO4YKZWM1MR","TMTS7M6XXRDL","TMZIKPH4DA3W","TMZ3OXJ7B7LX","TMUU7YPZ919M","TM0D6GBVYBS1"],experience_action_id:null,promo_state:0,amount_src:null,currency_base:null,term_id:null,offer_id:"OFPO01411HS1",offer_template_id:null,tags:[],template_id:null,offer_template_version_id:null,visit_id:"v-2018-01-19-17-31-08-724-HagCeekViJgOOUXT-b3406d5935fa88070f3a94c8e3e27277"},starting:"Today",subscriptionExpires:"Feb 19, 2018",duration:"1 month",resource:{name:"Test Resource",description:null,rid:"RID",url:null,imageUrl:null},routes:{},errors:[]},e.state=e.STATE_INFO},redeem:function(){e.state=e.STATE_DONE;i.completeEvent({rid:"RID",termConversionId:"TCLZPKTFXAJH",termId:"TMG43Q953C17",uid:"some-user1@yahoo.com",email:"some-user1@yahoo.com",token_list:"{jax}ng29BtT4DWn01SUxeDd_lEnmvkWJl2Reqj0Z8GbKrb4kc4FGxrr3iQOUKtKTcwBXdMkGtckhv6WVfwbZys9qQNsna2GtuZA_1PG9aTMbhomyLiZ4VWjvzDJAGnhW5VmYeNbc9Wfvq-JUszTYcxwj2He2nu9GZZczO4p0KwwTT_dGejPYyldoC9X0VnMKWR2n",cookie_domain:".tinypass.com",user_token:"{jax}9uttX5YDRhUKjR14bfaAtpuD606dfqROTyz8YOa2qt7BqylnedqHwiFn7Q-MvbYoikxIHjUEoFQFyq7fwZyQe5TiNbF718c933SIK7dC1NL107IsqWP5om6q3DhyKTUGYIB4FoNzUj1GC-L-rZ26_EOvFsTw5pHRxnlzumbOr2_XT4VRtjRuoNyZmqzqrXzf"})}},"redemptionService"),e}])},t.mockGiftService=function(){t.$provide.decorator("giftService",["$delegate","$q","$timeout",function(e,n,r){return t.$q=n,t.$timeout=r,t.mockPromiserFunction(e,{saveGiftParams:function(){return{models:{ok:!0},routes:{},errors:[]}}},"redemptionService"),e}])},t.mockRegistrationService=function(){t.$provide.decorator("registrationService",["$delegate","$q","$timeout",function(e,n,r){return t.$q=n,t.$timeout=r,t.mockPromiserFunction(e,{initiatePurchase:function(e,t,n){t({receipt:{rid:"RID",termConversionId:"TCGE9V6HNBW1",termId:"TM7LXVS9F8KW",startedAt:"2018-01-22T08:26:14.284+0000",expires:1516695974,uid:"zGRCHAxwFw",email:"qwer11@qwer.qwer",token_list:"{jax}5aR8CiYr-kMXDdcT4PsPhx9EAjeRYpVCG4nDEeTYIJ34qCgWk98FqqN_byle6924ACZlx7tj_9e2J0QNezLMOXnbrYGFQYEssGcvBOFbMhiIRMDe7BR0XR-y0eKubB2GEoWKnqJLIoeXH6a-UceAMcUtDEGolqvvxmYHRBx_Mbc",cookie_domain:".tinypass.com",user_token:"{jax}8L7SjOo85dU9431e24jWWtydAEHhcrJ4JYS1hsGXKr5yOdJubiX2HA5w_EuPnIq8ptDe_QlV76alno9laHMtGWVoizZ48BZvHDBQSnVLxpwxJP-NC0DBc-4jG_eQtf4tkB-HNfKSbXDNPNOj9juJtyPkZFj0Ax0K7fHN1zBXjdk",promotionId:null},checkoutStats:{content_author:null,offer_template_version_num:null,content_section:null,currency_src:null,promo_code:null,promotion_id:null,experience_execution_id:null,experience_id:null,amount_base:null,browser_id:null,pageview_id:"2018-01-22-12-25-13-863-4jY1yTrNhnwjpBhK-3ec2322c169f37ff04cbc38e94b60b4b",campaigns:[],content_created:"null",AID:"MODEFOUR",shown_terms:["TM7LXVS9F8KW","TM40E4OZ0YTB","TMA19C7AHY45","TM7N0O596L9X","TM5KWTLUIOG4","TMOK70WEZN78","TMQLCIVH2FKJ","TMYOP839K7B2","TMI5I15KI7NS","TMWL7BZX4XF0","TM3L13Q6G5HP","TMKTXTWV6Z5I"],experience_action_id:null,promo_state:0,amount_src:null,currency_base:null,term_id:"TM7LXVS9F8KW",offer_id:"OF8VGPZO42BQ",offer_template_id:null,tags:[],template_id:null,offer_template_version_id:null,visit_id:"v-2018-01-22-12-25-13-866-VHk4iwgs6Y1mQ9sA-3ec2322c169f37ff04cbc38e94b60b4b"}})}},"registrationService"),e}])},t.mockPayWhatYouWantData=function(){t.$provide.decorator("payWhatYouWantData",["$delegate","$q","$timeout",function(e,n,r){return t.$q=n,t.$timeout=r,t.mockPromiserFunction(e,{getInitialData:{models:{minPriceUSD:"$15.99",maxPriceUSD:"$1000",minPrice:"$15.99",maxPrice:"$1000",currency:"USD",currencyRate:1,amountUSD:15.99,amount:15.99},routes:{},errors:[]},applyNewPrice:function(e,t,n){var r=parseFloat(""+n);return r<15.99||r>1e3?{errors:[{field:"",key:null,msg:"Amount invalid"}]}:{ok:{models:{},routes:{},errors:[]}}}},"payWhatYouWantData"),e}])},t.mockPaymentServiceData=function(){t.$provide.decorator("purchaseServiceData",["$delegate","$q","$timeout","$injector",function(e,n,r,o){return t.$q=n,t.$timeout=r,t.mockPromiserFunction(e,{initiatePurchase:function(e){var t=new Date,n=new Date(t.getFullYear()+3,t.getMonth()),r={4:{models:{result:"ok",oid:"C05mEkzvlDBGAA0ATRuTxgsWZnyg9ysd",stored:'[{"id":"PMKSKF3GJT2T","expire_year":"2015","expire_month":"11","ending_in":"1111","type":"Visa","identifier":"v"}]',stored_rurl:""},routes:{},errors:[]},8:{models:{result:"ok",uid:"D1dRm47BHFX3H2DxE_6QY_Y8wLYrGnDy5wGDt1ZrGzk",OID:"P0jKQ8wPBVo3kj44qS0E9d6moH9IBhPX",isRecurring:"false",oid:"C0bDapTEwv24ReGLvHC4wpXJaqQgqq16",sellerId:"AS1O4NPHMCIQE",aid:"AIDAIDAID0",clientId:"amzn1.application-oa2-client.57294db70bde435b866f210407b7556c"},routes:{},errors:[]},11:{models:{result:"ok",oid:"C01Rda4EllaGzQQF1DRNp3nM56YvwclF",client_token:"eyJ2ZXJzaW9uIjoyLCJhdXRob3JpemF0aW9uRmluZ2VycHJpbnQiOiI1ZDdhNjIyZWJlZmMzYjYyYWI3YWJhNWUxMGMyNmNjN2Y0OWNjZDFmNzliMWY3NzIwNTY0ODYzNjNmOGIwOGQyfGNyZWF0ZWRfYXQ9MjAxNS0wOC0xMFQwNzoxOToxOC45MDczMzYzMDQrMDAwMFx1MDAyNm1lcmNoYW50X2lkPW5kNG1iNHNuZmMzNDloZmZcdTAwMjZwdWJsaWNfa2V5PXR2d2YzZzd6cXlrNmo5eHMiLCJjb25maWdVcmwiOiJodHRwczovL2FwaS5zYW5kYm94LmJyYWludHJlZWdhdGV3YXkuY29tOjQ0My9tZXJjaGFudHMvbmQ0bWI0c25mYzM0OWhmZi9jbGllbnRfYXBpL3YxL2NvbmZpZ3VyYXRpb24iLCJjaGFsbGVuZ2VzIjpbImN2diIsInBvc3RhbF9jb2RlIl0sImVudmlyb25tZW50Ijoic2FuZGJveCIsImNsaWVudEFwaVVybCI6Imh0dHBzOi8vYXBpLnNhbmRib3guYnJhaW50cmVlZ2F0ZXdheS5jb206NDQzL21lcmNoYW50cy9uZDRtYjRzbmZjMzQ5aGZmL2NsaWVudF9hcGkiLCJhc3NldHNVcmwiOiJodHRwczovL2Fzc2V0cy5icmFpbnRyZWVnYXRld2F5LmNvbSIsImF1dGhVcmwiOiJodHRwczovL2F1dGgudmVubW8uc2FuZGJveC5icmFpbnRyZWVnYXRld2F5LmNvbSIsImFuYWx5dGljcyI6eyJ1cmwiOiJodHRwczovL2NsaWVudC1hbmFseXRpY3Muc2FuZGJveC5icmFpbnRyZWVnYXRld2F5LmNvbSJ9LCJ0aHJlZURTZWN1cmVFbmFibGVkIjp0cnVlLCJ0aHJlZURTZWN1cmUiOnsibG9va3VwVXJsIjoiaHR0cHM6Ly9hcGkuc2FuZGJveC5icmFpbnRyZWVnYXRld2F5LmNvbTo0NDMvbWVyY2hhbnRzL25kNG1iNHNuZmMzNDloZmYvdGhyZWVfZF9zZWN1cmUvbG9va3VwIn0sInBheXBhbEVuYWJsZWQiOnRydWUsInBheXBhbCI6eyJkaXNwbGF5TmFtZSI6IlRpbnkgUGFzcyIsImNsaWVudElkIjpudWxsLCJwcml2YWN5VXJsIjoiaHR0cDovL2V4YW1wbGUuY29tL3BwIiwidXNlckFncmVlbWVudFVybCI6Imh0dHA6Ly9leGFtcGxlLmNvbS90b3MiLCJiYXNlVXJsIjoiaHR0cHM6Ly9hc3NldHMuYnJhaW50cmVlZ2F0ZXdheS5jb20iLCJhc3NldHNVcmwiOiJodHRwczovL2NoZWNrb3V0LnBheXBhbC5jb20iLCJkaXJlY3RCYXNlVXJsIjpudWxsLCJhbGxvd0h0dHAiOnRydWUsImVudmlyb25tZW50Tm9OZXR3b3JrIjp0cnVlLCJlbnZpcm9ubWVudCI6Im9mZmxpbmUiLCJ1bnZldHRlZE1lcmNoYW50IjpmYWxzZSwiYnJhaW50cmVlQ2xpZW50SWQiOiJtYXN0ZXJjbGllbnQzIiwibWVyY2hhbnRBY2NvdW50SWQiOiJUaW55UGFzcyIsImN1cnJlbmN5SXNvQ29kZSI6IlVTRCJ9LCJjb2luYmFzZUVuYWJsZWQiOmZhbHNlLCJtZXJjaGFudElkIjoibmQ0bWI0c25mYzM0OWhmZiIsInZlbm1vIjoib2ZmIn0=",stored_rurl:"http://ya.ru",stored:"[]"}},12:{models:{result:"ok",reference:"https://payments-test.worldpay.com/app/hpp/integration/wpg/corporate?OrderKey=TINYPASSCONTAUTHGBP%5EWP_HPP_2hh1111111&Ticket=001517915190836025MWbIbtqPgF-GWM4kmhKpQ",oid:"2222",server_url:window.location.origin,stored:"[]"},routes:{},errors:[]},20:{models:{result:"ok",publicKey:"1#10001#11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111112222222222222222222222222223333333333333333333333333333333334444444444444444444444444444444444444555555555555555555555555555555555555555555555555566666666666666666666666666666666666666677777777777777777777777777778888888888888888888889999999999999999999999999999999999999999999911111111111111111111111111111112222222222222222222222222222222222222333333333333333333333444444444444444",oid:"22222",stored:"[]"},routes:{},errors:[]},37:{models:{result:"ok",pollingEnabled:!1,stored_rurl:"https://localhost/checkout/offer/onetStoredReturn?storeInVault=true&uid=-BHW3OcAZDtC5zc2T5xh9g&store_in_vault=true&OID=P03oQr2osRHqhro5rOiFBoTSj8v4rBOl&oid=C0VK2vnTfF0IqoooPFDXyBKAcAkmtAic&aid=D2HxKhD4kk",stored:'[{"identifier":"v","ending_in":"1111","expire_month":"null","id":"PMPS3U2OOA3R","expire_year":"null","type":"Visa","postal_code":"null","tax_request":"{\\"billingCountryCode\\":\\"\\",\\"residenceCountryCode\\":null,\\"zip\\":null,\\"billingZipCode\\":null,\\"empty\\":true,\\"residenceZipCode\\":null}"}]',oid:"C0VK2vnTfF0IqoooPFDXyBKAcAkmtAic"},routes:{},errors:[]},40:{models:{result:"ok",pollingEnabled:!1,oid:e.oid,stored:JSON.stringify([{id:"PMKSKF3GJT2T",expire_year:n.getFullYear(),expire_month:n.getMonth()+1,ending_in:"ending_in",type:"Visa",identifier:"v"}]),publishableAPIKey:"pk_test_TYooMQauvdEDq54NiTphI7jx"}},45:{models:{result:"ok",pollingEnabled:!1,oid:e.oid,stored:JSON.stringify([{id:"PMKSKF3GJT2U",expire_year:n.getFullYear(),expire_month:n.getMonth()+1,ending_in:"*1003",type:"Visa",identifier:"v"}]),mockEnabled:!0}}};return r[e.pm_type]?r[e.pm_type]:{models:{result:"ok",oid:"C0wdxEfdvGXs3WHIN807aeMsVRE6WQhU",stored:"[]"},routes:{},errors:[]}},processPurchase:function(){return{models:{result:"ok",trData:"dee20d86a012093f5a6b216ebc8beff3ac357fe7|api_version=4&public_key=tvwf3g7zqyk6j9xs&redirect_url=http%3A%2F%2Fmf.co.uk%3A9000%2Fcheckout%2Foffer%2FbrainTreeReturn%3Fuid%3DD1dRm47BHFX3H2DxE_6QY_Y8wLYrGnDy5wGDt1ZrGzk%26OID%3DP08WV6zsQVb4vU1mDRijKWLNBepMI9T2%26oid%3DC0J7rHlpcmOj2X4IxHowMyVyeDiS0mU0%26aid%3DMODETWOAPP&time=20150807180846&kind=create_transaction&transaction%5Bdescriptor%5D%5Bname%5D=Mode2TestApp*Tinypass+&transaction%5Bmerchant_account_id%5D=TinyPass&transaction%5Btype%5D=sale&transaction%5Bamount%5D=1.99&transaction%5Border_id%5D=BTPnhusXE69u_1438970865435",trUrl:"https://api.sandbox.braintreegateway.com:443/merchants/nd4mb4snfc349hff/transparent_redirect_requests",q:"q"},routes:{},errors:[]}},listenForResponse:function(){return{event:"payment-complete",params:{q:"XDmlHDiuJCIxuz4jbsLwyZ84VTaNUhZ133N7yGPPMw5X0gaiiPPA2zHuzFe5W1mc_qcX-gtwcJ5pFTalVoI3Lm9KASwJDJF9NUYDFNuDOImOEQRbLmKeVM1j3HxuH6TeuL8qgdDd-2d53PGwV_MGePQTwJjAmOYUgb60yUA3W36rbXGRRrH7LXgdGoldSAeXmEixt5YdQExv8_bNi788KQ~~~mixwndv5mHynUIaN0LOoxCJPRDGEgZGVmjjy2gvEaGs"}}},completePurchase:function(){return{models:{receipt:{rid:"RID",chargeAmount:1.99,chargeCurrency:"USD",termConversionId:"TC5JFCHG5XAW",termId:"TM1FZ7H4W6A6",expires:1414929066,uid:"some-user1@yahoo.com"}},routes:{},errors:[]}},confirmPayment:function(){var e=o.get("checkout"),t=angular.copy(e.getSelectedTerm());return t.billingPlan=t.billingPlanTable,t.chargeAmount=t.firstRealPriceWithTax,{models:t}}},"paymentServiceData"),e}])},t.mockCreditCardService=function(){t.$provide.decorator("creditCardService",["$delegate","$q","$timeout",function(e,n,r){return t.$q=n,t.$timeout=r,t.mockPromiserFunction(e,{processCC:function(e,n,o,i){t.utils.sendPaymentComplete(r)}}),e}])},t.mockworldPayRxml=function(){t.$provide.decorator("worldPayRxml",["$delegate","$rootScope",function(e,n){return t.mockPromiserFunction(e,{beforeProcess:function(e){n.$broadcast(EVENT_PREVIEW_WP_RXML_TERM_COMPLETE,e)}}),e}])},t.mockworldPayHpp=function(){t.$provide.decorator("worldPayHpp",["$delegate","$rootScope",function(e,n){return t.mockPromiserFunction(e,{beforeProcess:function(e){n.$broadcast(EVENT_PREVIEW_WP_HPP_TERM_COMPLETE,e)}}),e}])},t.mockspreedly=function(){t.$provide.decorator("spreedly",["$delegate","$rootScope",function(e,n){return t.mockPromiserFunction(e,{beforeProcess:function(e){n.$broadcast(EVENT_PREVIEW_SPR_TERM_COMPLETE,e)}}),e}])},t.mockedgilPaywayProvider=function(){t.$provide.decorator("edgilPaywayProvider",["$delegate","$rootScope",function(e,n){return t.mockPromiserFunction(e,{beforeProcess:function(e){n.$broadcast(EVENT_PREVIEW_EDGIL_TERM_COMPLETE,e)}}),e}])},t.mockworldPayToken=function(){t.$provide.decorator("worldPayToken",["$delegate","$rootScope",function(e,n){return t.mockPromiserFunction(e,{beforeProcess:function(e){n.$broadcast(EVENT_PREVIEW_WP_TOKEN_TERM_COMPLETE,e)}}),e}])},t.mockeigenProvider=function(){t.$provide.decorator("eigenProvider",["$delegate","$rootScope",function(e,n){return t.mockPromiserFunction(e,{beforeProcess:function(e){n.$broadcast(EVENT_PREVIEW_EIGEN_TERM_COMPLETE,e)}}),e}])},t.mockStripe=function(){t.$provide.decorator("stripeProviderCH",["$delegate","$rootScope","eventsServiceCH",function(e,n,r){var o=r.events;return t.mockPromiserFunction(e,{beforeProcess:function(){return!1},processSucceed:function(){n.$broadcast(o.previewTermComplete)}}),e}])},t.mockopenpayCashProvider=function(){t.$provide.decorator("openpayCashProvider",["$delegate","$rootScope",function(e,n){return t.mockPromiserFunction(e,{beforeProcess:function(e){n.$broadcast(EVENT_PREVIEW_OPENPAY_CASH_TERM_COMPLETE,e)}}),e}])},t.mockapplePayBt=function(){t.$provide.decorator("applePayBt",["$delegate","$rootScope",function(e,n){return t.mockPromiserFunction(e,{initiateSucceed:function(e){n.$broadcast(EVENT_PREVIEW_APBT_TERM_COMPLETE,e)}}),e}])},t.mockcoinbase=function(){t.$provide.decorator("coinbase",["$delegate","$rootScope",function(e,n){return t.mockPromiserFunction(e,{beforeProcess:function(e){n.$broadcast(EVENT_PREVIEW_COINBASE_TERM_COMPLETE,e)},initiateSucceed:function(e){n.$broadcast(EVENT_PREVIEW_COINBASE_TERM_COMPLETE,e)}}),e}])},t.mockamazonmws=function(){t.$provide.decorator("amazonmws",["$delegate","$rootScope",function(e,n){return t.mockPromiserFunction(e,{initiateSucceed:function(e){n.$broadcast(EVENT_PREVIEW_COINBASE_TERM_COMPLETE,e)}}),e}])},t.mockdwolla=function(){t.$provide.decorator("dwolla",["$delegate","$rootScope",function(e,n){return t.mockPromiserFunction(e,{initiateSucceed:function(e){n.$broadcast(EVENT_PREVIEW_DWOLLA_TERM_COMPLETE,e)}}),e}])},t.mockEdgilCreditCardService=function(){t.$provide.decorator("edgilCreditCardService",["$delegate","$q","$timeout",function(e,n,r){return t.$q=n,t.$timeout=r,t.mockPromiserFunction(e,{processCC:function(e,n,o,i){t.utils.sendPaymentComplete(r)}}),e}])},t.mockEasyPay=function(){t.$provide.decorator("easypayBoletoService",["$delegate","$q","$timeout",function(e,n,r){return t.$q=n,t.$timeout=r,t.mockPromiserFunction(e,{generateBoleto:function(e,n,o,i){return t.utils.sendPaymentComplete(r),{billId:123,reference:123}}}),e}]),t.$provide.decorator("easypayDirectDebitService",["$delegate","$q","$timeout",function(e,n,r){return t.$q=n,t.$timeout=r,t.mockPromiserFunction(e,{startPurchase:function(e,n,o,i){return t.utils.sendPaymentComplete(r),{token:123,reference:123,orderId:123}},proceedPurchase:function(e,n,o,i){t.utils.sendPaymentComplete(r)}}),e}])},t.mockKlarna=function(){t.$provide.decorator("klarnaService",["$delegate","$q","$timeout",function(e,n,r){return t.$q=n,t.$timeout=r,e.getSession=function(){return Promise.resolve({sessionId:"3419e2fe-8f80-580b-937e-3ba3a0eadfd4",clientToken:"token.mock",paymentMethodCategories:[{identifier:"pay_later",name:"Pay later."},{identifier:"pay_now",name:"Pay now."}]}).then(function(t){return e.patchData("session",t),t})},e.init=function(){return Promise.resolve(!0)},e.load=function(){return Promise.resolve({})},e.completePayment=function(){return t.utils.sendPaymentComplete(r),Promise.resolve({})},e}])},t.mockDatatrans=function(){t.$provide.decorator("datatransIntegrationService",["$delegate","$q","$timeout","$injector",function(e,n,r,o){return t.$q=n,t.$timeout=r,e.init=function(){return Promise.resolve(!0)},e}])},t.mockObiPaypal=function(){t.$provide.decorator("obiPaypalIntegrationService",["$delegate","$q","$timeout","$injector",function(e,n,r,o){return t.$q=n,t.$timeout=r,t.mockPromiserFunction(e,{addPaypalAccount:function(){return{instrumentId:"instrument.id",billingAddress:{country:"US",state:"IL",city:"Chicago",street:"Lake Barrington Shores Str",postalCode:"60010"},email:"test.account@piano.io",paypalEmail:"test.account@paypal.com"}},processPurchase:function(){t.utils.sendPaymentComplete(r)}}),e}])},t.mockDatatransPostfinance=function(){t.$provide.decorator("datatransPostfinanceIntegrationService",["$delegate","$q","$timeout","$injector",function(e,n,r,o){return t.$q=n,t.$timeout=r,t.mockPromiserFunction(e,{startPostfinanceCheckout:function(){return{payerInfo:"****2345",result:"return",transactionId:"190110094910778768"}},processPurchase:function(){t.utils.sendPaymentComplete(r)}}),e}])},t.mockIframeService=function(){t.$provide.decorator("iframeService",["$delegate","$q","$timeout","$injector",function(e,n,r,o){return t.$q=n,t.$timeout=r,e.injectHiddenIframe=function(){return t.utils.sendPaymentComplete(r),Promise.resolve({})},e.injectHiddenIframeWithTimeout=function(){return t.utils.sendPaymentComplete(r),Promise.resolve({})},e}])},t.mockPaypalExpressCheckoutService=function(){t.$provide.decorator("paypalExpressCheckoutService",["$delegate","$q","$timeout",function(e,n,r){return t.$q=n,t.$timeout=r,t.mockPromiserFunction(e,{startExpressCheckout:function(){return{email:"test.account@paypal.com",token:"test_token",payerId:"test.account"}},processPurchase:function(){t.utils.sendPaymentComplete(r)}}),e}])},t.mockPayPalBtService=function(){t.$provide.decorator("payPalBtService",["$delegate","$q","$timeout",function(e,n,r){return t.$q=n,t.$timeout=r,t.mockPromiserFunction(e,{processPayPalBt:function(e,n,o,i){t.utils.sendPaymentComplete(r)}}),e}])},t.mockExternalVerificationService=function(){t.$provide.decorator("externalVerificationService",["$delegate","$q","$timeout",function(e,n,r){return t.$q=n,t.$timeout=r,t.mockPromiserFunction(e,{check:function(t,n,r,o){var i=!0;n.externalApiFields&&angular.forEach(n.externalApiFields,function(e){e.value!==e.defaultValue&&(i=!1)}),e.externalVerificationSucceeded=!0,e.externalVerificationStatus=i?"accepted":"rejected",e.externalVerificationConversionId="C0wdxEfdvGXs3WHIN807aeMsVRE6WQhU"}}),e}])},t.mockEigenCreditCardService=function(){t.$provide.decorator("eigenCreditCardService",["$delegate","$q","$timeout",function(e,n,r){return t.$q=n,t.$timeout=r,t.mockPromiserFunction(e,{processCC:function(e,n,o,i){t.utils.sendPaymentComplete(r)}}),e}])},e.config(["$provide",function(e){var n={};window.TPParam&&window.TPParam.params&&angular.copy(window.TPParam.params,n),"true"===n.preview&&(t.$provide=e,t.mockDataServices(e))}])}();var payPalBt=angular.module("payPalBtModule",["checkoutModule"]),EVENT_PREVIEW_PPBT_TERM_COMPLETE="EVENT_PREVIEW_PPBT_TERM_COMPLETE",EVENT_PPBT_BEFORE_INITIATE="EVENT_PPBT_BEFORE_INITIATE",EVENT_PPBT_INITIATE_SUCCEED="EVENT_PPBT_INITIATE_SUCCEED",EVENT_PPBT_PROCESS_SUCCEED="EVENT_PPBT_PROCESS_SUCCEED",EVENT_PPBT_FAILED="EVENT_PPBT_FAILED",DEFAULT_SELECTED_UPI_ID="0";payPalBt.factory("payPalBt",["$rootScope",function(e){var t={beforeInitiate:function(){e.$broadcast(EVENT_PPBT_BEFORE_INITIATE)},initiateSucceed:function(t){e.$broadcast(EVENT_PPBT_INITIATE_SUCCEED,t)},initiateFailed:function(e){},beforeProcess:function(){},processSucceed:function(t){e.$broadcast(EVENT_PPBT_PROCESS_SUCCEED,t)},processFailed:function(e){},confirmed:function(e){},declined:function(e){},completeSucceed:function(e){},completeFailed:function(t){e.$broadcast(EVENT_PPBT_FAILED,t&&t.length>0?t[0].msg:"Unknown error")}};return t}]),payPalBt.factory("payPalBtService",["tpHTTP","$q","$timeout","$window","checkout",function(e,t,n,r,o){return{processPayPalBt:function(e,t,n,r){angular.element("#paypalbt_frame").remove();var i=e.model.selectedUpiId!==DEFAULT_SELECTED_UPI_ID?e.storedRurl+"&id="+e.model.selectedUpiId:r.rurl+"&payment_method_nonce="+encodeURIComponent(o.input.paypalBt.nonce),a=angular.element('<iframe name="paypalbt_frame" id="paypalbt_frame" style="display: none" src="'+i+'"></iframe>');t.append(a)}}}]),payPalBt.directive("paypalThroughBraintreeFormComponent",["checkout","payPalBtService","cookieLang","billingConfig",function(e,t,n,r){return{restrict:"A",require:"^view",transclude:!0,templateUrl:"/widget/checkout/component/partials/paypal-through-braintree-form-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","errorService","$interval","$rootElement",function(o,i,a,c){angular.extend(o,BaseComponentController),e.input.paypalBt.nonce=null,o.model={selectedUpiId:DEFAULT_SELECTED_UPI_ID};var s=function(){return void 0!==e.input.paypalBt.nonce&&null!==e.input.paypalBt.nonce&&""!==e.input.paypalBt.nonce},u=function(){return s()||o.model.selectedUpiId!==DEFAULT_SELECTED_UPI_ID};o.isLoggedIn=s,o.canContinue=u,o.checkout=e;var l=!1;o.isContainerVisible=function(){return l},o.$on(EVENT_PREVIEW_PPBT_TERM_COMPLETE,function(){e._completeTerm({q:"q"})}),o.$on(EVENT_PPBT_FAILED,function(e,t){i(o).global(t)}),o.$on(EVENT_PPBT_BEFORE_INITIATE,function(){l=!1}),o.$on(EVENT_PPBT_INITIATE_SUCCEED,function(t,r){if(r.client_token)if(s())l=!0;else{o.stored=JSON.parse(r.stored),o.storedRurl=r.stored_rurl,e.disableCheckout();var c=angular.element("#paypal-bt-button");c.html("");var u=a(function(){""!==c.html()&&(a.cancel(u),e.enabledCheckout())},100,100);l=!0;var d={container:c,enableBillingAddress:!0,onPaymentMethodReceived:function(t){e.input.paypalBt.nonce=t.nonce,o.$apply()},onCancelled:function(){e.input.paypalBt.nonce=null,o.$apply()},onUnsupported:function(){e.input.paypalBt.nonce=null,o.$apply()}},p=function(){var e=n.getCookie("LANG"),t={en_US:"en_us",es_MX:"es_es",fr_CA:"fr_fr",it_IT:"it_it",de_DE:"de_de",nl_NL:"nl_nl",pl_PL:"pl_pl"};if(t.hasOwnProperty(e))return t[e];return""}();""!==p&&(d.locale=p),braintree.setup(r.client_token,"paypal",d),o.updateUpiInfo()}else i(o).terminal("client_token is missed")}),o.$on(EVENT_PPBT_PROCESS_SUCCEED,function(e,n){t.processPayPalBt(o,c,e,n)}),o._isValid=function(){return i(o).reset(),!(e.isPaymentMethod(PAYPAL_BT)&&!e.isMockUsed())||(!!u()||(i(o).global("You must be logged in to proceed further"),!1))},o.$watch("model.selectedUpiId",function(){o.updateUpiInfo()}),o.updateUpiInfo=function(){if(o.model.selectedUpiId!==DEFAULT_SELECTED_UPI_ID){var t=o.getTaxRequest();e.setUpiId(o.model.selectedUpiId),e.getUpiId()&&t&&r.updateFromTaxRequest(e,t)}},o.getTaxRequest=function(){if(o.model.selectedUpiId!==DEFAULT_SELECTED_UPI_ID)for(var e=0;e<o.stored.length;e++){var t=o.stored[e];if(t.id===o.model.selectedUpiId)return r.taxRequestFromUpi(t)}return null},propagatePaymentVars(e,o)}]}}]);var applePayBt=angular.module("applePayBtModule",["checkoutModule"]),EVENT_PREVIEW_APBT_TERM_COMPLETE="EVENT_PREVIEW_APBT_TERM_COMPLETE",EVENT_APBT_INITIATE_SUCCEED="EVENT_APBT_INITIATE_SUCCEED",EVENT_APBT_PROCESS_SUCCEED="EVENT_APBT_PROCESS_SUCCEED",EVENT_APPLE_PAY_BEFORE_PROCESS="EVENT_APPLE_PAY_BEFORE_PROCESS";applePayBt.factory("applePayBt",["$rootScope",function(e){var t={beforeInitiate:function(){},initiateSucceed:function(t){e.$broadcast(EVENT_APBT_INITIATE_SUCCEED,t)},initiateFailed:function(e){},beforeProcess:function(){e.$broadcast(EVENT_APPLE_PAY_BEFORE_PROCESS)},processSucceed:function(t){e.$broadcast(EVENT_APBT_PROCESS_SUCCEED,t)},processFailed:function(e){},confirmed:function(e){},declined:function(e){},completeSucceed:function(e){},completeFailed:function(e){}};return t}]),applePayBt.factory("applePayBtService",["tpHTTP","$q","$timeout","$window","checkout","lang",function(e,t,n,r,o,i){return{processApplePayBt:function(e,t,n,r){if(!e.selectedPaymentMethod.id)return;var i;angular.element("#apple_pay_bt_frame").remove(),i=e.selectedPaymentMethod.isNew?r.rurl+"&payment_method_nonce="+encodeURIComponent(o.input.applePayBt.nonce||o.input.paymentMethodNonce):e.storedRurl+"&id="+e.selectedPaymentMethod.id;var a=angular.element('<iframe name="apple_pay_bt_frame" id="apple_pay_bt_frame" style="display: none" src="'+i+'"></iframe>');t.append(a)},initPasswordlessApplePayBt:function(){return e({method:"post",url:TPParam.BRAINTREE_APPLE_PAY_CLIENT,params:{aid:o.getAid()}}).then(function(e){window.parent.postMessage(JSON.stringify({clientToken:e.models.btClientToken}),"*")})},errorCodes:{100:i.trc("checkout.platform","Error creating client"),101:i.trc("checkout.platform","Error creating applePayInstance"),102:i.trc("checkout.platform","Apple Pay failed to load"),103:i.trc("checkout.platform","Error tokenizing Apple Pay"),104:i.trc("checkout.platform","Error after applying a new shipping address")}}}]),applePayBt.directive("applePayThroughBraintreeFormComponent",["checkout","applePayBtService","lang","eventService","purchaseService","tpHTTP","viewService","userService","passwordlessService","utilsService","ngEventService","passwordlessPaymentService","checkoutUpdatesService",function(e,t,n,r,o,i,a,c,s,u,l,d,p){return{restrict:"A",require:"^view",transclude:!0,templateUrl:"/widget/checkout/component/partials/apple-pay-through-braintree-form-component.html",scope:{skipValidation:"@",termId:"@?"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","errorService","$rootElement","$q",function(i,a,u,f){var m,h;angular.extend(i,BaseComponentController);var g,v,y={},C=!1,E=[];function S(){return!!i.selectedPaymentMethod.id||C}function T(){return i.termId||""}i.enabled=!1,i.stored=[],i.isApplePayBtEnabled=!1,e.input.applePayBt.nonce=null,i.isPaymentAuthorized=A,i.cancelNewAccount=function(){C=!1,i.selectedPaymentMethod.id="",i.selectedPaymentMethod.isNew=!1,i.stored=angular.copy(E),i.stored.length>0&&(i.selectedPaymentMethod.id=i.stored[0].id,g=i.stored[0])},i.canContinue=S,i.changePaymentMethod=function(e){g=e,i.selectedPaymentMethod.isNew=!e.source},i.isPasswordlessCheckout=e.isPasswordlessCheckoutEnabled,i.isPaymentState=d.isPaymentState,i.isPasswordlessApplePayUsed=d.isPasswordlessApplePayUsed(),i.termId=i.termId||"",i.selectedPaymentMethod={id:"",isNew:!1},i.zeroTerm=!1,i.isApplePayBtShown=function(){return e.isPaymentMethod(APPLE_PAY_BT)||i.isPasswordlessCheckout()&&i.enabled};var _=function(t){C=!0,e.input.applePayBt.nonce=t,i.stored.push({id:t,isNew:!0}),i.selectedPaymentMethod.id=t,i.selectedPaymentMethod.isNew=!0,g=angular.copy(i.selectedPaymentMethod),i.$apply()};function w(){r.postMessage("applePayCheckoutFlowProperties",{isBillingAddressShown:i.isPasswordlessApplePayUsed})}function b(){return i.termId&&i.termId===e.flags.selectedTerm.termId}function P(e){d.completePasswordlessPayment(function(){_(e)},i)}function A(){return C}r.postMessage("checkApplePayBtInstance"),i.isPasswordlessApplePayUsed&&(i.enabled=e.flags.applePayCanMakePayments,w(),i.isApplePayBtEnabled||t.initPasswordlessApplePayBt()),window.addEventListener("message",function(n){try{y=JSON.parse(n.data)}catch(e){}switch(y.event){case"loaded":!function(){if(i.isSingleStepForm=d.isSingleStepForm(),!e.isPasswordlessCheckoutEnabled())return;i.enabled=e.flags.applePayCanMakePayments,i.termId&&i.termId===e.config.terms[0].termId&&(w(),t.initPasswordlessApplePayBt())}();break;case"applePayInit":!function(){var t=i.termId||e.flags.selectedTerm.termId;if(t)for(var n=e._findTerm(t).oneOffPaymentMethods||[],r=0;r<n.length;r+=1)n[r].id===APPLE_PAY_BT&&(i.isApplePayBtEnabled=!0,i.$apply())}();break;case"applePayNonce"+T():!function(t){t.params.nonce!==e.input.paymentMethodNonce&&function(t){b()&&(e.input.paymentMethodNonce=t.params.nonce||"");if(i.isSingleStepForm)return n=t.params.nonce,void s.loginUser(e).then(function(){P(n)});var n;!function(t){if(i.isPasswordlessApplePayUsed&&b()&&!c.isUserValid()){var n={oid:e.input.oid,nonce:t.params.nonce,email:t.params.user.email,aid:e.getAid(),url:e.params.url};d.proceedPasswordlessUser(i,n,v).then(function(e){e&&e.isPasswordlessEmailSent||P(t.params.nonce)})}else i.isPasswordlessApplePayUsed&&b()&&c.isUserValid()?P(t.params.nonce):_(t.params.nonce)}(t)}(t)}(y);break;case"applePayPaymentAuthorized"+T():d.checkSelectedTerm(i).then(function(){d.applyTax(i,y.params)});break;case"payment-error":!function(e){a(i).reset();var n=e.params.errorCode;void 0!==n&&t.errorCodes.hasOwnProperty(n)&&a(i).global(t.errorCodes[n])}(y)}},!1),i.$on(EVENT_PREVIEW_APBT_TERM_COMPLETE,function(){e._completeTerm({q:"q"})}),i.$on(EVENT_CHECKOUT_TERM_SELECTED,function(){C=!1,g=null,i.selectedPaymentMethod={id:"",isNew:!1}}),i.$on(EVENT_APBT_INITIATE_SUCCEED,function(t,r){if(!i.termId||i.termId===e.flags.selectedTerm.termId)if(r.client_token){if(A())return i.stored=JSON.parse(r.stored),i.stored.push(angular.copy({id:e.input.applePayBt.nonce,isNew:!0})),void(i.selectedPaymentMethod=angular.copy(g));e.input.oid,m=r.client_token,i.stored=JSON.parse(r.stored),E=JSON.parse(r.stored),i.storedRurl=r.stored_rurl,i.stored.length&&(i.selectedPaymentMethod=g||{id:i.stored[0].id,isNew:!1}),(h=window.parent).postMessage(JSON.stringify({clientToken:m}),"*")}else a(i).terminal(n.trc("checkout.platform","client_token is missing"))}),i.$on(EVENT_APBT_PROCESS_SUCCEED,function(e,n){(i.isPasswordlessApplePayUsed||i.isSingleStepForm)&&(i.selectedPaymentMethod.isNew=!0),t.processApplePayBt(i,u,e,n)}),l.subscribe(EVENT_CHECKOUT_PRICE_CHANGED,function(){i.zeroTerm=e.getSelectedTerm().isZero}),i.openApplePayWindow=function(t){var n;(w(),m&&i.isApplePayBtEnabled||e.isPasswordlessCheckoutEnabled())&&(n=t||{beginSession:!0,currencyCode:e.input.chargeCurrency,resourceTitle:e.config.app.name,chargeAmount:e.getSelectedTermChargeAmount()},e.isPasswordlessCheckoutEnabled()&&!h?window.parent.postMessage(JSON.stringify(n),"*"):h.postMessage(JSON.stringify(n),"*"))},i.openPasswordLessApplePay=function(){a(i).reset(),v=e._findTerm(i.termId),o.createOrder(e,i.termId,e.config.offerId,e.params.templateId).then(function(t){return e.input.oid=t.models.oid,e.input.sharedAccountCount=t.models.sourceTerm.sharedAccountCount,e._selectTerm(v),p.updatePaymentMethods(!1,e)}).then(function(){var t=v.isZero?ZERO:APPLE_PAY_BT;return e.setUpiId(null),e.selectPaymentMethodById(t)}).then(function(t){t&&d.setPurchaseInitiated(t.purchaseInitiated),v.isZero&&e.completePayment()}),e.isTermAllowedToSelect(v)&&!v.isZero&&i.openApplePayWindow({beginSession:!0,currencyCode:v.chargeCurrency,resourceTitle:e.config.app.name,chargeAmount:e.getTermChargeAmount(v),termId:v.termId})},i._isValid=function(){return a(i).reset(),!!i.isPasswordlessApplePayUsed||(!(e.isPaymentMethod(APPLE_PAY_BT)&&!e.isMockUsed()&&b())||(!!S()||(a(i).global(n.trc("checkout.platform","You must authorize payment to proceed further")),!1)))},propagatePaymentVars(e,i)}]}}]);var worldPayProvider=angular.module("worldPayModule",["checkoutModule"]),EVENT_PREVIEW_WP_RXML_TERM_COMPLETE="EVENT_PREVIEW_WP_RXML_TERM_COMPLETE",EVENT_WP_RXML_INITIATE_SUCCEED="EVENT_WP_RXML_INITIATE_SUCCEED",EVENT_WP_RXML_BEFORE_PROCESS="EVENT_WP_RXML_BEFORE_PROCESS",EVENT_WP_RXML_PROCESS_SUCCEED="EVENT_WP_RXML_PROCESS_SUCCEED",EVENT_WP_RXML_PROCESS_FAILED="EVENT_WP_RXML_PROCESS_FAILED",EVENT_WP_RXML_CONFIRMED="EVENT_WP_RXML_CONFIRMED",EVENT_WP_RXML_DECLINED="EVENT_WP_RXML_DECLINED",EVENT_WP_RXML_WAITING_FINISHED="EVENT_WP_RXML_WAITING_FINISHED",MAX_RETRY_COUNT=15,DELAY_RETRY=2e3;worldPayProvider.factory("worldPayRxml",["$rootScope","$q","tpHTTP",function(e,t,n){var r={},o=0;return r.beforeInitiate=function(){o=0},r.initiateSucceed=function(t){e.$broadcast(EVENT_WP_RXML_INITIATE_SUCCEED,t)},r.initiateFailed=function(e){},r.beforeProcess=function(){e.$broadcast(EVENT_WP_RXML_BEFORE_PROCESS)},r.processSucceed=function(t){e.$broadcast(EVENT_WP_RXML_PROCESS_SUCCEED,t)},r.processFailed=function(t){e.$broadcast(EVENT_WP_RXML_PROCESS_FAILED,t)},r.confirmed=function(t){e.$broadcast(EVENT_WP_RXML_CONFIRMED,t)},r.declined=function(t,n){return n.retry&&JSON.parse(n.retry.toLowerCase())&&o<MAX_RETRY_COUNT?(o++,e.$broadcast(EVENT_WP_RXML_DECLINED,t),!0):(e.$broadcast(EVENT_WP_RXML_WAITING_FINISHED,t),!1)},r.completeSucceed=function(e){},r.completeFailed=function(e){},r}]),worldPayProvider.directive("worldpayRxmlFormComponent",["checkout",function(e){return{restrict:"A",require:"^view",transclude:!0,templateUrl:"/widget/checkout/component/partials/worldpay-rxml-form-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","errorService","$interval","$rootElement","tpHTTP","$q","checkout","billingConfig","checkoutUpdatesService",function(e,t,n,r,o,i,a,c,s){var u;e.continue=!1,e.upis=[],e.initArgs={},e.showUpis=!1,e.checkedUpi="",e.storedRurl="",e.worldpay={},e.worldpay.saveCreditCard=!0,e.worldpay.worldpayReference="";var l,d=function(){return e.continue};function p(e){var t=angular.element('<iframe name="worldpay_frame" id="worldpay_frame" style="display: none" src="'+e+'"></iframe>');r.append(t)}function f(){if(a.getUpiId())for(var t=0;t<e.upis.length;t++){var n=e.upis[t];if(n.id===a.getUpiId()){var r=c.taxRequestFromUpi(n);c.updateFromTaxRequest(a,r)}}}e.changeUpi=function(t){e.checkedUpi=t,a.setUpiId(t),e.checkedUpi&&(e.continue=!0),f()},e.showCreditCards=function(){e.showUpis=!0,e.continue=!1},e.addNewCard=function(t){e.showUpis=!1,e.continue=!0,a.setUpiId(""),e.checkedUpi="",e.completePayment()},e.canContinue=d,e._isValid=function(){return t(e).reset(),!((a.isPaymentMethod(WORLDPAY_IDEAL)||a.isPaymentMethod(WORLDPAY_PAYPAL)||a.isPaymentMethod(WORLDPAY_ELV))&&!a.isMockUsed())||(!!d()||(t(e).global("Can't complete payment"),!1))},e.saveCC=function(){e.worldpay.saveCreditCard=!e.worldpay.saveCreditCard,a.input.storeInVault=e.worldpay.saveCreditCard},e.$on(EVENT_PREVIEW_WP_RXML_TERM_COMPLETE,function(e,t){a._completeTerm({q:"q"})}),e.$on(EVENT_WP_RXML_INITIATE_SUCCEED,function(t,n){e.upis=JSON.parse(n.stored),e.initArgs=n,e.storedRurl=n.stored_rurl,e.continue=!1,a.setUpiId(""),e.checkedUpi="",a.input.storeInVault=void 0===a.input.storeInVault||a.input.storeInVault,e.upis.length>0?(e.showUpis=!0,e.continue=!1):(e.showUpis=!1,e.continue=!0),f()}),e.$on(EVENT_WP_RXML_BEFORE_PROCESS,function(){if(!1===e.showUpis){var t="";if(a.isPaymentMethod(WORLDPAY_IDEAL))t="iDeal";else if(a.isPaymentMethod(WORLDPAY_PAYPAL))t="PayPal";else{if(!a.isPaymentMethod(WORLDPAY_ELV))throw"Not implemented";t="ELV"}u=createPaymentPopUp(800,600,t),e.continue=!0}}),e.$on(EVENT_WP_RXML_PROCESS_SUCCEED,function(t,n){(a.disableCheckout(),l=n.rurl+"&status=success",e.checkedUpi)?p(e.storedRurl+"&id="+e.checkedUpi):(u.location.href=n.reference,e.worldpay.worldpayReference=n.reference)}),e.$on(EVENT_WP_RXML_PROCESS_FAILED,function(e,t){u&&u.close()}),e.$on(EVENT_WP_RXML_CONFIRMED,function(e,t){u&&u.close()}),e.$on(EVENT_WP_RXML_DECLINED,function(e,n){u&&u.close(),t(a.$rootScope).reset(),setTimeout(function(){p(l)},DELAY_RETRY)}),e.$on(EVENT_WP_RXML_WAITING_FINISHED,function(e,n){a.enabledCheckout(),n&&(t(a.$rootScope).reset(),s.updatePaymentMethods(!0,a))}),e.completePayment=function(){a.completePayment()},propagatePaymentVars(a,e)}]}}]);var worldPayHppModule=angular.module("worldPayHppModule",["checkoutModule","tp.i18n","generalModule","consentModule"]),EVENT_PREVIEW_WP_HPP_TERM_COMPLETE="EVENT_PREVIEW_WP_HPP_TERM_COMPLETE",EVENT_WP_HPP_INITIATE_SUCCEED="EVENT_WP_HPP_INITIATE_SUCCEED",EVENT_WP_HPP_PROCESS_SUCCEED="EVENT_WP_HPP_PROCESS_SUCCEED",EVENT_WP_HPP_DECLINED="EVENT_WP_HPP_DECLINED",EVENT_WP_HPP_WAITING_FINISHED="EVENT_WP_HPP_WAITING_FINISHED",MAX_RETRY_COUNT=15,DELAY_RETRY=2e3;worldPayHppModule.factory("worldPayHpp",["$rootScope","$q","tpHTTP",function(e,t,n){var r={},o=0;return r.beforeInitiate=function(){o=0},r.initiateSucceed=function(t){e.$broadcast(EVENT_WP_HPP_INITIATE_SUCCEED,t)},r.initiateFailed=function(e){},r.beforeProcess=function(){},r.processSucceed=function(t){e.$broadcast(EVENT_WP_HPP_PROCESS_SUCCEED,t)},r.processFailed=function(e){},r.confirmed=function(t){e.$broadcast(EVENT_WP_HPP_WAITING_FINISHED)},r.declined=function(t,n){return n.retry&&JSON.parse(n.retry.toLowerCase())&&o<MAX_RETRY_COUNT?(o++,e.$broadcast(EVENT_WP_HPP_DECLINED,t),!0):(e.$broadcast(EVENT_WP_HPP_WAITING_FINISHED,t),!1)},r.completeSucceed=function(e){},r.completeFailed=function(e){},r}]),worldPayHppModule.directive("worldpayHppFormComponent",["checkout","cookieLang",function(e,t){return{restrict:"A",require:"^view",transclude:!0,templateUrl:"/widget/checkout/component/partials/worldpay-hpp-form-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","errorService","$interval","$rootElement","tpHTTP","$q","checkout","topLocation","ngEventService","billingConfig","checkoutUpdatesService",function(e,n,r,o,i,a,c,s,u,l,d){var p=Math.random(),f=function(){var e=a.defer();return function t(){return s().then(function(n){n.hash.indexOf("successwp_"+p)>=0?(s.hash(n.hash.replace("successwp_"+p,"")),e.resolve({status:"pending"})):n.hash.indexOf("cancelwp_"+p)>=0?(s.hash(n.hash.replace("cancelwp_"+p,"")),e.resolve({status:"cancel"})):n.hash.indexOf("failurewp_"+p)>=0?(s.hash(n.hash.replace("failurewp_"+p,"")),e.resolve({status:"failure"})):n.hash.indexOf("pendingwp_"+p)>=0?(s.hash(n.hash.replace("pendingwp_"+p,"")),e.resolve({status:"pending"})):n.hash.indexOf("errorwp_"+p)>=0?(s.hash(n.hash.replace("errorwp_"+p,"")),e.resolve({status:"error"})):setTimeout(t,500)})}(),e.promise};e.continue=!1,e.upis=[],e.initArgs={},e.showUpis=!1,e.checkedUpi="",e.worldPayHpp={},e.worldPayHpp.saveCreditCard=!0,c.input.storeInVault=!0,e.storedRurl="",e.saveCCHpp=function(){e.worldPayHpp.saveCreditCard=!e.worldPayHpp.saveCreditCard,c.input.storeInVault=e.worldPayHpp.saveCreditCard,c.selectPaymentMethod(c.flags.selectedPaymentMethod)};var m=function(n){return e.continue=!1,function(e){return s().then(function(n){var r=e.server_url,o=n.href;"#"!==o.substr(o.length-1)&&(o+="#");var i={success:o+"successwp_"+p,cancel:o+"cancelwp_"+p,failure:o+"failurewp_"+p,pending:o+"pendingwp_"+p,error:o+"errorwp_"+p};return customOptions={type:"iframe",iframeIntegrationId:"libraryObject",iframeHelperURL:r+"/widget/worldpay.helper.shtml",iframeBaseURL:r,url:""+e.reference,target:"worldpay_hpp_placeholder",accessibility:!1,debug:!1,language:t.getLanguageCode(),country:"gb",preferredPaymentMethod:"",successURL:i.success,cancelURL:i.cancel,failureURL:i.failure,pendingURL:i.pending,errorURL:i.error}})}(n).then(function(e){var t=window.libraryObject=new WPCL.Library;t.setup(e);var n=t.resize;t.resize=function(e){n.call(this,e,!0),c.resize()},u.subscribe("EVENT_WP_HPP_HELPER",function(e,n){var r=n.method,o=n.arg;r&&t[r]&&"function"==typeof t[r]&&t[r](o)}),window.onload()}).then(f).then(function(t){e.worldPayHpp.status=t.status,c.completePayment().catch(function(){e.continue=!0})})};e.$on(EVENT_PREVIEW_WP_HPP_TERM_COMPLETE,function(e,t){c._completeTerm({q:"q"})}),e.$on(EVENT_WP_HPP_INITIATE_SUCCEED,function(t,n){e.upis=JSON.parse(n.stored),e.checkedUpi="",e.initArgs=n,e.continue=!1,c.setUpiId(""),c.input.storeInVault=void 0===c.input.storeInVault||c.input.storeInVault,0===e.upis.length?(m(n),e.showUpis=!1):e.showUpis=!0,v()});var h;function g(e){var t=angular.element('<iframe name="worldpay_frame" id="worldpay_frame" style="display: none" src="'+e+'"></iframe>');o.append(t)}function v(){if(c.getUpiId())for(var t=0;t<e.upis.length;t++){var n=e.upis[t];if(n.id===c.getUpiId()){var r=l.taxRequestFromUpi(n);l.updateFromTaxRequest(c,r)}}}e.changeUpi=function(t){e.checkedUpi=t,e.checkedUpi&&(e.continue=!0),v()},e.showCreditCards=function(){e.showUpis=!0},e.addNewCard=function(t){e.showUpis=!1,m(t)},e.canContinue=function(){return e.continue},e._isValid=function(){return n(e).reset(),!c.isPaymentMethod(WORLDPAY_HPP)||c.isMockUsed(),!0},e.$on(EVENT_WP_HPP_PROCESS_SUCCEED,function(t,n){c.disableCheckout(),e.storedRurl=n.stored_rurl,g(h=e.checkedUpi?e.storedRurl+"&id="+e.checkedUpi:n.rurl+"&status="+e.worldPayHpp.status)}),e.$on(EVENT_WP_HPP_DECLINED,function(e,t){n(c.$rootScope).reset(),setTimeout(function(){g(h)},DELAY_RETRY)}),e.$on(EVENT_WP_HPP_WAITING_FINISHED,function(e,t){n(c.$rootScope).reset(),c.enabledCheckout(),t&&d.updatePaymentMethods(!0,c)}),propagatePaymentVars(c,e)}]}}]);var worldPayTokenModule=angular.module("worldPayTokenModule",["checkoutModule","tp.i18n","generalModule","consentModule"]),EVENT_PREVIEW_WP_TOKEN_TERM_COMPLETE="EVENT_PREVIEW_WP_TOKEN_TERM_COMPLETE",EVENT_WP_TOKEN_INITIATE_SUCCEED="EVENT_WP_TOKEN_INITIATE_SUCCEED",EVENT_WP_TOKEN_BEFORE_PROCCESS="EVENT_WP_TOKEN_BEFORE_PROCCESS",EVENT_WP_TOKEN_PROCESS_SUCCEED="EVENT_WP_TOKEN_PROCESS_SUCCEED",EVENT_WP_TOKEN_DECLINED="EVENT_WP_TOKEN_DECLINED",EVENT_WP_TOKEN_COMPLETE_FAILED="EVENT_WP_TOKEN_COMPLETE_FAILED";worldPayTokenModule.factory("worldPayToken",["$rootScope","$q","tpHTTP",function(e,t,n){var r={beforeInitiate:function(){},initiateSucceed:function(t){e.$broadcast(EVENT_WP_TOKEN_INITIATE_SUCCEED,t)},initiateFailed:function(e){},beforeProcess:function(){e.$broadcast(EVENT_WP_TOKEN_BEFORE_PROCCESS)},processSucceed:function(t){e.$broadcast(EVENT_WP_TOKEN_PROCESS_SUCCEED,t)},processFailed:function(e){},confirmed:function(e){},declined:function(t,n){e.$broadcast(EVENT_WP_TOKEN_DECLINED,t)},completeSucceed:function(e){},completeFailed:function(t){e.$broadcast(EVENT_WP_TOKEN_COMPLETE_FAILED,t)}};return r}]),worldPayTokenModule.directive("worldpayTokenFormComponent",["checkout",function(e){return{restrict:"A",require:"^view",transclude:!0,templateUrl:"/widget/checkout/component/partials/worldpay-token-form-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","errorService","$interval","$rootElement","tpHTTP","$q","checkout","topLocation","ngEventService","$rootScope","lang","billingConfig",function(e,t,n,r,o,i,a,c,s,u,l,d){var p;function f(){var n={101:l.trc("checkout.platform","A credit or debit card number is mandatory"),102:l.trc("checkout.platform","Card number should contain between 12 and 20 digits"),103:l.trc("checkout.platform","The card number entered is invalid"),201:l.trc("checkout.platform","The security code is invalid"),301:l.trc("checkout.platform","The Expiry Month is not set"),302:l.trc("checkout.platform","Expiry Month must contain exactly 2 digits"),303:l.trc("checkout.platform","Expiry Month should be between 01 and 12"),304:l.trc("checkout.platform","The Expiry Year is not set"),305:l.trc("checkout.platform","Expiry Year must contain exactly 2 digits"),306:l.trc("checkout.platform","Expiry Month and Expiry Year together must form a date in the future"),401:l.trc("checkout.platform","Card Holder name is mandatory"),402:l.trc("checkout.platform","Card Holder name cannot exceed thirty (30) characters")},r={cvc:e.credit_card.cvv,cardHolderName:e.credit_card.cardholder,cardNumber:e.credit_card.num,expiryMonth:e.credit_card.expire_month,expiryYear:"20"+e.credit_card.expire_year};Worldpay.setPublicKey(e.worldpayClientKey);var o=Worldpay.encrypt(r,function(e){for(var r=[],o=0;o<e.length;o++)r[o]=n[e[o]],t(u).global(r[o])});return o||""}e.worldpayClientKey="",e.cc={payWithNew:!0,initiated:!0,defaultPaymentMethodId:null},e.credit_card={num:null,expire_month:null,expire_year:null,cvv:null,cardholder:null,store_in_vault:!0},e.$on(EVENT_PREVIEW_WP_TOKEN_TERM_COMPLETE,function(e,t){a._completeTerm({q:"q"})}),e.$on(EVENT_WP_TOKEN_BEFORE_PROCCESS,function(){!0===e.cc.payWithNew&&(e.cc.selectedUpiId=null,a.setUpiId(null)),a.input.storeInVault=e.credit_card.store_in_vault,a.input.defaultPaymentMethodId=e.credit_card.store_in_vault&&e.cc.defaultPaymentMethodId}),e.$on(EVENT_WP_TOKEN_COMPLETE_FAILED,function(e,n){a.enabledCheckout(),t(u).global(n[0].msg)}),e.$on(EVENT_WP_TOKEN_DECLINED,function(e,t){a.enabledCheckout()}),e.$on(EVENT_WP_TOKEN_INITIATE_SUCCEED,function(t,n){p=n.storedRurl,e.worldpayClientKey=n.publicKey,e.cc.stored=JSON.parse(n.stored),e.cc.defaultPaymentMethodId=n.defaultPaymentMethodId,e.cc.stored.length>0&&(e.cc.payWithNew=!1,e.cc.initiated=!0,e.cc.selectedUpiId=e.cc.stored[0].id),m()}),e.$watch("cc.selectedUpiId",function(){m()}),e.getTaxRequest=function(){if(e.cc.payWithNew)return null;if(e.cc.selectedUpiId)for(var t=0;t<e.cc.stored.length;t++){var n=e.cc.stored[t];if(n.id===e.cc.selectedUpiId)return d.taxRequestFromUpi(n)}return null};function m(){var t=e.getTaxRequest();a.setUpiId(e.cc.selectedUpiId),a.getUpiId()&&t&&d.updateFromTaxRequest(a,t)}e.changeUpi=function(t){e.checkedUpi=t,e.checkedUpi&&(e.continue=!0)},e.canContinue=function(){return e.continue},e._isValid=function(){return t(e).reset(),!(a.isPaymentMethod(WORLDPAY_CC_TOKEN)&&!a.isMockUsed())||(!e.cc.payWithNew||!!f())},e.$on(EVENT_WP_TOKEN_PROCESS_SUCCEED,function(t,n){a.disableCheckout();var o,i,c=!e.cc.payWithNew&&e.cc.selectedUpiId?p+"&id="+e.cc.selectedUpiId:n.rurl+"&cc="+encodeURIComponent(JSON.stringify({wp_encrypted_card:f(),cardholder:e.credit_card.cardholder,exp_mon:parseInt(e.credit_card.expire_month),exp_yr:parseInt("20"+e.credit_card.expire_year)}));o=c,i=angular.element('<iframe name="worldpay_token_frame" id="worldpay_token_frame" style="display: none" src="'+o+'"></iframe>'),r.append(i)}),propagatePaymentVars(a,e)}]}}]);var spreedlyDefaultStrategyModule=angular.module("spreedlyDefaultStrategyModule",["checkoutModule","tp.i18n"]);spreedlyDefaultStrategyModule.factory("spreedlyDefaultStrategy",["errorService","checkout","lang",function(e,t,n){return{init:function(e){},destroy:function(){},getTokenizationData:function(e){return tokenizeParams={},e.credit_card.cardholder?tokenizeParams={full_name:e.credit_card.cardholder,year:"20"+e.credit_card.expire_year,month:e.credit_card.expire_month,email:t.config.user.email}:tokenizeParams={first_name:e.first_name,last_name:e.last_name,year:"20"+e.credit_card.expire_year,month:e.credit_card.expire_month,email:t.config.user.email},tokenizeParams},getNotProtectedFields:function(){return[{name:"expire_month",msg:n.trc("checkout.platform","Expired month is required")},{name:"expire_year",msg:n.trc("checkout.platform","Expired year is required")},{name:"postal_code",msg:n.trc("checkout.platform","Postal code is required")}]}}}]);var spreedlyPayULatamStrategyModule=angular.module("spreedlyPayULatamStrategyModule",["checkoutModule","tp.i18n","ajaxServices","ngCookies"]);spreedlyPayULatamStrategyModule.factory("spreedlyPayULatamStrategy",["tpHTTP","$q","errorService","checkout","lang","$cookies","$http",function(e,t,n,r,o,i,a){var c,s,u,l="js-payu-container",d=!1;return{init:function(n){var i;if(n.credit_card.email=r.config.user.email||r.getPasswordlessEmail(),$("#userAgent").val(navigator.userAgent),n.dniTypes=[{code:"CC",name:o.trc("default","Citizenship card")},{code:"CE",name:o.trc("default","Foreign citizenship card")},{code:"NIT",name:o.trc("default","For a company")},{code:"TI",name:o.trc("default","Identity Card")},{code:"PP",name:o.trc("default","Passport")},{code:"IDC",name:o.trc("default","Client's unique identifier")},{code:"CEL",name:o.trc("default","Identification by the mobile line")},{code:"RC",name:o.trc("default","Birth certificate")},{code:"DE",name:o.trc("default","Foreign identification document")}],n.ccForm.country){var f={oid:n.input.oid};e.get(TPParam.LOAD_PAYULATAM_UI_MODELS,{params:f}).then(function(e){d=e.data.models.showCountrySelector||!1,n.paymentCountry=e.data.models.paymentCountry,n.credit_card.country=n.paymentCountry,d?function(){var e={},t={},r=g(),l=v(),d=!1,p=!1;function f(){var e=t[n.credit_card.country.countryCode];i=null,n.showDropdown=void 0!==e&&e.length>0,n.stateSelectorOptions.selectorModel.label=r,n.citySelectorOptions.selectorModel.label=l,n.credit_card.state="",n.credit_card.city="",n.stateSelectorOptions.items=e||[],n.citySelectorOptions.items=[]}function m(t){d=!0,i!==t.name&&(n.credit_card.city="",n.citySelectorOptions={selectorModel:{label:l}},p=!1,n.credit_card.state=t.name,n.citySelectorOptions.items=e[t.category]||[],i=t.name)}function h(e){p=!0,n.credit_card.city=e.name}function g(){return o.trc("checkout.platform","State")}function v(){return o.trc("checkout.platform","City")}n.stateSelectorOptions={selectorModel:{label:r},items:[]},n.citySelectorOptions={selectorModel:{label:l},items:[]},o.on(function(){r=g(),d||(n.stateSelectorOptions.selectorModel.label=r),l=v(),p||(n.citySelectorOptions.selectorModel.label=l)}),a.get("/ng/common/payu.min.json").then(function(r){c=r.data.validUsStates,s=r.data.validUsTerritories,u=r.data.validCaProvinces,e=r.data.citiesByState,t=r.data.states,function(e){angular.forEach(e,function(t,n){e[n]=e[n].map(function(e){return{category:e,name:e,countryCode:"hidden"}})})}(e),n.countryList=r.data.countries,n.onChangeState=m,n.onChangeCity=h,n.onCountryChange=f,n.showDropdown=!1,f()})}():n.countryList=e.data.models.countryList},function(e){return t.reject(e.data.errors)})}n.birthDateCalendarOptions={mainOptions:{applyClose:!0,instantChanges:!0,applyButton:{title:o.trc("publisher.dashboard","Apply date")},time:{}},calendarOptions:[{calendarTitle:o.trc("publisher.dashboard","Birth date"),oneCanvasCalendar:!0,enableOneClickRange:!0,selectYear:!0}]},function(e){var t=e.cc.device_session_id,n=document.getElementById(l);n&&p(n);var r='<div id="'+l+'"><p style="background:url(https://maf.pagosonline.net/ws/fp?id='+t+'80200)"></p><img src="https://maf.pagosonline.net/ws/fp/clear.png?id='+t+'80200"><script src="https://maf.pagosonline.net/ws/fp/check.js?id='+t+'80200"><\/script><object type="application/x-shockwave-flash" data="https://maf.pagosonline.net/ws/fp/fp.swf?id='+t+'80200" width="1" height="1" id="thm_fp"></object></div>';document.body.insertAdjacentHTML("beforeend",r)}(n)},destroy:function(){p()},getTokenizationData:function(e){if(tokenizeParams={year:"20"+e.credit_card.expire_year,month:e.credit_card.expire_month,email:e.credit_card.email},e.credit_card.cardholder?tokenizeParams.full_name=e.credit_card.cardholder:(tokenizeParams.first_name=e.first_name,tokenizeParams.last_name=e.last_name),e.credit_card.address1&&(tokenizeParams.address1=e.credit_card.address1),e.credit_card.address2&&(tokenizeParams.address2=e.credit_card.address2),e.credit_card.country&&(tokenizeParams.country=e.credit_card.country.countryCode),e.credit_card.state){var t=e.credit_card.state;if(d){var n=e.credit_card.country.countryCode;"US"===n&&(t=c[e.credit_card.state]||s[e.credit_card.state]||t),"CA"===n&&(t=u[e.credit_card.state]||t)}tokenizeParams.state=t}return e.credit_card.city&&(tokenizeParams.city=e.credit_card.city),e.credit_card.phone_number&&(tokenizeParams.phone_number=e.credit_card.phone_number),tokenizeParams},getNotProtectedFields:function(){return[{name:"expire_month",msg:o.trc("checkout.platform","Expired month is required")},{name:"expire_year",msg:o.trc("checkout.platform","Expired year is required")},{name:"cardholder",msg:o.trc("checkout.platform","Cardholder is required")},{name:"dniType",msg:o.trc("checkout.platform","Identification type is required")},{name:"dniNumber",msg:o.trc("checkout.platform","Identification number is required")},{name:"country",msg:o.trc("checkout.platform","Country is required")},{name:"state",msg:o.trc("checkout.platform","State is required")},{name:"city",msg:o.trc("checkout.platform","City is required")},{name:"address1",msg:o.trc("checkout.platform","Address is required")},{name:"email",msg:o.trc("checkout.platform","Email is required")},{name:"phoneNumber",msg:o.trc("checkout.platform","Contact phone number is required")},{name:"birthDate",msg:o.trc("checkout.platform","Birth date is required")}]}};function p(e){var t=e||document.getElementById(l);t&&document.body.removeChild(t)}}]);var spreedly=angular.module("spreedlyModule",["checkoutModule","tp.i18n","spreedlyDefaultStrategyModule","spreedlyPayULatamStrategyModule"]),EVENT_PREVIEW_SPR_TERM_COMPLETE="EVENT_PREVIEW_SPR_TERM_COMPLETE",EVENT_SPR_BEFORE_PROCESS="EVENT_SPREEDLY_BEFORE_PROCESS",EVENT_SPR_INITIATED="EVENT_SPREEDLY_CC_INITIATED",EVENT_SPR_PROCESSED="EVENT_SPREEDLY_PROCESSED",EVENT_SPR_FAILED="EVENT_SPR_FAILED",EVENT_SPR_UNLOCK="EVENT_SPR_UNLOCK";spreedly.factory("spreedly",["$rootElement","eventService","$timeout","$rootScope","errorService","$q",function(e,t,n,r,o,i){var a={initiateSucceed:function(e){r.$broadcast(EVENT_SPR_INITIATED,e)},beforeProcess:function(){r.$broadcast(EVENT_SPR_BEFORE_PROCESS)},processSucceed:function(e){var t=i.defer();return r.$broadcast(EVENT_SPR_PROCESSED,e,t),t.promise},processFailed:function(e){r.$broadcast(EVENT_SPR_UNLOCK)},declined:function(e){r.$broadcast(EVENT_SPR_UNLOCK)},completeFailed:function(e){r.$broadcast(EVENT_SPR_FAILED,e&&e[0]&&e[0].msg?e[0].msg:"Unknown error")}};return a}]),spreedly.directive("spreedlyFormComponent",["checkout","lang",function(e,t){return{restrict:"A",require:"^view",transclude:!0,templateUrl:"/widget/checkout/component/partials/spreedly-form-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","$rootScope","ngEventService","purchaseService","errorService","$rootElement","$q","spreedlyDefaultStrategy","spreedlyPayULatamStrategy","billingConfig",function(n,r,o,i,a,c,s,u,l,d){angular.extend(n,BaseComponentController),n.PAYMENT_PROVIDER_ID=SPREEDLY_CC,n.cc={},n.credit_card={cardholder:null},n.cc.stored=[],n.cc.defaultPaymentMethodId=null,n.$on(EVENT_PREVIEW_SPR_TERM_COMPLETE,function(t,n){e._completeTerm({q:"q"})}),n.$on(EVENT_SPR_INITIATED,function(r,o){n.initiated||(n.cc.stored=JSON.parse(o.stored||"[]"),n.first_name=o.first_name,n.last_name=o.last_name,n.stripe_cus_id=o.stripe_cus_id||"",n.stored_rurl=o.stored_rurl,n.cc.payWithNew=0===n.cc.stored.length,n.cc.selectedUpiId=n.cc.stored.length>0?n.cc.stored[0].id:null,n.cc.store_in_vault="true"===o.store_in_vault,n.cc.device_session_id=o.device_session_id||null,n.cc.spreedly_payu_latam_language=o.spreedly_payu_latam_language||null,n.cc.defaultPaymentMethodId=o.defaultPaymentMethodId,n.$watch("cc.payWithNew",function(t){n.isSupportedSpreedlyCcMethod(e)&&!0===t&&m()}),Spreedly.on("ready",function(e){m()}),Spreedly.on("paymentMethod",function(e,t){$("#payment_method_token").val(t.token),$("#cc_masked_number").val(t.number),$("#cc_type_name").val(t.card_type),n.tokenizeDeferred.resolve()}),Spreedly.on("errors",function(e){var r={number:t.trc("checkout.platform","Invalid credit card number"),cvv:t.trc("checkout.platform","CVV is required")},o=e.map(function(e){return"errors.invalid"===e.key&&r[e.attribute]||e.message});o.length&&n.tokenizeDeferred.reject(o[0])}),Spreedly.on("fieldEvent",function(e,r,o,i){if("input"===r){var a,c;if(n.spreedlyErrors=[],!i.validNumber)a=0===i.numberLength?t.trc("checkout.platform","Credit card number is required"):t.trc("checkout.platform","Invalid credit card number"),n.spreedlyErrors.push(a);if(!i.validCvv)c=0===i.cvvLength?t.trc("checkout.platform","CVV is required"):t.trc("checkout.platform","Your CVV must be 4 digits for American Express or 3 digits for other cards"),n.spreedlyErrors.push(c)}}),Spreedly.init(o.spreedly_env_key,{numberEl:"spreedly-protected-cc-num-placeholder",cvvEl:"spreedly-protected-ccv-placeholder"}),p().init(n),n.initiated=!0,g())}),n.$on(EVENT_SPR_BEFORE_PROCESS,function(){e.input.storeInVault=n.cc.store_in_vault,e.input.deviceSessionId=n.cc.device_session_id,e.input.spreedlyPayULatamLanguage=n.cc.spreedly_payu_latam_language,e.input.defaultPaymentMethodId=n.cc.store_in_vault&&n.cc.defaultPaymentMethodId,n.cc.payWithNew&&(n.cc.selectedUpiId=null,e.setUpiId(null),n.tokenizeDeferred=s.defer(),tokenizeParams=p().getTokenizationData(n),Spreedly.tokenizeCreditCard(tokenizeParams))}),n.$on("$destroy",function(){p().destroy()});var p=function(){return n.isPaymentMethod(n.SPREEDLY_PAYU_LATAM)?l:u},f=function(e){var t=angular.element('<iframe name="spr_post_frame" style="display: none"></iframe>');c.append(t);var n=$("#spreedly-new-cc-form");n.attr("action",e),n.submit()},m=function(){var e=$(".spreedly-input-template");if(e[0]){var n=e[0].getBoundingClientRect().height;if(!n)return void setTimeout(function(){m()},100);for(var r=["font-family","font-size","font-weight","box-sizing","background"],o="",i=0;i<r.length;i++){var a=e.css(r[i]);o+=r[i]+":"+a+";"}o+="height:"+n+"px;",o+="color:"+($(".spreedly-input-color-template").css("color")||e.css("color"))+";",Spreedly.setStyle("number",o),Spreedly.setFieldType("number","text"),Spreedly.setPlaceholder("number",t.trc("checkout.platform","Card number")),Spreedly.setStyle("cvv",o),Spreedly.setFieldType("cvv","text"),Spreedly.setPlaceholder("cvv",t.trc("default","CVV"))}};n.$on(EVENT_SPR_PROCESSED,function(t,o,i){a(n).reset(),e.disableCheckout(),n.cc.payWithNew?n.tokenizeDeferred.promise.then(function(){i.resolve(),f(o.rurl_for_a_new+"&stripe_cus_id="+n.stripe_cus_id)},function(e){i.reject(),r.$broadcast(EVENT_SPR_FAILED,e)}):(i.resolve(),f(n.stored_rurl+"&id="+n.cc.selectedUpiId))}),n.$on(EVENT_SPR_FAILED,function(t,r){e.enabledCheckout(),a(n).global(r||"Unknown error")}),n.$on(EVENT_SPR_UNLOCK,function(){e.enabledCheckout()}),n.$on(EVENT_VIEW_ACTIVATED,function(){n.initiated&&m()}),n.$watch("cc.selectedUpiId ",function(){g()});var h=function(){var e=t.trc("checkout.platform","Invalid expiration date"),r=n.ccForm.expire_month,o=n.ccForm.expire_year;if(isNaN(r.$modelValue)||isNaN(o.$modelValue))return a(n).global(e),!1;var i=parseInt(r.$modelValue),c=2e3+parseInt(o.$modelValue);if(i<1||i>12)return a(n).global(e),!1;var s=new Date;return!(c<s.getUTCFullYear()||c===s.getUTCFullYear()&&i<s.getUTCMonth()||c>s.getUTCFullYear()+10)||(a(n).global(e),!1)};function g(){if(e.setUpiId(n.cc.selectedUpiId),n.cc.selectedUpiId)for(var t=0;t<n.cc.stored.length;t++){var r=n.cc.stored[t];if(r.id===n.cc.selectedUpiId){var o=d.taxRequestFromUpi(r);d.updateFromTaxRequest(e,o)}}}n._isValid=function(){var t=!0;if(n.isSupportedSpreedlyCcMethod(e)&&n.cc.payWithNew&&(a(n).reset(),t=function(){for(var e=p().getNotProtectedFields(),t=0;t<e.length;t++){var r=e[t];if(n.ccForm[r.name]&&n.ccForm[r.name].$invalid)return a(n).global(r.msg),!1}return h()}(),n.spreedlyErrors&&n.spreedlyErrors.length>0)){for(var r=0;r<n.spreedlyErrors.length;r++)a(n).global(n.spreedlyErrors[r]);t=!1}return t},propagatePaymentVars(e,n)}]}}]);var edgilPaywayProviderModule=angular.module("edgilPaywayProviderModule",["checkoutModule"]),EVENT_PREVIEW_EDGIL_TERM_COMPLETE="EVENT_PREVIEW_EDGIL_TERM_COMPLETE",EVENT_EDGIL_PAYWAY_INITIATE_SUCCEED="EVENT_EDGIL_PAYWAY_INITIATE_SUCCEED",EVENT_EDGIL_PAYWAY_INITIATE_FAILED="EVENT_EDGIL_PAYWAY_INITIATE_FAILED",EVENT_EDGIL_PAYWAY_BEFORE_PROCESS="EVENT_EDGIL_PAYWAY_BEFORE_PROCESS",EVENT_EDGIL_PAYWAY_PROCESS_SUCCEED="EVENT_EDGIL_PAYWAY_PROCESS_SUCCEED",EVENT_EDGIL_PAYWAY_PROCESS_FAILED="EVENT_EDGIL_PAYWAY_PROCESS_FAILED",EVENT_EDGIL_PAYWAY_CONFIRMED="EVENT_EDGIL_PAYWAY_CONFIRMED",EVENT_EDGIL_PAYWAY_DECLINED="EVENT_EDGIL_PAYWAY_DECLINED",EVENT_EDGIL_PAYWAY_COMPLETE_SUCCEED="EVENT_EDGIL_PAYWAY_COMPLETE_SUCCEED",EVENT_EDGIL_PAYWAY_COMPLETE_FAILED="EVENT_EDGIL_PAYWAY_COMPLETE_FAILED",iframeHungTimeout;edgilPaywayProviderModule.factory("edgilPaywayProvider",["$rootScope",function(e){var t={beforeInitiate:function(){},initiateSucceed:function(t){e.$broadcast(EVENT_EDGIL_PAYWAY_INITIATE_SUCCEED,t)},initiateFailed:function(t){e.$broadcast(EVENT_EDGIL_PAYWAY_INITIATE_FAILED,t)},beforeProcess:function(){e.$broadcast(EVENT_EDGIL_PAYWAY_BEFORE_PROCESS)},processSucceed:function(t){e.$broadcast(EVENT_EDGIL_PAYWAY_PROCESS_SUCCEED,t)},processFailed:function(t){e.$broadcast(EVENT_EDGIL_PAYWAY_PROCESS_FAILED,t)},confirmed:function(t){e.$broadcast(EVENT_EDGIL_PAYWAY_CONFIRMED,t)},declined:function(t){e.$broadcast(EVENT_EDGIL_PAYWAY_DECLINED,t)},completeSucceed:function(t){e.$broadcast(EVENT_EDGIL_PAYWAY_COMPLETE_SUCCEED,t)},completeFailed:function(t){e.$broadcast(EVENT_EDGIL_PAYWAY_COMPLETE_FAILED,t)}};return t}]),edgilPaywayProviderModule.factory("edgilCreditCardService",["tpHTTP","$q","$timeout","$window","checkout",function(e,t,n,r,o){return{processCC:function(e,t,n,r){var i;o.disableCheckout(),iframeHungTimeout=window.setTimeout(function(){angular.element("#edgil-payway-provider-form-component-iframe").remove();var e=angular.element('<iframe name="edgil-payway-provider-form-component-iframe" id="edgil-payway-provider-form-component-iframe" style="display: none"></iframe>');i=e[0],t.append(i);var r=i.contentWindow?i.contentWindow.document:i.contentDocument;r.open("text/html","replace"),r.write('<html>    <head>        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">        <script type="text/javascript">            function submitform() {                document.forms["page_return"].submit();            }        <\/script>    </head>    <body onload="submitform()">        <form name="page_return" method="post" action="'+n.replyURL+'">            <input type="hidden" name="resultCode" value="999">            <input type="hidden" name="message" value="Request timeout">        </form>    </body></html>'),r.close()},15e3),angular.element("#edgil-payway-provider-form-component-iframe").remove();var a=angular.element('<iframe name="edgil-payway-provider-form-component-iframe" id="edgil-payway-provider-form-component-iframe" style="display: none"></iframe>');if(i=a[0],e.cc.payWithNew){var c=n.replyURL;i.onload=function(){i.contentWindow.postMessage(JSON.stringify({accountNumber:e.credit_card.num,expiration:e.credit_card.expire_month+e.credit_card.expire_year,fraudSecurityValue:e.credit_card.cvv,zip:e.input.zipCode,replyURL:c}),"*")},t.append(i);var s=i.contentWindow?i.contentWindow.document:i.contentDocument;s.open("text/html","replace"),s.write(n.iframeContent),s.close()}else{var u=e.cc.storedRurl+"&id="+e.cc.selectedUpiId;i.src=u,t.append(i)}}}}]),edgilPaywayProviderModule.directive("edgilPaywayProviderFormComponent",["checkout","$rootElement","errorService","edgilCreditCardService","lang","billingConfig",function(e,t,n,r,o,i){return{restrict:"A",require:"^view",transclude:!0,templateUrl:"/widget/checkout/component/partials/edgil-payway-provider-form-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","errorService","$timeout","ngEventService",function(n,a,c,s){angular.extend(n,BaseComponentController),n.PAYMENT_PROVIDER_ID=EDGIL_PAYWAY;var u={shortName:"card",longName:"Credit card"},l=function(){n.cc={},n.cc.payWithNew=!0,n.cc.selectedUpiId=null,n.cc.initiated=!1,n.cc.defaultPaymentMethodId=null,n.credit_card={},n.credit_card.store_in_vault=!0};var d=function(e){for(var t={shortName:"v",longName:"Visa"},n=[{type:t,rname:"electron",rgxp:/^(4026|417500|4405|4508|4844|4913|4917)\d+$/},{type:u,rname:"maestro",rgxp:/^(5018|5020|5038|5612|5893|6304|6759|6761|6762|6763|0604|6390)\d+$/},{type:u,rname:"dankort",rgxp:/^(5019)\d+$/},{type:u,rname:"interpayment",rgxp:/^(636)\d+$/},{type:u,rname:"unionpay",rgxp:/^(62|88)\d+$/},{type:t,rname:"visa",rgxp:/^4[0-9]{12}(?:[0-9]{3})?$/},{type:{shortName:"mc",longName:"MasterCard"},rname:"mastercard",rgxp:/^5[1-5][0-9]{2}|(222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)[0-9]{12}$/},{type:{shortName:"amex",longName:"American Express"},rname:"amex",rgxp:/^3[47][0-9]{13}$/},{type:{shortName:"dci",longName:"Diners Club"},rname:"diners",rgxp:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/},{type:{shortName:"d",longName:"Discover"},rname:"discover",rgxp:/^6(?:011|5[0-9]{2})[0-9]{12}$/},{type:u,rname:"jcb",rgxp:/^(?:2131|1800|35\d{3})\d{11}$/}],r=0;r<n.length;r++){var o=n[r];if(o.rgxp.test(e))return o.type}return u};function p(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var r=e[t].msg||e[t].message;r&&""!==r.trim()&&a(n).global(r)}else a(n).global(e.message)}function f(){e.input.credit_card=n.getCurrentCreditCardInfo(),e.setUpiId(n.cc.selectedUpiId),e.getUpiId()&&e.input.credit_card.taxRequest&&i.updateFromTaxRequest(e,e.input.credit_card.taxRequest)}n.getCurrentCreditCardInfo=function(){if(n.cc.payWithNew)return{type:d(n.credit_card.num),ending:n.credit_card.num?n.credit_card.num.slice(-4):"",expireMonth:n.credit_card.expire_month,expireYear:n.credit_card.expire_year};if(n.cc.selectedUpiId)for(var e=0;e<n.cc.stored.length;e++){var t=n.cc.stored[e];if(t.id===n.cc.selectedUpiId)return{type:{shortName:t.identifier,longName:t.type},ending:t.ending_in,expireMonth:t.expire_month,expireYear:t.expire_year,taxRequest:i.taxRequestFromUpi(t)}}return{type:u,ending:n.credit_card.num?n.credit_card.num.slice(-4):"",expireMonth:n.credit_card.expire_month,expireYear:n.credit_card.expire_year}},n._isValid=function(){if(a(n).reset(),!e.isPaymentMethod(EDGIL_PAYWAY)||e.isMockUsed())return!0;if(!0===toBoolean(n.skipValidation))return!0;if(n.cc.payWithNew){if(!1===n.ccForm.$valid){for(var t=[{name:"num",msg:o.trc("checkout.platform","Credit card number is required")},{name:"expire_month",msg:o.trc("checkout.platform","Expired month is required")},{name:"expire_year",msg:o.trc("checkout.platform","Expired year is required")},{name:"cvv",msg:o.trc("checkout.platform","CVV is required")},{name:"postal_code",msg:o.trc("checkout.platform","Postal code is required")}],r=0;r<t.length;r++){var i=t[r];if(n.ccForm[i.name])if(n.ccForm[i.name].$invalid){a(n).global(i.msg);break}}return!1}if(!function(e){if(!e.match(/^\d+$/))return!1;for(var t=e.length,n=1&t,r=0,o=0;o<t;o++){var i=parseInt(e.charAt(o));1&o^n||(i*=2)>9&&(i-=9),r+=i}return r%10==0}(n.credit_card.num))return a(n).global(o.trc("checkout.platform","Invalid credit card number")),!1;if(!function(e,t){var n=e.replace(/\D/g,""),r=t.replace(/\D/g,"");if("amex"===d(n).shortName){if(/^\d{4}$/.test(r))return!0}else if(/^\d{3}$/.test(r))return!0;return!1}(n.credit_card.num,n.credit_card.cvv))return a(n).global(o.trc("checkout.platform","Your CVV must be 4 digits for American Express or 3 digits for other cards")),!1;if(!function(e,t){if(!e||!t)return!1;var n=parseInt(e,10),r=parseInt(t,10);if(n<1||n>12)return!1;if(r<0)return!1;r<100&&(r+=2e3);var o=new Date;o.setDate(1),o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0);var i=new Date;return i.setDate(1),i.setMonth(n-1),i.setYear(r),i.setHours(0),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0),o.getTime()<=i.getTime()}(n.credit_card.expire_month,n.credit_card.expire_year))return a(n).global(o.trc("checkout.platform","Invalid expiration date")),!1}else if(!n.cc.selectedUpiId)return a(n).global(o.trc("checkout.platform","Please select one of your cards or add new one")),!1;return!0},n.$on(EVENT_PREVIEW_EDGIL_TERM_COMPLETE,function(t,n){e._completeTerm({q:"q"})}),n.$on(EVENT_EDGIL_PAYWAY_INITIATE_SUCCEED,function(e,t){void 0!==t.stored&&(n.cc.stored=JSON.parse(t.stored)),n.cc.storedRurl=t.stored_rurl,n.cc.payWithNew=void 0===n.cc.stored||0===n.cc.stored.length||n.cc.payWithNew&&n.cc.initiated,n.cc.selectedUpiId=void 0!==n.cc.stored&&n.cc.stored.length>0?n.cc.stored[0].id:null,n.cc.defaultPaymentMethodId=t.defaultPaymentMethodId,n.cc.initiated=!0,f(),c(function(){n.$apply()})}),n.$on(EVENT_EDGIL_PAYWAY_INITIATE_FAILED,function(t,n){e.enabledCheckout(),p(n)}),n.$on(EVENT_EDGIL_PAYWAY_BEFORE_PROCESS,function(){e.input.storeInVault=n.credit_card.store_in_vault,e.input.defaultPaymentMethodId=n.credit_card.store_in_vault&&n.cc.defaultPaymentMethodId,n.cc.payWithNew&&e.setUpiId(null)}),n.$on(EVENT_EDGIL_PAYWAY_PROCESS_SUCCEED,function(e,o){r.processCC(n,t,o)}),n.$on(EVENT_EDGIL_PAYWAY_PROCESS_FAILED,function(t,n){e.enabledCheckout(),p(n)}),n.$on(EVENT_EDGIL_PAYWAY_DECLINED,function(t,n){e.enabledCheckout()}),n.$on(EVENT_EDGIL_PAYWAY_COMPLETE_SUCCEED,function(e,t){window.clearTimeout(iframeHungTimeout)}),n.$on(EVENT_EDGIL_PAYWAY_COMPLETE_FAILED,function(t,n){window.clearTimeout(iframeHungTimeout),e.enabledCheckout(),p(n)}),n.$watch("cc.selectedUpiId ",function(){f()}),n.$watch("credit_card.num ",function(){e.input.credit_card=n.getCurrentCreditCardInfo()}),n.$watch("credit_card.expire_month ",function(){e.input.credit_card=n.getCurrentCreditCardInfo()}),n.$watch("credit_card.expire_year ",function(){e.input.credit_card=n.getCurrentCreditCardInfo()}),s.subscribe(EVENT_CHECKOUT_STARTED,function(){l()}),l(),n.expireYears=getYears(),n.expireMonths=getMonths(),propagatePaymentVars(e,n)}]}}]);var eigenProviderModule=angular.module("eigenProviderModule",["checkoutModule","paymentProviderModule","eigenMiraSecureModule"]),EVENT_PREVIEW_EIGEN_TERM_COMPLETE="EVENT_PREVIEW_EIGEN_TERM_COMPLETE",EVENT_EIGEN_INITIATE_SUCCEED="EVENT_EIGEN_INITIATE_SUCCEED",EVENT_EIGEN_INITIATE_FAILED="EVENT_EIGEN_INITIATE_FAILED",EVENT_EIGEN_BEFORE_PROCESS="EVENT_EIGEN_BEFORE_PROCESS",EVENT_EIGEN_PROCESS_SUCCEED="EVENT_EIGEN_PROCESS_SUCCEED",EVENT_EIGEN_PROCESS_FAILED="EVENT_EIGEN_PROCESS_FAILED",EVENT_EIGEN_CONFIRMED="EVENT_EIGEN_CONFIRMED",EVENT_EIGEN_DECLINED="EVENT_EIGEN_DECLINED",EVENT_EIGEN_COMPLETE_SUCCEED="EVENT_EIGEN_COMPLETE_SUCCEED",EVENT_EIGEN_COMPLETE_FAILED="EVENT_EIGEN_COMPLETE_FAILED";function klarnaService(e,t,n,r,o){var i,a,c={},s={oid:null,session:null,urls:{}},u=[];function l(e){r(function(){util.log("[KLARNA] Firing payment-error",e);var t={event:"payment-error",params:{},error:e};window.postMessage(JSON.stringify(t),"*")},0)}return c.setStoredRurl=function(e){i=e},c.getStoredRurl=function(){return i},c.setStoredAccounts=function(e){u=e},c.getStoredAccounts=function(){return Object.freeze(u)},c.setData=function(e){s=e},c.getData=function(){return s},c.patchData=function(e,t){s[e]=t},c.setAuthToken=function(e){a=e},c.getAuthToken=function(){return a},c.getSession=function(e,t){return n({method:"POST",url:TPParam.KLARNA_INIT_URL,params:{countryCode:e,oid:t}}).then(function(e){var t=e.data&&e.data.models&&e.data.models.session;return c.patchData("session",t),t},function(e){throw c.patchData("session",null),e})},c.init=function(t){var n=e.defer();try{Klarna.Payments.init({client_token:t}),n.resolve(!0)}catch(e){n.reject({error:e})}return n.promise},c.paymentMethods=function(){return s.session&&s.session.paymentMethodCategories||[]},c.onIframeSizeChange=function(e){"Klarna"in window&&Klarna.Payments.on("heightChanged",e)},c.load=function(t,n){var r=e.defer();try{Klarna.Payments.load({container:n,payment_method_category:t},function(e){!0===e.show_form&&r.resolve(e)})}catch(e){r.reject(e)}return r.promise},c.emulatePaymentError=function(e){l(e)},c.completePayment=function(t,r,o){return n({method:"POST",url:t,data:{authToken:r,countryCode:o}},!0).then(function(e){!function(e){var t=angular.copy(e);util.log("[KLARNA] Firing payment-complete",t);var n={event:"payment-complete",params:t};window.postMessage(JSON.stringify(n),"*")}(e.data&&e.data.models)}).catch(function(t){return l(t.data&&t.data.errors),e.reject(t)})},c.authorize=function(t,n,r,i){var a=e.defer(),c=o.getInMinorUnits(i.chargeAmount);return Klarna.Payments.authorize({payment_method_category:t},{purchase_country:n,purchase_currency:i.chargeCurrency,locale:r.locale,order_amount:c,order_tax_amount:0,order_lines:[{type:"digital",reference:i.termId,name:i.name,quantity:1,unit_price:c,tax_rate:0,total_amount:c,total_discount_amount:0,total_tax_amount:0}],customer:{date_of_birth:null,gender:null}},function(e){e.approved?a.resolve(e.authorization_token):a.reject(e&&e.error)}),a.promise},c}function obiIntegrationServiceFactory(e,t,n,r){if(t.has("obiIntegrationServiceMock"))return console.warn("ATTENTION! You are working with mock of obiIntegrationService"),t.get("obiIntegrationServiceMock");var o,i={postMessage:function(e,t){console.warn("used alt post");var n={};n.event=e,n.params=t,$.postMessage(JSON.stringify(n),"*")}},a={subscribe:function(e,t){console.warn("used alt subs"),r.$on(e,t)}};try{i=t.get("eventService"),a=t.get("ngEventService")}catch(e){console.warn("unable to get services")}var c=void 0,s={"font-family":"Helvetica, Arial, sans-serif","font-size":"13px",width:"100%",height:"38px","font-weight":"100","box-sizing":"border-box",color:"#1c2544",padding:"0px 14px","background-color":"#ffffff"};return a.subscribe("obi-3ds-challenge-complete",function(t,n){if(o){if(n.error){var r={status:"three_ds_challenge_completed"};switch(n.error){case"challenge-error":console.error(n),r.message=e.tr("Authentication failed");break;case"timeout":r.message=e.tr("Timeout expired");break;default:console.error(n),r.message=e.tr("Unknown error occurred during 3DS challenge")}o.reject(r)}else o.resolve(n);o=null}}),{init:function(t,n){var r;r=0!==$("#obi-number iframe, #obi-cvv iframe").length,c=c&&r?c:(console.warn(n),obick(n).then(function(n){return n.input({theme:{iframe:{cardNumber:{style:function(){return angular.extend({"::placeholder":e.tr("Card number")},t||s)}},cvv:{style:function(){return angular.extend({"::placeholder":e.tr("CVV")},t||s)}}}}})}))},initCvv:function(t,n){var r;r=0!==$("#obi-cvv iframe").length,c=c&&r?c:obick(n).then(function(n){return n.cvv.input({theme:{iframe:{cvv:{style:function(){return angular.extend({"::placeholder":e.tr("CVV")},t||s)}}}}})})},deInit:function(){var e=0!==$("#obi-cvv iframe").length;return c||e?c.then(function(e){return e.dispose().then(function(){return c=null,e=n.defer(),setTimeout(function t(){if(0===$("#obi-cvv iframe").length)return e.resolve();setTimeout(t,100)},100),e.promise;var e})}):n.when()},createCardToken:function(e){return c.then(function(t){return t.createToken().then(function(r){return e.token=r,e.referenceId=t.referenceId(),n.when(e)})})},process3DS:function(e){o=n.defer();var t=angular.extend({zIndex:1e7},e);return console.warn(t),i.postMessage("obi-handle-3ds-challenge",t),o.promise},handle3dsChallenge:function(e){var t=angular.extend({zIndex:1e7},e);return obick.handle3dsChallenge(t)},processError:function(e){if("object"!=typeof e||null===e)throw"type of obiError is wrong!";if(void 0===e.status||void 0===e.message)throw"obiError has unknown format!";return"three_ds_challenge_completed"===e.status.toLowerCase()?[{msg:e.message}]:"MISSING_PARAMS"===e.status?e.message.split(".").map(function(e){return{msg:e.trim()}}):void 0}}}function obiPaypalIntegrationServiceFactory(e,t,n,r){var o=null,i=null,a={};return a.addPaypalAccount=function(e,n){o&&o.reject(),o=t.defer();var r=e+"&countryCode="+n;return i=window.open(r,"payment_popup","scrollbars=1,popup=true,width=980,height=600",!0),o.promise},a.processPurchase=function(e,t,n,o){var i;i=e.isNew?n+"&instrumentId="+e.instrumentId+"&email="+encodeURIComponent(e.email)+"&paypalEmail="+encodeURIComponent(e.paypalEmail)+"&residenceCountryCode="+o:t+"&id="+e.id,r.injectHiddenIframe("obi-paypal-frame",i)},n.subscribe("obi-paypal-complete",function(e,t){if(i&&i.close(),o){switch(t.result){case"return":o.resolve(t);break;case"cancel":o.reject();break;case"failed":o.reject({message:t.error});break;default:o.reject({message:"[Obi Paypal] Received unknown message: "+t.result})}o=null}}),a}eigenProviderModule.factory("eigenProvider",["$rootScope","$q",function(e,t){var n={beforeInitiate:function(){},initiateSucceed:function(t){e.$broadcast(EVENT_EIGEN_INITIATE_SUCCEED,t)},initiateFailed:function(t){e.$broadcast(EVENT_EIGEN_INITIATE_FAILED,t)},beforeProcess:function(){e.$broadcast(EVENT_EIGEN_BEFORE_PROCESS)},processSucceed:function(n){var r=t.defer();return e.$broadcast(EVENT_EIGEN_PROCESS_SUCCEED,n,r),r.promise},processFailed:function(t){e.$broadcast(EVENT_EIGEN_PROCESS_FAILED,t)},confirmed:function(t){e.$broadcast(EVENT_EIGEN_CONFIRMED,t)},declined:function(t){e.$broadcast(EVENT_EIGEN_DECLINED,t)},completeSucceed:function(t){e.$broadcast(EVENT_EIGEN_COMPLETE_SUCCEED,t)},completeFailed:function(t){e.$broadcast(EVENT_EIGEN_COMPLETE_FAILED,t)}};return n}]),eigenProviderModule.factory("eigenCreditCardService",["checkout","eigenMiraSecure","iframeService","errorService","lang",function(e,t,n,r,o){return{processCC:function(i,a,c){if(e.disableCheckout(),i.cc.payWithNew){var s={CardNumber:i.credit_card.num,CardHolderName:i.credit_card.cardholder,Expiry:i.credit_card.expire_month+i.credit_card.expire_year,CVV:i.credit_card.cvv,PostalCode:i.input.zipCode};t.tokenize(i.cc.hostedPageURL,s).then(function(e){var t=a.new_card_rurl+"&token="+e;i.credit_card.cardholder&&(t+="&cardHolder="+i.credit_card.cardholder),n.injectHiddenIframe("eigen-provider-form-component-iframe",t)}).catch(function(t){t&&(console.warn(t),e.enabledCheckout(),c.reject(),r(i).global({message:o.trc("checkout.platform","Payment could not be processed")}))})}else{var u=i.cc.storedRurl+"&id="+i.cc.selectedUpiId;n.injectHiddenIframe("eigen-provider-form-component-iframe",u)}}}}]),eigenProviderModule.directive("eigenProviderFormComponent",["checkout","$rootElement","errorService","eigenCreditCardService","lang","billingConfig",function(e,t,n,r,o,i){return{restrict:"A",require:"^view",transclude:!0,templateUrl:"/widget/checkout/component/partials/eigen-provider-form-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","errorService","$timeout","ngEventService","creditCardUtils",function(t,n,a,c,s){angular.extend(t,BaseComponentController),t.PAYMENT_PROVIDER_ID=EIGEN;var u=function(){t.cc={},t.cc.payWithNew=!0,t.cc.selectedUpiId=null,t.cc.initiated=!1,t.cc.defaultPaymentMethodId=null,t.credit_card={},t.credit_card.store_in_vault=!0};function l(e){if(Array.isArray(e))for(var r=0;r<e.length;r++){var o=e[r].msg||e[r].message;o&&""!==o.trim()&&n(t).global(o)}else n(t).global(e.message)}t.getCurrentCreditCardInfo=function(){if(t.cc.payWithNew)return{type:s.detectCardType(t.credit_card.num),ending:t.credit_card.num?t.credit_card.num.slice(-4):"",expireMonth:t.credit_card.expire_month,expireYear:t.credit_card.expire_year};if(t.cc.selectedUpiId)for(var e=0;e<t.cc.stored.length;e++){var n=t.cc.stored[e];if(n.id===t.cc.selectedUpiId)return{type:{shortName:n.identifier,longName:n.type},ending:n.ending_in,expireMonth:n.expire_month,expireYear:n.expire_year,taxRequest:i.taxRequestFromUpi(n)}}return{type:s.getUnknownCardType(),ending:t.credit_card.num?t.credit_card.num.slice(-4):"",expireMonth:t.credit_card.expire_month,expireYear:t.credit_card.expire_year}},t._isValid=function(){if(n(t).reset(),!e.isPaymentMethod(EIGEN)||e.isMockUsed())return!0;if(!0===toBoolean(t.skipValidation))return!0;if(t.cc.payWithNew){if(!1===t.ccForm.$valid){for(var r=[{name:"num",msg:o.trc("checkout.platform","Credit card number is required")},{name:"expire_month",msg:o.trc("checkout.platform","Expired month is required")},{name:"expire_year",msg:o.trc("checkout.platform","Expired year is required")},{name:"cvv",msg:o.trc("checkout.platform","CVV is required")},{name:"postal_code",msg:o.trc("checkout.platform","Postal code is required")}],i=0;i<r.length;i++){var a=r[i];if(t.ccForm[a.name])if(t.ccForm[a.name].$invalid){n(t).global(a.msg);break}}return!1}if(!s.ccLuhnCheck(t.credit_card.num))return n(t).global(o.trc("checkout.platform","Invalid credit card number")),!1;if(!s.ccExpireDateValidate(t.credit_card.expire_month,t.credit_card.expire_year))return n(t).global(o.trc("checkout.platform","Invalid expiration date")),!1}else if(!t.cc.selectedUpiId)return n(t).global(o.trc("checkout.platform","Please select one of your cards or add new one")),!1;return!0},t.$on(EVENT_PREVIEW_EIGEN_TERM_COMPLETE,function(t,n){e._completeTerm({q:"q"})}),t.$on(EVENT_EIGEN_INITIATE_SUCCEED,function(e,n){void 0!==n.stored&&(t.cc.stored=JSON.parse(n.stored)),t.cc.storedRurl=n.stored_rurl,t.cc.hostedPageURL=n.hostedPageURL,t.cc.defaultPaymentMethodId=n.defaultPaymentMethodId,t.cc.payWithNew=void 0===t.cc.stored||0===t.cc.stored.length||t.cc.payWithNew&&t.cc.initiated,t.cc.selectedUpiId=void 0!==t.cc.stored&&t.cc.stored.length>0?t.cc.stored[0].id:null,t.cc.initiated=!0}),t.$on(EVENT_EIGEN_INITIATE_FAILED,function(t,n){e.enabledCheckout(),l(n)}),t.$on(EVENT_EIGEN_BEFORE_PROCESS,function(){e.input.storeInVault=t.credit_card.store_in_vault,e.input.defaultPaymentMethodId=t.credit_card.store_in_vault&&t.cc.defaultPaymentMethodId}),t.$on(EVENT_EIGEN_PROCESS_SUCCEED,function(e,n,o){r.processCC(t,n,o)}),t.$on(EVENT_EIGEN_PROCESS_FAILED,function(t,n){e.enabledCheckout(),l(n)}),t.$on(EVENT_EIGEN_DECLINED,function(t,n){e.enabledCheckout()}),t.$on(EVENT_EIGEN_COMPLETE_SUCCEED,function(e,t){}),t.$on(EVENT_EIGEN_COMPLETE_FAILED,function(t,n){e.enabledCheckout(),l(n)}),t.$watch("cc.selectedUpiId ",function(){e.input.credit_card=t.getCurrentCreditCardInfo(),e.setUpiId(t.cc.selectedUpiId)}),t.$watch("credit_card.num ",function(){e.input.credit_card=t.getCurrentCreditCardInfo()}),t.$watch("credit_card.expire_month ",function(){e.input.credit_card=t.getCurrentCreditCardInfo()}),t.$watch("credit_card.expire_year ",function(){e.input.credit_card=t.getCurrentCreditCardInfo()}),c.subscribe(EVENT_CHECKOUT_STARTED,function(){u()}),u(),t.expireYears=getYears(),t.expireMonths=getMonths(),propagatePaymentVars(e,t)}]}}]),angular.module("braintreeCommonModule",[]),angular.module("braintreeCommonModule").factory("braintreeFactory",["$q","lang","utilsService",function(e,t,n){var r=null,o=null,i=null;return{initHostedFields:function(e){o&&o.teardown();return(a=e.client_token,braintree.client.create({authorization:a}).then(function(e){r=e})).then(function(){return function(e){var i={number:{selector:"#card-number",placeholder:t.tr("Card number")},cvv:{selector:"#cvv",placeholder:t.tr("CVV")},expirationDate:{selector:"#expiration-date",placeholder:t.tr("MM/YYYY")},postalCode:{selector:"#postal-code",placeholder:t.tr("Postal code")}},a=angular.element("#postal-code");a.length&&a.attr("disabled")&&(delete i.postalCode,a.closest(".field-card-postal-code").hide());!0===e.isEditing&&i.number&&delete i.number;var c={"font-size":n.isIOS()?"16px":"13px","font-weight":"100","text-overflow":"ellipsis"};e.padding&&(c.padding=e.padding);return braintree.hostedFields.create({client:r,styles:{input:c,"input::placeholder":{color:"#a1aab6"},"input::-webkit-input-placeholder":{color:"#a1aab6"},"input:-ms-input-placeholder":{color:"#a1aab6"},"input:-moz-placeholder":{color:"#a1aab6"}},fields:i}).then(function(e){o=e})}(e)}).then(function(){return braintree.threeDSecure.create({client:r}).then(function(e){i=e})}).then(function(){return{clientInstance:r,hostedFieldsInstance:o,threeDSecureInstance:i}});var a},processCc:function(e,t){t.payWithNew?function(e,t){var n=t.trData,r=t.trUrl+"?paymentMethodNonce="+t.paymentMethodNonce;angular.element("#bt_post_frame").remove(),angular.element("#bt_form").remove();var o=angular.element('<iframe name="bt_post_frame" id="bt_post_frame" style="display: none"></iframe>'),i=angular.element('<form id="bt_form" method="POST" target="bt_post_frame" action="'+r+'">'),a=[{name:"",btName:"tr_data",value:n},{name:"",btName:"paymentMethodNonce",value:t.paymentMethodNonce},{name:"",btName:"transaction[options][add_billing_address_to_payment_method]",value:!0},{name:"store_in_vault",btName:"transaction[options][store_in_vault_on_success]",value:!0},{name:"email",btName:"transaction[customer][email]",value:t.email},{name:"first_name",btName:"transaction[customer][first_name]",value:t.first_name},{name:"last_name",btName:"transaction[customer][last_name]",value:t.last_name}];angular.forEach(a,function(e){var t=angular.element("<input type='hidden'>");t.attr("name",e.btName),t.val(e.value),i.append(t)}),e.append(o),e.append(i),i.submit()}(e,t):function(e,t){angular.element("#bt_form").remove();var n=t.storedRurl+"&id="+t.selectedUpiId,r=angular.element('<iframe name="bt_post_frame" id="bt_post_frame" style="display: none" src="'+n+'"></iframe>');e.append(r)}(e,t)},getNonceData:function(n){if(!n||!n.hostedFieldsInstance)return e.reject({message:t.trc("service.error.codes","Failed to process form data")});var r=e.defer();return n.hostedFieldsInstance.tokenize().then(function(e){r.resolve(e)}).catch(function(e){console.warn(e),r.reject(function(e){var n=t.tr("Unable to process credit card"),r=t.tr("The card information you provided does not seem to be valid."),o={HOSTED_FIELDS_TOKENIZATION_FAIL_ON_DUPLICATE:t.tr("This credit card already exists in the merchant's vault."),HOSTED_FIELDS_TOKENIZATION_CVV_VERIFICATION_FAILED:r,HOSTED_FIELDS_FAILED_TOKENIZATION:r,HOSTED_FIELDS_FIELDS_EMPTY:r,HOSTED_FIELDS_FIELDS_INVALID:r};return e?(e.message=n,o[e.code]&&(e.message=o[e.code]),e):{message:n}}(e))}),r.promise},verifyCard:function(t){var n=e.defer();return t.threeDSecure.verifyCard({amount:t.amount,nonce:t.nonce,version:2,addFrame:function(e,r){t.addFrameCallback(e,r,n)},removeFrame:function(){}}).then(function(e){n.resolve({nonce:e.nonce})}).catch(function(e){n.reject(e)}),n.promise}}}]),angular.module("datatransCommonModule",["tinypassServices","ajaxServices","tinypassServices"]),angular.module("datatransCommonModule").factory("datatransIntegrationService",["$q","lang","TinypassService","$injector",function(e,t,n,r){var o,i,a,c,s={},u=[],l="",d="",p=null;function f(e,t){return t&&Array.isArray(t.errors)?t.errors.map(function(t){var n=e[t];return n||e.default}):[e.default]}return s.setMerchantId=function(e){a=e},s.setRegisterCardOnly=function(e){c=e},s.setStoredRurl=function(e){o=e},s.getStoredRurl=function(e){return o+"&id="+e},s.setStoredCards=function(e){u=e},s.getStoredCards=function(){return Object.freeze(u)},s.setReturnUrl=function(e){i=e},s.getReturnUrl=function(e,t){var n=i+"&transactionId="+e;return t&&(n+="&zipCode="+t),n},s.init=function(t,n,r,o){if(p&&!0!==o)return p;p=e.defer();var i={};i.cardNumber=t,i.cvv=n,r&&(r.common&&(l=r.common),r.error&&(d=r.error));var u=c?Inline.initRegister:Inline.initPay;try{u(a,i,{useAlias:!0}),Inline.on("ready",function(){s.setPlaceholder(),Inline.setStyle("cardNumber",l),Inline.setStyle("cvv",l),Inline.on("change",function(e){var t=e.event.field;e.fields[t].length>0?Inline.setStyle(t,"opacity: 1;"):Inline.setStyle(t,"opacity: 0.6;")})}),p.resolve(!0)}catch(e){p.resolve(!1)}return p.promise},s.getTransactionId=function(r,o,i,a,c){var s=e.defer();!function(e){Inline.on("success",function(t){t.transactionId?e.resolve(t.transactionId):e.reject({errors:[t.error]})}),Inline.on("error",function(t){e.reject({errors:[t]})}),Inline.on("validate",function(t){if(t&&t.hasErrors){var n=[];!1===t.fields.cardNumber.valid&&(Inline.setStyle("cardNumber.invalid",d),Inline.setStyle("cardNumber.empty",d),n.push("Card number is invalid")),!1===t.fields.cvv.valid&&(Inline.setStyle("cvv.empty",d),Inline.setStyle("cvv.invalid",d),n.push("CVV is invalid")),e.reject({errors:n})}})}(s);try{Inline.submit({amount:n.getInMinorUnits(r),expm:i,expy:a,currency:o,returnUrl:c})}catch(e){s.reject({errors:[t.trc("publisher.dashboard","Unexpected error")]})}return s.promise},s.setPlaceholder=function(){Inline.setPlaceholder("cardNumber",t.trc("publisher.dashboard","Card number")),Inline.setPlaceholder("cvv",t.trc("publisher.dashboard","CVV"))},s.mappingForPublisherErrors=function(e){return f({"Card number is invalid":{field:"number",msg:t.trc("publisher.dashboard","Invalid credit card number")},"CVV is invalid":{field:"number",msg:t.trc("publisher.dashboard","Invalid CVV")},"Card number not allowed in test mode":{field:"number",msg:t.trc("publisher.dashboard","Card number not allowed in test mode")},default:{field:"number",msg:t.trc("publisher.dashboard","Unable to process credit card")}},e)},s.mappingForConsumerErrors=function(e){return f({"Card number is invalid":{field:"number",msg:t.trc("checkout.platform","Invalid credit card number")},"CVV is invalid":{field:"number",msg:t.trc("checkout.platform","Invalid CVV")},"Card number not allowed in test mode":{field:"number",msg:t.trc("checkout.platform","Card number not allowed in test mode")},default:{field:"number",msg:t.trc("checkout.platform","Unable to process credit card")}},e)},s}]),angular.module("datatransPostfinanceCommonModule",["tinypassServices","ajaxServices","tinypassServices"]),angular.module("datatransPostfinanceCommonModule").factory("datatransPostfinanceIntegrationService",["$rootElement","$q","ngEventService","iframeService",function(e,t,n,r){var o=null,i=null,a=null,c={};return c.setStoredRurl=function(e){o=e},c.getStoredRurl=function(e){return o+"&id="+e},c.getReturnUrl=function(e,t){return e+"&transactionId="+t},c.startPostfinanceCheckout=function(e){return i&&i.reject(),i=t.defer(),a=window.open(e,"payment_popup","scrollbars=1,popup=true,width=980,height=600",!0),i.promise},c.processPurchase=function(e,t,n,o){var i;i=t.isNew?o+"&transactionId="+e+"&payerInfo="+t.payerInfo:n+"&id="+t.id,r.injectHiddenIframe("datatrans-postfinance-checkout-frame",i)},n.subscribe("datatrans-postfinance-checkout-complete",function(e,t){if(a&&a.close(),i){switch(t.result){case"return":i.resolve(t);break;case"cancel":i.reject();break;case"failed":i.reject({message:t.error});break;default:i.reject({message:"[DatatransPostfinanceCheckout] Received unknown message: "+t.result})}i=null}}),c}]),angular.module("easypayCommonModule",["tinypassServices"]),angular.module("easypayCommonModule").factory("easypayBoletoService",["tpHTTP",function(e){var t={resendBill:function(t,n){return e.post(TPParam.BILL_PAYMENTS_RESEND_BILL_URL,{billId:t,userToken:n})}};return t}]),angular.module("easypayCommonModule").factory("easypayDirectDebitService",["$rootElement","$q","ngEventService",function(e,t,n){var r=null,o=null,i={};return i.startPurchase=function(e){return r&&r.reject(),r=t.defer(),o=window.open(e,"payment_popup","scrollbars=1,popup=true,width=980,height=600",!0),r.promise},i.proceedPurchase=function(t,n){var r=n;r+="&token="+t.token,r+="&reference="+t.reference,r+="&orderId="+t.orderId,r+="&maxDebit="+t.maxDebit,r+="&maxAmount="+t.maxAmount,function(t){var n=angular.element('<iframe name="easypay_direct_debit_frame" id="easypay_direct_debit_frame" style="display: none" src="'+t+'"></iframe>');e.append(n)}(r+="&expirationDate="+t.expirationDate)},n.subscribe("easypay-direct-debit-complete",function(e,t){if(o&&o.close(),r){switch(t.result){case"ok":r.resolve(t);break;case"failed":r.reject({message:t.error});break;default:console.warn("[EasypayDirectDebit] Received unknown message: "+t.result),r.reject()}r=null}}),i}]),angular.module("klarnaCommonModule",["tinypassServices","ajaxServices"]),angular.module("klarnaCommonModule").factory("klarnaService",klarnaService),klarnaService.$inject=["$q","lang","tpHTTP","$timeout","TinypassService"],angular.module("obiCommonModule",["tp.i18n"]),angular.module("obiCommonModule").factory("obiIntegrationService",obiIntegrationServiceFactory).factory("obiPaypalIntegrationService",obiPaypalIntegrationServiceFactory),obiIntegrationServiceFactory.$inject=["lang","$injector","$q","$rootScope"],obiPaypalIntegrationServiceFactory.$inject=["$rootElement","$q","ngEventService","iframeService"],function(){return function e(t,n,r){function o(a,c){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!c&&s)return s(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){return o(t[a][1][e]||e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}}()({1:[function(e,t,n){"use strict";var r=e("../creditCardComponentsModule"),o=e("../config").prefixes.CHECKOUT,i=e("../common").providersService,a=e("../common").getNewFlowComponents,c=e("../common").ppCreditCardActionsService,s=e("../common").dynamicBaseInputsComponent,u=e("../common").getModulesFor,l=[r.name].concat(u(o)),d=angular.module("providersModuleCH",[].concat(l)).factory("eventsServiceCH",function(){return{events:{previewTermComplete:"NEW_FLOW_EVENT_PREVIEW_TERM_COMPLETE",initiateSucceed:"NEW_FLOW_EVENT_INITIATE_SUCCEED",initiateFailed:"NEW_FLOW_EVENT_INITIATE_FAILED",beforeProcess:"NEW_FLOW_EVENT_BEFORE_PROCESS",processSucceed:"NEW_FLOW_EVENT_PROCESS_SUCCEED",processFailed:"NEW_FLOW_EVENT_PROCESS_FAILED",confirmed:"NEW_FLOW_EVENT_CONFIRMED",declined:"NEW_FLOW_EVENT_DECLINED",completeSucceed:"NEW_FLOW_EVENT_COMPLETE_SUCCEED",completeFailed:"NEW_FLOW_EVENT_COMPLETE_FAILED"},iframeHungTimeout:null}}).factory("providersServiceCH",["$injector","ccFieldsService",function(e,t){return i(e,t,o)}]).directive("newFlowComponentsCH",["ccFieldsService",function(e){return a(e,o)}]).service("ppCreditCardActionsService",c).directive("dynamicBaseInputsComponent",s);t.exports=d},{"../common":2,"../config":3,"../creditCardComponentsModule":4}],2:[function(e,t,n){"use strict";var r=e("./config").providers;t.exports={getModulesFor:function(e){var t=[];for(var n in r){var o=r[n].name+"Module"+e;t.push(o)}return t},dynamicBaseInputsComponent:["$compile",function(e){return{restrict:"E",link:function(t,n){n.html("<"+t.name+'-base-inputs-component credit-card="creditCard" readonly="readonly" callback-on-form-init="callbackOnFormInit"><'+t.name+"-base-inputs-component/>").show(),e(n.contents())(t)},scope:{name:"=",creditCard:"=",callbackOnFormInit:"=?"}}}],ppCreditCardActionsService:function(){return{loaded:"PP_CARD_LOADED",init:"PP_CARD_INITIALIZE",initSuccess:"INIT_PP_CARD_SUCCESS",initError:"INIT_PP_CARD_ERROR",create:"CREATE_PP_CARD",createSuccess:"CREATE_PP_CARD_SUCCESS",createError:"CREATE_PP_CARD_ERROR",validationStart:"PP_CARD_VALIDATION_START",validationEnd:"PP_CARD_VALIDATION_END",isValid:"CREDIT_CARD_FORM_IS_VALID",isNotValid:"CREDIT_CARD_FORM_IS_NOT_VALID"}},providersService:function(e,t,n){return{getProviderInstanceById:function(t){return e.get(this._getProviderInstanceNameById(t))},checkProviderInstanceById:function(n){var r=!0;return t.getNewFlowProviders()[n]&&e.has(this._getProviderInstanceNameById(n))||(r=!1),r},_getProviderInstanceNameById:function(e){return t.getNewFlowProviders()[e].name+"Provider"+n},hasNewFlow:function(e){var n=t.getNewFlowProviders()[e];return n&&n.name}}},getNewFlowComponents:function(e,t,n){var r=e.getNewFlowProviders(),o=t,i="";for(var a in t=t.toLowerCase().split("").join("-"),r){var c=r[a].name,s=n?c+o+" cc-detailed":"";i+="<".concat(c,"-component-").concat(t,'\n \t\t\t\t\t\tclass="').concat(s,'" \n \t\t\t\t\t\treadonly="readonly"\n \t\t\t\t\t\tpayment-provider="paymentProvider"\n            card="card"\n            term-id="{{termId}}"\n            ng-if="paymentSource == ').concat(a,'">\n\t\t\t\t\t</').concat(c,"-component-").concat(t,">")}return{restrict:"E",scope:{paymentProvider:"=paymentProvider",card:"=card",paymentSource:"=paymentSource",readonly:"=readonly",termId:"@?"},template:i}}}},{"./config":3}],3:[function(e,t,n){"use strict";t.exports={prefixes:{CONSUMER_DASHBOARD:"CD",PUBLISHER_DASHBOARD:"PD",CHECKOUT:"CH",APPLY_TERM_WIZARD:"ATW",MY_ACCOUNT:"MA"},providers:{19:{name:"edgil"},37:{name:"onet"},38:{name:"applepayss"},39:{name:"cybersource"},40:{name:"stripe"},41:{name:"applepaystripe"},42:{name:"applepayway"},45:{name:"wirecard"},50:{name:"gocardlessdd"}}}},{}],4:[function(e,t,n){"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var o=angular.module("creditCardComponentsModule",[]),i=e("./config");o.service("ccFieldsService",function(){return{getBaseCreditCardFields:function(){return{value:"",disabled:!1,required:!1,readonly:!1,onChangeCallback:angular.noop,maxlength:null,valid:!0,showLabel:!1}},getBaseCcComponentScope:function(){return{text:"=ngModel",onChange:"=onChange",disabled:"=ngDisabled",required:"=ngRequired",readonly:"=ngReadonly",maxlength:"=maxlength",className:"=?className",name:"=name",valid:"=valid"}},getBaseCcInputDirectiveParams:function(e){return{restrict:"E",require:"ngModel",templateUrl:e,scope:this.getBaseCcComponentScope()}},getTemplatesScope:function(){return{credit_card:{num:this.getBaseCreditCardFields(),expire:this.getBaseCreditCardFields(),cvv:this.getBaseCreditCardFields(),postal_code:this.getBaseCreditCardFields()}}},getExpireValueSplitted:function(e){var t={month:"",year:""};if(e){var n=r(e.split("/"),2),o=n[0],i=n[1];void 0!==o&&(o=o.trim()),void 0!==i&&(i=i.trim()),t={month:o,year:i}}return t},getFormattedMonth:function(e){return("0"+e).slice(-2)},getFormattedYear:function(e){return e.toString().slice(-2)},getFullyFormattedYear:function(e){return("20"+e).slice(-4)},getNewFlowProviders:function(){return i.providers},detectCardType:function(e){for(var t=this.getUnknownCardType(),n={shortName:"v",longName:"Visa"},r=[{type:n,rname:"electron",rgxp:/^(4026|417500|4405|4508|4844|4913|4917)\d+$/},{type:t,rname:"maestro",rgxp:/^(5018|5020|5038|5612|5893|6304|6759|6761|6762|6763|0604|6390)\d+$/},{type:t,rname:"dankort",rgxp:/^(5019)\d+$/},{type:t,rname:"interpayment",rgxp:/^(636)\d+$/},{type:t,rname:"unionpay",rgxp:/^(62|88)\d+$/},{type:n,rname:"visa",rgxp:/^4[0-9]{12}(?:[0-9]{3})?$/},{type:{shortName:"mc",longName:"MasterCard"},rname:"mastercard",rgxp:/^5[1-5][0-9]{2}|(222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)[0-9]{12}$/},{type:{shortName:"amex",longName:"American Express"},rname:"amex",rgxp:/^3[47][0-9]{13}$/},{type:{shortName:"dci",longName:"Diners Club"},rname:"diners",rgxp:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/},{type:{shortName:"d",longName:"Discover"},rname:"discover",rgxp:/^6(?:011|5[0-9]{2})[0-9]{12}$/},{type:t,rname:"jcb",rgxp:/^(?:2131|1800|35\d{3})\d{11}$/}],o=0;o<r.length;o++){var i=r[o];if(i.rgxp.test(e))return i.type}return t},getUnknownCardType:function(){return{shortName:"card",longName:"Credit card"}},getCardType:function(e){return{type:{shortName:{"American Express":"amex",Visa:"v",MasterCard:"mc"}[e],longName:e}}}}}),o.service("ccValidationService",["ccFieldsService","lang",function(e,t){return{collectCCErrors:function(e,t){var n=this.getEmptyFieldsErrors(e,t);return n.length?n:this.getSpecificFieldsErrors(e,t)},getEmptyFieldsErrors:function(e,t){return(t=t||this.baseFields).reduce(function(t,n){return e[n.name].value||e[n.name].disabled||t.push({name:n.name,msg:n.msg}),t},[])},getSpecificFieldsErrors:function(e){return[this.getCCNumberError(e.num),this.getExpireError(e.expire),this.getCVVError(e)].filter(function(e){return e})},getCCNumberError:function(e){var n;return this.ccLuhnCheck(e.value)||(n={name:"num",msg:t.tr("Invalid credit card number")}),n},getExpireError:function(n){var r,o=e.getExpireValueSplitted(n.value);return this.ccExpireDateValidate(o.month,o.year)||(r={name:"expire",msg:t.tr("Invalid expiration date")}),r},getCVVError:function(e){if(!this.cvvValidate(e.num.value,e.cvv.value))return{name:"cvv",msg:t.tr("Your CVV must be 4 digits for American Express or 3 digits for other cards")}},cvvValidate:function(t,n){var r=t.replace(/\D/g,""),o=n.replace(/\D/g,"");if("amex"===e.detectCardType(r).shortName){if(/^\d{4}$/.test(o))return!0}else if(/^\d{3}$/.test(o))return!0;return!1},ccExpireDateValidate:function(e,t){if(!e||!t)return!1;var n=parseInt(e,10),r=parseInt(t,10);if(n<1||n>12)return!1;if(r<0)return!1;r<100&&(r+=2e3);var o=new Date;o.setDate(1),o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0);var i=new Date;return i.setDate(1),i.setMonth(n-1),i.setYear(r),i.setHours(0),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0),o.getTime()<=i.getTime()},ccLuhnCheck:function(e){if(!e.match(/^\d+$/))return!1;for(var t=e.length,n=1&t,r=0,o=0;o<t;o++){var i=parseInt(e.charAt(o));1&o^n||(i*=2)>9&&(i-=9),r+=i}return r%10==0},baseFields:[{name:"num",msg:t.tr("Card number is required")},{name:"expire",msg:t.tr("Expiration date is required")},{name:"cvv",msg:t.tr("CVV is required")},{name:"postal_code",msg:t.tr("Postal code is required")}]}}]),o.directive("formatExpiryDate",function(){var e,t,n,r,o,i,a,c,s,u;return i=function(e){var t;return null!=e.prop("selectionStart")&&e.prop("selectionStart")!==e.prop("selectionEnd")||!(null==("undefined"!=typeof document&&null!==document&&null!=(t=document.selection)?t.createRange:void 0)||!document.selection.createRange().text)},s=function(e){var t;return!(!e.metaKey&&!e.ctrlKey)||32!==e.which&&(0===e.which||(e.which<33||(t=String.fromCharCode(e.which),!!/[\d\s]/.test(t))))},c=function(e){var t,n;if(t=$(e.currentTarget),n=String.fromCharCode(e.which),/^\d+$/.test(n)&&!i(t))return!((t.val()+n).replace(/\D/g,"").length>u+2)&&void 0},n=function(e){var t,n,r;if(n=String.fromCharCode(e.which),/^\d+$/.test(n))return t=$(e.currentTarget),r=t.val()+n,/^\d$/.test(r)&&"0"!==r&&"1"!==r?(e.preventDefault(),setTimeout(function(){return t.val("0"+r+" / ")})):/^\d\d$/.test(r)?(e.preventDefault(),setTimeout(function(){return t.val(r+" / ")})):void 0},a=function(t){return setTimeout(function(){var n,r;return r=(n=$(t.currentTarget)).val(),r=e(r),n.val(r)})},e=function(e){var t,n,r,o,i=new RegExp("^\\D*(\\d{1,2})(\\D+)?(\\d{1,"+u+"})?");return(n=e.match(i))?(t=n[1]||"",r=n[2]||"",(o=n[3]||"").length>0?r=" / ":" /"===r?(t=t.substring(0,1),r=""):2===t.length||r.length>0?r=" / ":1===t.length&&"0"!==t&&"1"!==t&&(t="0"+t,r=" / "),t+r+o):""},o=function(e){var t,n,r;if("/"===(r=String.fromCharCode(e.which))||" "===r)return n=(t=$(e.currentTarget)).val(),/^\d$/.test(n)&&"0"!==n?t.val("0"+n+" / "):void 0},r=function(e){var t,n,r;if(n=String.fromCharCode(e.which),/^\d+$/.test(n))return r=(t=$(e.currentTarget)).val(),/^\d\d$/.test(r)?t.val(r+" / "):void 0},t=function(e){var t,n;if(t=$(e.currentTarget),n=t.val(),8===e.which&&(null==t.prop("selectionStart")||t.prop("selectionStart")===n.length))return/\d\s\/\s$/.test(n)?(e.preventDefault(),setTimeout(function(){return t.val(n.replace(/\d\s\/\s$/,""))})):void 0},{scope:{formatYear:"=?formatYear"},restrict:"A",link:function(e,i){u=e.formatYear||2,i.on("keypress",s),i.on("keypress",c),i.on("keypress",n),i.on("keypress",o),i.on("keypress",r),i.on("keydown",t),i.on("change",a),i.on("input",a)}}}),o.directive("ccTextInput",function(){return{restrict:"E",require:"ngModel",templateUrl:"/frontend/providers/common/credit-card-text-input.html",scope:{text:"=ngModel",placeholder:"=placeholder",icon:"=icon",name:"=name",maxlength:"=maxlength",readonly:"=ngReadonly",required:"=ngRequired",disabled:"=ngDisabled",iconClass:"=iconClass",iconWidth:"=iconWidth",className:"=className",borderBottom:"=borderBottom",autocomplete:"=autocomplete",onChange:"=onChange",valid:"=valid"},controller:["$scope",function(e){e.getIconClass=function(){var t="";return e.readonly&&(t+="".concat("cc-field__icon--","readonly ")),e.text&&(t+="".concat("cc-field__icon--","highlighted ")),e.iconClass?t+="".concat(e.iconClass," "):t+="".concat("cc-field__icon--").concat(e.icon," "),t},e.getFieldClass=function(){var t="";return e.name&&(t+="".concat("cc-field--").concat(e.name," ")),e.valid||(t+="".concat("cc-field--","not-valid")),t}}]}}),o.directive("creditCardCvv",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-cvv.html")}]),o.directive("creditCardPostalCode",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-postal-code.html")}]),o.directive("creditCardNumber",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-number.html")}]),o.directive("creditCardHolder",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-holder.html")}]),o.directive("ccExpireComponent",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-expire.html")}]),t.exports=o},{"./config":3}]},{},[1]),function(){return function e(t,n,r){function o(a,c){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!c&&s)return s(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){return o(t[a][1][e]||e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}}()({1:[function(e,t,n){"use strict";t.exports={prefixes:{CONSUMER_DASHBOARD:"CD",PUBLISHER_DASHBOARD:"PD",CHECKOUT:"CH",APPLY_TERM_WIZARD:"ATW",MY_ACCOUNT:"MA"},providers:{19:{name:"edgil"},37:{name:"onet"},38:{name:"applepayss"},39:{name:"cybersource"},40:{name:"stripe"},41:{name:"applepaystripe"},42:{name:"applepayway"},45:{name:"wirecard"},50:{name:"gocardlessdd"}}}},{}],2:[function(e,t,n){"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var o=angular.module("creditCardComponentsModule",[]),i=e("./config");o.service("ccFieldsService",function(){return{getBaseCreditCardFields:function(){return{value:"",disabled:!1,required:!1,readonly:!1,onChangeCallback:angular.noop,maxlength:null,valid:!0,showLabel:!1}},getBaseCcComponentScope:function(){return{text:"=ngModel",onChange:"=onChange",disabled:"=ngDisabled",required:"=ngRequired",readonly:"=ngReadonly",maxlength:"=maxlength",className:"=?className",name:"=name",valid:"=valid"}},getBaseCcInputDirectiveParams:function(e){return{restrict:"E",require:"ngModel",templateUrl:e,scope:this.getBaseCcComponentScope()}},getTemplatesScope:function(){return{credit_card:{num:this.getBaseCreditCardFields(),expire:this.getBaseCreditCardFields(),cvv:this.getBaseCreditCardFields(),postal_code:this.getBaseCreditCardFields()}}},getExpireValueSplitted:function(e){var t={month:"",year:""};if(e){var n=r(e.split("/"),2),o=n[0],i=n[1];void 0!==o&&(o=o.trim()),void 0!==i&&(i=i.trim()),t={month:o,year:i}}return t},getFormattedMonth:function(e){return("0"+e).slice(-2)},getFormattedYear:function(e){return e.toString().slice(-2)},getFullyFormattedYear:function(e){return("20"+e).slice(-4)},getNewFlowProviders:function(){return i.providers},detectCardType:function(e){for(var t=this.getUnknownCardType(),n={shortName:"v",longName:"Visa"},r=[{type:n,rname:"electron",rgxp:/^(4026|417500|4405|4508|4844|4913|4917)\d+$/},{type:t,rname:"maestro",rgxp:/^(5018|5020|5038|5612|5893|6304|6759|6761|6762|6763|0604|6390)\d+$/},{type:t,rname:"dankort",rgxp:/^(5019)\d+$/},{type:t,rname:"interpayment",rgxp:/^(636)\d+$/},{type:t,rname:"unionpay",rgxp:/^(62|88)\d+$/},{type:n,rname:"visa",rgxp:/^4[0-9]{12}(?:[0-9]{3})?$/},{type:{shortName:"mc",longName:"MasterCard"},rname:"mastercard",rgxp:/^5[1-5][0-9]{2}|(222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)[0-9]{12}$/},{type:{shortName:"amex",longName:"American Express"},rname:"amex",rgxp:/^3[47][0-9]{13}$/},{type:{shortName:"dci",longName:"Diners Club"},rname:"diners",rgxp:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/},{type:{shortName:"d",longName:"Discover"},rname:"discover",rgxp:/^6(?:011|5[0-9]{2})[0-9]{12}$/},{type:t,rname:"jcb",rgxp:/^(?:2131|1800|35\d{3})\d{11}$/}],o=0;o<r.length;o++){var i=r[o];if(i.rgxp.test(e))return i.type}return t},getUnknownCardType:function(){return{shortName:"card",longName:"Credit card"}},getCardType:function(e){return{type:{shortName:{"American Express":"amex",Visa:"v",MasterCard:"mc"}[e],longName:e}}}}}),o.service("ccValidationService",["ccFieldsService","lang",function(e,t){return{collectCCErrors:function(e,t){var n=this.getEmptyFieldsErrors(e,t);return n.length?n:this.getSpecificFieldsErrors(e,t)},getEmptyFieldsErrors:function(e,t){return(t=t||this.baseFields).reduce(function(t,n){return e[n.name].value||e[n.name].disabled||t.push({name:n.name,msg:n.msg}),t},[])},getSpecificFieldsErrors:function(e){return[this.getCCNumberError(e.num),this.getExpireError(e.expire),this.getCVVError(e)].filter(function(e){return e})},getCCNumberError:function(e){var n;return this.ccLuhnCheck(e.value)||(n={name:"num",msg:t.tr("Invalid credit card number")}),n},getExpireError:function(n){var r,o=e.getExpireValueSplitted(n.value);return this.ccExpireDateValidate(o.month,o.year)||(r={name:"expire",msg:t.tr("Invalid expiration date")}),r},getCVVError:function(e){if(!this.cvvValidate(e.num.value,e.cvv.value))return{name:"cvv",msg:t.tr("Your CVV must be 4 digits for American Express or 3 digits for other cards")}},cvvValidate:function(t,n){var r=t.replace(/\D/g,""),o=n.replace(/\D/g,"");if("amex"===e.detectCardType(r).shortName){if(/^\d{4}$/.test(o))return!0}else if(/^\d{3}$/.test(o))return!0;return!1},ccExpireDateValidate:function(e,t){if(!e||!t)return!1;var n=parseInt(e,10),r=parseInt(t,10);if(n<1||n>12)return!1;if(r<0)return!1;r<100&&(r+=2e3);var o=new Date;o.setDate(1),o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0);var i=new Date;return i.setDate(1),i.setMonth(n-1),i.setYear(r),i.setHours(0),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0),o.getTime()<=i.getTime()},ccLuhnCheck:function(e){if(!e.match(/^\d+$/))return!1;for(var t=e.length,n=1&t,r=0,o=0;o<t;o++){var i=parseInt(e.charAt(o));1&o^n||(i*=2)>9&&(i-=9),r+=i}return r%10==0},baseFields:[{name:"num",msg:t.tr("Card number is required")},{name:"expire",msg:t.tr("Expiration date is required")},{name:"cvv",msg:t.tr("CVV is required")},{name:"postal_code",msg:t.tr("Postal code is required")}]}}]),o.directive("formatExpiryDate",function(){var e,t,n,r,o,i,a,c,s,u;return i=function(e){var t;return null!=e.prop("selectionStart")&&e.prop("selectionStart")!==e.prop("selectionEnd")||!(null==("undefined"!=typeof document&&null!==document&&null!=(t=document.selection)?t.createRange:void 0)||!document.selection.createRange().text)},s=function(e){var t;return!(!e.metaKey&&!e.ctrlKey)||32!==e.which&&(0===e.which||(e.which<33||(t=String.fromCharCode(e.which),!!/[\d\s]/.test(t))))},c=function(e){var t,n;if(t=$(e.currentTarget),n=String.fromCharCode(e.which),/^\d+$/.test(n)&&!i(t))return!((t.val()+n).replace(/\D/g,"").length>u+2)&&void 0},n=function(e){var t,n,r;if(n=String.fromCharCode(e.which),/^\d+$/.test(n))return t=$(e.currentTarget),r=t.val()+n,/^\d$/.test(r)&&"0"!==r&&"1"!==r?(e.preventDefault(),setTimeout(function(){return t.val("0"+r+" / ")})):/^\d\d$/.test(r)?(e.preventDefault(),setTimeout(function(){return t.val(r+" / ")})):void 0},a=function(t){return setTimeout(function(){var n,r;return r=(n=$(t.currentTarget)).val(),r=e(r),n.val(r)})},e=function(e){var t,n,r,o,i=new RegExp("^\\D*(\\d{1,2})(\\D+)?(\\d{1,"+u+"})?");return(n=e.match(i))?(t=n[1]||"",r=n[2]||"",(o=n[3]||"").length>0?r=" / ":" /"===r?(t=t.substring(0,1),r=""):2===t.length||r.length>0?r=" / ":1===t.length&&"0"!==t&&"1"!==t&&(t="0"+t,r=" / "),t+r+o):""},o=function(e){var t,n,r;if("/"===(r=String.fromCharCode(e.which))||" "===r)return n=(t=$(e.currentTarget)).val(),/^\d$/.test(n)&&"0"!==n?t.val("0"+n+" / "):void 0},r=function(e){var t,n,r;if(n=String.fromCharCode(e.which),/^\d+$/.test(n))return r=(t=$(e.currentTarget)).val(),/^\d\d$/.test(r)?t.val(r+" / "):void 0},t=function(e){var t,n;if(t=$(e.currentTarget),n=t.val(),8===e.which&&(null==t.prop("selectionStart")||t.prop("selectionStart")===n.length))return/\d\s\/\s$/.test(n)?(e.preventDefault(),setTimeout(function(){return t.val(n.replace(/\d\s\/\s$/,""))})):void 0},{scope:{formatYear:"=?formatYear"},restrict:"A",link:function(e,i){u=e.formatYear||2,i.on("keypress",s),i.on("keypress",c),i.on("keypress",n),i.on("keypress",o),i.on("keypress",r),i.on("keydown",t),i.on("change",a),i.on("input",a)}}}),o.directive("ccTextInput",function(){return{restrict:"E",require:"ngModel",templateUrl:"/frontend/providers/common/credit-card-text-input.html",scope:{text:"=ngModel",placeholder:"=placeholder",icon:"=icon",name:"=name",maxlength:"=maxlength",readonly:"=ngReadonly",required:"=ngRequired",disabled:"=ngDisabled",iconClass:"=iconClass",iconWidth:"=iconWidth",className:"=className",borderBottom:"=borderBottom",autocomplete:"=autocomplete",onChange:"=onChange",valid:"=valid"},controller:["$scope",function(e){e.getIconClass=function(){var t="";return e.readonly&&(t+="".concat("cc-field__icon--","readonly ")),e.text&&(t+="".concat("cc-field__icon--","highlighted ")),e.iconClass?t+="".concat(e.iconClass," "):t+="".concat("cc-field__icon--").concat(e.icon," "),t},e.getFieldClass=function(){var t="";return e.name&&(t+="".concat("cc-field--").concat(e.name," ")),e.valid||(t+="".concat("cc-field--","not-valid")),t}}]}}),o.directive("creditCardCvv",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-cvv.html")}]),o.directive("creditCardPostalCode",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-postal-code.html")}]),o.directive("creditCardNumber",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-number.html")}]),o.directive("creditCardHolder",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-holder.html")}]),o.directive("ccExpireComponent",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-expire.html")}]),t.exports=o},{"./config":1}],3:[function(e,t,n){"use strict";var r=e("../common/config").name,o=e("../../../common/config").prefixes.CHECKOUT,i=e("../common").getInstanceName,a=["checkout","ngEventService","$rootElement","errorService","lang","$injector","$q",function(e,t,n,a,c,s,u){return{restrict:"E",require:"^view",transclude:!0,templateUrl:"/frontend/providers/components/"+r+"/checkout/component.shtml",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","errorService","$timeout","ngEventService",function(t,r,a,u){angular.extend(t,BaseComponentController);var l=s.get("eventsService"+o),d=s.get(i("Provider",o)),p=l.events,f=null;t.input=e.input,t.isApplePaySsEnabled=!1,t.isSelectedTermAutoRenewChoiceAvailable=e.isSelectedTermAutoRenewChoiceAvailable;var m={110:c.trc("checkout.platform","Payment completion error"),111:c.trc("checkout.platform","Merchant validation error"),112:c.trc("checkout.platform","Error occurred while starting Apple Pay session"),113:c.trc("checkout.platform","Can not receive payment session from server")};function h(e){if(Array.isArray(e))for(var n=0;n<e.length;n++){var o=e[n].msg||e[n].message;o&&""!==o.trim()&&r(t).global(o)}else r(t).global(e.message)}t.openApplePayWindow=function(){if(t.isApplePaySsEnabled){var n={countryCode:"US",currencyCode:e.input.chargeCurrency,resourceName:e.flags.selectedTerm.resource.name,chargeAmount:e.input.chargeAmount};d.sendPostMessage("start-purchase",n)}},t.onValidationStart=function(){r(t).reset()},t.onValidationEnd=function(e){e.forEach(function(e){r(t).global(e.msg)})},t.$on("apple-pay-payment-authorized",function(e,t){g(t.paymentData)}),t.$on("payment-error",function(e,n){r(t).reset();var o=n.errorCode;void 0!==o&&m.hasOwnProperty(o)&&r(t).global(m[o])}),t.$on("apple-pay-init",function(){t.isApplePaySsEnabled=!0,t.$apply()}),t.$on(p.previewTermComplete,function(){e._completeTerm({q:"q"})}),t.$on(p.initiateSucceed,function(e,n){a(function(){t.$apply()})}),t.$on(p.initiateFailed,function(t,n){e.enabledCheckout(),h(n)}),t.$on(p.beforeProcess,function(){}),t.$on(p.processSucceed,function(t,r){var o={oid:e.input.oid,aid:e.params.aid};d.processPaymentData(o,f).then(function(e){n.append(angular.element('<iframe name="bt_post_frame" id="bt_post_frame" style="display: none" src="'+r.rurl+'"></iframe>'))}).catch(function(e){h({message:c.trc("checkout.platform","Payment could not be processed"),params:""}),h(e.errors)})}),t.$on(p.processFailed,function(t,n){e.enabledCheckout()}),t.$on(p.declined,function(){e.enabledCheckout()}),t.$on(p.completeSucceed,function(){d.sendPostMessage("apple-pay-complete-payment",{status:window.ApplePaySession.STATUS_SUCCESS})}),t.$on(p.completeFailed,function(t,n){var r=null;e.enabledCheckout(),Array.isArray(n)&&(r=n.map(function(e){return e.msg||e.message})),d.sendPostMessage("apple-pay-complete-payment",{status:window.ApplePaySession.STATUS_FAILURE,errors:r})});var g=function(n){f=n.token,e.completePayment(),t.$apply()};d.sendPostMessage("provider-component-initiated")}]}}];t.exports=a},{"../../../common/config":1,"../common":8,"../common/config":7}],4:[function(e,t,n){"use strict";var r=e("../common/module"),o=e("../../../common/config").prefixes.CHECKOUT,i=e("../common").getInstanceName,a=e("./component"),c=e("./service"),s=angular.module(i("Module",o),["checkoutModule",r.name]).factory(i("Provider",o),c).directive(i("Component",o),a);t.exports=s},{"../../../common/config":1,"../common":8,"../common/module":9,"./component":3,"./service":5}],5:[function(e,t,n){"use strict";var r=e("../../../common/config").prefixes.CHECKOUT,o=["$rootScope","$injector","$timeout","tpHTTP","ngEventService","checkout","eventService",function(e,t,n,o,i,a,c){var s=t.get("eventsService"+r).events;function u(e,t){return e.userToken=t.params.userToken,e.userProvider=t.params.userProvider,e.userRef=t.params.userRef,e.janrainCaptureToken=t.params.janrainCaptureToken,e.aid=t.getAid(),o({method:"post",url:TPParam.APPLE_PAY_PAYMENT_SESSION_URL,params:e,data:{dataParam:"applepay"}})}function l(e,t){c.postMessage(function(e){if(TPParam.APPLE_PAY_INT_SERVICE_MOCK)return e+"-"+TPParam.APPLE_PAY_INT_SERVICE_MOCK;return e}(e),t)}return i.subscribe("apple-pay-pay-session-request",function(t,n){u(n,a).then(function(e){l("pay-session-received",{applePaySession:e.models.applePaySession})}).catch(function(t){l("abort-apple-pay-session",{}),e.$broadcast("payment-error",{errorCode:113,error:null})})}),{sendPostMessage:l,beforeInitiate:function(){},initiateSucceed:function(t){e.$broadcast(s.initiateSucceed,t)},initiateFailed:function(t){e.$broadcast(s.initiateFailed,t)},beforeProcess:function(){e.$broadcast(s.beforeProcess)},processSucceed:function(t){e.$broadcast(s.processSucceed,t)},processFailed:function(t){e.$broadcast(s.processFailed,t)},confirmed:function(t){e.$broadcast(s.confirmed,t)},declined:function(t){e.$broadcast(s.declined,t)},completeSucceed:function(t){e.$broadcast(s.completeSucceed,t)},completeFailed:function(t){e.$broadcast(s.completeFailed,t)},processPaymentData:function(e,t){return o({method:"post",url:TPParam.APPLE_PAY_PROCESS_PAYMENT_DATA_URL,params:e,data:t})},validateMerchantAndGetPaymentSession:u}}];t.exports=o},{"../../../common/config":1}],6:[function(e,t,n){"use strict";var r=e("./config").name;t.exports=function(){return{restrict:"E",require:"ngModel",templateUrl:"/frontend/providers/components/"+r+"/common/baseTemplate.shtml",scope:{credit_card:"=creditCard",readonly:"=readonly"}}}},{"./config":7}],7:[function(e,t,n){"use strict";var r=e("../../../common/config"),o={id:38};o.name=r.providers[o.id].name,t.exports=o},{"../../../common/config":1}],8:[function(e,t,n){"use strict";var r=e("./config");t.exports={getInstanceName:function(e,t){var n=r.name+e;return t&&(n+=t),n}}},{"./config":7}],9:[function(e,t,n){"use strict";var r=e("./baseInputsComponent"),o=e("../../../common/creditCardComponentsModule"),i=e("./").getInstanceName,a=angular.module(i("CommonModule"),[o.name]).directive(i("BaseInputsComponent"),r);t.exports=a},{"../../../common/creditCardComponentsModule":2,"./":8,"./baseInputsComponent":6}]},{},[4]),function(){return function e(t,n,r){function o(a,c){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!c&&s)return s(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){return o(t[a][1][e]||e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}}()({1:[function(e,t,n){"use strict";t.exports={prefixes:{CONSUMER_DASHBOARD:"CD",PUBLISHER_DASHBOARD:"PD",CHECKOUT:"CH",APPLY_TERM_WIZARD:"ATW",MY_ACCOUNT:"MA"},providers:{19:{name:"edgil"},37:{name:"onet"},38:{name:"applepayss"},39:{name:"cybersource"},40:{name:"stripe"},41:{name:"applepaystripe"},42:{name:"applepayway"},45:{name:"wirecard"},50:{name:"gocardlessdd"}}}},{}],2:[function(e,t,n){"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var o=angular.module("creditCardComponentsModule",[]),i=e("./config");o.service("ccFieldsService",function(){return{getBaseCreditCardFields:function(){return{value:"",disabled:!1,required:!1,readonly:!1,onChangeCallback:angular.noop,maxlength:null,valid:!0,showLabel:!1}},getBaseCcComponentScope:function(){return{text:"=ngModel",onChange:"=onChange",disabled:"=ngDisabled",required:"=ngRequired",readonly:"=ngReadonly",maxlength:"=maxlength",className:"=?className",name:"=name",valid:"=valid"}},getBaseCcInputDirectiveParams:function(e){return{restrict:"E",require:"ngModel",templateUrl:e,scope:this.getBaseCcComponentScope()}},getTemplatesScope:function(){return{credit_card:{num:this.getBaseCreditCardFields(),expire:this.getBaseCreditCardFields(),cvv:this.getBaseCreditCardFields(),postal_code:this.getBaseCreditCardFields()}}},getExpireValueSplitted:function(e){var t={month:"",year:""};if(e){var n=r(e.split("/"),2),o=n[0],i=n[1];void 0!==o&&(o=o.trim()),void 0!==i&&(i=i.trim()),t={month:o,year:i}}return t},getFormattedMonth:function(e){return("0"+e).slice(-2)},getFormattedYear:function(e){return e.toString().slice(-2)},getFullyFormattedYear:function(e){return("20"+e).slice(-4)},getNewFlowProviders:function(){return i.providers},detectCardType:function(e){for(var t=this.getUnknownCardType(),n={shortName:"v",longName:"Visa"},r=[{type:n,rname:"electron",rgxp:/^(4026|417500|4405|4508|4844|4913|4917)\d+$/},{type:t,rname:"maestro",rgxp:/^(5018|5020|5038|5612|5893|6304|6759|6761|6762|6763|0604|6390)\d+$/},{type:t,rname:"dankort",rgxp:/^(5019)\d+$/},{type:t,rname:"interpayment",rgxp:/^(636)\d+$/},{type:t,rname:"unionpay",rgxp:/^(62|88)\d+$/},{type:n,rname:"visa",rgxp:/^4[0-9]{12}(?:[0-9]{3})?$/},{type:{shortName:"mc",longName:"MasterCard"},rname:"mastercard",rgxp:/^5[1-5][0-9]{2}|(222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)[0-9]{12}$/},{type:{shortName:"amex",longName:"American Express"},rname:"amex",rgxp:/^3[47][0-9]{13}$/},{type:{shortName:"dci",longName:"Diners Club"},rname:"diners",rgxp:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/},{type:{shortName:"d",longName:"Discover"},rname:"discover",rgxp:/^6(?:011|5[0-9]{2})[0-9]{12}$/},{type:t,rname:"jcb",rgxp:/^(?:2131|1800|35\d{3})\d{11}$/}],o=0;o<r.length;o++){var i=r[o];if(i.rgxp.test(e))return i.type}return t},getUnknownCardType:function(){return{shortName:"card",longName:"Credit card"}},getCardType:function(e){return{type:{shortName:{"American Express":"amex",Visa:"v",MasterCard:"mc"}[e],longName:e}}}}}),o.service("ccValidationService",["ccFieldsService","lang",function(e,t){return{collectCCErrors:function(e,t){var n=this.getEmptyFieldsErrors(e,t);return n.length?n:this.getSpecificFieldsErrors(e,t)},getEmptyFieldsErrors:function(e,t){return(t=t||this.baseFields).reduce(function(t,n){return e[n.name].value||e[n.name].disabled||t.push({name:n.name,msg:n.msg}),t},[])},getSpecificFieldsErrors:function(e){return[this.getCCNumberError(e.num),this.getExpireError(e.expire),this.getCVVError(e)].filter(function(e){return e})},getCCNumberError:function(e){var n;return this.ccLuhnCheck(e.value)||(n={name:"num",msg:t.tr("Invalid credit card number")}),n},getExpireError:function(n){var r,o=e.getExpireValueSplitted(n.value);return this.ccExpireDateValidate(o.month,o.year)||(r={name:"expire",msg:t.tr("Invalid expiration date")}),r},getCVVError:function(e){if(!this.cvvValidate(e.num.value,e.cvv.value))return{name:"cvv",msg:t.tr("Your CVV must be 4 digits for American Express or 3 digits for other cards")}},cvvValidate:function(t,n){var r=t.replace(/\D/g,""),o=n.replace(/\D/g,"");if("amex"===e.detectCardType(r).shortName){if(/^\d{4}$/.test(o))return!0}else if(/^\d{3}$/.test(o))return!0;return!1},ccExpireDateValidate:function(e,t){if(!e||!t)return!1;var n=parseInt(e,10),r=parseInt(t,10);if(n<1||n>12)return!1;if(r<0)return!1;r<100&&(r+=2e3);var o=new Date;o.setDate(1),o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0);var i=new Date;return i.setDate(1),i.setMonth(n-1),i.setYear(r),i.setHours(0),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0),o.getTime()<=i.getTime()},ccLuhnCheck:function(e){if(!e.match(/^\d+$/))return!1;for(var t=e.length,n=1&t,r=0,o=0;o<t;o++){var i=parseInt(e.charAt(o));1&o^n||(i*=2)>9&&(i-=9),r+=i}return r%10==0},baseFields:[{name:"num",msg:t.tr("Card number is required")},{name:"expire",msg:t.tr("Expiration date is required")},{name:"cvv",msg:t.tr("CVV is required")},{name:"postal_code",msg:t.tr("Postal code is required")}]}}]),o.directive("formatExpiryDate",function(){var e,t,n,r,o,i,a,c,s,u;return i=function(e){var t;return null!=e.prop("selectionStart")&&e.prop("selectionStart")!==e.prop("selectionEnd")||!(null==("undefined"!=typeof document&&null!==document&&null!=(t=document.selection)?t.createRange:void 0)||!document.selection.createRange().text)},s=function(e){var t;return!(!e.metaKey&&!e.ctrlKey)||32!==e.which&&(0===e.which||(e.which<33||(t=String.fromCharCode(e.which),!!/[\d\s]/.test(t))))},c=function(e){var t,n;if(t=$(e.currentTarget),n=String.fromCharCode(e.which),/^\d+$/.test(n)&&!i(t))return!((t.val()+n).replace(/\D/g,"").length>u+2)&&void 0},n=function(e){var t,n,r;if(n=String.fromCharCode(e.which),/^\d+$/.test(n))return t=$(e.currentTarget),r=t.val()+n,/^\d$/.test(r)&&"0"!==r&&"1"!==r?(e.preventDefault(),setTimeout(function(){return t.val("0"+r+" / ")})):/^\d\d$/.test(r)?(e.preventDefault(),setTimeout(function(){return t.val(r+" / ")})):void 0},a=function(t){return setTimeout(function(){var n,r;return r=(n=$(t.currentTarget)).val(),r=e(r),n.val(r)})},e=function(e){var t,n,r,o,i=new RegExp("^\\D*(\\d{1,2})(\\D+)?(\\d{1,"+u+"})?");return(n=e.match(i))?(t=n[1]||"",r=n[2]||"",(o=n[3]||"").length>0?r=" / ":" /"===r?(t=t.substring(0,1),r=""):2===t.length||r.length>0?r=" / ":1===t.length&&"0"!==t&&"1"!==t&&(t="0"+t,r=" / "),t+r+o):""},o=function(e){var t,n,r;if("/"===(r=String.fromCharCode(e.which))||" "===r)return n=(t=$(e.currentTarget)).val(),/^\d$/.test(n)&&"0"!==n?t.val("0"+n+" / "):void 0},r=function(e){var t,n,r;if(n=String.fromCharCode(e.which),/^\d+$/.test(n))return r=(t=$(e.currentTarget)).val(),/^\d\d$/.test(r)?t.val(r+" / "):void 0},t=function(e){var t,n;if(t=$(e.currentTarget),n=t.val(),8===e.which&&(null==t.prop("selectionStart")||t.prop("selectionStart")===n.length))return/\d\s\/\s$/.test(n)?(e.preventDefault(),setTimeout(function(){return t.val(n.replace(/\d\s\/\s$/,""))})):void 0},{scope:{formatYear:"=?formatYear"},restrict:"A",link:function(e,i){u=e.formatYear||2,i.on("keypress",s),i.on("keypress",c),i.on("keypress",n),i.on("keypress",o),i.on("keypress",r),i.on("keydown",t),i.on("change",a),i.on("input",a)}}}),o.directive("ccTextInput",function(){return{restrict:"E",require:"ngModel",templateUrl:"/frontend/providers/common/credit-card-text-input.html",scope:{text:"=ngModel",placeholder:"=placeholder",icon:"=icon",name:"=name",maxlength:"=maxlength",readonly:"=ngReadonly",required:"=ngRequired",disabled:"=ngDisabled",iconClass:"=iconClass",iconWidth:"=iconWidth",className:"=className",borderBottom:"=borderBottom",autocomplete:"=autocomplete",onChange:"=onChange",valid:"=valid"},controller:["$scope",function(e){e.getIconClass=function(){var t="";return e.readonly&&(t+="".concat("cc-field__icon--","readonly ")),e.text&&(t+="".concat("cc-field__icon--","highlighted ")),e.iconClass?t+="".concat(e.iconClass," "):t+="".concat("cc-field__icon--").concat(e.icon," "),t},e.getFieldClass=function(){var t="";return e.name&&(t+="".concat("cc-field--").concat(e.name," ")),e.valid||(t+="".concat("cc-field--","not-valid")),t}}]}}),o.directive("creditCardCvv",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-cvv.html")}]),o.directive("creditCardPostalCode",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-postal-code.html")}]),o.directive("creditCardNumber",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-number.html")}]),o.directive("creditCardHolder",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-holder.html")}]),o.directive("ccExpireComponent",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-expire.html")}]),t.exports=o},{"./config":1}],3:[function(e,t,n){"use strict";var r=e("../common/config").name,o=e("../../../common/config").prefixes.CHECKOUT,i=e("../common").getInstanceName,a=["checkout","errorService","lang","$injector","$timeout","iframeService","$q","viewService","userService","passwordlessService","tpHTTP","passwordlessPaymentService","purchaseService",function(e,t,n,a,c,s,u,l,d,p,f,m,h){return{restrict:"E",require:"^view",transclude:!0,templateUrl:"/frontend/providers/components/".concat(r,"/checkout/component.shtml"),scope:{skipValidation:"@",termId:"@?"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","ngEventService","checkoutUpdatesService","$timeout",function(r,c,l,d){angular.extend(r,BaseComponentController);var p=a.get("eventsService"+o),g=a.get(i("Provider",o)),v=p.events;r.isStripeApplePayEnabled=!1,r.isPasswordlessApplePayUsed=m.isPasswordlessApplePayUsed(),r.termId=r.termId||"";var y,C=null,E=null,S=!1;function T(){return r.termId&&r.termId===e.flags.selectedTerm.termId}function _(e){S=e}function w(t){_(!0),r.isPasswordlessApplePayUsed&&T()?(e.input.paymentMethodInstrumentId=t.paymentMethodId||"",m.checkSelectedTerm(r).then(function(){return function(t){var n={oid:e.input.oid,instrumentId:t.paymentMethodId,email:t.payerEmail,aid:e.getAid(),url:e.params.url};m.applyTax(r,t.billingAddress,!0).then(function(){if(!e.isUserValid())return m.proceedPasswordlessUser(r,n,y)}).then(function(e){e&&e.isPasswordlessEmailSent||$(t.paymentMethodId)})}(t)})):$(t.paymentMethodId)}function b(){return e.onUserChanged().then(function(){S||g.sendPostMessage("stripe-applepay-abort-request")})}function P(){t(r).reset(),!(y=e._findTerm(r.termId)).chargeCurrency||r.isStripeApplePayEnabled||e.flags.isPasswordlessApplePayBeingInitiated||(m.setInitInProgress(!0),f({method:"post",url:TPParam.STRIPE_APPLE_PAY_INIT,params:{aid:e.getAid()}}).then(function(t){var n={apiKey:t.models.publishableAPIKey,paymentRequestPayload:{country:t.models.country,currency:y.chargeCurrency.toLowerCase(),total:{label:y.resource.name,amount:y.chargeAmountInMinorUnit},requestPayerName:!0,requestPayerEmail:r.isPasswordlessApplePayUsed&&!e.isUserValid()}};g.sendPostMessage("stripe-applepay-initiate-purchase",n),m.setInitInProgress(!1)}).then(b).catch(function(e){m.displayErrors(r,e.errors),m.setInitInProgress(!1)}))}function A(e){r.isStripeApplePayEnabled=e,d(function(){r.$apply()})}function $(t){C=t,e.input.paymentMethodInstrumentId=C,e.completePayment().finally(function(){return _(!1)}),d(function(){r.$apply()})}function I(e){if(e)if(t(r).reset(),Array.isArray(e))for(var n=0;n<e.length;n++){var o=e[n].msg||e[n].message;o&&""!==o.trim()&&t(r).global(o)}else t(r).global(e.msg||e.message)}c.subscribe("PAYMENT_BILLING_PLAN_TABLE_UPDATE",function(){r.isStripeApplePayEnabled&&(r.isStripeApplePayEnabled=!1)}),c.subscribe("PAYMENT_BILLING_PLAN_TABLE_IS_UPDATED",function(){r.isStripeApplePayEnabled||d(function(){r.isStripeApplePayEnabled=!0},1e3)}),r.termId&&r.isPasswordlessApplePayUsed&&P(),r.initiatePurchase=function(){if(r.isStripeApplePayEnabled){var t={total:{label:e.flags.selectedTerm.resource.name,amount:e.flags.selectedTerm.chargeAmountInMinorUnit}};g.sendPostMessage("stripe-applepay-start-purchase",{paymentRequestPayload:t})}},r.initiatePasswordlessPurchase=function(){if((r.isStripeApplePayEnabled||T())&&(h.createOrder(e,r.termId,e.config.offerId,e.params.templateId).then(function(t){return e.input.oid=t.models.oid,e.input.sharedAccountCount=t.models.sourceTerm.sharedAccountCount,e._selectTerm(y),l.updatePaymentMethods(!1,e)}).then(function(){var t=y.isZero?ZERO:STRIPE_APPLEPAY;return e.selectPaymentMethodById(t)}).then(function(t){t&&m.setPurchaseInitiated(t.purchaseInitiated),y.isZero&&e.completePayment()}),e.isTermAllowedToSelect(y)&&!y.isZero)){var t={total:{label:y.resource.name,amount:y.chargeAmountInMinorUnit}};g.sendPostMessage("stripe-applepay-start-purchase",{paymentRequestPayload:t,termId:y.termId})}},r.$on(v.initiateSucceed,function(t,n){n.country&&n.initiateTransactionUrl&&(E=n.initiateTransactionUrl,g.sendPostMessage("stripe-applepay-initiate-purchase",{apiKey:n.publishableAPIKey,paymentRequestPayload:{country:n.country,currency:e.input.chargeCurrency.toLowerCase(),total:{label:e.flags.selectedTerm.resource.name,amount:e.flags.selectedTerm.chargeAmountInMinorUnit},requestPayerName:!0,requestPayerEmail:r.isPasswordlessApplePayUsed&&!e.isUserValid()}}),d(function(){r.$apply()}))}),r.$on(v.initiateFailed,function(t,n){e.enabledCheckout(),I(n)}),r.$on(v.beforeProcess,function(t,n){c.fire("EVENT_APPLE_PAY_BEFORE_PROCESS"),e.disableCheckout(),e.input.storeInVault=!0,e.setUpiId(null),e.input.instrumentId=C,n.resolve(["instrumentId"])}),r.$on(v.processSucceed,function(t,o,i){if((!r.isPasswordlessApplePayUsed||T())&&C){e.disableCheckout();var a=o.rurl,c="".concat(E,"&instrumentId=").concat(C);r.isPasswordlessApplePayUsed&&(c+="&userToken=".concat(encodeURI(e.params.userToken),"&userProvider=").concat(e.params.userProvider)),g.doGetRequest(c).then(function(e){var t=e.models.paymentIntentStatus;if("requires_capture"!==t)throw Error(n.trc("checkout.platform","Unexpected payment status ".concat(t)));s.injectHiddenIframe("stripe-applepay-provider-form-component-iframe",a),i.resolve()},function(e){var t=e.errors;return u.reject(t)}).catch(function(t){e.enabledCheckout(),I(t),i.reject()})}}),r.$on(v.processFailed,function(){e.enabledCheckout()}),r.$on(v.completeFailed,function(t,n){e.enabledCheckout(),I(n)}),r.$on(v.declined,function(){e.enabledCheckout()}),c.subscribe("stripe-applepay-initiate-purchase-complete",function(e,t){A(t.canMakePayment)}),c.subscribe("stripe-applepay-start-purchase-complete"+r.termId,function(e,t){"success"!==t.status||S||w(t)}),c.subscribe("stripe-applepay-reopen-request",function(){A(!1),P()}),propagatePaymentVars(e,r),g.sendPostMessage("stripe-applepay-initialized")}]}}];t.exports=a},{"../../../common/config":1,"../common":7,"../common/config":6}],4:[function(e,t,n){"use strict";var r=e("../common/module"),o=e("../../../common/config").prefixes.CHECKOUT,i=e("../common").getInstanceName,a=e("./component"),c=e("./service"),s=angular.module(i("Module",o),["checkoutModule",r.name]).factory(i("Provider",o),c).directive(i("Component",o),a);t.exports=s},{"../../../common/config":1,"../common":7,"../common/module":8,"./component":3,"./service":5}],5:[function(e,t,n){"use strict";var r=e("../../../common/config").prefixes.CHECKOUT,o=["$rootScope","$injector","$q","eventService","tpHTTP",function(e,t,n,o,i){var a=t.get("eventsService"+r).events;return{sendPostMessage:function(e,t){o.postMessage((n=e,n),t);var n},doGetRequest:function(e){return i.get(e)},beforeInitiate:function(){},initiateSucceed:function(t){e.$broadcast(a.initiateSucceed,t)},initiateFailed:function(t){e.$broadcast(a.initiateFailed,t)},beforeProcess:function(){var t=n.defer();return e.$broadcast(a.beforeProcess,t),t.promise},processSucceed:function(t){var r=n.defer();return e.$broadcast(a.processSucceed,t,r),r.promise},processFailed:function(t){e.$broadcast(a.processFailed,t)},confirmed:function(t){e.$broadcast(a.confirmed,t)},declined:function(t){e.$broadcast(a.declined,t)},completeSucceed:function(t){e.$broadcast(a.completeSucceed,t)},completeFailed:function(t){e.$broadcast(a.completeFailed,t)}}}];t.exports=o},{"../../../common/config":1}],6:[function(e,t,n){"use strict";var r=e("../../../common/config"),o={id:41};o.name=r.providers[o.id].name,t.exports=o},{"../../../common/config":1}],7:[function(e,t,n){"use strict";var r=e("./config");t.exports={getInstanceName:function(e,t){var n=r.name+e;return t&&(n+=t),n}}},{"./config":6}],8:[function(e,t,n){"use strict";var r=e("../../../common/creditCardComponentsModule"),o=e("./").getInstanceName,i=angular.module(o("CommonModule"),[r.name]);t.exports=i},{"../../../common/creditCardComponentsModule":2,"./":7}]},{},[4]),function(){return function e(t,n,r){function o(a,c){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!c&&s)return s(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){return o(t[a][1][e]||e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}}()({1:[function(e,t,n){"use strict";t.exports={prefixes:{CONSUMER_DASHBOARD:"CD",PUBLISHER_DASHBOARD:"PD",CHECKOUT:"CH",APPLY_TERM_WIZARD:"ATW",MY_ACCOUNT:"MA"},providers:{19:{name:"edgil"},37:{name:"onet"},38:{name:"applepayss"},39:{name:"cybersource"},40:{name:"stripe"},41:{name:"applepaystripe"},42:{name:"applepayway"},45:{name:"wirecard"},50:{name:"gocardlessdd"}}}},{}],2:[function(e,t,n){"use strict";var r=e("../common/config").name,o=e("../../../common/config").prefixes.CHECKOUT,i=e("../common").getInstanceName,a=["checkout","ngEventService","$rootElement","errorService","lang","$injector","$q","passwordlessPaymentService","purchaseService",function(e,t,n,a,c,s,u,l,d){return{restrict:"E",require:"^view",transclude:!0,templateUrl:"/frontend/providers/components/"+r+"/checkout/component.shtml",scope:{skipValidation:"@",termId:"@?"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","errorService","$timeout","ngEventService","checkoutUpdatesService",function(t,r,a,u,p){angular.extend(t,BaseComponentController),t.LANG_CONTEXT="checkout.platform";var f=s.get("eventsService"+o),m=s.get(i("Provider",o)),h=f.events,g=null,v=null,y=null,C=null;t.input=e.input,t.isApplePayPwEnabled=!1,t.isSelectedTermAutoRenewChoiceAvailable=e.isSelectedTermAutoRenewChoiceAvailable,t.termId=t.termId||"",t.isPasswordlessApplePayUsed=l.isPasswordlessApplePayUsed();var E=e._findTerm(t.termId),S={110:c.trc("checkout.platform","Payment completion error"),111:c.trc("checkout.platform","Merchant validation error"),112:c.trc("checkout.platform","Error occurred while starting Apple Pay session"),113:c.trc("checkout.platform","Can not receive payment session from server")};function T(e){return!t.termId||t.termId===e}function _(e){if(Array.isArray(e))for(var n=0;n<e.length;n++){var o=e[n].msg||e[n].message;o&&""!==o.trim()&&r(t).global(o)}else r(t).global(e.message)}t.isPasswordlessApplePayUsed&&t.termId&&!e.flags.isPasswordlessApplePayBeingInitiated&&(l.setInitInProgress(!0),m.sendPostMessage("initPwApplePay")),e.input.areTaxesCalculated=!0,t.openPasswordLessApplePay=function(){if(e.input.areTaxesCalculated=!1,r(t).reset(),E=e._findTerm(t.termId),d.createOrder(e,t.termId,e.config.offerId,e.params.templateId).then(function(t){return e.input.oid=t.models.oid,e.input.sharedAccountCount=t.models.sourceTerm.sharedAccountCount,e._selectTerm(E),p.updatePaymentMethods(!1,e)}).then(function(){var t=E.isZero?ZERO:PAYWAY_APPLEPAY;return e.selectPaymentMethodById(t)}).then(function(t){t&&l.setPurchaseInitiated(t.purchaseInitiated),E.isZero&&e.completePayment()}),e.isTermAllowedToSelect(E)&&!E.isZero){var n={countryCode:"US",currencyCode:E.chargeCurrency,resourceName:E.resource.name,chargeAmount:E.chargeAmount,termId:t.termId,requiredBillingContactFields:["postalAddress"]};e.isUserValid()||(n.requiredShippingContactFields=["email"]),t.openApplePayWindow(n)}},t.openApplePayWindow=function(n){t.isApplePayPwEnabled&&m.sendPostMessage("start-purchase",function(t){if(t)return t;return{countryCode:"US",currencyCode:e.input.chargeCurrency,resourceName:e.flags.selectedTerm.resource.name,chargeAmount:e.input.chargeAmount}}(n))},t.onValidationStart=function(){r(t).reset()},t.onValidationEnd=function(e){e.forEach(function(e){r(t).global(e.msg)})},t.$on("apple-pay-payment-authorized",function(e,t){T(t.termId)&&(g=t.paymentData.token,P(t))}),t.$on("payment-error",function(e,n){if(T(n.termId)){r(t).reset();var o=n.errorCode;void 0!==o&&S.hasOwnProperty(o)&&r(t).global(S[o])}}),t.$on("apple-pay-init",function(){t.isApplePayPwEnabled=!0,t.$apply()}),t.$on("apple-pay-pay-session-request",function(e,t){T(t.termId)&&(C=t,w())}),t.$on(h.previewTermComplete,function(){e._completeTerm({q:"q"})}),t.$on(h.initiateSucceed,function(e,n){l.setInitInProgress(!1),a(function(){t.$apply()})}),t.$on(h.initiateFailed,function(t,n){l.setInitInProgress(!1),e.enabledCheckout()}),t.$on(h.beforeProcess,function(){u.fire(EVENT_APPLE_PAY_BEFORE_PROCESS)}),t.$on(h.processSucceed,function(e,t){g&&n.append(angular.element('<iframe name="apple_pay_pw_frame" id="apple_pay_pw_frame" style="display: none" src="'+t.rurl+'"></iframe>'))}),t.$on(h.processFailed,function(t,n){e.enabledCheckout()}),t.$on(h.declined,function(){e.enabledCheckout()}),t.$on(h.completeFailed,function(t,n){e.enabledCheckout(),_(n)});var w=function(){if(t.isPasswordlessApplePayUsed)return l.checkSelectedTerm(t).then(m.getPaywayToken).then(function(e){b(e.models)});var n={countryCode:e.getBillingCountryCode(),zipCode:e.input.zipCode,billingZipCode:e.getBillingZipCode()};l.applyTax(t,n,!0).then(m.getPaywayToken).then(function(e){return b(e.models)}).catch(function(){m.sendPostMessage("abort-apple-pay-session")})},b=function(e){C.paywayTxQueuedToken=e.paywayTxQueuedToken,y=e.trackingId,v=e.source,m.validateMerchantAndGetPaymentSession(C)},P=function(n){if(t.isPasswordlessApplePayUsed&&t.termId&&t.termId===e.flags.selectedTerm.termId){var r={countryCode:n.paymentData.billingContact.countryCode.toUpperCase(),zipCode:n.paymentData.billingContact.postalCode,billingZipCode:n.paymentData.billingContact.postalCode},o=n.paymentData.shippingContact?n.paymentData.shippingContact.emailAddress:"";return l.applyTax(t,r,!0).then(function(){return A(o)}).catch(function(e){m.sendPostMessage("abort-apple-pay-session"),_(e)})}A()};function A(n){m.sendQueuedTransaction(g,v,y,C).then(function(){$()&&m.sendPostMessage("apple-pay-complete-payment",{status:window.ApplePaySession.STATUS_SUCCESS,termId:t.termId})}).then(function(){if(!e.isUserValid()&&n){var r={oid:e.input.oid,aid:e.getAid(),url:e.params.url,email:n};return l.proceedPasswordlessUser(t,r,E)}}).then(function(t){t&&t.isPasswordlessEmailSent||e.completePayment()}).catch(function(e){var n;Array.isArray(e)&&(n=e.map(function(e){return e.msg||e.message})),$()&&m.sendPostMessage("apple-pay-complete-payment",{status:window.ApplePaySession.STATUS_FAILURE,errors:n,termId:t.termId}),_(e)}).finally(function(){l.setPurchaseInitiated(null)})}function $(){return!window.IGNORE_APPLEPAY_EVENTS}m.sendPostMessage("provider-component-initiated")}]}}];t.exports=a},{"../../../common/config":1,"../common":6,"../common/config":5}],3:[function(e,t,n){"use strict";var r=e("../common/module"),o=e("../../../common/config").prefixes.CHECKOUT,i=e("../common").getInstanceName,a=e("./component"),c=e("./service"),s=angular.module(i("Module",o),["checkoutModule",r.name]).factory(i("Provider",o),c).directive(i("Component",o),a);t.exports=s},{"../../../common/config":1,"../common":6,"../common/module":7,"./component":2,"./service":4}],4:[function(e,t,n){"use strict";var r=e("../../../common/config").prefixes.CHECKOUT,o=["$rootScope","$injector","$timeout","tpHTTP","ngEventService","checkout","eventService",function(e,t,n,o,i,a,c){var s=t.get("eventsService"+r).events;function u(e){return"https://apple-pay-gateway.apple.com/paymentservices/startSession/mockUrl"===e.validationUrl}function l(t){e.$broadcast("payment-error",{errorCode:113,error:null}),console.error("Payway getApplePaySession error: "+t),f("abort-apple-pay-session",{})}function d(){return new Promise(function(e,t){e({paywayCode:5e3,appleSessionToken:"{}"})})}function p(e){var t={request:"getApplePaySession",url:e.validationUrl,domain:e.domainName,paywayTransactionToken:e.paywayTxQueuedToken};return new Promise(function(e,n){var r=new XMLHttpRequest,o=TPParam.PAYWAY_API_URL+"Session";r.open("POST",o,!0),r.setRequestHeader("Content-Type","application/json"),r.onload=function(){200===r.status?e(JSON.parse(this.responseText)):n(this.responseText)},r.onerror=function(){r.onload()},r.send(JSON.stringify(t))})}function f(e,t){c.postMessage(e,t)}return{sendPostMessage:f,beforeInitiate:function(){},initiateSucceed:function(t){e.$broadcast(s.initiateSucceed,t)},initiateFailed:function(t){e.$broadcast(s.initiateFailed,t)},beforeProcess:function(){e.$broadcast(s.beforeProcess)},processSucceed:function(t){e.$broadcast(s.processSucceed,t)},processFailed:function(t){e.$broadcast(s.processFailed,t)},confirmed:function(t){e.$broadcast(s.confirmed,t)},declined:function(t){e.$broadcast(s.declined,t)},completeSucceed:function(t){e.$broadcast(s.completeSucceed,t)},completeFailed:function(t){e.$broadcast(s.completeFailed,t)},validateMerchantAndGetPaymentSession:function(e){return(u(e)?d:p)(e).then(function(e){5e3==e.paywayCode?f("pay-session-received",{applePaySession:JSON.parse(e.appleSessionToken)}):l(e.paywayMessage)}).catch(function(e){l(e)})},sendQueuedTransaction:function(e,t,n,r){if(u(r))return new Promise(function(e,t){e({paywayCode:5e3})});var o={accountInputMode:"applePayToken",paywayRequestToken:r.paywayTxQueuedToken,transactionName:n,transactionSourceId:t,request:"sendQueuedTransaction",applePayToken:e.paymentData,cardAccount:{}};return new Promise(function(e,t){var n=new XMLHttpRequest,r=TPParam.PAYWAY_API_URL+"Payment/CreditCard";n.open("POST",r,!0),n.setRequestHeader("Content-type","application/json"),n.onload=function(){if(200===n.status){var r=JSON.parse(this.responseText);5e3==r.paywayCode?e(r):t({message:r.paywayMessage})}else t({message:this.responseText})},n.send(JSON.stringify(o))})},getPaywayToken:function(){return o.get(TPParam.PAYWAY_APPLE_PAY_AUTH,{params:{aid:a.getAid(),oid:a.input.oid,areTaxesCalculated:a.input.areTaxesCalculated}})}}}];t.exports=o},{"../../../common/config":1}],5:[function(e,t,n){"use strict";var r=e("../../../common/config"),o={id:42};o.name=r.providers[o.id].name,t.exports=o},{"../../../common/config":1}],6:[function(e,t,n){"use strict";var r=e("./config");t.exports={getInstanceName:function(e,t){var n=r.name+e;return t&&(n+=t),n}}},{"./config":5}],7:[function(e,t,n){"use strict";var r=e("./").getInstanceName;t.exports=angular.module(r("CommonModule"),[])},{"./":6}]},{},[3]),function(){return function e(t,n,r){function o(a,c){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!c&&s)return s(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){return o(t[a][1][e]||e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}}()({1:[function(e,t,n){"use strict";var r=e("./config").providers;t.exports={getModulesFor:function(e){var t=[];for(var n in r){var o=r[n].name+"Module"+e;t.push(o)}return t},dynamicBaseInputsComponent:["$compile",function(e){return{restrict:"E",link:function(t,n){n.html("<"+t.name+'-base-inputs-component credit-card="creditCard" readonly="readonly" callback-on-form-init="callbackOnFormInit"><'+t.name+"-base-inputs-component/>").show(),e(n.contents())(t)},scope:{name:"=",creditCard:"=",callbackOnFormInit:"=?"}}}],ppCreditCardActionsService:function(){return{loaded:"PP_CARD_LOADED",init:"PP_CARD_INITIALIZE",initSuccess:"INIT_PP_CARD_SUCCESS",initError:"INIT_PP_CARD_ERROR",create:"CREATE_PP_CARD",createSuccess:"CREATE_PP_CARD_SUCCESS",createError:"CREATE_PP_CARD_ERROR",validationStart:"PP_CARD_VALIDATION_START",validationEnd:"PP_CARD_VALIDATION_END",isValid:"CREDIT_CARD_FORM_IS_VALID",isNotValid:"CREDIT_CARD_FORM_IS_NOT_VALID"}},providersService:function(e,t,n){return{getProviderInstanceById:function(t){return e.get(this._getProviderInstanceNameById(t))},checkProviderInstanceById:function(n){var r=!0;return t.getNewFlowProviders()[n]&&e.has(this._getProviderInstanceNameById(n))||(r=!1),r},_getProviderInstanceNameById:function(e){return t.getNewFlowProviders()[e].name+"Provider"+n},hasNewFlow:function(e){var n=t.getNewFlowProviders()[e];return n&&n.name}}},getNewFlowComponents:function(e,t,n){var r=e.getNewFlowProviders(),o=t,i="";for(var a in t=t.toLowerCase().split("").join("-"),r){var c=r[a].name,s=n?c+o+" cc-detailed":"";i+="<".concat(c,"-component-").concat(t,'\n \t\t\t\t\t\tclass="').concat(s,'" \n \t\t\t\t\t\treadonly="readonly"\n \t\t\t\t\t\tpayment-provider="paymentProvider"\n            card="card"\n            term-id="{{termId}}"\n            ng-if="paymentSource == ').concat(a,'">\n\t\t\t\t\t</').concat(c,"-component-").concat(t,">")}return{restrict:"E",scope:{paymentProvider:"=paymentProvider",card:"=card",paymentSource:"=paymentSource",readonly:"=readonly",termId:"@?"},template:i}}}},{"./config":2}],2:[function(e,t,n){"use strict";t.exports={prefixes:{CONSUMER_DASHBOARD:"CD",PUBLISHER_DASHBOARD:"PD",CHECKOUT:"CH",APPLY_TERM_WIZARD:"ATW",MY_ACCOUNT:"MA"},providers:{19:{name:"edgil"},37:{name:"onet"},38:{name:"applepayss"},39:{name:"cybersource"},40:{name:"stripe"},41:{name:"applepaystripe"},42:{name:"applepayway"},45:{name:"wirecard"},50:{name:"gocardlessdd"}}}},{}],3:[function(e,t,n){"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var o=angular.module("creditCardComponentsModule",[]),i=e("./config");o.service("ccFieldsService",function(){return{getBaseCreditCardFields:function(){return{value:"",disabled:!1,required:!1,readonly:!1,onChangeCallback:angular.noop,maxlength:null,valid:!0,showLabel:!1}},getBaseCcComponentScope:function(){return{text:"=ngModel",onChange:"=onChange",disabled:"=ngDisabled",required:"=ngRequired",readonly:"=ngReadonly",maxlength:"=maxlength",className:"=?className",name:"=name",valid:"=valid"}},getBaseCcInputDirectiveParams:function(e){return{restrict:"E",require:"ngModel",templateUrl:e,scope:this.getBaseCcComponentScope()}},getTemplatesScope:function(){return{credit_card:{num:this.getBaseCreditCardFields(),expire:this.getBaseCreditCardFields(),cvv:this.getBaseCreditCardFields(),postal_code:this.getBaseCreditCardFields()}}},getExpireValueSplitted:function(e){var t={month:"",year:""};if(e){var n=r(e.split("/"),2),o=n[0],i=n[1];void 0!==o&&(o=o.trim()),void 0!==i&&(i=i.trim()),t={month:o,year:i}}return t},getFormattedMonth:function(e){return("0"+e).slice(-2)},getFormattedYear:function(e){return e.toString().slice(-2)},getFullyFormattedYear:function(e){return("20"+e).slice(-4)},getNewFlowProviders:function(){return i.providers},detectCardType:function(e){for(var t=this.getUnknownCardType(),n={shortName:"v",longName:"Visa"},r=[{type:n,rname:"electron",rgxp:/^(4026|417500|4405|4508|4844|4913|4917)\d+$/},{type:t,rname:"maestro",rgxp:/^(5018|5020|5038|5612|5893|6304|6759|6761|6762|6763|0604|6390)\d+$/},{type:t,rname:"dankort",rgxp:/^(5019)\d+$/},{type:t,rname:"interpayment",rgxp:/^(636)\d+$/},{type:t,rname:"unionpay",rgxp:/^(62|88)\d+$/},{type:n,rname:"visa",rgxp:/^4[0-9]{12}(?:[0-9]{3})?$/},{type:{shortName:"mc",longName:"MasterCard"},rname:"mastercard",rgxp:/^5[1-5][0-9]{2}|(222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)[0-9]{12}$/},{type:{shortName:"amex",longName:"American Express"},rname:"amex",rgxp:/^3[47][0-9]{13}$/},{type:{shortName:"dci",longName:"Diners Club"},rname:"diners",rgxp:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/},{type:{shortName:"d",longName:"Discover"},rname:"discover",rgxp:/^6(?:011|5[0-9]{2})[0-9]{12}$/},{type:t,rname:"jcb",rgxp:/^(?:2131|1800|35\d{3})\d{11}$/}],o=0;o<r.length;o++){var i=r[o];if(i.rgxp.test(e))return i.type}return t},getUnknownCardType:function(){return{shortName:"card",longName:"Credit card"}},getCardType:function(e){return{type:{shortName:{"American Express":"amex",Visa:"v",MasterCard:"mc"}[e],longName:e}}}}}),o.service("ccValidationService",["ccFieldsService","lang",function(e,t){return{collectCCErrors:function(e,t){var n=this.getEmptyFieldsErrors(e,t);return n.length?n:this.getSpecificFieldsErrors(e,t)},getEmptyFieldsErrors:function(e,t){return(t=t||this.baseFields).reduce(function(t,n){return e[n.name].value||e[n.name].disabled||t.push({name:n.name,msg:n.msg}),t},[])},getSpecificFieldsErrors:function(e){return[this.getCCNumberError(e.num),this.getExpireError(e.expire),this.getCVVError(e)].filter(function(e){return e})},getCCNumberError:function(e){var n;return this.ccLuhnCheck(e.value)||(n={name:"num",msg:t.tr("Invalid credit card number")}),n},getExpireError:function(n){var r,o=e.getExpireValueSplitted(n.value);return this.ccExpireDateValidate(o.month,o.year)||(r={name:"expire",msg:t.tr("Invalid expiration date")}),r},getCVVError:function(e){if(!this.cvvValidate(e.num.value,e.cvv.value))return{name:"cvv",msg:t.tr("Your CVV must be 4 digits for American Express or 3 digits for other cards")}},cvvValidate:function(t,n){var r=t.replace(/\D/g,""),o=n.replace(/\D/g,"");if("amex"===e.detectCardType(r).shortName){if(/^\d{4}$/.test(o))return!0}else if(/^\d{3}$/.test(o))return!0;return!1},ccExpireDateValidate:function(e,t){if(!e||!t)return!1;var n=parseInt(e,10),r=parseInt(t,10);if(n<1||n>12)return!1;if(r<0)return!1;r<100&&(r+=2e3);var o=new Date;o.setDate(1),o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0);var i=new Date;return i.setDate(1),i.setMonth(n-1),i.setYear(r),i.setHours(0),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0),o.getTime()<=i.getTime()},ccLuhnCheck:function(e){if(!e.match(/^\d+$/))return!1;for(var t=e.length,n=1&t,r=0,o=0;o<t;o++){var i=parseInt(e.charAt(o));1&o^n||(i*=2)>9&&(i-=9),r+=i}return r%10==0},baseFields:[{name:"num",msg:t.tr("Card number is required")},{name:"expire",msg:t.tr("Expiration date is required")},{name:"cvv",msg:t.tr("CVV is required")},{name:"postal_code",msg:t.tr("Postal code is required")}]}}]),o.directive("formatExpiryDate",function(){var e,t,n,r,o,i,a,c,s,u;return i=function(e){var t;return null!=e.prop("selectionStart")&&e.prop("selectionStart")!==e.prop("selectionEnd")||!(null==("undefined"!=typeof document&&null!==document&&null!=(t=document.selection)?t.createRange:void 0)||!document.selection.createRange().text)},s=function(e){var t;return!(!e.metaKey&&!e.ctrlKey)||32!==e.which&&(0===e.which||(e.which<33||(t=String.fromCharCode(e.which),!!/[\d\s]/.test(t))))},c=function(e){var t,n;if(t=$(e.currentTarget),n=String.fromCharCode(e.which),/^\d+$/.test(n)&&!i(t))return!((t.val()+n).replace(/\D/g,"").length>u+2)&&void 0},n=function(e){var t,n,r;if(n=String.fromCharCode(e.which),/^\d+$/.test(n))return t=$(e.currentTarget),r=t.val()+n,/^\d$/.test(r)&&"0"!==r&&"1"!==r?(e.preventDefault(),setTimeout(function(){return t.val("0"+r+" / ")})):/^\d\d$/.test(r)?(e.preventDefault(),setTimeout(function(){return t.val(r+" / ")})):void 0},a=function(t){return setTimeout(function(){var n,r;return r=(n=$(t.currentTarget)).val(),r=e(r),n.val(r)})},e=function(e){var t,n,r,o,i=new RegExp("^\\D*(\\d{1,2})(\\D+)?(\\d{1,"+u+"})?");return(n=e.match(i))?(t=n[1]||"",r=n[2]||"",(o=n[3]||"").length>0?r=" / ":" /"===r?(t=t.substring(0,1),r=""):2===t.length||r.length>0?r=" / ":1===t.length&&"0"!==t&&"1"!==t&&(t="0"+t,r=" / "),t+r+o):""},o=function(e){var t,n,r;if("/"===(r=String.fromCharCode(e.which))||" "===r)return n=(t=$(e.currentTarget)).val(),/^\d$/.test(n)&&"0"!==n?t.val("0"+n+" / "):void 0},r=function(e){var t,n,r;if(n=String.fromCharCode(e.which),/^\d+$/.test(n))return r=(t=$(e.currentTarget)).val(),/^\d\d$/.test(r)?t.val(r+" / "):void 0},t=function(e){var t,n;if(t=$(e.currentTarget),n=t.val(),8===e.which&&(null==t.prop("selectionStart")||t.prop("selectionStart")===n.length))return/\d\s\/\s$/.test(n)?(e.preventDefault(),setTimeout(function(){return t.val(n.replace(/\d\s\/\s$/,""))})):void 0},{scope:{formatYear:"=?formatYear"},restrict:"A",link:function(e,i){u=e.formatYear||2,i.on("keypress",s),i.on("keypress",c),i.on("keypress",n),i.on("keypress",o),i.on("keypress",r),i.on("keydown",t),i.on("change",a),i.on("input",a)}}}),o.directive("ccTextInput",function(){return{restrict:"E",require:"ngModel",templateUrl:"/frontend/providers/common/credit-card-text-input.html",scope:{text:"=ngModel",placeholder:"=placeholder",icon:"=icon",name:"=name",maxlength:"=maxlength",readonly:"=ngReadonly",required:"=ngRequired",disabled:"=ngDisabled",iconClass:"=iconClass",iconWidth:"=iconWidth",className:"=className",borderBottom:"=borderBottom",autocomplete:"=autocomplete",onChange:"=onChange",valid:"=valid"},controller:["$scope",function(e){e.getIconClass=function(){var t="";return e.readonly&&(t+="".concat("cc-field__icon--","readonly ")),e.text&&(t+="".concat("cc-field__icon--","highlighted ")),e.iconClass?t+="".concat(e.iconClass," "):t+="".concat("cc-field__icon--").concat(e.icon," "),t},e.getFieldClass=function(){var t="";return e.name&&(t+="".concat("cc-field--").concat(e.name," ")),e.valid||(t+="".concat("cc-field--","not-valid")),t}}]}}),o.directive("creditCardCvv",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-cvv.html")}]),o.directive("creditCardPostalCode",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-postal-code.html")}]),o.directive("creditCardNumber",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-number.html")}]),o.directive("creditCardHolder",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-holder.html")}]),o.directive("ccExpireComponent",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-expire.html")}]),t.exports=o},{"./config":2}],4:[function(e,t,n){"use strict";var r=["$q","tpHTTP","$rootElement","iframeService","ccFieldsService","lang",function(e,t,n,r,o,i){return{createCardToken:function(n,r,a){if(!window.crypto.subtle)throw i.tr("Crypto not available.");var c=function(e,t){var n=o.getExpireValueSplitted(e.expire.value),r=o.getFormattedMonth(n.month);return{keyId:null,cardInfo:{cardNumber:e.num.value,cardExpirationMonth:r,cardExpirationYear:"20".concat(n.year),cardType:t}}}(n,r),s={kty:"RSA",n:null,e:"AQAB",alg:"RSA-OAEP-256",ext:!0};return function(n){if(n.n&&n.keyId){var r=e.defer();return r.resolve(n),r.promise}return t({method:"post",url:TPParam.CYBER_SOURCE_CARD_ENCRYPTION_KEY_URL,params:{aid:n.aid}})}(a).then(function(e){return s.n=e.n||e.models.cyberSourceEncryptionKey.jwk.n,c.keyId=e.keyId||e.models.cyberSourceEncryptionKey.keyId,window.crypto.subtle.importKey("jwk",s,{name:"RSA-OAEP",hash:{name:"SHA-256"}},!1,["encrypt"])}).then(function(e){var t=function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0,o=e.length;r<o;r++)n[r]=e.charCodeAt(r);return t}(c.cardInfo.cardNumber);return window.crypto.subtle.encrypt({name:"RSA-OAEP",hash:{name:"SHA-256"}},e,t)}).then(function(e){var t=new Uint8Array(e);c.cardInfo.cardNumber=function(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,o=0;o<r;o++)t+=String.fromCharCode(n[o]);return window.btoa(t)}(t);var n=new XMLHttpRequest;return new Promise(function(e,t){n.open("POST",TPParam.CYBER_SOURCE_TOKENIZE_CARD_URL,!0),n.onreadystatechange=function(){4===this.readyState&&(this.status>=200&&this.status<300?e(this.responseText):t({errors:[{msg:i.tr("Cybersource tokenization error")}]}))},n.send(JSON.stringify(c))})}).then(function(e){return JSON.parse(e)}).catch(function(e){throw e.errors})},processCC:function(e){r.injectHiddenIframe("cybersource-provider-form-component-iframe",e.url)}}}];t.exports=r},{}],5:[function(e,t,n){"use strict";var r=e("../common/config").name,o=e("../common/config").id,i=e("../../../common/config").prefixes.CHECKOUT,a=e("../common").getInstanceName,c=e("../common/addCardBaseComponent"),s=["checkout","$rootElement","errorService","lang","ccFieldsService","$injector","ccValidationService","ppCreditCardActionsService","$q","tpHTTP","billingConfig",function(e,t,n,s,u,l,d,p,f,m,h){return{restrict:"E",require:"^view",transclude:!0,templateUrl:"/frontend/providers/components/"+r+"/checkout/component.shtml",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","errorService","$timeout","ngEventService",function(t,n,g,v){c.apply(t,[f,l,m,u,d,p]),t.cardService=l.get(a("CardService",i));var y=l.get("eventsService"+i),C=y.events;t.providerName=r,t.PAYMENT_PROVIDER_ID=o,t.customValidation=!0,angular.extend(t,BaseComponentController);var E=function(){t.cc={},t.cc.payWithNew=!0,t.cc.selectedUpiId=null,t.cc.defaultPaymentMethodId=null,t.cc.initiated=!1,t.credit_card=u.getTemplatesScope().credit_card,t.credit_card.store_in_vault=!0,t.credit_card.postal_code.disabled=!0};function S(){e.input.credit_card=t.getCurrentCreditCardInfo(),e.setUpiId(t.cc.selectedUpiId),e.getUpiId()&&e.input.credit_card.taxRequest&&h.updateFromTaxRequest(e,e.input.credit_card.taxRequest)}t.getDataToCreateCard=function(e){var t=e.cardModel,n=u.getExpireValueSplitted(t.expire.value);return{expireMonth:parseInt(n.month,10),zipcode:t.postal_code.value,expireYear:parseInt(n.year,10),cardNumber:t.num.value,cardType:"001"}},t.getCurrentCreditCardInfo=function(){var e=u.getExpireValueSplitted(t.credit_card.expire.value),n=e.month,r=e.year;if(t.cc.payWithNew)return{cardType:t.detectCardType(t.credit_card.num.value).longName,ending:t.credit_card.num.value?t.credit_card.num.value.slice(-4):"",expireMonth:n,expireYear:r};if(t.cc.selectedUpiId)for(var o=0;o<t.cc.stored.length;o++){var i=t.cc.stored[o];if(i.id===t.cc.selectedUpiId)return{cardType:i.type,ending:i.ending_in,expireMonth:i.expire_month,expireYear:i.expire_year,taxRequest:h.taxRequestFromUpi(i)}}return{cardType:t.unknowCardType.longName,ending:t.credit_card.num.value?t.credit_card.num.value.slice(-4):"",expireMonth:n,expireYear:r}},t._isValid=function(){return t.isFieldsValid()},t.collectErrors=function(){if(!e.isPaymentMethod(o)||e.isMockUsed()||!0===toBoolean(t.skipValidation))return[];return t.cc.payWithNew?d.collectCCErrors(t.credit_card):d.getEmptyFieldsErrors({selectedUpiId:{value:t.cc.selectedUpiId}},[{name:"selectedUpiId",msg:s.tr("Please select one of your cards or add new one")}])},t.onValidationStart=function(){n(t).reset()},t.onValidationEnd=function(e){e.forEach(function(e){n(t).global(e.msg)})},t.$on(C.previewTermComplete,function(){e._completeTerm({q:"q"})}),t.$on(C.initiateSucceed,function(e,n){void 0!==n.stored&&(t.cc.stored=JSON.parse(n.stored)),t.cc.storedRurl=n.stored_rurl,t.cc.payWithNew=void 0===t.cc.stored||0===t.cc.stored.length||t.cc.payWithNew&&t.cc.initiated,t.cc.selectedUpiId=void 0!==t.cc.stored&&t.cc.stored.length>0?t.cc.stored[0].id:null,t.cc.initiated=!0,S(),g(function(){t.$apply()})}),t.$on(C.initiateFailed,function(t,n){e.enabledCheckout()}),t.$on(C.beforeProcess,function(){e.input.storeInVault=t.credit_card.store_in_vault,e.input.defaultPaymentMethodId=t.credit_card.store_in_vault&&t.cc.defaultPaymentMethodId,e.input.credit_card=t.getCurrentCreditCardInfo(),t.cc.payWithNew&&(t.cc.selectedUpiId=null,e.setUpiId(null))}),t.$on(C.processSucceed,function(n,r){e.disableCheckout(),(r=angular.extend({},r,t.cc)).aid=e.getAid(),r.payWithNew?t.$broadcast(p.create,r):t.$broadcast(p.createSuccess,r)}),t.$on(C.processFailed,function(t,n){e.enabledCheckout()}),t.$on(C.declined,function(){e.enabledCheckout()}),t.$on(C.completeSucceed,function(){}),t.$on(C.completeFailed,function(t,n){window.clearTimeout(y.iframeHungTimeout),e.enabledCheckout()}),t.$on(p.createSuccess,function(n,r){var o;if(r.payWithNew){var i=JSON.stringify(e.input.credit_card);o=r.rurl+"&token="+r.tokenizedCard.token+"&accountNumber="+r.tokenizedCard.maskedPan+"&cardZipCode="+r.requestData.zipcode+"&upi="+encodeURIComponent(i)}else o=r.storedRurl+"&id="+r.selectedUpiId;return t.cardService.processCC({url:o})}),t.$watch("cc.selectedUpiId",function(){S()}),t.$watchCollection(["credit_card.num","credit_card.expire_month","credit_card.expire_year"],function(){e.input.credit_card=t.getCurrentCreditCardInfo()}),v.subscribe(EVENT_CHECKOUT_STARTED,function(){E()}),E(),t.expireYears=getYears(),t.expireMonths=getMonths(),propagatePaymentVars(e,t)}]}}];t.exports=s},{"../../../common/config":2,"../common":11,"../common/addCardBaseComponent":8,"../common/config":10}],6:[function(e,t,n){"use strict";var r=e("../common/module"),o=e("../../../common/config").prefixes.CHECKOUT,i=e("../common").getInstanceName,a=e("./component"),c=e("./service"),s=e("../cardService"),u=angular.module(i("Module",o),["checkoutModule",r.name]).factory(i("CardService",o),s).factory(i("Provider",o),c).directive(i("Component",o),a);t.exports=u},{"../../../common/config":2,"../cardService":4,"../common":11,"../common/module":12,"./component":5,"./service":7}],7:[function(e,t,n){"use strict";var r=e("../../../common/config").prefixes.CHECKOUT,o=["$rootScope","$injector",function(e,t){var n=t.get("eventsService"+r).events;return{beforeInitiate:function(){},initiateSucceed:function(t){e.$broadcast(n.initiateSucceed,t)},initiateFailed:function(t){e.$broadcast(n.initiateFailed,t)},beforeProcess:function(){e.$broadcast(n.beforeProcess)},processSucceed:function(t){e.$broadcast(n.processSucceed,t)},processFailed:function(t){e.$broadcast(n.processFailed,t)},confirmed:function(t){e.$broadcast(n.confirmed,t)},declined:function(t){e.$broadcast(n.declined,t)},completeSucceed:function(t){e.$broadcast(n.completeSucceed,t)},completeFailed:function(t){e.$broadcast(n.completeFailed,t)}}}];t.exports=o},{"../../../common/config":2}],8:[function(e,t,n){"use strict";var r=e("./config").name;t.exports=function(e,t,n,o,i,a,c){var s=this;this.providerName=r,this.credit_card=o.getTemplatesScope().credit_card,this.credit_card.postal_code.disabled=!0,this.customValidation=!1,this.$watch("readonly",function(){s.initCardAttributes()}),this.$on(a.loaded,function(e,t){s.initCardData(t)}),this.$on(a.create,function(e,t){s.create(t).then(s.onSuccess,s.onError)}),this.onSuccess=function(e){s.$emit(a.createSuccess,e)},this.onError=function(e){s.$emit(a.createError,e)},this.createUpdateCardMock=function(t){var n=e.defer();return n.resolve(t),n.promise},this.createNewCard=function(e){return s.createUpdateCardMock(e)},this.updateCard=function(e){return s.createUpdateCardMock(e)},this.create=function(e){var t=this,n=this.credit_card;if(this.customValidation||this.isFieldsValid(n)){var r=this.detectCardType(n.num.value).cyberSourceValue;return this.cardService.createCardToken(n,r,e).then(function(n){var r=e.payWithNew?t.createNewCard:t.updateCard,o={cardModel:t.credit_card,tokenizedCard:n};return e.tokenizedCard=n,e.requestData=t.getDataToCreateCard(o),r(e).then(function(e){return e}).catch(function(e){throw e.errors})}).catch(function(e){throw e})}throw{message:c.tr("Credit card information is not valid")}},this.isFieldsValid=function(e){this.onValidationStart();var t=this.collectErrors(e);return this.onValidationEnd(t),!t.length},this.collectErrors=function(e){return i.collectCCErrors(e)},this.onValidationStart=function(){for(var e in this.credit_card)this.credit_card[e].valid=!0;this.$emit(a.validationStart)},this.onValidationEnd=function(e){var t=this;e.forEach(function(e){t.credit_card[e.name].valid=!1}),this.$emit(a.validationEnd,e)},this.getDataToCreateCard=function(e){var t=e.cardModel;return{number:t.num.value,cvv:t.cvv.value,exp_mon:t.expire.value.substring(0,2),exp_yr:"20".concat(t.expire.value.substring(5)),zipcode:t.postal_code.value}},this.initCardAttributes=function(){this.credit_card.num.readonly=this.readonly,this.credit_card.cvv.readonly=this.readonly,this.credit_card.postal_code.readonly=this.readonly,this.credit_card.expire.readonly=this.readonly},this.unknownCardType=function(e){return this.unknownCardType,{shortName:"card",longName:"Credit card",cyberSourceValue:e}},this.detectCardType=function(e){for(var t={shortName:"v",longName:"Visa",cyberSourceValue:"001"},n=this.unknownCardType("006"),r=this.unknownCardType("034"),o=this.unknownCardType("042"),i=this.unknownCardType("050"),a=this.unknownCardType("051"),c=this.unknownCardType("054"),s=this.unknownCardType("061"),u=this.unknownCardType("062"),l=[{type:t,rname:"electron",rgxp:/^(4026|417500|4405|4508|4844|4913|4917)\d+$/},{type:o,rname:"maestro",rgxp:/^(5018|5020|5038|5612|5893|6304|6759|6761|6762|6763|0604|6390)\d+$/},{type:r,rname:"dankort",rgxp:/^(5019)\d+$/},{type:this.unknownCardType,rname:"interpayment",rgxp:/^(636)\d+$/},{type:u,rname:"unionpay",rgxp:/^(62|88)\d+$/},{type:t,rname:"visa",rgxp:/^4[0-9]{12}(?:[0-9]{3})?$/},{type:{shortName:"mc",longName:"MasterCard",cyberSourceValue:"002"},rname:"mastercard",rgxp:/^5[1-5][0-9]{2}|(222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)[0-9]{12}$/},{type:{shortName:"amex",longName:"American Express",cyberSourceValue:"003"},rname:"amex",rgxp:/^3[47][0-9]{13}$/},{type:{shortName:"dci",longName:"Diners Club",cyberSourceValue:"005"},rname:"diners",rgxp:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/},{type:{shortName:"d",longName:"Discover",cyberSourceValue:"004"},rname:"discover",rgxp:/^6(?:011|5[0-9]{2})[0-9]{12}$/},{type:{shortName:"jcb",longName:"JCB",cyberSourceValue:"007"},rname:"jcb",rgxp:/^(?:2131|1800|35\d{3})\d{11}$/},{type:n,rname:"carteBlanche",rgxp:/^389[0-9]{11}$/},{type:s,rname:"ruPay",rgxp:/^6[0-9]{15}$/},{type:i,rname:"hipercard",rgxp:/^(606282\d{10}(\d{3})?)|(3841\d{15})$/},{type:c,rname:"elo",rgxp:/^((((636368)|(438935)|(504175)|(451416)|(636297))\d{0,10})|((5067)|(4576)|(4011))\d{0,12})$/},{type:a,rname:"aura",rgxp:/^(5078\d{2})(\d{2})(\d{11})$/}],d=0;d<l.length;d++){var p=l[d];if(p.rgxp.test(e))return p.type}return this.unknownCardType}}},{"./config":10}],9:[function(e,t,n){"use strict";var r=e("./config").name;t.exports=function(){return{restrict:"E",require:"ngModel",templateUrl:"/frontend/providers/components/"+r+"/common/baseTemplate.shtml",scope:{credit_card:"=creditCard",readonly:"=readonly"}}}},{"./config":10}],10:[function(e,t,n){"use strict";var r=e("../../../common/config"),o={id:39};o.name=r.providers[o.id].name,t.exports=o},{"../../../common/config":2}],11:[function(e,t,n){"use strict";var r=e("./config");t.exports={getInstanceName:function(e,t){var n=r.name+e;return t&&(n+=t),n}}},{"./config":10}],12:[function(e,t,n){"use strict";var r=e("./baseInputsComponent"),o=e("../../../common/creditCardComponentsModule"),i=e("./").getInstanceName,a=(e("../../../common/common").dynamicBaseInputsComponent,angular.module(i("CommonModule"),[o.name]).directive(i("BaseInputsComponent"),r));t.exports=a},{"../../../common/common":1,"../../../common/creditCardComponentsModule":3,"./":11,"./baseInputsComponent":9}]},{},[6]),function(){return function e(t,n,r){function o(a,c){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!c&&s)return s(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){return o(t[a][1][e]||e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}}()({1:[function(e,t,n){"use strict";t.exports={prefixes:{CONSUMER_DASHBOARD:"CD",PUBLISHER_DASHBOARD:"PD",CHECKOUT:"CH",APPLY_TERM_WIZARD:"ATW",MY_ACCOUNT:"MA"},providers:{19:{name:"edgil"},37:{name:"onet"},38:{name:"applepayss"},39:{name:"cybersource"},40:{name:"stripe"},41:{name:"applepaystripe"},42:{name:"applepayway"},45:{name:"wirecard"},50:{name:"gocardlessdd"}}}},{}],2:[function(e,t,n){"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var o=angular.module("creditCardComponentsModule",[]),i=e("./config");o.service("ccFieldsService",function(){return{getBaseCreditCardFields:function(){return{value:"",disabled:!1,required:!1,readonly:!1,onChangeCallback:angular.noop,maxlength:null,valid:!0,showLabel:!1}},getBaseCcComponentScope:function(){return{text:"=ngModel",onChange:"=onChange",disabled:"=ngDisabled",required:"=ngRequired",readonly:"=ngReadonly",maxlength:"=maxlength",className:"=?className",name:"=name",valid:"=valid"}},getBaseCcInputDirectiveParams:function(e){return{restrict:"E",require:"ngModel",templateUrl:e,scope:this.getBaseCcComponentScope()}},getTemplatesScope:function(){return{credit_card:{num:this.getBaseCreditCardFields(),expire:this.getBaseCreditCardFields(),cvv:this.getBaseCreditCardFields(),postal_code:this.getBaseCreditCardFields()}}},getExpireValueSplitted:function(e){var t={month:"",year:""};if(e){var n=r(e.split("/"),2),o=n[0],i=n[1];void 0!==o&&(o=o.trim()),void 0!==i&&(i=i.trim()),t={month:o,year:i}}return t},getFormattedMonth:function(e){return("0"+e).slice(-2)},getFormattedYear:function(e){return e.toString().slice(-2)},getFullyFormattedYear:function(e){return("20"+e).slice(-4)},getNewFlowProviders:function(){return i.providers},detectCardType:function(e){for(var t=this.getUnknownCardType(),n={shortName:"v",longName:"Visa"},r=[{type:n,rname:"electron",rgxp:/^(4026|417500|4405|4508|4844|4913|4917)\d+$/},{type:t,rname:"maestro",rgxp:/^(5018|5020|5038|5612|5893|6304|6759|6761|6762|6763|0604|6390)\d+$/},{type:t,rname:"dankort",rgxp:/^(5019)\d+$/},{type:t,rname:"interpayment",rgxp:/^(636)\d+$/},{type:t,rname:"unionpay",rgxp:/^(62|88)\d+$/},{type:n,rname:"visa",rgxp:/^4[0-9]{12}(?:[0-9]{3})?$/},{type:{shortName:"mc",longName:"MasterCard"},rname:"mastercard",rgxp:/^5[1-5][0-9]{2}|(222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)[0-9]{12}$/},{type:{shortName:"amex",longName:"American Express"},rname:"amex",rgxp:/^3[47][0-9]{13}$/},{type:{shortName:"dci",longName:"Diners Club"},rname:"diners",rgxp:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/},{type:{shortName:"d",longName:"Discover"},rname:"discover",rgxp:/^6(?:011|5[0-9]{2})[0-9]{12}$/},{type:t,rname:"jcb",rgxp:/^(?:2131|1800|35\d{3})\d{11}$/}],o=0;o<r.length;o++){var i=r[o];if(i.rgxp.test(e))return i.type}return t},getUnknownCardType:function(){return{shortName:"card",longName:"Credit card"}},getCardType:function(e){return{type:{shortName:{"American Express":"amex",Visa:"v",MasterCard:"mc"}[e],longName:e}}}}}),o.service("ccValidationService",["ccFieldsService","lang",function(e,t){return{collectCCErrors:function(e,t){var n=this.getEmptyFieldsErrors(e,t);return n.length?n:this.getSpecificFieldsErrors(e,t)},getEmptyFieldsErrors:function(e,t){return(t=t||this.baseFields).reduce(function(t,n){return e[n.name].value||e[n.name].disabled||t.push({name:n.name,msg:n.msg}),t},[])},getSpecificFieldsErrors:function(e){return[this.getCCNumberError(e.num),this.getExpireError(e.expire),this.getCVVError(e)].filter(function(e){return e})},getCCNumberError:function(e){var n;return this.ccLuhnCheck(e.value)||(n={name:"num",msg:t.tr("Invalid credit card number")}),n},getExpireError:function(n){var r,o=e.getExpireValueSplitted(n.value);return this.ccExpireDateValidate(o.month,o.year)||(r={name:"expire",msg:t.tr("Invalid expiration date")}),r},getCVVError:function(e){if(!this.cvvValidate(e.num.value,e.cvv.value))return{name:"cvv",msg:t.tr("Your CVV must be 4 digits for American Express or 3 digits for other cards")}},cvvValidate:function(t,n){var r=t.replace(/\D/g,""),o=n.replace(/\D/g,"");if("amex"===e.detectCardType(r).shortName){if(/^\d{4}$/.test(o))return!0}else if(/^\d{3}$/.test(o))return!0;return!1},ccExpireDateValidate:function(e,t){if(!e||!t)return!1;var n=parseInt(e,10),r=parseInt(t,10);if(n<1||n>12)return!1;if(r<0)return!1;r<100&&(r+=2e3);var o=new Date;o.setDate(1),o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0);var i=new Date;return i.setDate(1),i.setMonth(n-1),i.setYear(r),i.setHours(0),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0),o.getTime()<=i.getTime()},ccLuhnCheck:function(e){if(!e.match(/^\d+$/))return!1;for(var t=e.length,n=1&t,r=0,o=0;o<t;o++){var i=parseInt(e.charAt(o));1&o^n||(i*=2)>9&&(i-=9),r+=i}return r%10==0},baseFields:[{name:"num",msg:t.tr("Card number is required")},{name:"expire",msg:t.tr("Expiration date is required")},{name:"cvv",msg:t.tr("CVV is required")},{name:"postal_code",msg:t.tr("Postal code is required")}]}}]),o.directive("formatExpiryDate",function(){var e,t,n,r,o,i,a,c,s,u;return i=function(e){var t;return null!=e.prop("selectionStart")&&e.prop("selectionStart")!==e.prop("selectionEnd")||!(null==("undefined"!=typeof document&&null!==document&&null!=(t=document.selection)?t.createRange:void 0)||!document.selection.createRange().text)},s=function(e){var t;return!(!e.metaKey&&!e.ctrlKey)||32!==e.which&&(0===e.which||(e.which<33||(t=String.fromCharCode(e.which),!!/[\d\s]/.test(t))))},c=function(e){var t,n;if(t=$(e.currentTarget),n=String.fromCharCode(e.which),/^\d+$/.test(n)&&!i(t))return!((t.val()+n).replace(/\D/g,"").length>u+2)&&void 0},n=function(e){var t,n,r;if(n=String.fromCharCode(e.which),/^\d+$/.test(n))return t=$(e.currentTarget),r=t.val()+n,/^\d$/.test(r)&&"0"!==r&&"1"!==r?(e.preventDefault(),setTimeout(function(){return t.val("0"+r+" / ")})):/^\d\d$/.test(r)?(e.preventDefault(),setTimeout(function(){return t.val(r+" / ")})):void 0},a=function(t){return setTimeout(function(){var n,r;return r=(n=$(t.currentTarget)).val(),r=e(r),n.val(r)})},e=function(e){var t,n,r,o,i=new RegExp("^\\D*(\\d{1,2})(\\D+)?(\\d{1,"+u+"})?");return(n=e.match(i))?(t=n[1]||"",r=n[2]||"",(o=n[3]||"").length>0?r=" / ":" /"===r?(t=t.substring(0,1),r=""):2===t.length||r.length>0?r=" / ":1===t.length&&"0"!==t&&"1"!==t&&(t="0"+t,r=" / "),t+r+o):""},o=function(e){var t,n,r;if("/"===(r=String.fromCharCode(e.which))||" "===r)return n=(t=$(e.currentTarget)).val(),/^\d$/.test(n)&&"0"!==n?t.val("0"+n+" / "):void 0},r=function(e){var t,n,r;if(n=String.fromCharCode(e.which),/^\d+$/.test(n))return r=(t=$(e.currentTarget)).val(),/^\d\d$/.test(r)?t.val(r+" / "):void 0},t=function(e){var t,n;if(t=$(e.currentTarget),n=t.val(),8===e.which&&(null==t.prop("selectionStart")||t.prop("selectionStart")===n.length))return/\d\s\/\s$/.test(n)?(e.preventDefault(),setTimeout(function(){return t.val(n.replace(/\d\s\/\s$/,""))})):void 0},{scope:{formatYear:"=?formatYear"},restrict:"A",link:function(e,i){u=e.formatYear||2,i.on("keypress",s),i.on("keypress",c),i.on("keypress",n),i.on("keypress",o),i.on("keypress",r),i.on("keydown",t),i.on("change",a),i.on("input",a)}}}),o.directive("ccTextInput",function(){return{restrict:"E",require:"ngModel",templateUrl:"/frontend/providers/common/credit-card-text-input.html",scope:{text:"=ngModel",placeholder:"=placeholder",icon:"=icon",name:"=name",maxlength:"=maxlength",readonly:"=ngReadonly",required:"=ngRequired",disabled:"=ngDisabled",iconClass:"=iconClass",iconWidth:"=iconWidth",className:"=className",borderBottom:"=borderBottom",autocomplete:"=autocomplete",onChange:"=onChange",valid:"=valid"},controller:["$scope",function(e){e.getIconClass=function(){var t="";return e.readonly&&(t+="".concat("cc-field__icon--","readonly ")),e.text&&(t+="".concat("cc-field__icon--","highlighted ")),e.iconClass?t+="".concat(e.iconClass," "):t+="".concat("cc-field__icon--").concat(e.icon," "),t},e.getFieldClass=function(){var t="";return e.name&&(t+="".concat("cc-field--").concat(e.name," ")),e.valid||(t+="".concat("cc-field--","not-valid")),t}}]}}),o.directive("creditCardCvv",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-cvv.html")}]),o.directive("creditCardPostalCode",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-postal-code.html")}]),o.directive("creditCardNumber",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-number.html")}]),o.directive("creditCardHolder",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-holder.html")}]),o.directive("ccExpireComponent",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-expire.html")}]),t.exports=o},{"./config":1}],3:[function(e,t,n){"use strict";var r=["$q","tpHTTP","$rootElement","iframeService","ccFieldsService",function(e,t,n,r,o){return{createCardToken:function(t,n,o){var i,a=this,c=e.defer();return window.addEventListener("message",function e(n){var r;window.clearTimeout(i);try{r=JSON.parse(n.data)}catch(e){c.reject([{msg:e.message}])}void 0!==r&&r.event&&"string"==typeof r.event&&0!=r.event.indexOf("edgil-payway-")&&c.reject(),window.removeEventListener("message",e),"edgil-payway-complete"==r.event?(t.token=r.params.token,c.resolve(t)):"edgil-payway-failed"==r.event&&c.reject([{msg:r.error.message}])},!1),this.hostedPageSetup(n,o).then(function(e){var n="edgil-payway-provider-form-component-iframe",o=e.data.models.replyURL,s=e.data.models.iframeContent;i=r.injectHungTimeoutIframe(n,o);var u=r.injectHiddenIframe(n);return u.onload=function(){u.contentWindow.postMessage(JSON.stringify(a.prepareDataForSend(t,o)),"*")},r.appendContentToIframe(u,s),c.promise})},hostedPageSetup:function(e,n){var r=TPParam.EDGIL_PAYWAY_HOSTED_PAGE_SETUP_ROUTE,o={};return e&&(r=e),n&&(o={params:{aid:n}}),t.get(r,o)},processCC:function(e,t,o){var i=this,a="edgil-payway-provider-form-component-iframe",c=e.replyURL,s=e.iframeContent;e.iframeHungTimeout=r.injectHungTimeoutIframe(a,c);var u=r.injectHiddenIframe(a);if(o.payWithNew)u.onload=function(){u.contentWindow.postMessage(JSON.stringify(i.prepareDataForSend(t,c)),"*")},r.appendContentToIframe(u,s);else{var l=o.stored_rurl?o.stored_rurl:o.storedRurl;u.src=l+"&id="+o.selectedUpiId,n.append(u)}},prepareDataForSend:function(e,t){var n=o.getExpireValueSplitted(e.expire.value);return{accountNumber:e.num.value,expiration:n.month+n.year,fraudSecurityValue:e.cvv.value,zip:e.postal_code.value,replyURL:t}}}}];t.exports=r},{}],4:[function(e,t,n){"use strict";var r=e("../common/config").name,o=e("../common/config").id,i=e("../../../common/config").prefixes.CHECKOUT,a=e("../common").getInstanceName,c=e("../common/addCardBaseComponent"),s=["checkout","$rootElement","errorService","lang","ccFieldsService","$injector","ccValidationService","ppCreditCardActionsService","$q","tpHTTP","billingConfig",function(e,t,n,s,u,l,d,p,f,m,h){return{restrict:"E",require:"^view",transclude:!0,templateUrl:"/frontend/providers/components/"+r+"/checkout/component.shtml",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","errorService","$timeout","ngEventService",function(t,n,g,v){c.apply(t,[f,l,m,u,d,p]);var y=l.get("eventsService"+i),C=y.events;t.providerName=r,t.PAYMENT_PROVIDER_ID=o;var E=l.get(a("CardService",i));angular.extend(t,BaseComponentController);var S=function(){t.cc={},t.cc.payWithNew=!0,t.cc.selectedUpiId=null,t.cc.initiated=!1,t.cc.defaultPaymentMethod=!1,t.credit_card=u.getTemplatesScope().credit_card,t.credit_card.store_in_vault=!0};function T(){e.input.credit_card=t.getCurrentCreditCardInfo(),e.setUpiId(t.cc.selectedUpiId),e.getUpiId()&&e.input.credit_card.taxRequest&&h.updateFromTaxRequest(e,e.input.credit_card.taxRequest)}t.getCurrentCreditCardInfo=function(){var e=u.getExpireValueSplitted(t.credit_card.expire.value),n=e.expireMonth,r=e.expireYear;if(t.cc.payWithNew)return{type:u.detectCardType(t.credit_card.num.value),ending:t.credit_card.num.value?t.credit_card.num.value.slice(-4):"",expireMonth:n,expireYear:r};if(t.cc.selectedUpiId)for(var o=0;o<t.cc.stored.length;o++){var i=t.cc.stored[o];if(i.id==t.cc.selectedUpiId)return{type:{shortName:i.identifier,longName:i.type},ending:i.ending_in,expireMonth:i.expire_month,expireYear:i.expire_year,taxRequest:h.taxRequestFromUpi(i)}}return{type:u.getUnknownCardType(),ending:t.credit_card.num.value?t.credit_card.num.value.slice(-4):"",expireMonth:n,expireYear:r}},t._isValid=function(){return t.isFieldsValid()},t.collectErrors=function(){if(e.isPaymentMethod(o)&&!e.isMockUsed()&&!0!==toBoolean(t.skipValidation)){return t.cc.payWithNew?d.collectCCErrors(t.credit_card):d.getEmptyFieldsErrors({selectedUpiId:{value:t.cc.selectedUpiId}},[{name:"selectedUpiId",msg:s.tr("Please select one of your cards or add new one")}])}},t.onValidationStart=function(){n(t).reset()},t.onValidationEnd=function(e){e.forEach(function(e){n(t).global(e.msg)})},t.$on(C.previewTermComplete,function(){e._completeTerm({q:"q"})}),t.$on(C.initiateSucceed,function(e,n){void 0!==n.stored&&(t.cc.stored=JSON.parse(n.stored)),t.cc.storedRurl=n.stored_rurl,t.cc.payWithNew=void 0===t.cc.stored||0===t.cc.stored.length||t.cc.payWithNew&&t.cc.initiated,t.cc.selectedUpiId=void 0!==t.cc.stored&&t.cc.stored.length>0?t.cc.stored[0].id:null,t.cc.initiated=!0,T(),g(function(){t.$apply()})}),t.$on(C.initiateFailed,function(t,n){e.enabledCheckout()}),t.$on(C.beforeProcess,function(){e.input.storeInVault=t.credit_card.store_in_vault,e.input.defaultPaymentMethodId=t.credit_card.store_in_vault&&t.cc.defaultPaymentMethod}),t.$on(C.processSucceed,function(n,r){return e.disableCheckout(),r.iframeHungTimeout=y.iframeHungTimeout,E.processCC(r,t.credit_card,t.cc)}),t.$on(C.processFailed,function(r,o){e.enabledCheckout(),function(e){if(!Array.isArray(e))return void n(t).global(e.message);for(var r=0;r<e.length;r++){var o=e[r].msg||e[r].message;o&&""!==o.trim()&&n(t).global(o)}}(o)}),t.$on(C.declined,function(){e.enabledCheckout()}),t.$on(C.completeSucceed,function(){window.clearTimeout(y.iframeHungTimeout)}),t.$on(C.completeFailed,function(t,n){window.clearTimeout(y.iframeHungTimeout),e.enabledCheckout()}),t.$watch("cc.selectedUpiId",function(){T()}),t.$watchCollection(["credit_card.num","credit_card.expire_month","credit_card.expire_year"],function(){e.input.credit_card=t.getCurrentCreditCardInfo()}),v.subscribe(EVENT_CHECKOUT_STARTED,function(){S()}),S(),t.expireYears=getYears(),t.expireMonths=getMonths(),propagatePaymentVars(e,t)}]}}];t.exports=s},{"../../../common/config":1,"../common":10,"../common/addCardBaseComponent":7,"../common/config":9}],5:[function(e,t,n){"use strict";var r=e("../common/module"),o=e("../../../common/config").prefixes.CHECKOUT,i=e("../common").getInstanceName,a=e("./component"),c=e("./service"),s=e("../cardService"),u=angular.module(i("Module",o),["checkoutModule",r.name]).factory(i("CardService",o),s).factory(i("Provider",o),c).directive(i("Component",o),a);t.exports=u},{"../../../common/config":1,"../cardService":3,"../common":10,"../common/module":11,"./component":4,"./service":6}],6:[function(e,t,n){"use strict";var r=e("../../../common/config").prefixes.CHECKOUT,o=["$rootScope","$injector",function(e,t){var n=t.get("eventsService"+r).events;return{beforeInitiate:function(){},initiateSucceed:function(t){e.$broadcast(n.initiateSucceed,t)},initiateFailed:function(t){e.$broadcast(n.initiateFailed,t)},beforeProcess:function(){e.$broadcast(n.beforeProcess)},processSucceed:function(t){e.$broadcast(n.processSucceed,t)},processFailed:function(t){e.$broadcast(n.processFailed,t)},confirmed:function(t){e.$broadcast(n.confirmed,t)},declined:function(t){e.$broadcast(n.declined,t)},completeSucceed:function(t){e.$broadcast(n.completeSucceed,t)},completeFailed:function(t){e.$broadcast(n.completeFailed,t)}}}];t.exports=o},{"../../../common/config":1}],7:[function(e,t,n){"use strict";var r=e("./config").name;t.exports=function(e,t,n,o,i,a){var c=this;this.providerName=r,this.credit_card=o.getTemplatesScope().credit_card,this.create_route=TPParam.WALLET_CREATE_ROUTE,this.$watch("readonly",function(){c.initCardAttributes()}),this.$on(a.loaded,function(e,t){c.initCardData(t)}),this.$on(a.create,function(e,t){t&&(c.aid=t),c.create().then(c.onSuccess,c.onError)}),this.onSuccess=function(){c.$emit(a.createSuccess)},this.onError=function(e){c.$emit(a.createError,e)},this.create=function(){var t=this;if(this.isFieldsValid(this.credit_card)){var r=angular.extend(this.card,this.credit_card);return this.cardService.createCardToken(r,this.pageSetupRoute,this.aid).then(function(e){var r=t.getDataToCreateCard(e);return n.post(t.create_route,r)})}return e.reject()},this.isFieldsValid=function(e){this.onValidationStart();var t=this.collectErrors(e);return this.onValidationEnd(t),!t.length},this.collectErrors=function(e){return i.collectCCErrors(e)},this.onValidationStart=function(){for(var e in this.credit_card)this.credit_card[e].valid=!0;this.$emit(a.validationStart)},this.onValidationEnd=function(e){var t=this;e.forEach(function(e){t.credit_card[e.name].valid=!1}),this.$emit(a.validationEnd,e)},this.getDataToCreateCard=function(){return{}},this.initCardAttributes=function(){this.credit_card.num.readonly=this.readonly,this.credit_card.cvv.readonly=this.readonly,this.credit_card.postal_code.readonly=this.readonly,this.credit_card.expire.readonly=this.readonly}}},{"./config":9}],8:[function(e,t,n){"use strict";var r=e("./config").name;t.exports=function(){return{restrict:"E",require:"ngModel",templateUrl:"/frontend/providers/components/"+r+"/common/baseTemplate.shtml",scope:{credit_card:"=creditCard",readonly:"=readonly"}}}},{"./config":9}],9:[function(e,t,n){"use strict";var r=e("../../../common/config"),o={id:19};o.name=r.providers[o.id].name,t.exports=o},{"../../../common/config":1}],10:[function(e,t,n){"use strict";var r=e("./config");t.exports={getInstanceName:function(e,t){var n=r.name+e;return t&&(n+=t),n}}},{"./config":9}],11:[function(e,t,n){"use strict";var r=e("./baseInputsComponent"),o=e("../../../common/creditCardComponentsModule"),i=e("./").getInstanceName,a=angular.module(i("CommonModule"),[o.name]).directive(i("BaseInputsComponent"),r);t.exports=a},{"../../../common/creditCardComponentsModule":2,"./":10,"./baseInputsComponent":8}]},{},[5]),function(){return function e(t,n,r){function o(a,c){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!c&&s)return s(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){return o(t[a][1][e]||e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}}()({1:[function(e,t,n){"use strict";var r=e("./config").providers;t.exports={getModulesFor:function(e){var t=[];for(var n in r){var o=r[n].name+"Module"+e;t.push(o)}return t},dynamicBaseInputsComponent:["$compile",function(e){return{restrict:"E",link:function(t,n){n.html("<"+t.name+'-base-inputs-component credit-card="creditCard" readonly="readonly" callback-on-form-init="callbackOnFormInit"><'+t.name+"-base-inputs-component/>").show(),e(n.contents())(t)},scope:{name:"=",creditCard:"=",callbackOnFormInit:"=?"}}}],ppCreditCardActionsService:function(){return{loaded:"PP_CARD_LOADED",init:"PP_CARD_INITIALIZE",initSuccess:"INIT_PP_CARD_SUCCESS",initError:"INIT_PP_CARD_ERROR",create:"CREATE_PP_CARD",createSuccess:"CREATE_PP_CARD_SUCCESS",createError:"CREATE_PP_CARD_ERROR",validationStart:"PP_CARD_VALIDATION_START",validationEnd:"PP_CARD_VALIDATION_END",isValid:"CREDIT_CARD_FORM_IS_VALID",isNotValid:"CREDIT_CARD_FORM_IS_NOT_VALID"}},providersService:function(e,t,n){return{getProviderInstanceById:function(t){return e.get(this._getProviderInstanceNameById(t))},checkProviderInstanceById:function(n){var r=!0;return t.getNewFlowProviders()[n]&&e.has(this._getProviderInstanceNameById(n))||(r=!1),r},_getProviderInstanceNameById:function(e){return t.getNewFlowProviders()[e].name+"Provider"+n},hasNewFlow:function(e){var n=t.getNewFlowProviders()[e];return n&&n.name}}},getNewFlowComponents:function(e,t,n){var r=e.getNewFlowProviders(),o=t,i="";for(var a in t=t.toLowerCase().split("").join("-"),r){var c=r[a].name,s=n?c+o+" cc-detailed":"";i+="<".concat(c,"-component-").concat(t,'\n \t\t\t\t\t\tclass="').concat(s,'" \n \t\t\t\t\t\treadonly="readonly"\n \t\t\t\t\t\tpayment-provider="paymentProvider"\n            card="card"\n            term-id="{{termId}}"\n            ng-if="paymentSource == ').concat(a,'">\n\t\t\t\t\t</').concat(c,"-component-").concat(t,">")}return{restrict:"E",scope:{paymentProvider:"=paymentProvider",card:"=card",paymentSource:"=paymentSource",readonly:"=readonly",termId:"@?"},template:i}}}},{"./config":2}],2:[function(e,t,n){"use strict";t.exports={prefixes:{CONSUMER_DASHBOARD:"CD",PUBLISHER_DASHBOARD:"PD",CHECKOUT:"CH",APPLY_TERM_WIZARD:"ATW",MY_ACCOUNT:"MA"},providers:{19:{name:"edgil"},37:{name:"onet"},38:{name:"applepayss"},39:{name:"cybersource"},40:{name:"stripe"},41:{name:"applepaystripe"},42:{name:"applepayway"},45:{name:"wirecard"},50:{name:"gocardlessdd"}}}},{}],3:[function(e,t,n){"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var o=angular.module("creditCardComponentsModule",[]),i=e("./config");o.service("ccFieldsService",function(){return{getBaseCreditCardFields:function(){return{value:"",disabled:!1,required:!1,readonly:!1,onChangeCallback:angular.noop,maxlength:null,valid:!0,showLabel:!1}},getBaseCcComponentScope:function(){return{text:"=ngModel",onChange:"=onChange",disabled:"=ngDisabled",required:"=ngRequired",readonly:"=ngReadonly",maxlength:"=maxlength",className:"=?className",name:"=name",valid:"=valid"}},getBaseCcInputDirectiveParams:function(e){return{restrict:"E",require:"ngModel",templateUrl:e,scope:this.getBaseCcComponentScope()}},getTemplatesScope:function(){return{credit_card:{num:this.getBaseCreditCardFields(),expire:this.getBaseCreditCardFields(),cvv:this.getBaseCreditCardFields(),postal_code:this.getBaseCreditCardFields()}}},getExpireValueSplitted:function(e){var t={month:"",year:""};if(e){var n=r(e.split("/"),2),o=n[0],i=n[1];void 0!==o&&(o=o.trim()),void 0!==i&&(i=i.trim()),t={month:o,year:i}}return t},getFormattedMonth:function(e){return("0"+e).slice(-2)},getFormattedYear:function(e){return e.toString().slice(-2)},getFullyFormattedYear:function(e){return("20"+e).slice(-4)},getNewFlowProviders:function(){return i.providers},detectCardType:function(e){for(var t=this.getUnknownCardType(),n={shortName:"v",longName:"Visa"},r=[{type:n,rname:"electron",rgxp:/^(4026|417500|4405|4508|4844|4913|4917)\d+$/},{type:t,rname:"maestro",rgxp:/^(5018|5020|5038|5612|5893|6304|6759|6761|6762|6763|0604|6390)\d+$/},{type:t,rname:"dankort",rgxp:/^(5019)\d+$/},{type:t,rname:"interpayment",rgxp:/^(636)\d+$/},{type:t,rname:"unionpay",rgxp:/^(62|88)\d+$/},{type:n,rname:"visa",rgxp:/^4[0-9]{12}(?:[0-9]{3})?$/},{type:{shortName:"mc",longName:"MasterCard"},rname:"mastercard",rgxp:/^5[1-5][0-9]{2}|(222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)[0-9]{12}$/},{type:{shortName:"amex",longName:"American Express"},rname:"amex",rgxp:/^3[47][0-9]{13}$/},{type:{shortName:"dci",longName:"Diners Club"},rname:"diners",rgxp:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/},{type:{shortName:"d",longName:"Discover"},rname:"discover",rgxp:/^6(?:011|5[0-9]{2})[0-9]{12}$/},{type:t,rname:"jcb",rgxp:/^(?:2131|1800|35\d{3})\d{11}$/}],o=0;o<r.length;o++){var i=r[o];if(i.rgxp.test(e))return i.type}return t},getUnknownCardType:function(){return{shortName:"card",longName:"Credit card"}},getCardType:function(e){return{type:{shortName:{"American Express":"amex",Visa:"v",MasterCard:"mc"}[e],longName:e}}}}}),o.service("ccValidationService",["ccFieldsService","lang",function(e,t){return{collectCCErrors:function(e,t){var n=this.getEmptyFieldsErrors(e,t);return n.length?n:this.getSpecificFieldsErrors(e,t)},getEmptyFieldsErrors:function(e,t){return(t=t||this.baseFields).reduce(function(t,n){return e[n.name].value||e[n.name].disabled||t.push({name:n.name,msg:n.msg}),t},[])},getSpecificFieldsErrors:function(e){return[this.getCCNumberError(e.num),this.getExpireError(e.expire),this.getCVVError(e)].filter(function(e){return e})},getCCNumberError:function(e){var n;return this.ccLuhnCheck(e.value)||(n={name:"num",msg:t.tr("Invalid credit card number")}),n},getExpireError:function(n){var r,o=e.getExpireValueSplitted(n.value);return this.ccExpireDateValidate(o.month,o.year)||(r={name:"expire",msg:t.tr("Invalid expiration date")}),r},getCVVError:function(e){if(!this.cvvValidate(e.num.value,e.cvv.value))return{name:"cvv",msg:t.tr("Your CVV must be 4 digits for American Express or 3 digits for other cards")}},cvvValidate:function(t,n){var r=t.replace(/\D/g,""),o=n.replace(/\D/g,"");if("amex"===e.detectCardType(r).shortName){if(/^\d{4}$/.test(o))return!0}else if(/^\d{3}$/.test(o))return!0;return!1},ccExpireDateValidate:function(e,t){if(!e||!t)return!1;var n=parseInt(e,10),r=parseInt(t,10);if(n<1||n>12)return!1;if(r<0)return!1;r<100&&(r+=2e3);var o=new Date;o.setDate(1),o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0);var i=new Date;return i.setDate(1),i.setMonth(n-1),i.setYear(r),i.setHours(0),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0),o.getTime()<=i.getTime()},ccLuhnCheck:function(e){if(!e.match(/^\d+$/))return!1;for(var t=e.length,n=1&t,r=0,o=0;o<t;o++){var i=parseInt(e.charAt(o));1&o^n||(i*=2)>9&&(i-=9),r+=i}return r%10==0},baseFields:[{name:"num",msg:t.tr("Card number is required")},{name:"expire",msg:t.tr("Expiration date is required")},{name:"cvv",msg:t.tr("CVV is required")},{name:"postal_code",msg:t.tr("Postal code is required")}]}}]),o.directive("formatExpiryDate",function(){var e,t,n,r,o,i,a,c,s,u;return i=function(e){var t;return null!=e.prop("selectionStart")&&e.prop("selectionStart")!==e.prop("selectionEnd")||!(null==("undefined"!=typeof document&&null!==document&&null!=(t=document.selection)?t.createRange:void 0)||!document.selection.createRange().text)},s=function(e){var t;return!(!e.metaKey&&!e.ctrlKey)||32!==e.which&&(0===e.which||(e.which<33||(t=String.fromCharCode(e.which),!!/[\d\s]/.test(t))))},c=function(e){var t,n;if(t=$(e.currentTarget),n=String.fromCharCode(e.which),/^\d+$/.test(n)&&!i(t))return!((t.val()+n).replace(/\D/g,"").length>u+2)&&void 0},n=function(e){var t,n,r;if(n=String.fromCharCode(e.which),/^\d+$/.test(n))return t=$(e.currentTarget),r=t.val()+n,/^\d$/.test(r)&&"0"!==r&&"1"!==r?(e.preventDefault(),setTimeout(function(){return t.val("0"+r+" / ")})):/^\d\d$/.test(r)?(e.preventDefault(),setTimeout(function(){return t.val(r+" / ")})):void 0},a=function(t){return setTimeout(function(){var n,r;return r=(n=$(t.currentTarget)).val(),r=e(r),n.val(r)})},e=function(e){var t,n,r,o,i=new RegExp("^\\D*(\\d{1,2})(\\D+)?(\\d{1,"+u+"})?");return(n=e.match(i))?(t=n[1]||"",r=n[2]||"",(o=n[3]||"").length>0?r=" / ":" /"===r?(t=t.substring(0,1),r=""):2===t.length||r.length>0?r=" / ":1===t.length&&"0"!==t&&"1"!==t&&(t="0"+t,r=" / "),t+r+o):""},o=function(e){var t,n,r;if("/"===(r=String.fromCharCode(e.which))||" "===r)return n=(t=$(e.currentTarget)).val(),/^\d$/.test(n)&&"0"!==n?t.val("0"+n+" / "):void 0},r=function(e){var t,n,r;if(n=String.fromCharCode(e.which),/^\d+$/.test(n))return r=(t=$(e.currentTarget)).val(),/^\d\d$/.test(r)?t.val(r+" / "):void 0},t=function(e){var t,n;if(t=$(e.currentTarget),n=t.val(),8===e.which&&(null==t.prop("selectionStart")||t.prop("selectionStart")===n.length))return/\d\s\/\s$/.test(n)?(e.preventDefault(),setTimeout(function(){return t.val(n.replace(/\d\s\/\s$/,""))})):void 0},{scope:{formatYear:"=?formatYear"},restrict:"A",link:function(e,i){u=e.formatYear||2,i.on("keypress",s),i.on("keypress",c),i.on("keypress",n),i.on("keypress",o),i.on("keypress",r),i.on("keydown",t),i.on("change",a),i.on("input",a)}}}),o.directive("ccTextInput",function(){return{restrict:"E",require:"ngModel",templateUrl:"/frontend/providers/common/credit-card-text-input.html",scope:{text:"=ngModel",placeholder:"=placeholder",icon:"=icon",name:"=name",maxlength:"=maxlength",readonly:"=ngReadonly",required:"=ngRequired",disabled:"=ngDisabled",iconClass:"=iconClass",iconWidth:"=iconWidth",className:"=className",borderBottom:"=borderBottom",autocomplete:"=autocomplete",onChange:"=onChange",valid:"=valid"},controller:["$scope",function(e){e.getIconClass=function(){var t="";return e.readonly&&(t+="".concat("cc-field__icon--","readonly ")),e.text&&(t+="".concat("cc-field__icon--","highlighted ")),e.iconClass?t+="".concat(e.iconClass," "):t+="".concat("cc-field__icon--").concat(e.icon," "),t},e.getFieldClass=function(){var t="";return e.name&&(t+="".concat("cc-field--").concat(e.name," ")),e.valid||(t+="".concat("cc-field--","not-valid")),t}}]}}),o.directive("creditCardCvv",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-cvv.html")}]),o.directive("creditCardPostalCode",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-postal-code.html")}]),o.directive("creditCardNumber",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-number.html")}]),o.directive("creditCardHolder",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-holder.html")}]),o.directive("ccExpireComponent",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-expire.html")}]),t.exports=o},{"./config":2}],4:[function(e,t,n){"use strict";var r=["$q","tpHTTP","$rootElement","iframeService","lang",function(e,t,n,r,o){var i="bank-secure-form-component-iframe",a={100:{statusCode:"ERROR_INTERNAL",codeLiteral:"GENERAL_ERROR",message:o.tr("Other error.")},101:{statusCode:"ERROR_UNKNOWN_MERCHANT_POS",codeLiteral:"UNKNOWN_MERCHANT",message:o.tr("Incorrect POS ID.")},4003:{statusCode:"ERROR_VALUE_INVALID",codeLiteral:"CARD_INVALID_CVV",message:o.tr("CVV length is incorrect (only 3 or 4 digits allowed).")},4100:{statusCode:"SERVICE_NOT_AVAILABLE",codeLiteral:"CARD_TOKENIZATION_DISABLED",message:o.tr("Tokenization is not enabled for your POS ID.")},4101:{statusCode:"SERVICE_NOT_AVAILABLE",codeLiteral:"CARD_MERCHANT_INACTIVE",message:o.tr("Card payments not enabled for your POS ID.")}},c={"card.expirationDate":"formatInvalid date","card.expirationMonth":"formatInvalid month","card.expirationYear":"formatInvalid year","card.number":"unsupportedType card number"};return{createCardTokenIPay:function(t){var n=e.defer();return n.resolve({token:null}),n.promise},createCardToken:function(t){var n=e.defer();if(OpenPayU.merchantId=t.posId,!t.posId)return n.reject({message:"Pos ID can not be empty"}),n.promise;var r=OpenPayU.Token.create({},function(e){"0"===e.status.code?n.resolve(e.data):n.reject(a[e.status.code])});if(!0!==r){var o=Object.keys(r).map(function(e){return{msg:c[e]}});n.reject(o)}return n.promise},processCC:function(e){r.injectHiddenIframe(i,e)},injectIframe:function(e){r.injectIframe(i,e,angular.element("#onet-3dsecure-container"))}}}];t.exports=r},{}],5:[function(e,t,n){"use strict";var r=e("../common/config").name,o=e("../common/config").id,i=e("../../../common/config").prefixes.CHECKOUT,a=e("../common").getInstanceName,c=e("../common/addCardBaseComponent"),s=["checkout","ngEventService","$rootElement","$rootScope","errorService","lang","ccFieldsService","$injector","ccValidationService","ppCreditCardActionsService","$q","tpHTTP","viewService","paymentProvider","iframeService","eventService","billingConfig","checkoutGoTo",function(e,t,n,s,u,l,d,p,f,m,h,g,v,y,C,E,S,T){return{restrict:"E",require:"^view",transclude:!0,templateUrl:"/frontend/providers/components/"+r+"/checkout/component.shtml",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","errorService","$timeout","ngEventService",function(t,n,s,u){var _;angular.extend(t,BaseComponentController),c.apply(t,[h,p,g,d,f,m,l]);var w=p.get("eventsService"+i).events;t.providerName=r,t.PAYMENT_PROVIDER_ID=o;var b={};t.iPayEnabled=!1,t.cardService=p.get(a("CardService",i));var P={shortName:"card",longName:"Credit card"};function A(e){var n=d.getExpireValueSplitted(e);t.credit_card.expire.month=n.month,t.credit_card.expire.year=n.year}var $=function(){t.cc={},t.cc.payWithNew=!0,t.cc.selectedUpiId=null,t.cc.initiated=!1,t.cc.defaultPaymentMethodId=null,t.credit_card=d.getTemplatesScope().credit_card,t.credit_card.store_in_vault=!0,t.credit_card.postal_code.disabled=!0,t.credit_card.expire.onChangeCallback=A},I=function(e){for(var t={shortName:"v",longName:"Visa"},n=[{type:t,rname:"electron",rgxp:/^(4026|417500|4405|4508|4844|4913|4917)\d+$/},{type:P,rname:"maestro",rgxp:/^(5018|5020|5038|5612|5893|6304|6759|6761|6762|6763|0604|6390)\d+$/},{type:P,rname:"dankort",rgxp:/^(5019)\d+$/},{type:P,rname:"interpayment",rgxp:/^(636)\d+$/},{type:P,rname:"unionpay",rgxp:/^(62|88)\d+$/},{type:t,rname:"visa",rgxp:/^4[0-9]{12}(?:[0-9]{3})?$/},{type:{shortName:"mc",longName:"MasterCard"},rname:"mastercard",rgxp:/^5[1-5][0-9]{2}|(222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)[0-9]{12}$/},{type:{shortName:"amex",longName:"American Express"},rname:"amex",rgxp:/^3[47][0-9]{13}$/},{type:{shortName:"dci",longName:"Diners Club"},rname:"diners",rgxp:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/},{type:{shortName:"d",longName:"Discover"},rname:"discover",rgxp:/^6(?:011|5[0-9]{2})[0-9]{12}$/},{type:P,rname:"jcb",rgxp:/^(?:2131|1800|35\d{3})\d{11}$/}],r=0;r<n.length;r++){var o=n[r];if(o.rgxp.test(e))return o.type}return P};function k(e){if(n(t).reset(),Array.isArray(e))for(var r=0;r<e.length;r++){var o=e[r].msg||e[r].message;o&&""!==o.trim()&&n(t).global(o)}else n(t).global(e.message)}function N(){e.input.credit_card=t.getCurrentCreditCardInfo(),e.setUpiId(t.cc.selectedUpiId),e.getUpiId()&&e.input.credit_card.taxRequest&&S.updateFromTaxRequest(e,e.input.credit_card.taxRequest)}t.getCurrentCreditCardInfo=function(){var e=d.getExpireValueSplitted(t.credit_card.expire.value),n=e.expireMonth,r=e.expireYear;if(t.cc.payWithNew)return{type:I(t.credit_card.num.value),ending:t.credit_card.num.value?t.credit_card.num.value.slice(-4):"",expireMonth:n,expireYear:r};if(t.cc.selectedUpiId)for(var o=0;o<t.cc.stored.length;o++){var i=t.cc.stored[o];if(i.id==t.cc.selectedUpiId)return{type:{shortName:i.identifier,longName:i.type},ending:i.ending_in,expireMonth:i.expire_month,expireYear:i.expire_year,taxRequest:S.taxRequestFromUpi(i)}}return{type:P,ending:t.credit_card.num.value?t.credit_card.num.value.slice(-4):"",expireMonth:n,expireYear:r}},t._isValid=function(){return t.isFieldsValid()},t.collectErrors=function(){if(t.iPayEnabled||!e.isPaymentMethod(o)||e.isMockUsed()||!0===toBoolean(t.skipValidation))return[];return t.cc.payWithNew?f.collectCCErrors(t.credit_card):f.getEmptyFieldsErrors({selectedUpiId:{value:t.cc.selectedUpiId}},[{name:"selectedUpiId",msg:l.trc("checkout.platform","Please select one of your cards or add new one")}])},t.onValidationStart=function(){n(t).reset()},t.onValidationEnd=function(e){e.forEach(function(e){n(t).global(e.msg)})},t.$on(w.previewTermComplete,function(){e._completeTerm({q:"q"})}),t.$on(w.initiateSucceed,function(e,n){void 0!==n.stored&&(t.cc.stored=JSON.parse(n.stored)),t.cc.storedRurl=n.stored_rurl,t.iPayEnabled="true"==n.iPayEnabled||1==n.iPayEnabled,t.posId=n.posId,t.cc.payWithNew=t.iPayEnabled||void 0===t.cc.stored||0===t.cc.stored.length||t.cc.payWithNew&&t.cc.initiated,t.cc.selectedUpiId=void 0!==t.cc.stored&&t.cc.stored.length>0?t.cc.stored[0].id:null,t.cc.initiated=!0,N(),s(function(){t.$apply()})}),t.$on(w.initiateFailed,function(t,n){e.enabledCheckout()}),t.$on(w.beforeProcess,function(){e.input.storeInVault=t.credit_card.store_in_vault,e.input.defaultPaymentMethodId=t.credit_card.store_in_vault&&t.cc.defaultPaymentMethodId,t.cc.payWithNew&&(t.cc.selectedUpiId=null,e.setUpiId(null))}),t.$on(w.processSucceed,function(n,r,o){e.disableCheckout(),(r=angular.extend({},r,t.cc)).iPayEnabled=t.iPayEnabled,r.posId=t.posId,_=o,t.bankSecureUrl=null,t.$broadcast(m.create,r)}),t.$on(m.createError,function(t,n){e.enabledCheckout(),k(n),_.reject()}),t.$on(w.processFailed,function(t,n){e.enabledCheckout(),k(n)}),t.$on(w.declined,function(){e.enabledCheckout()}),t.$on(w.completeSucceed,function(){}),t.$on(w.completeFailed,function(t,n){e.enabledCheckout(),k(n)}),b.goBackToPreviousState=function(){_.reject&&_.reject(),v.gotoPreviousState()},t.$on("BANK_SECURE_COMPONENT_INIT_SUCCESS",function(){u.fire("INIT_BANK_SECURE")}),t.$on("onet-settransaction-complete",function(n,r){if("success"===r.status)switch(r.action.toLowerCase()){case"continue":t.cardService.processCC(r.data);break;case"continue_3ds":TPParam.FULL_REDIRECT_3DS_ENABLED?E.postMessage("fullRedirectThreeDS",{bankSecureUrl:r.data}):(t.bankSecureUrl=r.data,b.callbackOnInit=function(e){C.injectIframe(e.iframeId,t.bankSecureUrl,angular.element("#bank-secure-container"))},T.goToBankSecureState(e),u.fire("INIT_BANK_SECURE"))}"fail"===r.status&&(k([{msg:r.error_message}]),_.reject()),e.enabledCheckout()}),t.$watch("cc.selectedUpiId",function(){N()}),t.$watchCollection(["credit_card.num","credit_card.expire_month","credit_card.expire_year"],function(){e.input.credit_card=t.getCurrentCreditCardInfo()}),u.subscribe(EVENT_CHECKOUT_STARTED,function(){$()}),$(),t.expireYears=getYears(),t.expireMonths=getMonths(),propagatePaymentVars(e,t),y.setInstance(b)}]}}];t.exports=s},{"../../../common/config":2,"../common":11,"../common/addCardBaseComponent":8,"../common/config":10}],6:[function(e,t,n){"use strict";var r=e("../common/module"),o=e("../../../common/config").prefixes.CHECKOUT,i=e("../common").getInstanceName,a=e("./component"),c=e("./service"),s=e("../cardService"),u=angular.module(i("Module",o),["checkoutModule",r.name]).factory(i("CardService",o),s).factory(i("Provider",o),c).directive(i("Component",o),a);t.exports=u},{"../../../common/config":2,"../cardService":4,"../common":11,"../common/module":12,"./component":5,"./service":7}],7:[function(e,t,n){"use strict";var r=e("../../../common/config").prefixes.CHECKOUT,o=["$rootScope","$injector","$q",function(e,t,n){var o=t.get("eventsService"+r).events;return{beforeInitiate:function(){},initiateSucceed:function(t){e.$broadcast(o.initiateSucceed,t)},initiateFailed:function(t){e.$broadcast(o.initiateFailed,t)},beforeProcess:function(){e.$broadcast(o.beforeProcess)},processSucceed:function(t){var r=n.defer();return e.$broadcast(o.processSucceed,t,r),r.promise},processFailed:function(t){e.$broadcast(o.processFailed,t)},confirmed:function(t){e.$broadcast(o.confirmed,t)},declined:function(t){e.$broadcast(o.declined,t)},completeSucceed:function(t){e.$broadcast(o.completeSucceed,t)},completeFailed:function(t){e.$broadcast(o.completeFailed,t)}}}];t.exports=o},{"../../../common/config":2}],8:[function(e,t,n){"use strict";var r=e("./config").name;t.exports=function(e,t,n,o,i,a,c){var s=this;this.providerName=r,this.credit_card=o.getTemplatesScope().credit_card,this.credit_card.postal_code.disabled=!0,this.create_route=TPParam.WALLET_CREATE_ROUTE,this.$watch("readonly",function(){s.initCardAttributes()}),this.$on(a.loaded,function(e,t){s.initCardData(t)}),this.$on(a.create,function(e,t){s.create(t).then(s.onSuccess,s.onError)}),this.onSuccess=function(e){s.$emit(a.createSuccess,e)},this.onError=function(e){s.$emit(a.createError,e)},this.create=function(t){var n,r=this,o=e.defer();return this.isFieldsValid(this.credit_card)?t.payWithNew?(t.iPayEnabled?this.cardService.createCardTokenIPay:this.cardService.createCardToken)(t).then(function(e){n=t.rurl,e.token&&(n+="&token="+e.token),r.cardService.processCC(n)}).catch(function(e){o.reject(e)}):(n=t.storedRurl+"&id="+t.selectedUpiId,this.cardService.processCC(n)):o.reject({message:c.tr("Credit card information is not valid")}),o.promise},this.isFieldsValid=function(e){this.onValidationStart();var t=this.collectErrors(e);return this.onValidationEnd(t),!t.length},this.collectErrors=function(e){return i.collectCCErrors(e)},this.onValidationStart=function(){for(var e in this.credit_card)this.credit_card[e].valid=!0;this.$emit(a.validationStart)},this.onValidationEnd=function(e){var t=this;e.forEach(function(e){t.credit_card[e.name].valid=!1}),this.$emit(a.validationEnd,e)},this.getDataToCreateCard=function(e){var t=this.card.source;return{number:e.num.value,cvv:e.cvv.value,exp_mon:parseInt(e.expire.month,10),exp_yr:parseInt(e.expire.year,10),source:t}},this.initCardAttributes=function(){this.credit_card.num.readonly=this.readonly,this.credit_card.cvv.readonly=this.readonly,this.credit_card.postal_code.readonly=this.readonly,this.credit_card.expire.readonly=this.readonly}}},{"./config":10}],9:[function(e,t,n){"use strict";var r=e("./config").name;t.exports=function(){return{restrict:"E",require:"ngModel",templateUrl:"/frontend/providers/components/"+r+"/common/baseTemplate.shtml",scope:{credit_card:"=creditCard",readonly:"=readonly"}}}},{"./config":10}],10:[function(e,t,n){"use strict";var r=e("../../../common/config"),o={id:37};o.name=r.providers[o.id].name,t.exports=o},{"../../../common/config":2}],11:[function(e,t,n){"use strict";var r=e("./config");t.exports={getInstanceName:function(e,t){var n=r.name+e;return t&&(n+=t),n}}},{"./config":10}],12:[function(e,t,n){"use strict";var r=e("./baseInputsComponent"),o=e("../../../common/creditCardComponentsModule"),i=e("./").getInstanceName,a=(e("../../../common/common").dynamicBaseInputsComponent,angular.module(i("CommonModule"),[o.name]).directive(i("BaseInputsComponent"),r));t.exports=a},{"../../../common/common":1,"../../../common/creditCardComponentsModule":3,"./":11,"./baseInputsComponent":9}]},{},[6]),function(){return function e(t,n,r){function o(a,c){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!c&&s)return s(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){return o(t[a][1][e]||e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}}()({1:[function(e,t,n){"use strict";t.exports={prefixes:{CONSUMER_DASHBOARD:"CD",PUBLISHER_DASHBOARD:"PD",CHECKOUT:"CH",APPLY_TERM_WIZARD:"ATW",MY_ACCOUNT:"MA"},providers:{19:{name:"edgil"},37:{name:"onet"},38:{name:"applepayss"},39:{name:"cybersource"},40:{name:"stripe"},41:{name:"applepaystripe"},42:{name:"applepayway"},45:{name:"wirecard"},50:{name:"gocardlessdd"}}}},{}],2:[function(e,t,n){"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var o=angular.module("creditCardComponentsModule",[]),i=e("./config");o.service("ccFieldsService",function(){return{getBaseCreditCardFields:function(){return{value:"",disabled:!1,required:!1,readonly:!1,onChangeCallback:angular.noop,maxlength:null,valid:!0,showLabel:!1}},getBaseCcComponentScope:function(){return{text:"=ngModel",onChange:"=onChange",disabled:"=ngDisabled",required:"=ngRequired",readonly:"=ngReadonly",maxlength:"=maxlength",className:"=?className",name:"=name",valid:"=valid"}},getBaseCcInputDirectiveParams:function(e){return{restrict:"E",require:"ngModel",templateUrl:e,scope:this.getBaseCcComponentScope()}},getTemplatesScope:function(){return{credit_card:{num:this.getBaseCreditCardFields(),expire:this.getBaseCreditCardFields(),cvv:this.getBaseCreditCardFields(),postal_code:this.getBaseCreditCardFields()}}},getExpireValueSplitted:function(e){var t={month:"",year:""};if(e){var n=r(e.split("/"),2),o=n[0],i=n[1];void 0!==o&&(o=o.trim()),void 0!==i&&(i=i.trim()),t={month:o,year:i}}return t},getFormattedMonth:function(e){return("0"+e).slice(-2)},getFormattedYear:function(e){return e.toString().slice(-2)},getFullyFormattedYear:function(e){return("20"+e).slice(-4)},getNewFlowProviders:function(){return i.providers},detectCardType:function(e){for(var t=this.getUnknownCardType(),n={shortName:"v",longName:"Visa"},r=[{type:n,rname:"electron",rgxp:/^(4026|417500|4405|4508|4844|4913|4917)\d+$/},{type:t,rname:"maestro",rgxp:/^(5018|5020|5038|5612|5893|6304|6759|6761|6762|6763|0604|6390)\d+$/},{type:t,rname:"dankort",rgxp:/^(5019)\d+$/},{type:t,rname:"interpayment",rgxp:/^(636)\d+$/},{type:t,rname:"unionpay",rgxp:/^(62|88)\d+$/},{type:n,rname:"visa",rgxp:/^4[0-9]{12}(?:[0-9]{3})?$/},{type:{shortName:"mc",longName:"MasterCard"},rname:"mastercard",rgxp:/^5[1-5][0-9]{2}|(222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)[0-9]{12}$/},{type:{shortName:"amex",longName:"American Express"},rname:"amex",rgxp:/^3[47][0-9]{13}$/},{type:{shortName:"dci",longName:"Diners Club"},rname:"diners",rgxp:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/},{type:{shortName:"d",longName:"Discover"},rname:"discover",rgxp:/^6(?:011|5[0-9]{2})[0-9]{12}$/},{type:t,rname:"jcb",rgxp:/^(?:2131|1800|35\d{3})\d{11}$/}],o=0;o<r.length;o++){var i=r[o];if(i.rgxp.test(e))return i.type}return t},getUnknownCardType:function(){return{shortName:"card",longName:"Credit card"}},getCardType:function(e){return{type:{shortName:{"American Express":"amex",Visa:"v",MasterCard:"mc"}[e],longName:e}}}}}),o.service("ccValidationService",["ccFieldsService","lang",function(e,t){return{collectCCErrors:function(e,t){var n=this.getEmptyFieldsErrors(e,t);return n.length?n:this.getSpecificFieldsErrors(e,t)},getEmptyFieldsErrors:function(e,t){return(t=t||this.baseFields).reduce(function(t,n){return e[n.name].value||e[n.name].disabled||t.push({name:n.name,msg:n.msg}),t},[])},getSpecificFieldsErrors:function(e){return[this.getCCNumberError(e.num),this.getExpireError(e.expire),this.getCVVError(e)].filter(function(e){return e})},getCCNumberError:function(e){var n;return this.ccLuhnCheck(e.value)||(n={name:"num",msg:t.tr("Invalid credit card number")}),n},getExpireError:function(n){var r,o=e.getExpireValueSplitted(n.value);return this.ccExpireDateValidate(o.month,o.year)||(r={name:"expire",msg:t.tr("Invalid expiration date")}),r},getCVVError:function(e){if(!this.cvvValidate(e.num.value,e.cvv.value))return{name:"cvv",msg:t.tr("Your CVV must be 4 digits for American Express or 3 digits for other cards")}},cvvValidate:function(t,n){var r=t.replace(/\D/g,""),o=n.replace(/\D/g,"");if("amex"===e.detectCardType(r).shortName){if(/^\d{4}$/.test(o))return!0}else if(/^\d{3}$/.test(o))return!0;return!1},ccExpireDateValidate:function(e,t){if(!e||!t)return!1;var n=parseInt(e,10),r=parseInt(t,10);if(n<1||n>12)return!1;if(r<0)return!1;r<100&&(r+=2e3);var o=new Date;o.setDate(1),o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0);var i=new Date;return i.setDate(1),i.setMonth(n-1),i.setYear(r),i.setHours(0),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0),o.getTime()<=i.getTime()},ccLuhnCheck:function(e){if(!e.match(/^\d+$/))return!1;for(var t=e.length,n=1&t,r=0,o=0;o<t;o++){var i=parseInt(e.charAt(o));1&o^n||(i*=2)>9&&(i-=9),r+=i}return r%10==0},baseFields:[{name:"num",msg:t.tr("Card number is required")},{name:"expire",msg:t.tr("Expiration date is required")},{name:"cvv",msg:t.tr("CVV is required")},{name:"postal_code",msg:t.tr("Postal code is required")}]}}]),o.directive("formatExpiryDate",function(){var e,t,n,r,o,i,a,c,s,u;return i=function(e){var t;return null!=e.prop("selectionStart")&&e.prop("selectionStart")!==e.prop("selectionEnd")||!(null==("undefined"!=typeof document&&null!==document&&null!=(t=document.selection)?t.createRange:void 0)||!document.selection.createRange().text)},s=function(e){var t;return!(!e.metaKey&&!e.ctrlKey)||32!==e.which&&(0===e.which||(e.which<33||(t=String.fromCharCode(e.which),!!/[\d\s]/.test(t))))},c=function(e){var t,n;if(t=$(e.currentTarget),n=String.fromCharCode(e.which),/^\d+$/.test(n)&&!i(t))return!((t.val()+n).replace(/\D/g,"").length>u+2)&&void 0},n=function(e){var t,n,r;if(n=String.fromCharCode(e.which),/^\d+$/.test(n))return t=$(e.currentTarget),r=t.val()+n,/^\d$/.test(r)&&"0"!==r&&"1"!==r?(e.preventDefault(),setTimeout(function(){return t.val("0"+r+" / ")})):/^\d\d$/.test(r)?(e.preventDefault(),setTimeout(function(){return t.val(r+" / ")})):void 0},a=function(t){return setTimeout(function(){var n,r;return r=(n=$(t.currentTarget)).val(),r=e(r),n.val(r)})},e=function(e){var t,n,r,o,i=new RegExp("^\\D*(\\d{1,2})(\\D+)?(\\d{1,"+u+"})?");return(n=e.match(i))?(t=n[1]||"",r=n[2]||"",(o=n[3]||"").length>0?r=" / ":" /"===r?(t=t.substring(0,1),r=""):2===t.length||r.length>0?r=" / ":1===t.length&&"0"!==t&&"1"!==t&&(t="0"+t,r=" / "),t+r+o):""},o=function(e){var t,n,r;if("/"===(r=String.fromCharCode(e.which))||" "===r)return n=(t=$(e.currentTarget)).val(),/^\d$/.test(n)&&"0"!==n?t.val("0"+n+" / "):void 0},r=function(e){var t,n,r;if(n=String.fromCharCode(e.which),/^\d+$/.test(n))return r=(t=$(e.currentTarget)).val(),/^\d\d$/.test(r)?t.val(r+" / "):void 0},t=function(e){var t,n;if(t=$(e.currentTarget),n=t.val(),8===e.which&&(null==t.prop("selectionStart")||t.prop("selectionStart")===n.length))return/\d\s\/\s$/.test(n)?(e.preventDefault(),setTimeout(function(){return t.val(n.replace(/\d\s\/\s$/,""))})):void 0},{scope:{formatYear:"=?formatYear"},restrict:"A",link:function(e,i){u=e.formatYear||2,i.on("keypress",s),i.on("keypress",c),i.on("keypress",n),i.on("keypress",o),i.on("keypress",r),i.on("keydown",t),i.on("change",a),i.on("input",a)}}}),o.directive("ccTextInput",function(){return{restrict:"E",require:"ngModel",templateUrl:"/frontend/providers/common/credit-card-text-input.html",scope:{text:"=ngModel",placeholder:"=placeholder",icon:"=icon",name:"=name",maxlength:"=maxlength",readonly:"=ngReadonly",required:"=ngRequired",disabled:"=ngDisabled",iconClass:"=iconClass",iconWidth:"=iconWidth",className:"=className",borderBottom:"=borderBottom",autocomplete:"=autocomplete",onChange:"=onChange",valid:"=valid"},controller:["$scope",function(e){e.getIconClass=function(){var t="";return e.readonly&&(t+="".concat("cc-field__icon--","readonly ")),e.text&&(t+="".concat("cc-field__icon--","highlighted ")),e.iconClass?t+="".concat(e.iconClass," "):t+="".concat("cc-field__icon--").concat(e.icon," "),t},e.getFieldClass=function(){var t="";return e.name&&(t+="".concat("cc-field--").concat(e.name," ")),e.valid||(t+="".concat("cc-field--","not-valid")),t}}]}}),o.directive("creditCardCvv",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-cvv.html")}]),o.directive("creditCardPostalCode",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-postal-code.html")}]),o.directive("creditCardNumber",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-number.html")}]),o.directive("creditCardHolder",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-holder.html")}]),o.directive("ccExpireComponent",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-expire.html")}]),t.exports=o},{"./config":1}],3:[function(e,t,n){"use strict";var r=["iframeService","tpHTTP","ppCreditCardActionsService","$q",function(e,t,n,r){var o="stripe-provider-form-component-iframe";return{processTransaction:function(e,t,n,r){var o="",i="";e.payWithNew?(o="".concat(e.initiateTransactionUrl,"&instrumentId=").concat(n,"&storeInstrument=").concat(!!r),i=t.rurl):(o="".concat(e.initiateTransactionUrl,"&upiId=").concat(e.selectedUpiId),i="".concat(e.storedRurl,"&id=").concat(e.selectedUpiId));return a(o).then(function(e){return{result:e,rurl:i}})},processPurchase:function(t){e.injectHiddenIframe(o,t)},createCard:function(e,t,o){e.isFieldsValid().then(function(t){return t?e.cardService.executeGetRequest(o):r.reject()}).then(function(t){var n=t.models.setupIntentClientSecret;return e.handleCardSetup(n)}).then(function(t){if(t.error){var n=e.parseStripeError(t.error);return r.reject({errors:[n]})}return t.setupIntent.payment_method}).then(function(n){var r=angular.extend({token:n},e.card,e.credit_card,t),o=e.getDataToCreateCard(r);return i(e.create_route,o)}).then(function(){e.$emit(n.createSuccess)}).catch(function(t){t&&(t=t.errors||t,e.$emit(n.createError,t))})},executePostRequest:i,executeGetRequest:a};function i(e,n){return t.post(e,n)}function a(e,n){return t.get(e,n)}}];t.exports=r},{}],4:[function(e,t,n){"use strict";var r=e("../common/config").name,o=e("../common/config").id,i=e("../../../common/config").prefixes.CHECKOUT,a=e("../common").getInstanceName,c=e("../common/addCardBaseComponent"),s=["$injector","checkout","ppCreditCardActionsService","lang","$q","tpHTTP","ccFieldsService","viewService","billingConfig","checkoutGoTo",function(e,t,n,s,u,l,d,p,f,m){return{restrict:"E",require:"^view",transclude:!0,templateUrl:"/frontend/providers/components/".concat(r,"/checkout/component.shtml"),scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","$timeout","errorService","ngEventService","paymentProvider","iframeService",function(l,h,g,v,y,C){c.apply(l,[u,e,d,n,s]),angular.extend(l,BaseComponentController),l.LANG_CONTEXT="checkout.platform",l.cardService=e.get(a("CardService",i)),l.providerName=r,l.PAYMENT_PROVIDER_ID=o;var E,S,T=e.get("eventsService"+i).events,_={};function w(){t.setUpiId(l.cc.selectedUpiId),t.getUpiId()&&t.input.credit_card.taxRequest&&f.updateFromTaxRequest(t,t.input.credit_card.taxRequest)}function b(){return!t.isPaymentMethod(o)||t.isMockUsed()||!0===toBoolean(l.skipValidation)}function P(e){if(e)if(g(l).reset(),Array.isArray(e))for(var t=0;t<e.length;t++){var n=e[t].msg||e[t].message;n&&""!==n.trim()&&g(l).global(n)}else g(l).global(e.msg||e.message)}l.customActionOnCompletePurchase=function(){return l.isFieldsValid().then(function(e){return e||u.reject({isCheckConsentsError:!0})})},l.$on(T.initiateSucceed,function(e,t){void 0!==t.stored&&(l.cc.stored=JSON.parse(t.stored)),l.cc.storedRurl=t.stored_rurl,l.cc.selectedUpiId=void 0!==l.cc.stored&&l.cc.stored.length>0?l.cc.stored[0].id:null,l.cc.initiateTransactionUrl=t.initiateTransactionUrl,l.cc.payWithNew=void 0===l.cc.stored||0===l.cc.stored.length||l.cc.payWithNew&&l.cc.initiated,l.cc.initiated=!0,w(),l.initStripeElements(t.publishableAPIKey),h(function(){l.$apply()})}),l.$on(T.initiateFailed,function(e,t){P(t)}),l.$on(T.beforeProcess,function(e,n){l.cc.payWithNew?(t.input.storeInVault=l.credit_card.store_in_vault,t.setUpiId(null),t.input.defaultPaymentMethodId=l.credit_card.store_in_vault&&l.credit_card.needToApplyDefaultPaymentMethod,l.createPaymentMethod().then(function(e){if(e.error){var r=l.parseStripeError(e.error);n.reject(r)}else t.input.instrumentId=e.paymentMethod.id,n.resolve(["instrumentId"])}).catch(function(e){n.reject(e)})):n.resolve()}),l.$on(T.processSucceed,function(e,n,r){E=r,l.cardService.processTransaction(l.cc,n,t.input.instrumentId,t.input.storeInVault).then(function(e){return S=e.rurl,e.result.models.paymentIntentClientSecret?l.retrievePaymentIntent(e.result.models.paymentIntentClientSecret):null},function(e){var t=e.errors;return u.reject(t)}).then(function(e){if(null===e)return l.cardService.processPurchase(S),void E.resolve();if(e.error){var n=l.parseStripeError(e.error);return u.reject([n])}var r=e.paymentIntent;if("requires_action"!==r.status&&"requires_source_action"!==r.status)return l.cardService.processPurchase(S),void E.resolve();var o=r.next_action||r.next_source_action;if("redirect_to_url"!==o.type&&"authorize_with_url"!==o.type){var i=r.client_secret;return l.handleCardAction(i).then(function(e){if(e.error){var t=l.parseStripeError(e.error);return u.reject([t])}l.cardService.processPurchase(S),E.resolve()})}var a=o.redirect_to_url||o.authorize_with_url;l.bankSecureUrl=a.url,_.callbackOnInit=function(e){document.getElementById(e.loaderWrapperId).style.display="none",C.injectIframe(e.iframeId,l.bankSecureUrl,angular.element("#bank-secure-container"))},m.goToBankSecureState(t),v.fire("INIT_BANK_SECURE",l.bankSecureUrl)}).catch(function(e){P(e),E.reject()})}),l.$on("stripe-authentication-complete",function(e,n){t.disableCheckout(),l.retrievePaymentIntent(n.paymentIntentClientSecret).then(function(e){if(e.error){var t=l.parseStripeError(e.error);return u.reject(t)}var n=e.paymentIntent;if("requires_payment_method"===n.status||"requires_source"===n.status){var r=l.parseStripeError(n.last_payment_error);return u.reject(r)}return"requires_confirmation"===n.status?(l.cardService.processPurchase(S),p.gotoPreviousState(),void E.resolve()):u.reject({msg:s.trc("checkout.platform","Unhandled payment status")})}).catch(function(e){t.enabledCheckout(),p.gotoPaymentStateFromBankSecureState(),E.reject(),P(e)})}),l.$on("BANK_SECURE_COMPONENT_INIT_SUCCESS",function(){v.fire("INIT_BANK_SECURE",l.bankSecureUrl)}),l.$on(T.completeFailed,function(e,t){P(t)}),l.$on(T.previewTermComplete,function(){t._completeTerm({q:"q"})}),l.$watch("cc.selectedUpiId",function(){w()}),_.goBackToPreviousState=function(){E&&E.reject(),p.gotoPreviousState()},l._isValid=function(){return!0},l.onValidationStart=function(){return b()||!l.cc.payWithNew},l.collectErrors=function(){return b()?[]:l.cc.payWithNew||l.cc.selectedUpiId?[]:[{name:"selectedUpiId",msg:s.trc("checkout.platform","Please select one of your cards or add new one")}]},l.onValidationEnd=function(e){return P(e),e},propagatePaymentVars(t,l),y.setInstance(_),l.cc={},l.cc.payWithNew=!0,l.cc.selectedUpiId=null,l.cc.initiated=!1,l.credit_card=d.getTemplatesScope().credit_card,l.credit_card.store_in_vault=!0,l.credit_card.needToApplyDefaultPaymentMethod=!1}]}}];t.exports=s},{"../../../common/config":1,"../common":10,"../common/addCardBaseComponent":7,"../common/config":9}],5:[function(e,t,n){"use strict";var r=e("../common/module"),o=e("../../../common/config").prefixes.CHECKOUT,i=e("../common").getInstanceName,a=e("./service"),c=e("../cardService"),s=e("./component"),u=angular.module(i("Module",o),["checkoutModule",r.name]).factory(i("CardService",o),c).factory(i("Provider",o),a).directive(i("Component",o),s);t.exports=u},{"../../../common/config":1,"../cardService":3,"../common":10,"../common/module":11,"./component":4,"./service":6}],6:[function(e,t,n){"use strict";var r=e("../../../common/config").prefixes.CHECKOUT,o=["$rootScope","$injector","$q",function(e,t,n){var o=t.get("eventsService"+r).events;return{beforeInitiate:function(){},initiateSucceed:function(t){e.$broadcast(o.initiateSucceed,t)},initiateFailed:function(t){e.$broadcast(o.initiateFailed,t)},beforeProcess:function(){var t=n.defer();return e.$broadcast(o.beforeProcess,t),t.promise},processSucceed:function(t){var r=n.defer();return e.$broadcast(o.processSucceed,t,r),r.promise},processFailed:function(t){e.$broadcast(o.processFailed,t)},confirmed:function(t){e.$broadcast(o.confirmed,t)},declined:function(t){e.$broadcast(o.declined,t)},completeSucceed:function(t){e.$broadcast(o.completeSucceed,t)},completeFailed:function(t){e.$broadcast(o.completeFailed,t)}}}];t.exports=o},{"../../../common/config":1}],7:[function(e,t,n){"use strict";var r=e("./config").name;t.exports=function(e,t,n,o,i){var a,c=this;this.providerName=r,this.credit_card=n.getTemplatesScope().credit_card;var s={},u=!1,l=function(){var e=Object.keys(s).map(function(e){return s[e].state});c.onElementChange(e)};function d(){return s.cardNumber.element}this.isFieldsValid=function(){return c.$emit(o.validationStart),e.when(c.onValidationStart()).then(function(t){return e.when(c.collectErrors()).then(function(e){return e.length>0?e:t?[]:a.createToken(d()).then(function(e){return e.error?[c.parseStripeError(e.error)]:[]}).catch(function(e){return e})})}).then(function(t){return t&&!Array.isArray(t)&&(t=[t]),c.$emit(o.validationEnd,t),e.when(c.onValidationEnd(t)).then(function(){return!t.length})})},this.onValidationStart=function(){return e.when(!1)},this.collectErrors=function(){return e.when([])},this.onValidationEnd=function(e){return e},this.parseStripeError=function(e,t){var n=function(e,t){return t&&"checkout.platform"!==t?function(e){switch(e.code){case"incomplete_number":return i.trc("publisher.dashboard","Card number is incomplete");case"incomplete_expiry":return i.trc("publisher.dashboard","Card's expiration date is incomplete");case"invalid_expiry_year_past":return i.trc("publisher.dashboard","Card's expiration year is in the past");case"incomplete_cvc":return i.trc("publisher.dashboard","Card's security code is incomplete");case"incomplete_zip":return i.trc("publisher.dashboard","Your postal code is incomplete");case"payment_intent_authentication_failure":return i.trc("publisher.dashboard","Unable to authenticate your payment method. Try a different payment method");case"setup_intent_authentication_failure":return i.trc("publisher.dashboard","The latest attempt to set up the payment method has failed because authentication failed");default:return e.message}}(e):function(e){switch(e.code){case"incomplete_number":return i.trc("checkout.platform","Your card number is incomplete");case"incomplete_expiry":return i.trc("checkout.platform","Your card's expiration date is incomplete");case"invalid_expiry_year_past":return i.trc("checkout.platform","Your card's expiration year is in the past");case"incomplete_cvc":return i.trc("checkout.platform","Your card's security code is incomplete");case"incomplete_zip":return i.trc("checkout.platform","Your postal code is incomplete");case"payment_intent_authentication_failure":return i.trc("checkout.platform","We are unable to authenticate your payment method. Please choose a different payment method and try again");case"setup_intent_authentication_failure":return i.trc("checkout.platform","The latest attempt to set up the payment method has failed because authentication failed");default:return e.message}}(e)}(e,t||c.LANG_CONTEXT);return{name:e.code,msg:n,message:n}},this.getDataToCreateCard=function(){return{}},this.initStripeElements=function(e){if(!u){a=Stripe(e);var t=function(){var e=document.getElementById("stripe-input-style"),t={};if(e){var n=e.innerText;try{t=JSON.parse(n)}catch(e){console.error(e)}}return t.elements=t.elements||{},t.elements.locale=t.elements.locale||i.getLanguageTag(),t.cardNumber=t.cardNumber||{},t.cardCvc=t.cardCvc||{},t.cardExpiry=t.cardExpiry||{},t.postalCode=t.postalCode||{},t}(),n=a.elements(t.elements);["cardNumber","cardExpiry","cardCvc","postalCode"].forEach(function(e){t[e].placeholder=i.trc(c.LANG_CONTEXT,t[e].placeholder);var r=n.create(e,t[e]),o="#stripe-".concat(e.replace(/[A-Z]/g,function(e){return"-".concat(e.toLowerCase())}),"-element");r.mount(o),s[e]={element:r,state:{}},r.on("change",function(t){var n=t.empty,r=t.error;s[e].state={empty:n,error:r?c.parseStripeError(r):null},l()}),r.on("blur",function(){l()})}),u=!0}},this.onElementChange=function(){},this.createPaymentMethod=function(){return a.createPaymentMethod("card",d())},this.retrievePaymentIntent=function(e){return a.retrievePaymentIntent(e)},this.handleCardAction=function(e){return a.handleCardAction(e)},this.handleCardSetup=function(e){return a.handleCardSetup(e,d())}}},{"./config":9}],8:[function(e,t,n){"use strict";var r=e("./config").name;t.exports=function(){return{restrict:"E",require:"ngModel",templateUrl:"/frontend/providers/components/".concat(r,"/common/baseTemplate.shtml"),scope:{credit_card:"=creditCard",readonly:"=readonly",callbackOnFormInit:"=?callbackOnFormInit"}}}},{"./config":9}],9:[function(e,t,n){"use strict";var r=e("../../../common/config"),o={id:40};o.name=r.providers[o.id].name,t.exports=o},{"../../../common/config":1}],10:[function(e,t,n){"use strict";var r=e("./config");t.exports={getInstanceName:function(e,t){var n=r.name+e;return t&&(n+=t),n}}},{"./config":9}],11:[function(e,t,n){"use strict";var r=e("./").getInstanceName,o=e("../../../common/creditCardComponentsModule"),i=e("./baseInputsComponent"),a=angular.module(r("CommonModule"),[o.name]).directive(r("BaseInputsComponent"),i);t.exports=a},{"../../../common/creditCardComponentsModule":2,"./":10,"./baseInputsComponent":8}]},{},[5]),function(){return function e(t,n,r){function o(a,c){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!c&&s)return s(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){return o(t[a][1][e]||e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}}()({1:[function(e,t,n){"use strict";var r=e("./config").providers;t.exports={getModulesFor:function(e){var t=[];for(var n in r){var o=r[n].name+"Module"+e;t.push(o)}return t},dynamicBaseInputsComponent:["$compile",function(e){return{restrict:"E",link:function(t,n){n.html("<"+t.name+'-base-inputs-component credit-card="creditCard" readonly="readonly" callback-on-form-init="callbackOnFormInit"><'+t.name+"-base-inputs-component/>").show(),e(n.contents())(t)},scope:{name:"=",creditCard:"=",callbackOnFormInit:"=?"}}}],ppCreditCardActionsService:function(){return{loaded:"PP_CARD_LOADED",init:"PP_CARD_INITIALIZE",initSuccess:"INIT_PP_CARD_SUCCESS",initError:"INIT_PP_CARD_ERROR",create:"CREATE_PP_CARD",createSuccess:"CREATE_PP_CARD_SUCCESS",createError:"CREATE_PP_CARD_ERROR",validationStart:"PP_CARD_VALIDATION_START",validationEnd:"PP_CARD_VALIDATION_END",isValid:"CREDIT_CARD_FORM_IS_VALID",isNotValid:"CREDIT_CARD_FORM_IS_NOT_VALID"}},providersService:function(e,t,n){return{getProviderInstanceById:function(t){return e.get(this._getProviderInstanceNameById(t))},checkProviderInstanceById:function(n){var r=!0;return t.getNewFlowProviders()[n]&&e.has(this._getProviderInstanceNameById(n))||(r=!1),r},_getProviderInstanceNameById:function(e){return t.getNewFlowProviders()[e].name+"Provider"+n},hasNewFlow:function(e){var n=t.getNewFlowProviders()[e];return n&&n.name}}},getNewFlowComponents:function(e,t,n){var r=e.getNewFlowProviders(),o=t,i="";for(var a in t=t.toLowerCase().split("").join("-"),r){var c=r[a].name,s=n?c+o+" cc-detailed":"";i+="<".concat(c,"-component-").concat(t,'\n \t\t\t\t\t\tclass="').concat(s,'" \n \t\t\t\t\t\treadonly="readonly"\n \t\t\t\t\t\tpayment-provider="paymentProvider"\n            card="card"\n            term-id="{{termId}}"\n            ng-if="paymentSource == ').concat(a,'">\n\t\t\t\t\t</').concat(c,"-component-").concat(t,">")}return{restrict:"E",scope:{paymentProvider:"=paymentProvider",card:"=card",paymentSource:"=paymentSource",readonly:"=readonly",termId:"@?"},template:i}}}},{"./config":2}],2:[function(e,t,n){"use strict";t.exports={prefixes:{CONSUMER_DASHBOARD:"CD",PUBLISHER_DASHBOARD:"PD",CHECKOUT:"CH",APPLY_TERM_WIZARD:"ATW",MY_ACCOUNT:"MA"},providers:{19:{name:"edgil"},37:{name:"onet"},38:{name:"applepayss"},39:{name:"cybersource"},40:{name:"stripe"},41:{name:"applepaystripe"},42:{name:"applepayway"},45:{name:"wirecard"},50:{name:"gocardlessdd"}}}},{}],3:[function(e,t,n){"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var o=angular.module("creditCardComponentsModule",[]),i=e("./config");o.service("ccFieldsService",function(){return{getBaseCreditCardFields:function(){return{value:"",disabled:!1,required:!1,readonly:!1,onChangeCallback:angular.noop,maxlength:null,valid:!0,showLabel:!1}},getBaseCcComponentScope:function(){return{text:"=ngModel",onChange:"=onChange",disabled:"=ngDisabled",required:"=ngRequired",readonly:"=ngReadonly",maxlength:"=maxlength",className:"=?className",name:"=name",valid:"=valid"}},getBaseCcInputDirectiveParams:function(e){return{restrict:"E",require:"ngModel",templateUrl:e,scope:this.getBaseCcComponentScope()}},getTemplatesScope:function(){return{credit_card:{num:this.getBaseCreditCardFields(),expire:this.getBaseCreditCardFields(),cvv:this.getBaseCreditCardFields(),postal_code:this.getBaseCreditCardFields()}}},getExpireValueSplitted:function(e){var t={month:"",year:""};if(e){var n=r(e.split("/"),2),o=n[0],i=n[1];void 0!==o&&(o=o.trim()),void 0!==i&&(i=i.trim()),t={month:o,year:i}}return t},getFormattedMonth:function(e){return("0"+e).slice(-2)},getFormattedYear:function(e){return e.toString().slice(-2)},getFullyFormattedYear:function(e){return("20"+e).slice(-4)},getNewFlowProviders:function(){return i.providers},detectCardType:function(e){for(var t=this.getUnknownCardType(),n={shortName:"v",longName:"Visa"},r=[{type:n,rname:"electron",rgxp:/^(4026|417500|4405|4508|4844|4913|4917)\d+$/},{type:t,rname:"maestro",rgxp:/^(5018|5020|5038|5612|5893|6304|6759|6761|6762|6763|0604|6390)\d+$/},{type:t,rname:"dankort",rgxp:/^(5019)\d+$/},{type:t,rname:"interpayment",rgxp:/^(636)\d+$/},{type:t,rname:"unionpay",rgxp:/^(62|88)\d+$/},{type:n,rname:"visa",rgxp:/^4[0-9]{12}(?:[0-9]{3})?$/},{type:{shortName:"mc",longName:"MasterCard"},rname:"mastercard",rgxp:/^5[1-5][0-9]{2}|(222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)[0-9]{12}$/},{type:{shortName:"amex",longName:"American Express"},rname:"amex",rgxp:/^3[47][0-9]{13}$/},{type:{shortName:"dci",longName:"Diners Club"},rname:"diners",rgxp:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/},{type:{shortName:"d",longName:"Discover"},rname:"discover",rgxp:/^6(?:011|5[0-9]{2})[0-9]{12}$/},{type:t,rname:"jcb",rgxp:/^(?:2131|1800|35\d{3})\d{11}$/}],o=0;o<r.length;o++){var i=r[o];if(i.rgxp.test(e))return i.type}return t},getUnknownCardType:function(){return{shortName:"card",longName:"Credit card"}},getCardType:function(e){return{type:{shortName:{"American Express":"amex",Visa:"v",MasterCard:"mc"}[e],longName:e}}}}}),o.service("ccValidationService",["ccFieldsService","lang",function(e,t){return{collectCCErrors:function(e,t){var n=this.getEmptyFieldsErrors(e,t);return n.length?n:this.getSpecificFieldsErrors(e,t)},getEmptyFieldsErrors:function(e,t){return(t=t||this.baseFields).reduce(function(t,n){return e[n.name].value||e[n.name].disabled||t.push({name:n.name,msg:n.msg}),t},[])},getSpecificFieldsErrors:function(e){return[this.getCCNumberError(e.num),this.getExpireError(e.expire),this.getCVVError(e)].filter(function(e){return e})},getCCNumberError:function(e){var n;return this.ccLuhnCheck(e.value)||(n={name:"num",msg:t.tr("Invalid credit card number")}),n},getExpireError:function(n){var r,o=e.getExpireValueSplitted(n.value);return this.ccExpireDateValidate(o.month,o.year)||(r={name:"expire",msg:t.tr("Invalid expiration date")}),r},getCVVError:function(e){if(!this.cvvValidate(e.num.value,e.cvv.value))return{name:"cvv",msg:t.tr("Your CVV must be 4 digits for American Express or 3 digits for other cards")}},cvvValidate:function(t,n){var r=t.replace(/\D/g,""),o=n.replace(/\D/g,"");if("amex"===e.detectCardType(r).shortName){if(/^\d{4}$/.test(o))return!0}else if(/^\d{3}$/.test(o))return!0;return!1},ccExpireDateValidate:function(e,t){if(!e||!t)return!1;var n=parseInt(e,10),r=parseInt(t,10);if(n<1||n>12)return!1;if(r<0)return!1;r<100&&(r+=2e3);var o=new Date;o.setDate(1),o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0);var i=new Date;return i.setDate(1),i.setMonth(n-1),i.setYear(r),i.setHours(0),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0),o.getTime()<=i.getTime()},ccLuhnCheck:function(e){if(!e.match(/^\d+$/))return!1;for(var t=e.length,n=1&t,r=0,o=0;o<t;o++){var i=parseInt(e.charAt(o));1&o^n||(i*=2)>9&&(i-=9),r+=i}return r%10==0},baseFields:[{name:"num",msg:t.tr("Card number is required")},{name:"expire",msg:t.tr("Expiration date is required")},{name:"cvv",msg:t.tr("CVV is required")},{name:"postal_code",msg:t.tr("Postal code is required")}]}}]),o.directive("formatExpiryDate",function(){var e,t,n,r,o,i,a,c,s,u;return i=function(e){var t;return null!=e.prop("selectionStart")&&e.prop("selectionStart")!==e.prop("selectionEnd")||!(null==("undefined"!=typeof document&&null!==document&&null!=(t=document.selection)?t.createRange:void 0)||!document.selection.createRange().text)},s=function(e){var t;return!(!e.metaKey&&!e.ctrlKey)||32!==e.which&&(0===e.which||(e.which<33||(t=String.fromCharCode(e.which),!!/[\d\s]/.test(t))))},c=function(e){var t,n;if(t=$(e.currentTarget),n=String.fromCharCode(e.which),/^\d+$/.test(n)&&!i(t))return!((t.val()+n).replace(/\D/g,"").length>u+2)&&void 0},n=function(e){var t,n,r;if(n=String.fromCharCode(e.which),/^\d+$/.test(n))return t=$(e.currentTarget),r=t.val()+n,/^\d$/.test(r)&&"0"!==r&&"1"!==r?(e.preventDefault(),setTimeout(function(){return t.val("0"+r+" / ")})):/^\d\d$/.test(r)?(e.preventDefault(),setTimeout(function(){return t.val(r+" / ")})):void 0},a=function(t){return setTimeout(function(){var n,r;return r=(n=$(t.currentTarget)).val(),r=e(r),n.val(r)})},e=function(e){var t,n,r,o,i=new RegExp("^\\D*(\\d{1,2})(\\D+)?(\\d{1,"+u+"})?");return(n=e.match(i))?(t=n[1]||"",r=n[2]||"",(o=n[3]||"").length>0?r=" / ":" /"===r?(t=t.substring(0,1),r=""):2===t.length||r.length>0?r=" / ":1===t.length&&"0"!==t&&"1"!==t&&(t="0"+t,r=" / "),t+r+o):""},o=function(e){var t,n,r;if("/"===(r=String.fromCharCode(e.which))||" "===r)return n=(t=$(e.currentTarget)).val(),/^\d$/.test(n)&&"0"!==n?t.val("0"+n+" / "):void 0},r=function(e){var t,n,r;if(n=String.fromCharCode(e.which),/^\d+$/.test(n))return r=(t=$(e.currentTarget)).val(),/^\d\d$/.test(r)?t.val(r+" / "):void 0},t=function(e){var t,n;if(t=$(e.currentTarget),n=t.val(),8===e.which&&(null==t.prop("selectionStart")||t.prop("selectionStart")===n.length))return/\d\s\/\s$/.test(n)?(e.preventDefault(),setTimeout(function(){return t.val(n.replace(/\d\s\/\s$/,""))})):void 0},{scope:{formatYear:"=?formatYear"},restrict:"A",link:function(e,i){u=e.formatYear||2,i.on("keypress",s),i.on("keypress",c),i.on("keypress",n),i.on("keypress",o),i.on("keypress",r),i.on("keydown",t),i.on("change",a),i.on("input",a)}}}),o.directive("ccTextInput",function(){return{restrict:"E",require:"ngModel",templateUrl:"/frontend/providers/common/credit-card-text-input.html",scope:{text:"=ngModel",placeholder:"=placeholder",icon:"=icon",name:"=name",maxlength:"=maxlength",readonly:"=ngReadonly",required:"=ngRequired",disabled:"=ngDisabled",iconClass:"=iconClass",iconWidth:"=iconWidth",className:"=className",borderBottom:"=borderBottom",autocomplete:"=autocomplete",onChange:"=onChange",valid:"=valid"},controller:["$scope",function(e){e.getIconClass=function(){var t="";return e.readonly&&(t+="".concat("cc-field__icon--","readonly ")),e.text&&(t+="".concat("cc-field__icon--","highlighted ")),e.iconClass?t+="".concat(e.iconClass," "):t+="".concat("cc-field__icon--").concat(e.icon," "),t},e.getFieldClass=function(){var t="";return e.name&&(t+="".concat("cc-field--").concat(e.name," ")),e.valid||(t+="".concat("cc-field--","not-valid")),t}}]}}),o.directive("creditCardCvv",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-cvv.html")}]),o.directive("creditCardPostalCode",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-postal-code.html")}]),o.directive("creditCardNumber",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-number.html")}]),o.directive("creditCardHolder",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-holder.html")}]),o.directive("ccExpireComponent",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-expire.html")}]),t.exports=o},{"./config":2}],4:[function(e,t,n){"use strict";var r=["$q","tpHTTP","$rootElement","iframeService","ccFieldsService","lang",function(e,t,n,r,o,i){var a=!1;return{seamlessRender:function(e,t,n){WPP?WPP.seamlessRender({url:e,wrappingDivId:"seamless-form-target",onSuccess:t,onError:n}):console.error("WPP is not initialized.")},processCC:function(e){r.injectHiddenIframe("wirecard-provider-form-component-iframe",e.url)},injectWPP:function(e,t){if(!0!==a){var n=document.createElement("script"),r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(n,r),n.type="text/javascript",n.async=!0,n.onload=t,n.src=e,a=!0}else t&&t()},parseWPPResponse:function(e){var t=e["response-base64"],n=JSON.parse(atob(t)).payment,r=n["transaction-id"],o=n["card-token"],i=o["token-id"],a="",c=n["account-holder"];c&&c.address&&(a=c.address["postal-code"]);var s=n.card;return{transactionId:r,tokenId:i,creditCardInfo:{maskedPan:o["masked-account-number"],expMonth:s["expiration-month"],expYear:s["expiration-year"],cardType:s["card-type"]},cardZipCode:a}},getFullIframeReference:function(){for(var e="",t=document.location.ancestorOrigins,n=0;n<t.length;n++)e+=t[n]+" ";return e+=document.location.origin}}}];t.exports=r},{}],5:[function(e,t,n){"use strict";var r=e("../common/config").name,o=e("../common/config").id,i=e("../../../common/config").prefixes.CHECKOUT,a=e("../common").getInstanceName,c=e("../common/addCardBaseComponent"),s=["checkout","$rootElement","errorService","lang","ccFieldsService","$injector","ccValidationService","ppCreditCardActionsService","$q","tpHTTP",function(e,t,n,s,u,l,d,p,f,m){return{restrict:"E",require:"^view",transclude:!0,templateUrl:"/frontend/providers/components/"+r+"/checkout/component.shtml",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","errorService","$timeout","ngEventService",function(t,n,s,h){c.apply(t,[f,l,m,u,d,p]),t.cardService=l.get(a("CardService",i));var g=l.get("eventsService"+i),v=g.events;t.providerName=r,t.PAYMENT_PROVIDER_ID=o,t.customValidation=!0,angular.extend(t,BaseComponentController);var y=function(){t.cc={},t.cc.payWithNew=!0,t.cc.selectedUpiId=null,t.cc.defaultPaymentMethodId=null,t.cc.initiated=!1,t.credit_card=u.getTemplatesScope().credit_card,t.credit_card.store_in_vault=!0};function C(e){if(e)if(Array.isArray(e))for(var r=0;r<e.length;r++){var o=e[r].msg||e[r].message;o&&""!==o.trim()&&n(t).global(o)}else n(t).global(e.message);else console.warn("Errors are empty")}t.getCurrentCreditCardInfo=function(){var n=u.getExpireValueSplitted(t.credit_card.expire.value),r=n.month,o=n.year;if(t.cc.payWithNew)return{};if(t.cc.selectedUpiId)for(var i=0;i<t.cc.stored.length;i++){var a=t.cc.stored[i];if(a.id===t.cc.selectedUpiId)return{cardType:a.type,ending:a.ending_in,expireMonth:a.expire_month,expireYear:a.expire_year,taxRequest:e.billingConfig.taxRequestFromUpi(a)}}return{cardType:t.unknowCardType.longName,ending:t.credit_card.num.value?t.credit_card.num.value.slice(-4):"",expireMonth:r,expireYear:o}},t.$on(v.previewTermComplete,function(){e._completeTerm({q:"q"})}),t.$on(v.beforeInitiate,function(e,t){}),t.$on(v.initiateSucceed,function(n,r){if(r.mockEnabled)return e.wirecardMockEnabled=!0,void C([{msg:"Wirecard is not available for preview"}]);void 0!==r.stored&&(t.cc.stored=JSON.parse(r.stored)),t.paymentPageScriptUrl=r.paymentPageScriptUrl,t.WC_PAYMENT_TOKEN_URL=r.paymentRedirectUrl,t.cc.storedRurl=r.stored_rurl,t.cc.payWithNew=void 0===t.cc.stored||0===t.cc.stored.length||t.cc.payWithNew&&t.cc.initiated,t.cc.selectedUpiId=void 0!==t.cc.stored&&t.cc.stored.length>0?t.cc.stored[0].id:null,t.cc.initiated=!0,t.WIRECARD_REGISTER_PAYMENT_ROUTE=r.paymentTokenActionUrl,t.cc.payWithNew?t.cardService.injectWPP(r.paymentPageScriptUrl,t.refreshWirecardIframe):t.$watch("cc.payWithNew",function(e){e&&t.cardService.injectWPP(r.paymentPageScriptUrl,t.refreshWirecardIframe)}),s(function(){t.$apply()})}),t.WPPFormSubmited=!0,t.refreshWirecardIframe=function(n){if((t.WPPFormSubmited||n.forceRefresh)&&t.cc.payWithNew){var r=t.cardService.getFullIframeReference();m.post(t.WIRECARD_REGISTER_PAYMENT_ROUTE,{frameOrigins:r,pageUrl:window.urlParams.url,countryCode:e.getBillingCountryCode(),residenceCountryCode:e.getResidenceCountryCode(),billingZipCode:e.getBillingZipCode(),zipCode:e.input.zipCode}).then(function(e){t.cardService.seamlessRender(e.models.paymentRedirectUrl,function(){t.WPPFormSubmited=!1},function(e){console.error(e)})}).catch(function(e){t.onError(e.errors)})}},t.$on(v.initiateFailed,function(t,n){e.enabledCheckout(),C(n)}),t.$on(v.beforeProcess,function(){e.input.storeInVault=t.credit_card.store_in_vault,e.input.defaultPaymentMethodId=t.credit_card.store_in_vault&&t.cc.defaultPaymentMethodId,e.input.credit_card=t.getCurrentCreditCardInfo(),t.cc.payWithNew&&(t.cc.selectedUpiId=null,e.input.upiId=null)}),t.$on(v.processSucceed,function(n,r){e.disableCheckout(),(r=angular.extend({},r,t.cc)).aid=e.getAid(),r.payWithNew?t.$broadcast(p.create,r):t.$broadcast(p.createSuccess,r)}),t.$on(v.processFailed,function(e,t){}),t.$on(v.declined,function(){e.enabledCheckout()}),t.$on(v.completeSucceed,function(){}),t.$on(v.completeFailed,function(e,t){window.clearTimeout(g.iframeHungTimeout),C(t)}),t.$on(p.createSuccess,function(e,n){var r;if(n.payWithNew){var o=t.cardService.parseWPPResponse(n.wirecardResponse);r=n.rurl+"&token="+o.tokenId+"&transactionId="+o.transactionId+"&upi="+encodeURIComponent(JSON.stringify(o.creditCardInfo))}else r=n.storedRurl+"&id="+n.selectedUpiId;return t.cardService.processCC({url:r})}),t.$on(p.createError,function(t,n){h.fire("PURCHASE_FAILED"),e.enabledCheckout(),C(n)}),t.$watch("cc.selectedUpiId",function(){e.input.credit_card=t.getCurrentCreditCardInfo(),e.input.upiId=t.cc.selectedUpiId,e.input.upiId&&e.input.credit_card.taxRequest&&e.billingConfig.updateFromTaxRequest(e.input.credit_card.taxRequest)}),h.subscribe(EVENT_CHECKOUT_STARTED,function(){y()}),h.subscribe("PAYMENT_BILLING_PLAN_TABLE_IS_UPDATED",function(){console.info("Refreshing Wirecard iFrame"),t.refreshWirecardIframe({forceRefresh:!0})}),y(),window.addEventListener("message",function(t){var n=JSON.parse(t.data);if("wdPostMessage_integratedPaymentPagesSubmitErrorResp"===n.type){if(n.payload&&Array.isArray(n.payload.errors))return void C(n.payload.errors.map(function(e){return{msg:e.error.description}}));try{for(var r=atob(n.payload["response-base64"]),o=JSON.parse(r).payment.statuses.status,i=[],a=0;a<o.length;a++){var c=o[a];c.code.startsWith(20)||i.push({message:c.description})}window.clearTimeout(g.iframeHungTimeout),e.enabledCheckout(),C(i)}catch(e){}}})}]}}];t.exports=s},{"../../../common/config":2,"../common":11,"../common/addCardBaseComponent":8,"../common/config":10}],6:[function(e,t,n){"use strict";var r=e("../common/module"),o=e("../../../common/config").prefixes.CHECKOUT,i=e("../common").getInstanceName,a=e("./component"),c=e("./service"),s=e("../cardService"),u=angular.module(i("Module",o),["checkoutModule",r.name]).factory(i("CardService",o),s).factory(i("Provider",o),c).directive(i("Component",o),a);t.exports=u},{"../../../common/config":2,"../cardService":4,"../common":11,"../common/module":12,"./component":5,"./service":7}],7:[function(e,t,n){"use strict";var r=e("../../../common/config").prefixes.CHECKOUT,o=["$rootScope","$injector","$q",function(e,t,n){var o=t.get("eventsService"+r).events;return{beforeInitiate:function(t){e.$broadcast(o.beforeInitiate,t)},initiateSucceed:function(t){e.$broadcast(o.initiateSucceed,t)},initiateFailed:function(t){e.$broadcast(o.initiateFailed,t)},beforeProcess:function(t){var r=n.defer();return t.wirecardMockEnabled?r.reject({message:"Wirecard is not available for preview"}):(r.resolve({}),e.$broadcast(o.beforeProcess)),r.promise},processSucceed:function(t){e.$broadcast(o.processSucceed,t)},processFailed:function(t){e.$broadcast(o.processFailed,t)},confirmed:function(t){e.$broadcast(o.confirmed,t)},declined:function(t){e.$broadcast(o.declined,t)},completeSucceed:function(t){e.$broadcast(o.completeSucceed,t)},completeFailed:function(t){e.$broadcast(o.completeFailed,t)}}}];t.exports=o},{"../../../common/config":2}],8:[function(e,t,n){"use strict";var r=e("./config").name;t.exports=function(e,t,n,o,i,a,c){var s=this;this.providerName=r,this.credit_card=o.getTemplatesScope().credit_card,this.customValidation=!0,this.$watch("readonly",function(){s.initCardAttributes()}),this.$on(a.loaded,function(e,t){s.initCardData(t)}),this.create=function(e){return(e.payWithNew?s.createNewCard:s.updateCard)(e)},this.$on(a.create,function(e,t){s.create(t).then(s.onSuccess,s.onError)}),this.onSuccess=function(e){s.$emit(a.createSuccess,e)},this.onError=function(e){s.$emit(a.createError,e)},this.createUpdateCardMock=function(t){var n=e.defer();return n.resolve(t),n.promise},this.WPPFormSubmited=!1,this.createNewCard=function(t){var n=e.defer();return WPP.seamlessSubmit({onSuccess:function(e){t.wirecardResponse=e,this.WPPFormSubmited=!0,n.resolve(t)},onError:function(e){n.reject(s.tryExtractErrors(e))}}),n.promise},this.tryExtractErrors=function(e){return e&&Array.isArray(e.errors)?e.errors.map(function(e){return{msg:e.error.description}}):(console.warn(e),[{msg:"Can't parse unknown Wirecard error. See console for details."}])},this.updateCard=function(e){return s.createUpdateCardMock(e)},this.initCardAttributes=function(){this.credit_card.num.readonly=this.readonly,this.credit_card.cvv.readonly=this.readonly,this.credit_card.postal_code.readonly=this.readonly,this.credit_card.expire.readonly=this.readonly}}},{"./config":10}],9:[function(e,t,n){"use strict";var r=e("./config").name;t.exports=function(){return{restrict:"E",require:"ngModel",templateUrl:"/frontend/providers/components/"+r+"/common/baseTemplate.shtml",scope:{credit_card:"=creditCard",readonly:"=readonly"}}}},{"./config":10}],10:[function(e,t,n){"use strict";var r=e("../../../common/config"),o={id:45};o.name=r.providers[o.id].name,t.exports=o},{"../../../common/config":2}],11:[function(e,t,n){"use strict";var r=e("./config");t.exports={getInstanceName:function(e,t){var n=r.name+e;return t&&(n+=t),n}}},{"./config":10}],12:[function(e,t,n){"use strict";var r=e("./baseInputsComponent"),o=e("../../../common/creditCardComponentsModule"),i=e("./").getInstanceName,a=(e("../../../common/common").dynamicBaseInputsComponent,angular.module(i("CommonModule"),[o.name]).directive(i("BaseInputsComponent"),r));t.exports=a},{"../../../common/common":1,"../../../common/creditCardComponentsModule":3,"./":11,"./baseInputsComponent":9}]},{},[6]),function(){return function e(t,n,r){function o(a,c){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!c&&s)return s(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){return o(t[a][1][e]||e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}}()({1:[function(e,t,n){"use strict";var r=e("./config").providers;t.exports={getModulesFor:function(e){var t=[];for(var n in r){var o=r[n].name+"Module"+e;t.push(o)}return t},dynamicBaseInputsComponent:["$compile",function(e){return{restrict:"E",link:function(t,n){n.html("<"+t.name+'-base-inputs-component credit-card="creditCard" readonly="readonly" callback-on-form-init="callbackOnFormInit"><'+t.name+"-base-inputs-component/>").show(),e(n.contents())(t)},scope:{name:"=",creditCard:"=",callbackOnFormInit:"=?"}}}],ppCreditCardActionsService:function(){return{loaded:"PP_CARD_LOADED",init:"PP_CARD_INITIALIZE",initSuccess:"INIT_PP_CARD_SUCCESS",initError:"INIT_PP_CARD_ERROR",create:"CREATE_PP_CARD",createSuccess:"CREATE_PP_CARD_SUCCESS",createError:"CREATE_PP_CARD_ERROR",validationStart:"PP_CARD_VALIDATION_START",validationEnd:"PP_CARD_VALIDATION_END",isValid:"CREDIT_CARD_FORM_IS_VALID",isNotValid:"CREDIT_CARD_FORM_IS_NOT_VALID"}},providersService:function(e,t,n){return{getProviderInstanceById:function(t){return e.get(this._getProviderInstanceNameById(t))},checkProviderInstanceById:function(n){var r=!0;return t.getNewFlowProviders()[n]&&e.has(this._getProviderInstanceNameById(n))||(r=!1),r},_getProviderInstanceNameById:function(e){return t.getNewFlowProviders()[e].name+"Provider"+n},hasNewFlow:function(e){var n=t.getNewFlowProviders()[e];return n&&n.name}}},getNewFlowComponents:function(e,t,n){var r=e.getNewFlowProviders(),o=t,i="";for(var a in t=t.toLowerCase().split("").join("-"),r){var c=r[a].name,s=n?c+o+" cc-detailed":"";i+="<".concat(c,"-component-").concat(t,'\n \t\t\t\t\t\tclass="').concat(s,'" \n \t\t\t\t\t\treadonly="readonly"\n \t\t\t\t\t\tpayment-provider="paymentProvider"\n            card="card"\n            term-id="{{termId}}"\n            ng-if="paymentSource == ').concat(a,'">\n\t\t\t\t\t</').concat(c,"-component-").concat(t,">")}return{restrict:"E",scope:{paymentProvider:"=paymentProvider",card:"=card",paymentSource:"=paymentSource",readonly:"=readonly",termId:"@?"},template:i}}}},{"./config":2}],2:[function(e,t,n){"use strict";t.exports={prefixes:{CONSUMER_DASHBOARD:"CD",PUBLISHER_DASHBOARD:"PD",CHECKOUT:"CH",APPLY_TERM_WIZARD:"ATW",MY_ACCOUNT:"MA"},providers:{19:{name:"edgil"},37:{name:"onet"},38:{name:"applepayss"},39:{name:"cybersource"},40:{name:"stripe"},41:{name:"applepaystripe"},42:{name:"applepayway"},45:{name:"wirecard"},50:{name:"gocardlessdd"}}}},{}],3:[function(e,t,n){"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var o=angular.module("creditCardComponentsModule",[]),i=e("./config");o.service("ccFieldsService",function(){return{getBaseCreditCardFields:function(){return{value:"",disabled:!1,required:!1,readonly:!1,onChangeCallback:angular.noop,maxlength:null,valid:!0,showLabel:!1}},getBaseCcComponentScope:function(){return{text:"=ngModel",onChange:"=onChange",disabled:"=ngDisabled",required:"=ngRequired",readonly:"=ngReadonly",maxlength:"=maxlength",className:"=?className",name:"=name",valid:"=valid"}},getBaseCcInputDirectiveParams:function(e){return{restrict:"E",require:"ngModel",templateUrl:e,scope:this.getBaseCcComponentScope()}},getTemplatesScope:function(){return{credit_card:{num:this.getBaseCreditCardFields(),expire:this.getBaseCreditCardFields(),cvv:this.getBaseCreditCardFields(),postal_code:this.getBaseCreditCardFields()}}},getExpireValueSplitted:function(e){var t={month:"",year:""};if(e){var n=r(e.split("/"),2),o=n[0],i=n[1];void 0!==o&&(o=o.trim()),void 0!==i&&(i=i.trim()),t={month:o,year:i}}return t},getFormattedMonth:function(e){return("0"+e).slice(-2)},getFormattedYear:function(e){return e.toString().slice(-2)},getFullyFormattedYear:function(e){return("20"+e).slice(-4)},getNewFlowProviders:function(){return i.providers},detectCardType:function(e){for(var t=this.getUnknownCardType(),n={shortName:"v",longName:"Visa"},r=[{type:n,rname:"electron",rgxp:/^(4026|417500|4405|4508|4844|4913|4917)\d+$/},{type:t,rname:"maestro",rgxp:/^(5018|5020|5038|5612|5893|6304|6759|6761|6762|6763|0604|6390)\d+$/},{type:t,rname:"dankort",rgxp:/^(5019)\d+$/},{type:t,rname:"interpayment",rgxp:/^(636)\d+$/},{type:t,rname:"unionpay",rgxp:/^(62|88)\d+$/},{type:n,rname:"visa",rgxp:/^4[0-9]{12}(?:[0-9]{3})?$/},{type:{shortName:"mc",longName:"MasterCard"},rname:"mastercard",rgxp:/^5[1-5][0-9]{2}|(222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)[0-9]{12}$/},{type:{shortName:"amex",longName:"American Express"},rname:"amex",rgxp:/^3[47][0-9]{13}$/},{type:{shortName:"dci",longName:"Diners Club"},rname:"diners",rgxp:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/},{type:{shortName:"d",longName:"Discover"},rname:"discover",rgxp:/^6(?:011|5[0-9]{2})[0-9]{12}$/},{type:t,rname:"jcb",rgxp:/^(?:2131|1800|35\d{3})\d{11}$/}],o=0;o<r.length;o++){var i=r[o];if(i.rgxp.test(e))return i.type}return t},getUnknownCardType:function(){return{shortName:"card",longName:"Credit card"}},getCardType:function(e){return{type:{shortName:{"American Express":"amex",Visa:"v",MasterCard:"mc"}[e],longName:e}}}}}),o.service("ccValidationService",["ccFieldsService","lang",function(e,t){return{collectCCErrors:function(e,t){var n=this.getEmptyFieldsErrors(e,t);return n.length?n:this.getSpecificFieldsErrors(e,t)},getEmptyFieldsErrors:function(e,t){return(t=t||this.baseFields).reduce(function(t,n){return e[n.name].value||e[n.name].disabled||t.push({name:n.name,msg:n.msg}),t},[])},getSpecificFieldsErrors:function(e){return[this.getCCNumberError(e.num),this.getExpireError(e.expire),this.getCVVError(e)].filter(function(e){return e})},getCCNumberError:function(e){var n;return this.ccLuhnCheck(e.value)||(n={name:"num",msg:t.tr("Invalid credit card number")}),n},getExpireError:function(n){var r,o=e.getExpireValueSplitted(n.value);return this.ccExpireDateValidate(o.month,o.year)||(r={name:"expire",msg:t.tr("Invalid expiration date")}),r},getCVVError:function(e){if(!this.cvvValidate(e.num.value,e.cvv.value))return{name:"cvv",msg:t.tr("Your CVV must be 4 digits for American Express or 3 digits for other cards")}},cvvValidate:function(t,n){var r=t.replace(/\D/g,""),o=n.replace(/\D/g,"");if("amex"===e.detectCardType(r).shortName){if(/^\d{4}$/.test(o))return!0}else if(/^\d{3}$/.test(o))return!0;return!1},ccExpireDateValidate:function(e,t){if(!e||!t)return!1;var n=parseInt(e,10),r=parseInt(t,10);if(n<1||n>12)return!1;if(r<0)return!1;r<100&&(r+=2e3);var o=new Date;o.setDate(1),o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0);var i=new Date;return i.setDate(1),i.setMonth(n-1),i.setYear(r),i.setHours(0),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0),o.getTime()<=i.getTime()},ccLuhnCheck:function(e){if(!e.match(/^\d+$/))return!1;for(var t=e.length,n=1&t,r=0,o=0;o<t;o++){var i=parseInt(e.charAt(o));1&o^n||(i*=2)>9&&(i-=9),r+=i}return r%10==0},baseFields:[{name:"num",msg:t.tr("Card number is required")},{name:"expire",msg:t.tr("Expiration date is required")},{name:"cvv",msg:t.tr("CVV is required")},{name:"postal_code",msg:t.tr("Postal code is required")}]}}]),o.directive("formatExpiryDate",function(){var e,t,n,r,o,i,a,c,s,u;return i=function(e){var t;return null!=e.prop("selectionStart")&&e.prop("selectionStart")!==e.prop("selectionEnd")||!(null==("undefined"!=typeof document&&null!==document&&null!=(t=document.selection)?t.createRange:void 0)||!document.selection.createRange().text)},s=function(e){var t;return!(!e.metaKey&&!e.ctrlKey)||32!==e.which&&(0===e.which||(e.which<33||(t=String.fromCharCode(e.which),!!/[\d\s]/.test(t))))},c=function(e){var t,n;if(t=$(e.currentTarget),n=String.fromCharCode(e.which),/^\d+$/.test(n)&&!i(t))return!((t.val()+n).replace(/\D/g,"").length>u+2)&&void 0},n=function(e){var t,n,r;if(n=String.fromCharCode(e.which),/^\d+$/.test(n))return t=$(e.currentTarget),r=t.val()+n,/^\d$/.test(r)&&"0"!==r&&"1"!==r?(e.preventDefault(),setTimeout(function(){return t.val("0"+r+" / ")})):/^\d\d$/.test(r)?(e.preventDefault(),setTimeout(function(){return t.val(r+" / ")})):void 0},a=function(t){return setTimeout(function(){var n,r;return r=(n=$(t.currentTarget)).val(),r=e(r),n.val(r)})},e=function(e){var t,n,r,o,i=new RegExp("^\\D*(\\d{1,2})(\\D+)?(\\d{1,"+u+"})?");return(n=e.match(i))?(t=n[1]||"",r=n[2]||"",(o=n[3]||"").length>0?r=" / ":" /"===r?(t=t.substring(0,1),r=""):2===t.length||r.length>0?r=" / ":1===t.length&&"0"!==t&&"1"!==t&&(t="0"+t,r=" / "),t+r+o):""},o=function(e){var t,n,r;if("/"===(r=String.fromCharCode(e.which))||" "===r)return n=(t=$(e.currentTarget)).val(),/^\d$/.test(n)&&"0"!==n?t.val("0"+n+" / "):void 0},r=function(e){var t,n,r;if(n=String.fromCharCode(e.which),/^\d+$/.test(n))return r=(t=$(e.currentTarget)).val(),/^\d\d$/.test(r)?t.val(r+" / "):void 0},t=function(e){var t,n;if(t=$(e.currentTarget),n=t.val(),8===e.which&&(null==t.prop("selectionStart")||t.prop("selectionStart")===n.length))return/\d\s\/\s$/.test(n)?(e.preventDefault(),setTimeout(function(){return t.val(n.replace(/\d\s\/\s$/,""))})):void 0},{scope:{formatYear:"=?formatYear"},restrict:"A",link:function(e,i){u=e.formatYear||2,i.on("keypress",s),i.on("keypress",c),i.on("keypress",n),i.on("keypress",o),i.on("keypress",r),i.on("keydown",t),i.on("change",a),i.on("input",a)}}}),o.directive("ccTextInput",function(){return{restrict:"E",require:"ngModel",templateUrl:"/frontend/providers/common/credit-card-text-input.html",scope:{text:"=ngModel",placeholder:"=placeholder",icon:"=icon",name:"=name",maxlength:"=maxlength",readonly:"=ngReadonly",required:"=ngRequired",disabled:"=ngDisabled",iconClass:"=iconClass",iconWidth:"=iconWidth",className:"=className",borderBottom:"=borderBottom",autocomplete:"=autocomplete",onChange:"=onChange",valid:"=valid"},controller:["$scope",function(e){e.getIconClass=function(){var t="";return e.readonly&&(t+="".concat("cc-field__icon--","readonly ")),e.text&&(t+="".concat("cc-field__icon--","highlighted ")),e.iconClass?t+="".concat(e.iconClass," "):t+="".concat("cc-field__icon--").concat(e.icon," "),t},e.getFieldClass=function(){var t="";return e.name&&(t+="".concat("cc-field--").concat(e.name," ")),e.valid||(t+="".concat("cc-field--","not-valid")),t}}]}}),o.directive("creditCardCvv",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-cvv.html")}]),o.directive("creditCardPostalCode",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-postal-code.html")}]),o.directive("creditCardNumber",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-number.html")}]),o.directive("creditCardHolder",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-holder.html")}]),o.directive("ccExpireComponent",["ccFieldsService",function(e){return e.getBaseCcInputDirectiveParams("/frontend/providers/common/credit-card-expire.html")}]),t.exports=o},{"./config":2}],4:[function(e,t,n){"use strict";t.exports=["$q","tpHTTP","$rootElement","iframeService","ccFieldsService","lang",function(e,t,n,r){return{processPurchase:function(e){r.injectHiddenIframe("gocardlessdd-form-component-iframe",e)}}}]},{}],5:[function(e,t,n){"use strict";var r=e("../common/config").name,o=e("../common/config").id,i=e("../../../common/config").prefixes.CHECKOUT,a=e("../common").getInstanceName,c=e("../common/addCardBaseComponent"),s=["checkout","$rootElement","errorService","lang","ccFieldsService","$injector","ccValidationService","ppCreditCardActionsService","$q","tpHTTP",function(e,t,n,s,u,l,d,p,f,m){return{restrict:"E",require:"^view",transclude:!0,templateUrl:"/frontend/providers/components/"+r+"/checkout/component.shtml",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","errorService","$timeout","ngEventService",function(t,n,s,h){c.apply(t,[f,l,m,u,d,p]),t.cardService=l.get(a("CardService",i));var g=l.get("eventsService"+i).events;t.providerName=r,t.PAYMENT_PROVIDER_ID=o,t.customValidation=!0,angular.extend(t,BaseComponentController);var v=null;t.create=function(){e=t.createUrl,v=window.open(e,"_blank","toolbar=yes,scrollbars=yes,resizable=yes,top=0,left=0,width=4000,height=4000");var e};var y=function(){t.cc={},t.cc.payWithNew=!0,t.cc.selectedUpiId=null,t.cc.defaultPaymentMethodId=null,t.cc.initiated=!1,t.credit_card=u.getTemplatesScope().credit_card,t.credit_card.store_in_vault=!0};function C(){e.setUpiId(t.cc.selectedUpiId)}t._isValid=function(){return!!t.cc.selectedUpiId},t.$on(g.initiateSucceed,function(n,r){void 0!==r.stored&&(t.cc.stored=JSON.parse(r.stored)||[]),t.createUrl=r.createMandateUrl+"&userToken=".concat(encodeURI(e.params.userToken),"&userProvider=").concat(e.params.userProvider),t.cc.storedRurl=r.stored_rurl,t.cc.payWithNew=void 0===t.cc.stored||0===t.cc.stored.length||t.cc.payWithNew&&t.cc.initiated,t.cc.selectedUpiId=void 0!==t.cc.stored&&t.cc.stored.length>0?t.cc.stored[0].id:null,t.cc.initiated=!0,C(),s(function(){t.$apply()})}),t.$on(g.initiateFailed,function(){e.enabledCheckout()}),t.$on(g.processSucceed,function(){t.cardService.processPurchase(t.cc.storedRurl+"&id=".concat(t.cc.selectedUpiId))}),t.$on(g.completeFailed,function(r,o){!function(e){if(!e)return;if(n(t).reset(),!Array.isArray(e))return void n(t).global(e.msg||e.message);for(var r=0;r<e.length;r++){var o=e[r].msg||e[r].message;o&&""!==o.trim()&&n(t).global(o)}}(o),e.enabledCheckout()}),t.$on("go-cardlessdd-complete",function(e,n){t.cc.stored.push({id:n.upiId,nickname:n.nickname,cardholder:n.cardholder,ending_in:n.account_number}),t.cc.payWithNew=!1,t.cc.selectedUpiId=n.upiId,t.cc.initiated=!0,v.close(),v=null,t.$apply()}),t.$watch("cc.selectedUpiId",function(){C()}),h.subscribe(EVENT_CHECKOUT_STARTED,function(){y()}),y()}]}}];t.exports=s},{"../../../common/config":2,"../common":11,"../common/addCardBaseComponent":8,"../common/config":10}],6:[function(e,t,n){"use strict";var r=e("../common/module"),o=e("../../../common/config").prefixes.CHECKOUT,i=e("../common").getInstanceName,a=e("./component"),c=e("./service"),s=e("../cardService"),u=angular.module(i("Module",o),["checkoutModule",r.name]).factory(i("CardService",o),s).factory(i("Provider",o),c).directive(i("Component",o),a);t.exports=u},{"../../../common/config":2,"../cardService":4,"../common":11,"../common/module":12,"./component":5,"./service":7}],7:[function(e,t,n){"use strict";var r=e("../../../common/config").prefixes.CHECKOUT,o=["$rootScope","$injector",function(e,t){var n=t.get("eventsService"+r).events;return{beforeInitiate:function(){},initiateSucceed:function(t){e.$broadcast(n.initiateSucceed,t)},initiateFailed:function(t){e.$broadcast(n.initiateFailed,t)},beforeProcess:function(){e.$broadcast(n.beforeProcess)},processSucceed:function(t){e.$broadcast(n.processSucceed,t)},processFailed:function(t){e.$broadcast(n.processFailed,t)},confirmed:function(t){e.$broadcast(n.confirmed,t)},declined:function(t){e.$broadcast(n.declined,t)},completeSucceed:function(t){e.$broadcast(n.completeSucceed,t)},completeFailed:function(t){e.$broadcast(n.completeFailed,t)}}}];t.exports=o},{"../../../common/config":2}],8:[function(e,t,n){"use strict";var r=e("./config").name;t.exports=function(e,t,n,o,i,a,c){this.providerName=r,this.credit_card=o.getTemplatesScope().credit_card,this.customValidation=!1,this.unknownCardType=function(e){return{shortName:"card",longName:"Credit card",cyberSourceValue:e}},this.detectCardType=function(e){for(var t={shortName:"v",longName:"Visa",cyberSourceValue:"001"},n=this.unknownCardType("006"),r=this.unknownCardType("034"),o=this.unknownCardType("042"),i=this.unknownCardType("050"),a=this.unknownCardType("051"),c=this.unknownCardType("054"),s=this.unknownCardType("061"),u=this.unknownCardType("062"),l=[{type:t,rname:"electron",rgxp:/^(4026|417500|4405|4508|4844|4913|4917)\d+$/},{type:o,rname:"maestro",rgxp:/^(5018|5020|5038|5612|5893|6304|6759|6761|6762|6763|0604|6390)\d+$/},{type:r,rname:"dankort",rgxp:/^(5019)\d+$/},{type:this.unknownCardType,rname:"interpayment",rgxp:/^(636)\d+$/},{type:u,rname:"unionpay",rgxp:/^(62|88)\d+$/},{type:t,rname:"visa",rgxp:/^4[0-9]{12}(?:[0-9]{3})?$/},{type:{shortName:"mc",longName:"MasterCard",cyberSourceValue:"002"},rname:"mastercard",rgxp:/^5[1-5][0-9]{2}|(222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)[0-9]{12}$/},{type:{shortName:"amex",longName:"American Express",cyberSourceValue:"003"},rname:"amex",rgxp:/^3[47][0-9]{13}$/},{type:{shortName:"dci",longName:"Diners Club",cyberSourceValue:"005"},rname:"diners",rgxp:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/},{type:{shortName:"d",longName:"Discover",cyberSourceValue:"004"},rname:"discover",rgxp:/^6(?:011|5[0-9]{2})[0-9]{12}$/},{type:{shortName:"jcb",longName:"JCB",cyberSourceValue:"007"},rname:"jcb",rgxp:/^(?:2131|1800|35\d{3})\d{11}$/},{type:n,rname:"carteBlanche",rgxp:/^389[0-9]{11}$/},{type:s,rname:"ruPay",rgxp:/^6[0-9]{15}$/},{type:i,rname:"hipercard",rgxp:/^(606282\d{10}(\d{3})?)|(3841\d{15})$/},{type:c,rname:"elo",rgxp:/^((((636368)|(438935)|(504175)|(451416)|(636297))\d{0,10})|((5067)|(4576)|(4011))\d{0,12})$/},{type:a,rname:"aura",rgxp:/^(5078\d{2})(\d{2})(\d{11})$/}],d=0;d<l.length;d++){var p=l[d];if(p.rgxp.test(e))return p.type}return this.unknownCardType}}},{"./config":10}],9:[function(e,t,n){"use strict";var r=e("./config").name;t.exports=function(){return{restrict:"E",require:"ngModel",templateUrl:"/frontend/providers/components/"+r+"/common/baseTemplate.shtml",scope:{credit_card:"=creditCard",readonly:"=readonly"}}}},{"./config":10}],10:[function(e,t,n){"use strict";var r=e("../../../common/config"),o={id:50};o.name=r.providers[o.id].name,t.exports=o},{"../../../common/config":2}],11:[function(e,t,n){"use strict";var r=e("./config");t.exports={getInstanceName:function(e,t){var n=r.name+e;return t&&(n+=t),n}}},{"./config":10}],12:[function(e,t,n){"use strict";var r=e("./baseInputsComponent"),o=e("../../../common/creditCardComponentsModule"),i=e("./").getInstanceName,a=(e("../../../common/common").dynamicBaseInputsComponent,angular.module(i("CommonModule"),[o.name]).directive(i("BaseInputsComponent"),r));t.exports=a},{"../../../common/common":1,"../../../common/creditCardComponentsModule":3,"./":11,"./baseInputsComponent":9}]},{},[6]),angular.module("datatransCheckoutModule",["checkoutModule","paymentProviderModule","tpComponentsModule","datatransCommonModule"]);var EVENT_DATATRANS_INITIATE_SUCCEED="EVENT_DATATRANS_INITIATE_SUCCEED",EVENT_DATATRANS_BEFORE_PROCESS="EVENT_DATATRANS_BEFORE_PROCESS",EVENT_DATATRANS_PROCESS_SUCCEED="EVENT_DATATRANS_PROCESS_SUCCEED",EVENT_DATATRANS_DECLINED="EVENT_DATATRANS_DECLINED",EVENT_DATATRANS_COMPLETE_SUCCEED="EVENT_DATATRANS_COMPLETE_SUCCEED",EVENT_DATATRANS_COMPLETE_FAILED="EVENT_DATATRANS_COMPLETE_FAILED",EVENT_I18N_LOCALE_CHANGED="EVENT_I18N_LOCALE_CHANGED";function datatransFormComponent(e,t,n){return{restrict:"A",require:"^view",transclude:!0,templateUrl:"/widget/checkout/component/partials/datatrans-form-component.html",scope:{skipValidation:"@",isValid:"="},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","errorService","checkout","datatransIntegrationService","$timeout","lang","creditCardUtils","iframeService",function(e,t,n,r,o,i,a,c){function s(n){if(Array.isArray(n))for(var r=0;r<n.length;r++){var o=n[r].msg||n[r].message;o&&""!==o.trim()&&t(e).global(o)}else t(e).global(n.message)}angular.extend(e,BaseComponentController),e._isValid=function(){if(t(e).reset(),!n.isPaymentMethod(DATATRANS)||n.isMockUsed())return!0;var r=!0;if(e.cc.payWithNew){var o=!0;(!e.credit_card.expire_month||e.credit_card.expire_month.length<1)&&(t(e).global(i.trc("checkout.platform","Expiration month is required")),o=!1,r=!1),(!e.credit_card.expire_year||e.credit_card.expire_year.length<1)&&(t(e).global(i.trc("checkout.platform","Expiration year is required")),o=!1,r=!1),o&&!a.ccExpireDateValidate(e.credit_card.expire_month,e.credit_card.expire_year)&&(t(e).global(i.trc("checkout.platform","Invalid expiration date")),r=!1),(!e.credit_card.cardZipCode||e.credit_card.cardZipCode.length<1)&&(t(e).global(i.trc("checkout.platform","Postal code is required")),r=!1)}else if(!e.cc.selectedUpiId)return t(e).global(i.trc("checkout.platform","Please select one of your cards or add new one")),!1;return r},e.$on(EVENT_DATATRANS_INITIATE_SUCCEED,function(t,n){e.cc.stored=r.getStoredCards(),e.cc.payWithNew=void 0===e.cc.stored||0===e.cc.stored.length||e.cc.payWithNew&&e.cc.initiated,e.cc.selectedUpiId=void 0!==e.cc.stored&&e.cc.stored.length>0?e.cc.stored[0].id:null,e.cc.initiated=!0,e.cc.defaultPaymentMethodId=n.defaultPaymentMethodId;!function(e){var t=document.getElementById("datatrans-input-cardnumber-cvv-common-style").innerText,n=document.getElementById("datatrans-input-cardnumber-cvv-error-style").innerText;r.init("datatrans-card-number","datatrans-cvv",{common:t,error:n},e)}(!1)}),e.$on(EVENT_DATATRANS_BEFORE_PROCESS,function(){n.input.cardZipCode=e.credit_card.cardZipCode,n.input.defaultPaymentMethodId=e.credit_card.store_in_vault&&e.cc.defaultPaymentMethodId}),e.$on(EVENT_DATATRANS_PROCESS_SUCCEED,function(t,o,i){if(n.disableCheckout(),e.cc.payWithNew){r.getTransactionId(n.getSelectedTerm().chargeAmount,n.getSelectedTerm().chargeCurrency,e.credit_card.expire_month,e.credit_card.expire_year,"").then(function(t){c.injectHiddenIframe("datatrans-form-component-iframe",r.getReturnUrl(t,e.credit_card.cardZipCode)),i.resolve()}).catch(function(e){console.warn(e),s(r.mappingForConsumerErrors(e)),i.reject()}).finally(function(){n.enabledCheckout()})}else c.injectHiddenIframe("datatrans-form-component-iframe",r.getStoredRurl(e.cc.selectedUpiId))}),e.$on(EVENT_DATATRANS_DECLINED,function(e,t){n.enabledCheckout()}),e.$on(EVENT_DATATRANS_COMPLETE_FAILED,function(e,t){s(t)}),e.$on(EVENT_I18N_LOCALE_CHANGED,function(){n.isPaymentMethod(DATATRANS)&&setTimeout(function(){r.setPlaceholder()},100)}),e.cc={},e.cc.payWithNew=!0,e.cc.selectedUpiId=null,e.cc.initiated=!1,e.cc.defaultPaymentMethodId=null,e.credit_card={},e.credit_card.store_in_vault=!0,propagatePaymentVars(n,e)}]}}angular.module("datatransCheckoutModule").factory("datatransProvider",["$rootScope","$q","datatransIntegrationService",function(e,t,n){var r={beforeInitiate:function(){},initiateSucceed:function(t){n.setMerchantId(t.merchantId),n.setStoredRurl(t.stored_rurl),n.setStoredCards(JSON.parse(t.stored)),e.$broadcast(EVENT_DATATRANS_INITIATE_SUCCEED,t)},initiateFailed:function(e){},beforeProcess:function(){return e.$broadcast(EVENT_DATATRANS_BEFORE_PROCESS),["cardZipCode"]},processSucceed:function(r){var o=t.defer();return n.setReturnUrl(r.returnUrl),e.$broadcast(EVENT_DATATRANS_PROCESS_SUCCEED,r,o),o.promise},processFailed:function(e){},confirmed:function(e){},declined:function(t){e.$broadcast(EVENT_DATATRANS_DECLINED,t)},completeSucceed:function(t){e.$broadcast(EVENT_DATATRANS_COMPLETE_SUCCEED,t)},completeFailed:function(t){e.$broadcast(EVENT_DATATRANS_COMPLETE_FAILED,t)}};return r}]),angular.module("datatransCheckoutModule").directive("datatransFormComponent",datatransFormComponent),datatransFormComponent.$inject=["checkout","lang","errorService"],angular.module("datatransPostfinanceCheckoutModule",["checkoutModule","paymentProviderModule","tpComponentsModule","datatransPostfinanceCommonModule"]);var EVENT_PREVIEW_DATATRANS_POSTFINANCE_CHECKOUT_TERM_COMPLETE="EVENT_PREVIEW_DATATRANS_POSTFINANCE_CHECKOUT_TERM_COMPLETE",EVENT_DATATRANS_POSTFINANCE_INITIATE_SUCCEED="EVENT_DATATRANS_POSTFINANCE_INITIATE_SUCCEED",EVENT_DATATRANS_POSTFINANCE_BEFORE_PROCESS="EVENT_DATATRANS_POSTFINANCE_BEFORE_PROCESS",EVENT_DATATRANS_POSTFINANCE_PROCESS_SUCCEED="EVENT_DATATRANS_POSTFINANCE_PROCESS_SUCCEED",EVENT_DATATRANS_POSTFINANCE_DECLINED="EVENT_DATATRANS_POSTFINANCE_DECLINED",EVENT_DATATRANS_POSTFINANCE_COMPLETE_SUCCEED="EVENT_DATATRANS_POSTFINANCE_COMPLETE_SUCCEED",EVENT_DATATRANS_POSTFINANCE_COMPLETE_FAILED="EVENT_DATATRANS_POSTFINANCE_COMPLETE_FAILED";function datatransPostfinanceFormComponent(){return{restrict:"A",require:"^view",transclude:!0,templateUrl:"/widget/checkout/component/partials/datatrans-postfinance-form-component.html",scope:{skipValidation:"@",isValid:"="},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","errorService","checkout","datatransIntegrationService","$timeout","lang","creditCardUtils","iframeService","datatransPostfinanceIntegrationService","ngEventService","billingConfig",function(e,t,n,r,o,i,a,c,s,u,l){angular.extend(e,BaseComponentController);var d=-1;function p(){e.stored.length>0&&(e.data.selectedUpi=e.stored[0])}function f(){e.stored=[],e.data={},e.data.selectedUpi=null,e.data.newUpi=null}function m(){e.data.newUpi=null,e.stored.splice(e.stored.length-1,1),e.data.selectedUpi.isNew&&(e.data.selectedUpi=null,p())}function h(){if(e.data.selectedUpi){var t=e.getTaxRequest();e.data.selectedUpi.id&&n.setUpiId(e.data.selectedUpi.id),n.getUpiId()&&t&&l.updateFromTaxRequest(n,t)}}function g(n){if(Array.isArray(n))for(var r=0;r<n.length;r++){var o=n[r].msg||n[r].message;o&&""!==o.trim()&&t(e).global(o)}else t(e).global(n.message)}e._isValid=function(){if(!0!==n.isPreviewMod()){if(t(e).reset(),!n.isPaymentMethod(DATATRANS_POSTFINANCE)||n.isMockUsed())return!0;if(!e.data.selectedUpi)return t(e).global(i.trc("checkout.platform","Please select one of your Postfinance cards or add new one")),!1}return!0},e.$on(EVENT_PREVIEW_DATATRANS_POSTFINANCE_CHECKOUT_TERM_COMPLETE,function(e,t){n._completeTerm({q:"q"})}),e.$on(EVENT_DATATRANS_POSTFINANCE_INITIATE_SUCCEED,function(t,r){d=n.getSelectedTerm().chargeAmount,e.stored=JSON.parse(r.stored),e.data.newUpi&&e.stored.push(e.data.newUpi),e.data.selectedUpi||p(),e.initUrl=r.init_url,e.storedRurl=r.stored_rurl,e.commonRurl=r.common_rurl,h()}),e.$on(EVENT_DATATRANS_POSTFINANCE_BEFORE_PROCESS,function(){e.data.newUpi&&(n.setUpiId(null),n.input.transactionId=e.data.newUpi.transactionId)}),e.$on(EVENT_DATATRANS_POSTFINANCE_PROCESS_SUCCEED,function(t,n){e.data.newUpi?c.injectHiddenIframe("datatrans-postfinance-form-component-iframe",s.getReturnUrl(n.returnUrl,e.data.newUpi.transactionId)):c.injectHiddenIframe("datatrans-postfinance-form-component-iframe",s.getStoredRurl(e.data.selectedUpi.id))}),e.$on(EVENT_DATATRANS_POSTFINANCE_DECLINED,function(){n.enabledCheckout()}),e.$on(EVENT_DATATRANS_POSTFINANCE_COMPLETE_FAILED,function(e,t){g(t)}),u.subscribe(EVENT_CHECKOUT_STARTED,function(){f()}),u.subscribe(EVENT_CHECKOUT_PRICE_CHANGED,function(){var t=n.input.chargeAmount;e.data.newUpi&&t!==d&&m(),d=t}),u.subscribe(EVENT_CHECKOUT_RELOADED,function(){var e=n.getSelectedTerm();d=e.chargeAmount}),f(),e.startWithNewAccount=function(){var t=e.initUrl;t+="&zipCode="+n.input.zipCode,n.getBillingZipCode()&&(t+="&billingZipCode="+n.getBillingZipCode()),n.getBillingCountryCode()&&(t+="&countryCode="+n.getBillingCountryCode()),n.getResidenceCountryCode()&&(t+="&residenceCountryCode="+n.getResidenceCountryCode()),s.startPostfinanceCheckout(t).then(function(t){e.data.newUpi={id:void 0,isNew:!0,transactionId:t.transactionId,payerInfo:t.payerInfo},e.stored.push(e.data.newUpi),e.data.selectedUpi=e.data.newUpi}).catch(function(e){e&&g(e)})},e.$watch("data.selectedUpi ",function(){h()}),e.getTaxRequest=function(){if(e.data.selectedUpi)for(var t=0;t<e.stored.length;t++){var n=e.stored[t];if(n.id===e.data.selectedUpi.id)return l.taxRequestFromUpi(n)}return null},e.cancelNewAccount=m,e.canContinue=function(){return!!e.data.selectedUpi},propagatePaymentVars(n,e)}]}}function easypayBoletoFactory(e,t,n,r,o){var i={beforeInitiate:function(){},initiateSucceed:function(e){},initiateFailed:function(e){},beforeProcess:function(e){},processSucceed:function(t){e(function(){var e={q:t.q};util.log("[EASYPAY_BOLETO] Firing payment-complete",e);var n={event:"payment-complete",params:e};window.postMessage(JSON.stringify(n),"*")},0)},processFailed:function(t){e(function(){util.log("[EASYPAY_BOLETO] Firing payment-error",t);var e={event:"payment-error",error:t};window.postMessage(JSON.stringify(e),"*")},0)},confirmed:function(e){},declined:function(e){},completeSucceed:function(e){},completeFailed:function(e){n(t).reset(),n(t).global(e&&e[0]&&e[0].msg?e[0].msg:r.trc("checkout.platform","Unknown error"))}};return i}angular.module("datatransPostfinanceCheckoutModule").factory("datatransPostfinanceProvider",["$rootScope","$q","datatransPostfinanceIntegrationService",function(e,t,n){var r={beforeInitiate:function(){},initiateSucceed:function(t){n.setStoredRurl(t.stored_rurl),e.$broadcast(EVENT_DATATRANS_POSTFINANCE_INITIATE_SUCCEED,t)},initiateFailed:function(e){},beforeProcess:function(){return e.$broadcast(EVENT_DATATRANS_POSTFINANCE_BEFORE_PROCESS),["transactionId"]},processSucceed:function(n){var r=t.defer();return e.$broadcast(EVENT_DATATRANS_POSTFINANCE_PROCESS_SUCCEED,n,r),r.promise},processFailed:function(e){},confirmed:function(e){},declined:function(t){e.$broadcast(EVENT_DATATRANS_POSTFINANCE_DECLINED,t)},completeSucceed:function(t){e.$broadcast(EVENT_DATATRANS_POSTFINANCE_COMPLETE_SUCCEED,t)},completeFailed:function(t){e.$broadcast(EVENT_DATATRANS_POSTFINANCE_COMPLETE_FAILED,t)}};return r}]),angular.module("datatransPostfinanceCheckoutModule").directive("datatransPostfinanceFormComponent",datatransPostfinanceFormComponent),angular.module("easypayCheckoutModule",["checkoutModule","tpComponentsModule","paymentProviderModule","easypayCommonModule"]),angular.module("easypayCheckoutModule").factory("easypayBoletoProvider",easypayBoletoFactory),easypayBoletoFactory.$inject=["$timeout","$rootScope","errorService","lang","$q"];var EVENT_EASYPAY_DIRECT_DEBIT_INITIATE_SUCCEED="EVENT_EASYPAY_DIRECT_DEBIT_INITIATE_SUCCEED",EVENT_EASYPAY_DIRECT_DEBIT_PROCESS_SUCCEED="EVENT_EASYPAY_DIRECT_DEBIT_PROCESS_SUCCEED",EVENT_EASYPAY_DIRECT_DEBIT_DECLINED="EVENT_EASYPAY_DIRECT_DEBIT_DECLINED",EVENT_EASYPAY_DIRECT_DEBIT_COMPLETE_FAILED="EVENT_EASYPAY_DIRECT_DEBIT_COMPLETE_FAILED";angular.module("easypayCheckoutModule").factory("easypayDirectDebitProvider",["$rootScope",function(e){var t={beforeInitiate:function(){},initiateSucceed:function(t){e.$broadcast(EVENT_EASYPAY_DIRECT_DEBIT_INITIATE_SUCCEED,t)},initiateFailed:function(e){},beforeProcess:function(){},processSucceed:function(t){e.$broadcast(EVENT_EASYPAY_DIRECT_DEBIT_PROCESS_SUCCEED,t)},processFailed:function(e){},confirmed:function(e){},declined:function(t){e.$broadcast(EVENT_EASYPAY_DIRECT_DEBIT_DECLINED,t)},completeSucceed:function(e){},completeFailed:function(t){e.$broadcast(EVENT_EASYPAY_DIRECT_DEBIT_COMPLETE_FAILED,t)}};return t}]),angular.module("easypayCheckoutModule").factory("easypayMbwayProvider",easypayMbwayProvider);var EVENT_MBWAY_BEFORE_PROCESS="EVENT_MBWAY_BEFORE_PROCESS";function easypayMbwayProvider(e,t,n,r){var o={beforeInitiate:function(){},initiateSucceed:function(e){},initiateFailed:function(e){},beforeProcess:function(){return t.$broadcast(EVENT_MBWAY_BEFORE_PROCESS),["phoneCountryCode","phoneNumber"]},processSucceed:function(t){e(function(){var e={q:t.q};util.log("[EASYPAY_MBWAY] Firing payment-complete",e);var n={event:"payment-complete",params:e};window.postMessage(JSON.stringify(n),"*")},0)},processFailed:function(t){e(function(){util.log("[EASYPAY_MBWAY] Firing payment-error",t);var e={event:"payment-error",error:t};window.postMessage(JSON.stringify(e),"*")},0)},confirmed:function(e){},declined:function(e){},completeSucceed:function(e){},completeFailed:function(e){n(t).reset(),n(t).global(e&&e[0]&&e[0].msg?e[0].msg:r.trc("checkout.platform","Unknown error"))}};return o}function easypayMultibancoProvider(e,t,n,r){var o={beforeInitiate:function(){},initiateSucceed:function(e){},initiateFailed:function(e){},beforeProcess:function(){},processSucceed:function(t){e(function(){var e={q:t.q};util.log("[EASYPAY_MULTIBANCO] Firing payment-complete",e);var n={event:"payment-complete",params:e};window.postMessage(JSON.stringify(n),"*")},0)},processFailed:function(t){e(function(){util.log("[EASYPAY_MULTIBANCO] Firing payment-error",t);var e={event:"payment-error",error:t};window.postMessage(JSON.stringify(e),"*")},0)},confirmed:function(e){},declined:function(e){},completeSucceed:function(e){},completeFailed:function(e){n(t).reset(),n(t).global(e&&e[0]&&e[0].msg?e[0].msg:r.trc("checkout.platform","Unknown error"))}};return o}function easypayBoletoFormComponent(e){return{restrict:"A",require:"^view",transclude:!0,templateUrl:"/widget/checkout/component/partials/easypay-boleto-form-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope",function(t){angular.extend(t,BaseComponentController),t.selectedTerm=e.flags.selectedTerm,t._isValid=function(){return!0},propagatePaymentVars(e,t)}]}}easypayMbwayProvider.$inject=["$timeout","$rootScope","errorService","lang"],angular.module("easypayCheckoutModule").factory("easypayMultibancoProvider",easypayMultibancoProvider),easypayMultibancoProvider.$inject=["$timeout","$rootScope","errorService","lang"],angular.module("easypayCheckoutModule").directive("easypayBoletoFormComponent",easypayBoletoFormComponent),easypayBoletoFormComponent.$inject=["checkout","easypayBoletoService"];var EVENT_EASYPAY_DIRECT_DEBIT_INITIATE_SUCCEED="EVENT_EASYPAY_DIRECT_DEBIT_INITIATE_SUCCEED",EVENT_EASYPAY_DIRECT_DEBIT_PROCESS_SUCCEED="EVENT_EASYPAY_DIRECT_DEBIT_PROCESS_SUCCEED",EVENT_EASYPAY_DIRECT_DEBIT_DECLINED="EVENT_EASYPAY_DIRECT_DEBIT_DECLINED",EVENT_EASYPAY_DIRECT_DEBIT_COMPLETE_FAILED="EVENT_EASYPAY_DIRECT_DEBIT_COMPLETE_FAILED";angular.module("easypayCheckoutModule").directive("easypayDirectDebitProviderFormComponent",function(){return{restrict:"A",require:"^view",transclude:!0,templateUrl:"/widget/checkout/component/partials/easypay-direct-debit-provider-form-component.html",scope:{skipValidation:"@",isValid:"="},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","errorService","ngEventService","checkout","easypayDirectDebitService","$timeout","lang",function(e,t,n,r,o,i,a){angular.extend(e,BaseComponentController);var c={},s=-1,u=function(){e.stored=[],e.data={},e.data.selectedUpi=null,e.data.newUpi=null,(c={}).initUrl=null,c.commonRurl=null};function l(){e.stored.length>0&&(e.data.selectedUpi=e.stored[0])}function d(n){if(Array.isArray(n))for(var r=0;r<n.length;r++){var o=n[r].msg||n[r].message;o&&""!==o.trim()&&t(e).global(o)}else t(e).global(n.message)}function p(){e.data.newUpi=null,e.stored.splice(e.stored.length-1,1),e.data.selectedUpi.isNew&&(e.data.selectedUpi=null,l())}e.$watch("data.selectedUpi",function(){e.isValid=!!e.data.selectedUpi}),e._isValid=function(){return t(e).reset(),!(r.isPaymentMethod(EASYPAY_DIRECT_DEBIT)&&!r.isMockUsed())||(!!e.data.selectedUpi||(t(e).global(a.trc("checkout.platform","Please add Easypay account")),!1))},e.$on(EVENT_EASYPAY_DIRECT_DEBIT_INITIATE_SUCCEED,function(t,n){s=r.getSelectedTerm().chargeAmount,e.stored=JSON.parse(n.stored),e.data.newUpi&&e.stored.push(e.data.newUpi),e.data.selectedUpi||l(),c.initUrl=n.initUrl+"?oid="+n.oid,c.commonRurl=n.commonReturnUrl+"?oid="+n.oid}),e.$on(EVENT_EASYPAY_DIRECT_DEBIT_PROCESS_SUCCEED,function(t,n){r.disableCheckout(),o.proceedPurchase(e.data.selectedUpi,c.commonRurl)}),e.$on(EVENT_EASYPAY_DIRECT_DEBIT_DECLINED,function(e,t){r.enabledCheckout()}),e.$on(EVENT_EASYPAY_DIRECT_DEBIT_COMPLETE_FAILED,function(e,t){d(t)}),n.subscribe(EVENT_CHECKOUT_STARTED,function(){u()}),n.subscribe(EVENT_CHECKOUT_PRICE_CHANGED,function(){e.data.newUpi&&p()}),n.subscribe(EVENT_CHECKOUT_RELOADED,function(){var t=r.getSelectedTerm();e.data.newUpi&&t.chargeAmount!==s&&p(),s=t.chargeAmount}),u(),propagatePaymentVars(r,e),e.addNewAccount=function(){var t=c.initUrl;t+="&zipCode="+r.input.zipCode,r.getBillingZipCode()&&(t+="&billingZipCode="+r.getBillingZipCode()),r.getBillingCountryCode()&&(t+="&countryCode="+r.getBillingCountryCode()),r.getResidenceCountryCode()&&(t+="&residenceCountryCode="+r.getResidenceCountryCode()),o.startPurchase(t).then(function(t){e.data.newUpi={id:void 0,isNew:!0,token:t.token,reference:t.reference,orderId:t.orderId,maxDebit:t.maxDebit,maxAmount:t.maxAmount,expirationDate:t.expirationDate},e.stored.push(e.data.newUpi),e.data.selectedUpi=e.data.newUpi}).catch(function(e){d(e||{message:a.trc("checkout.platform","Payment could not be processed")})})},e.cancelNewAccount=p}]}}),angular.module("easypayCheckoutModule").directive("easypayMbwayFormComponent",easypayMbwayFormComponent);var EVENT_MBWAY_BEFORE_PROCESS="EVENT_MBWAY_BEFORE_PROCESS";function easypayMbwayFormComponent(e,t,n){return{restrict:"A",require:"^view",transclude:!0,templateUrl:"/widget/checkout/component/partials/easypay-mbway-form-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope",function(r){angular.extend(r,BaseComponentController),r.selectedTerm=e.flags.selectedTerm,r._isValid=function(){return n(r).reset(),!(e.isPaymentMethod(EASYPAY_MBWAY)&&!e.isMockUsed())||(!0===toBoolean(r.skipValidation)||(r.phone.countryCode?!!r.phone.number||(n(r).global(t.trc("checkout.platform","Phone number can not be empty")),!1):(n(r).global(t.trc("checkout.platform","Phone country code can not be empty")),!1)))};var o=function(e){return angular.extend([],e).map(function(e){return{category:"country",name:e.name+" (+"+e.callingCode+")",nameWithoutCode:e.name,callingCode:e.callingCode,countryCode:e.code,requireZipCode:!1,vatLabel:!1,needResidence:!1,taxIncludeBilling:!1,taxSupport:!1,visibility:!0}})}([{name:t.trc("country","Aruba"),code:"AW",callingCode:"297"},{name:t.trc("country","Afghanistan"),code:"AF",callingCode:"93"},{name:t.trc("country","Angola"),code:"AO",callingCode:"244"},{name:t.trc("country","Anguilla"),code:"AI",callingCode:"1264"},{name:t.trc("country","Åland Islands"),code:"AX",callingCode:"358"},{name:t.trc("country","Albania"),code:"AL",callingCode:"355"},{name:t.trc("country","Andorra"),code:"AD",callingCode:"376"},{name:t.trc("country","United Arab Emirates"),code:"AE",callingCode:"971"},{name:t.trc("country","Argentina"),code:"AR",callingCode:"54"},{name:t.trc("country","Armenia"),code:"AM",callingCode:"374"},{name:t.trc("country","American Samoa"),code:"AS",callingCode:"1684"},{name:t.trc("country","Antigua and Barbuda"),code:"AG",callingCode:"1268"},{name:t.trc("country","Australia"),code:"AU",callingCode:"61"},{name:t.trc("country","Austria"),code:"AT",callingCode:"43"},{name:t.trc("country","Azerbaijan"),code:"AZ",callingCode:"994"},{name:t.trc("country","Burundi"),code:"BI",callingCode:"257"},{name:t.trc("country","Belgium"),code:"BE",callingCode:"32"},{name:t.trc("country","Benin"),code:"BJ",callingCode:"229"},{name:t.trc("country","Burkina Faso"),code:"BF",callingCode:"226"},{name:t.trc("country","Bangladesh"),code:"BD",callingCode:"880"},{name:t.trc("country","Bulgaria"),code:"BG",callingCode:"359"},{name:t.trc("country","Bahrain"),code:"BH",callingCode:"973"},{name:t.trc("country","Bahamas"),code:"BS",callingCode:"1242"},{name:t.trc("country","Bosnia and Herzegovina"),code:"BA",callingCode:"387"},{name:t.trc("country","Saint Barthélemy"),code:"BL",callingCode:"590"},{name:t.trc("country","Belarus"),code:"BY",callingCode:"375"},{name:t.trc("country","Belize"),code:"BZ",callingCode:"501"},{name:t.trc("country","Bermuda"),code:"BM",callingCode:"1441"},{name:t.trc("country","Bolivia"),code:"BO",callingCode:"591"},{name:t.trc("country","Brazil"),code:"BR",callingCode:"55"},{name:t.trc("country","Barbados"),code:"BB",callingCode:"1246"},{name:t.trc("country","Brunei"),code:"BN",callingCode:"673"},{name:t.trc("country","Bhutan"),code:"BT",callingCode:"975"},{name:t.trc("country","Botswana"),code:"BW",callingCode:"267"},{name:t.trc("country","Central African Republic"),code:"CF",callingCode:"236"},{name:t.trc("country","Canada"),code:"CA",callingCode:"1"},{name:t.trc("country","Cocos Islands"),code:"CC",callingCode:"61"},{name:t.trc("country","Switzerland"),code:"CH",callingCode:"41"},{name:t.trc("country","Chile"),code:"CL",callingCode:"56"},{name:t.trc("country","China"),code:"CN",callingCode:"86"},{name:t.trc("country","Côte d'Ivoire"),code:"CI",callingCode:"225"},{name:t.trc("country","Cameroon"),code:"CM",callingCode:"237"},{name:t.trc("country","The Democratic Republic Of Congo"),code:"CD",callingCode:"243"},{name:t.trc("country","Congo"),code:"CG",callingCode:"242"},{name:t.trc("country","Cook Islands"),code:"CK",callingCode:"682"},{name:t.trc("country","Colombia"),code:"CO",callingCode:"57"},{name:t.trc("country","Comoros"),code:"KM",callingCode:"269"},{name:t.trc("country","Cape Verde"),code:"CV",callingCode:"238"},{name:t.trc("country","Costa Rica"),code:"CR",callingCode:"506"},{name:t.trc("country","Cuba"),code:"CU",callingCode:"53"},{name:t.trc("country","Curaçao"),code:"CW",callingCode:"5999"},{name:t.trc("country","Christmas Island"),code:"CX",callingCode:"61"},{name:t.trc("country","Cayman Islands"),code:"KY",callingCode:"1345"},{name:t.trc("country","Cyprus"),code:"CY",callingCode:"357"},{name:t.trc("country","Czech Republic"),code:"CZ",callingCode:"420"},{name:t.trc("country","Germany"),code:"DE",callingCode:"49"},{name:t.trc("country","Djibouti"),code:"DJ",callingCode:"253"},{name:t.trc("country","Dominica"),code:"DM",callingCode:"1767"},{name:t.trc("country","Denmark"),code:"DK",callingCode:"45"},{name:t.trc("country","Dominican Republic"),code:"DO",callingCode:"1809"},{name:t.trc("country","Dominican Republic"),code:"DO",callingCode:"1829"},{name:t.trc("country","Dominican Republic"),code:"DO",callingCode:"1849"},{name:t.trc("country","Algeria"),code:"DZ",callingCode:"213"},{name:t.trc("country","Ecuador"),code:"EC",callingCode:"593"},{name:t.trc("country","Egypt"),code:"EG",callingCode:"20"},{name:t.trc("country","Eritrea"),code:"ER",callingCode:"291"},{name:t.trc("country","Western Sahara"),code:"EH",callingCode:"212"},{name:t.trc("country","Spain"),code:"ES",callingCode:"34"},{name:t.trc("country","Estonia"),code:"EE",callingCode:"372"},{name:t.trc("country","Ethiopia"),code:"ET",callingCode:"251"},{name:t.trc("country","Finland"),code:"FI",callingCode:"358"},{name:t.trc("country","Fiji"),code:"FJ",callingCode:"679"},{name:t.trc("country","Falkland Islands"),code:"FK",callingCode:"500"},{name:t.trc("country","France"),code:"FR",callingCode:"33"},{name:t.trc("country","Faroe Islands"),code:"FO",callingCode:"298"},{name:t.trc("country","Micronesia"),code:"FM",callingCode:"691"},{name:t.trc("country","Gabon"),code:"GA",callingCode:"241"},{name:t.trc("country","United Kingdom"),code:"GB",callingCode:"44"},{name:t.trc("country","Georgia"),code:"GE",callingCode:"995"},{name:t.trc("country","Guernsey"),code:"GG",callingCode:"44"},{name:t.trc("country","Ghana"),code:"GH",callingCode:"233"},{name:t.trc("country","Gibraltar"),code:"GI",callingCode:"350"},{name:t.trc("country","Guinea"),code:"GN",callingCode:"224"},{name:t.trc("country","Guadeloupe"),code:"GP",callingCode:"590"},{name:t.trc("country","Gambia"),code:"GM",callingCode:"220"},{name:t.trc("country","Guinea-Bissau"),code:"GW",callingCode:"245"},{name:t.trc("country","Equatorial Guinea"),code:"GQ",callingCode:"240"},{name:t.trc("country","Greece"),code:"GR",callingCode:"30"},{name:t.trc("country","Grenada"),code:"GD",callingCode:"1473"},{name:t.trc("country","Greenland"),code:"GL",callingCode:"299"},{name:t.trc("country","Guatemala"),code:"GT",callingCode:"502"},{name:t.trc("country","French Guiana"),code:"GF",callingCode:"594"},{name:t.trc("country","Guam"),code:"GU",callingCode:"1671"},{name:t.trc("country","Guyana"),code:"GY",callingCode:"592"},{name:t.trc("country","Hong Kong"),code:"HK",callingCode:"852"},{name:t.trc("country","Honduras"),code:"HN",callingCode:"504"},{name:t.trc("country","Croatia"),code:"HR",callingCode:"385"},{name:t.trc("country","Haiti"),code:"HT",callingCode:"509"},{name:t.trc("country","Hungary"),code:"HU",callingCode:"36"},{name:t.trc("country","Indonesia"),code:"ID",callingCode:"62"},{name:t.trc("country","Isle Of Man"),code:"IM",callingCode:"44"},{name:t.trc("country","India"),code:"IN",callingCode:"91"},{name:t.trc("country","British Indian Ocean Territory"),code:"IO",callingCode:"246"},{name:t.trc("country","Ireland"),code:"IE",callingCode:"353"},{name:t.trc("country","Iran"),code:"IR",callingCode:"98"},{name:t.trc("country","Iraq"),code:"IQ",callingCode:"964"},{name:t.trc("country","Iceland"),code:"IS",callingCode:"354"},{name:t.trc("country","Israel"),code:"IL",callingCode:"972"},{name:t.trc("country","Italy"),code:"IT",callingCode:"39"},{name:t.trc("country","Jamaica"),code:"JM",callingCode:"1876"},{name:t.trc("country","Jersey"),code:"JE",callingCode:"44"},{name:t.trc("country","Jordan"),code:"JO",callingCode:"962"},{name:t.trc("country","Japan"),code:"JP",callingCode:"81"},{name:t.trc("country","Kazakhstan"),code:"KZ",callingCode:"76"},{name:t.trc("country","Kazakhstan"),code:"KZ",callingCode:"77"},{name:t.trc("country","Kenya"),code:"KE",callingCode:"254"},{name:t.trc("country","Kyrgyzstan"),code:"KG",callingCode:"996"},{name:t.trc("country","Cambodia"),code:"KH",callingCode:"855"},{name:t.trc("country","Kiribati"),code:"KI",callingCode:"686"},{name:t.trc("country","Saint Kitts And Nevis"),code:"KN",callingCode:"1869"},{name:t.trc("country","South Korea"),code:"KR",callingCode:"82"},{name:t.trc("country","Kosovo"),code:"XK",callingCode:"383"},{name:t.trc("country","Kuwait"),code:"KW",callingCode:"965"},{name:t.trc("country","Laos"),code:"LA",callingCode:"856"},{name:t.trc("country","Lebanon"),code:"LB",callingCode:"961"},{name:t.trc("country","Liberia"),code:"LR",callingCode:"231"},{name:t.trc("country","Libya"),code:"LY",callingCode:"218"},{name:t.trc("country","Saint Lucia"),code:"LC",callingCode:"1758"},{name:t.trc("country","Liechtenstein"),code:"LI",callingCode:"423"},{name:t.trc("country","Sri Lanka"),code:"LK",callingCode:"94"},{name:t.trc("country","Lesotho"),code:"LS",callingCode:"266"},{name:t.trc("country","Lithuania"),code:"LT",callingCode:"370"},{name:t.trc("country","Luxembourg"),code:"LU",callingCode:"352"},{name:t.trc("country","Latvia"),code:"LV",callingCode:"371"},{name:t.trc("country","Macao"),code:"MO",callingCode:"853"},{name:t.trc("country","Saint Martin"),code:"MF",callingCode:"590"},{name:t.trc("country","Morocco"),code:"MA",callingCode:"212"},{name:t.trc("country","Monaco"),code:"MC",callingCode:"377"},{name:t.trc("country","Moldova"),code:"MD",callingCode:"373"},{name:t.trc("country","Madagascar"),code:"MG",callingCode:"261"},{name:t.trc("country","Maldives"),code:"MV",callingCode:"960"},{name:t.trc("country","Mexico"),code:"MX",callingCode:"52"},{name:t.trc("country","Marshall Islands"),code:"MH",callingCode:"692"},{name:t.trc("country","Macedonia"),code:"MK",callingCode:"389"},{name:t.trc("country","Mali"),code:"ML",callingCode:"223"},{name:t.trc("country","Malta"),code:"MT",callingCode:"356"},{name:t.trc("country","Myanmar"),code:"MM",callingCode:"95"},{name:t.trc("country","Montenegro"),code:"ME",callingCode:"382"},{name:t.trc("country","Mongolia"),code:"MN",callingCode:"976"},{name:t.trc("country","Northern Mariana Islands"),code:"MP",callingCode:"1670"},{name:t.trc("country","Mozambique"),code:"MZ",callingCode:"258"},{name:t.trc("country","Mauritania"),code:"MR",callingCode:"222"},{name:t.trc("country","Montserrat"),code:"MS",callingCode:"1664"},{name:t.trc("country","Martinique"),code:"MQ",callingCode:"596"},{name:t.trc("country","Mauritius"),code:"MU",callingCode:"230"},{name:t.trc("country","Malawi"),code:"MW",callingCode:"265"},{name:t.trc("country","Malaysia"),code:"MY",callingCode:"60"},{name:t.trc("country","Mayotte"),code:"YT",callingCode:"262"},{name:t.trc("country","Namibia"),code:"NA",callingCode:"264"},{name:t.trc("country","New Caledonia"),code:"NC",callingCode:"687"},{name:t.trc("country","Niger"),code:"NE",callingCode:"227"},{name:t.trc("country","Norfolk Island"),code:"NF",callingCode:"672"},{name:t.trc("country","Nigeria"),code:"NG",callingCode:"234"},{name:t.trc("country","Nicaragua"),code:"NI",callingCode:"505"},{name:t.trc("country","Niue"),code:"NU",callingCode:"683"},{name:t.trc("country","Netherlands"),code:"NL",callingCode:"31"},{name:t.trc("country","Norway"),code:"NO",callingCode:"47"},{name:t.trc("country","Nepal"),code:"NP",callingCode:"977"},{name:t.trc("country","Nauru"),code:"NR",callingCode:"674"},{name:t.trc("country","New Zealand"),code:"NZ",callingCode:"64"},{name:t.trc("country","Oman"),code:"OM",callingCode:"968"},{name:t.trc("country","Pakistan"),code:"PK",callingCode:"92"},{name:t.trc("country","Panama"),code:"PA",callingCode:"507"},{name:t.trc("country","Pitcairn"),code:"PN",callingCode:"64"},{name:t.trc("country","Peru"),code:"PE",callingCode:"51"},{name:t.trc("country","Philippines"),code:"PH",callingCode:"63"},{name:t.trc("country","Palau"),code:"PW",callingCode:"680"},{name:t.trc("country","Papua New Guinea"),code:"PG",callingCode:"675"},{name:t.trc("country","Poland"),code:"PL",callingCode:"48"},{name:t.trc("country","Puerto Rico"),code:"PR",callingCode:"1787"},{name:t.trc("country","Puerto Rico"),code:"PR",callingCode:"1939"},{name:t.trc("country","North Korea"),code:"KP",callingCode:"850"},{name:t.trc("country","Portugal"),code:"PT",callingCode:"351"},{name:t.trc("country","Paraguay"),code:"PY",callingCode:"595"},{name:t.trc("country","Palestine"),code:"PS",callingCode:"970"},{name:t.trc("country","French Polynesia"),code:"PF",callingCode:"689"},{name:t.trc("country","Qatar"),code:"QA",callingCode:"974"},{name:t.trc("country","Reunion"),code:"RE",callingCode:"262"},{name:t.trc("country","Romania"),code:"RO",callingCode:"40"},{name:t.trc("country","Russia"),code:"RU",callingCode:"7"},{name:t.trc("country","Rwanda"),code:"RW",callingCode:"250"},{name:t.trc("country","Saudi Arabia"),code:"SA",callingCode:"966"},{name:t.trc("country","Sudan"),code:"SD",callingCode:"249"},{name:t.trc("country","Senegal"),code:"SN",callingCode:"221"},{name:t.trc("country","Singapore"),code:"SG",callingCode:"65"},{name:t.trc("country","South Georgia And The South Sandwich Islands"),code:"GS",callingCode:"500"},{name:t.trc("country","Svalbard And Jan Mayen"),code:"SJ",callingCode:"4779"},{name:t.trc("country","Solomon Islands"),code:"SB",callingCode:"677"},{name:t.trc("country","Sierra Leone"),code:"SL",callingCode:"232"},{name:t.trc("country","El Salvador"),code:"SV",callingCode:"503"},{name:t.trc("country","San Marino"),code:"SM",callingCode:"378"},{name:t.trc("country","Somalia"),code:"SO",callingCode:"252"},{name:t.trc("country","Saint Pierre And Miquelon"),code:"PM",callingCode:"508"},{name:t.trc("country","Serbia"),code:"RS",callingCode:"381"},{name:t.trc("country","South Sudan"),code:"SS",callingCode:"211"},{name:t.trc("country","Sao Tome And Principe"),code:"ST",callingCode:"239"},{name:t.trc("country","Suriname"),code:"SR",callingCode:"597"},{name:t.trc("country","Slovakia"),code:"SK",callingCode:"421"},{name:t.trc("country","Slovenia"),code:"SI",callingCode:"386"},{name:t.trc("country","Sweden"),code:"SE",callingCode:"46"},{name:t.trc("country","Swaziland"),code:"SZ",callingCode:"268"},{name:t.trc("country","Sint Maarten (Dutch part)"),code:"SX",callingCode:"1721"},{name:t.trc("country","Seychelles"),code:"SC",callingCode:"248"},{name:t.trc("country","Syria"),code:"SY",callingCode:"963"},{name:t.trc("country","Turks And Caicos Islands"),code:"TC",callingCode:"1649"},{name:t.trc("country","Chad"),code:"TD",callingCode:"235"},{name:t.trc("country","Togo"),code:"TG",callingCode:"228"},{name:t.trc("country","Thailand"),code:"TH",callingCode:"66"},{name:t.trc("country","Tajikistan"),code:"TJ",callingCode:"992"},{name:t.trc("country","Tokelau"),code:"TK",callingCode:"690"},{name:t.trc("country","Turkmenistan"),code:"TM",callingCode:"993"},{name:t.trc("country","Timor-Leste"),code:"TL",callingCode:"670"},{name:t.trc("country","Tonga"),code:"TO",callingCode:"676"},{name:t.trc("country","Trinidad and Tobago"),code:"TT",callingCode:"1868"},{name:t.trc("country","Tunisia"),code:"TN",callingCode:"216"},{name:t.trc("country","Turkey"),code:"TR",callingCode:"90"},{name:t.trc("country","Tuvalu"),code:"TV",callingCode:"688"},{name:t.trc("country","Taiwan"),code:"TW",callingCode:"886"},{name:t.trc("country","Tanzania"),code:"TZ",callingCode:"255"},{name:t.trc("country","Uganda"),code:"UG",callingCode:"256"},{name:t.trc("country","Ukraine"),code:"UA",callingCode:"380"},{name:t.trc("country","Uruguay"),code:"UY",callingCode:"598"},{name:t.trc("country","United States"),code:"US",callingCode:"1"},{name:t.trc("country","Uzbekistan"),code:"UZ",callingCode:"998"},{name:t.trc("country","Vatican"),code:"VA",callingCode:"3906698"},{name:t.trc("country","Vatican"),code:"VA",callingCode:"379"},{name:t.trc("country","Saint Vincent And The Grenadines"),code:"VC",callingCode:"1784"},{name:t.trc("country","Venezuela"),code:"VE",callingCode:"58"},{name:t.trc("country","British Virgin Islands"),code:"VG",callingCode:"1284"},{name:t.trc("country","U.S. Virgin Islands"),code:"VI",callingCode:"1340"},{name:t.trc("country","Vietnam"),code:"VN",callingCode:"84"},{name:t.trc("country","Vanuatu"),code:"VU",callingCode:"678"},{name:t.trc("country","Wallis And Futuna"),code:"WF",callingCode:"681"},{name:t.trc("country","Samoa"),code:"WS",callingCode:"685"},{name:t.trc("country","Yemen"),code:"YE",callingCode:"967"},{name:t.trc("country","South Africa"),code:"ZA",callingCode:"27"},{name:t.trc("country","Zambia"),code:"ZM",callingCode:"260"},{name:t.trc("country","Zimbabwe"),code:"ZW",callingCode:"263"}]);r.phone={},r.onCallingCodeSelect=function(e){r.phone.countryCode=e.callingCode},r.selectorOptions={selectorModel:{label:"",item:{}},items:o},r.$on(EVENT_MBWAY_BEFORE_PROCESS,function(){e.input.phoneCountryCode=r.phone.countryCode,e.input.phoneNumber=r.phone.number}),propagatePaymentVars(e,r)}]}}function easypayMultibancoFormComponent(e){return{restrict:"A",require:"^view",transclude:!0,templateUrl:"/widget/checkout/component/partials/easypay-multibanco-form-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope",function(t){angular.extend(t,BaseComponentController),t.selectedTerm=e.flags.selectedTerm,t._isValid=function(){return!0},propagatePaymentVars(e,t)}]}}function easypayBillControls(){return{restrict:"A",templateUrl:"/widget/checkout/component/partials/easypay-bill-controls.html",scope:{billUrl:"@",openBillTitle:"@"},controller:["$scope",function(e){}]}}easypayMbwayFormComponent.$inject=["checkout","lang","errorService"],angular.module("easypayCheckoutModule").directive("easypayMultibancoFormComponent",easypayMultibancoFormComponent),easypayMultibancoFormComponent.$inject=["checkout"],angular.module("easypayCheckoutModule").directive("easypayBillControls",easypayBillControls),angular.module("klarnaCheckoutModule",["checkoutModule","tpComponentsModule","paymentProviderModule","klarnaCommonModule"]);var EVENT_KLARNA_PROCESS_SUCCEED="EVENT_KLARNA_PROCESS_SUCCEED",EVENT_KLARNA_PROCESS_INITIATED="EVENT_KLARNA_PROCESS_INITIATED",EVENT_KLARNA_DECLINED="EVENT_KLARNA_DECLINED",EVENT_KLARNA_COMPLETE_FAILED="EVENT_KLARNA_COMPLETE_FAILED",EVENT_KLARNA_BEFORE_PROCESS="EVENT_KLARNA_BEFORE_PROCESS";function klarnaFormComponent(){return{restrict:"A",require:"^view",transclude:!0,templateUrl:"/widget/checkout/component/partials/klarna-provider-form-component.html",scope:{skipValidation:"@",isValid:"="},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope","errorService","ngEventService","checkout","klarnaService","$timeout","lang","klarnaProvider","$rootScope","$element","userService","viewService","checkMobile","$q","$rootElement",function(e,t,n,r,o,i,a,c,s,u,l,d,p,f,m){angular.extend(e,BaseComponentController);var h={},g=552,v=g+"px",y=[],C=null;function E(){e.data={},e.data.session=null,(h={}).rurl=null,h.commonRurl=null,e.state.billingData.selectedPaymentMethod=null,e.state.paymentMethodLoaded=null,e.state.isSessionInitialized=!1}function S(){v="0",T(),w("auto"),clearInterval(C)}function T(){document.body.offsetHeight<g&&w(g+"px"),y.length&&y.forEach(function(e){e.style.height=v})}function _(){var e=r.getBillingCountryCode();return r.isVatEuEnabled()&&!r.isSameResidence()&&r.getResidenceCountryCode()&&(e=r.getResidenceCountryCode()),e}function w(e){m.css("min-height",e),m.find("#checkout-container").css("min-height",e),r.resize()}function b(){if(r.isPaymentMethod(KLARNA)&&r.isBillingCountryEnabled()&&(r.getBillingCountryCode()||r.getResidenceCountryCode())){var t=_();if(t===e.state.billingData.address.countryCode)return;e.state.billingData.address.countryCode=t,$(t).then(P)}}function P(){1===e.paymentMethods().length&&i(function(){angular.element(document.querySelector("#paymentMethod-"+e.paymentMethods()[0].identifier)).triggerHandler("click")})}function A(){var t=e.state.billingData;return r.isBillingCountryEnabled()?_():t.address&&t.address.countryCode}function $(n){e.state.isSessionInitialized=!1,r.disableCheckout(),p()&&angular.element(document.body).addClass("klarna-fullscreen-mobile");var i=o.getData().oid;return i?o.getSession(n,i).then(function(n){return e.state.isSessionInitialized=!0,o.init(n.clientToken).catch(function(n){t(e).global(a.trc("checkout.platform","Could not initialize Klarna")),t(e).global(n.error&&n.error.message),console.warn("Klarna init failed:",n.error)})},function(n){(n&&n.data&&n.data.errors).forEach(function(n){t(e).global(n&&n.msg)})}).then(function(){r.enabledCheckout()},function(){r.enabledCheckout()}):f.reject()}function I(){var e="#klarna_container";return{selector:e,clean:function(){u[0].querySelector(e).innerHTML=""}}}function k(n){return r.disableCheckout(),e.state.paymentMethodLoaded=!1,I().clean(),o.load(n,I().selector).then(function(){i(function(){e.state.paymentMethodLoaded=!0})},function(n){t(e).global(n.message)}).then(function(){r.enabledCheckout(),r.input.locale=a.getLanguageTag()})}function N(n){if(Array.isArray(n))for(var r=0;r<n.length;r++){var o=n[r].msg||n[r].message;o&&""!==o.trim()&&t(e).global(o)}else t(e).global(n.message)}e.countrySelectorOptions={selectorModel:{label:"",item:{}},items:TPParam.config.taxCountries},e.defaultCountryCode=r.getGeoCountryCode(),e.state={billingData:{address:{},selectedPaymentMethod:null},userData:{firstName:l.getConfig().user.firstName,lastName:l.getConfig().user.lastName,email:l.getConfig().user.email,title:"mr",locale:a.getLanguageTag()},paymentMethodLoaded:!1,isSessionInitialized:!1,isPaymentMethodKlarna:!1},o.onIframeSizeChange(function(){r.resize()}),e.isBillingCountryEnabled=function(){return r.isBillingCountryEnabled()},e.$on(EVENT_KLARNA_PROCESS_INITIATED,function(){var e=A();e&&d.isActive("state2")&&$(e).then(P)}),b(),e.$watch(function(){return r.isPaymentMethod(KLARNA)+r.getBillingCountryCode()+r.isSameResidence()+r.getResidenceCountryCode()},function(e,t){e!==t&&b()}),e.$watch("state.billingData.address.postalCode",function(t){e.input.zipCode=t}),e.$watch("countrySelectorOptions.selectorModel.item",function(t){var n=t&&t.countryCode;n&&(e.state.billingData.address.countryCode=n,$(n).then(P))}),e.$watch("state.isSessionInitialized",function(n){var r;n&&(!(r=o.paymentMethods())||0===r.length)&&t(e).global(a.trc("checkout.platform","This payment method does not support selected country"))}),e.getSelectedCountry=A,e.isTheOnlyPaymentMethod=function(){return!r.canSelectPaymentMethod()},e._isValid=function(){return t(e).reset(),!(r.isPaymentMethod(KLARNA)&&!r.isMockUsed())||(e.state.billingData.address.countryCode?!!e.state.billingData.selectedPaymentMethod||(t(e).global(a.trc("checkout.platform","Please select payment method")),!1):(t(e).global(a.trc("checkout.platform","Please select country")),!1))},e.paymentMethods=function(){return o.paymentMethods()},e.selectPaymentMethod=function(t){e.state.billingData.selectedPaymentMethod=t,k(t)},e.$on("EVENT_I18N_LOCALE_CHANGED",function(){var t=A(),n=e.state.billingData.selectedPaymentMethod;r.isPaymentMethod(KLARNA)&&t&&$(t).then(function(){n&&k(n)})}),e.$on(EVENT_KLARNA_BEFORE_PROCESS,function(t,n){y=document.querySelectorAll('.klarna-fullscreen-mobile > [id^="klarna-"]:not([id="klarna-payments-device-recognition"])'),setTimeout(function(){window.scrollTo(1,1)},1),C=setInterval(T,1e3),o.authorize(e.state.billingData.selectedPaymentMethod,e.state.billingData.address.countryCode,e.state.userData,r.getSelectedTerm()).then(function(e){o.setAuthToken(e),n.resolve(c.getCustomParamNames())}).catch(function(){S(),o.emulatePaymentError({}),n.reject()})}),e.$on(EVENT_KLARNA_PROCESS_SUCCEED,function(t,n){var r=n.rurl;o.completePayment(r,o.getAuthToken(),e.state.billingData.address.countryCode).catch(function(e){e&&e.data&&e.data.errors&&N(e.data.errors)}).finally(function(){S()})}),e.$on(EVENT_KLARNA_DECLINED,function(){r.enabledCheckout(),S()}),e.$on(EVENT_KLARNA_COMPLETE_FAILED,function(e,t){N(t),S()}),n.subscribe(EVENT_CHECKOUT_STARTED,function(){E()}),E(),propagatePaymentVars(r,e)}]}}angular.module("klarnaCheckoutModule").factory("klarnaProvider",["$timeout","$rootScope","klarnaService","$rootElement","$q",function(e,t,n,r,o){var i={};return i.beforeInitiate=function(){},i.processPurchase=function(e,t){!function(e){var t=angular.element('<iframe name="klarna_checkout_frame" id="klarna_checkout_frame" style="display: none" src="'+e+'"></iframe>');r.append(t)}(t+"&id="+e.id)},i.initiateSucceed=function(e){n.setData({oid:e.oid,commonRurl:e.common_rurl,rurl:e.rurl});try{e.stored&&(n.setStoredAccounts(JSON.parse(e.stored)),n.setStoredRurl(e.stored_rurl))}catch(e){console.warn("could not set stored klarna accounts:",e.message)}t.$broadcast(EVENT_KLARNA_PROCESS_INITIATED,n.getData())},i.initiateFailed=function(e){},i.getCustomParamNames=function(){return["locale"]},i.beforeProcess=function(){var e=o.defer();return t.$broadcast(EVENT_KLARNA_BEFORE_PROCESS,e),e.promise},i.processSucceed=function(e){t.$broadcast(EVENT_KLARNA_PROCESS_SUCCEED,e)},i.processFailed=function(e){},i.confirmed=function(e){},i.declined=function(e){t.$broadcast(EVENT_KLARNA_DECLINED,e)},i.completeSucceed=function(e){},i.completeFailed=function(e){t.$broadcast(EVENT_KLARNA_COMPLETE_FAILED,e)},i}]),angular.module("klarnaCheckoutModule").directive("klarnaFormComponent",klarnaFormComponent),angular.module("obiCheckoutModule",["checkoutModule","paymentProviderModule","tpComponentsModule","obiCommonModule"]);var EVENT_OBI_INITIATE_SUCCEED="EVENT_OBI_INITIATE_SUCCEED",EVENT_OBI_BEFORE_PROCESS="EVENT_OBI_BEFORE_PROCESS",EVENT_OBI_BEFORE_CONFIRM="EVENT_OBI_BEFORE_CONFIRM",EVENT_OBI_PROCESS_SUCCEED="EVENT_OBI_PROCESS_SUCCEED",EVENT_OBI_DECLINED="EVENT_OBI_DECLINED",EVENT_OBI_COMPLETE_SUCCEED="EVENT_OBI_COMPLETE_SUCCEED",EVENT_OBI_COMPLETE_FAILED="EVENT_OBI_COMPLETE_FAILED";function obiProviderFactory(e,t){return{beforeInitiate:function(){},initiateSucceed:function(t){e.$broadcast(EVENT_OBI_INITIATE_SUCCEED,t)},initiateFailed:function(e){},beforeProcess:function(){var n=t.defer();return e.$broadcast(EVENT_OBI_BEFORE_PROCESS,n),n.promise},beforeConfirm:function(){return e.$broadcast(EVENT_OBI_BEFORE_CONFIRM),["city","countryState","street","cardCountryCode","cardZipCode"]},processSucceed:function(n){var r=t.defer();return e.$broadcast(EVENT_OBI_PROCESS_SUCCEED,n,r),r.promise},processFailed:function(e){console.warn(e)},confirmed:function(e){},declined:function(t){console.warn(t),e.$broadcast(EVENT_OBI_DECLINED,t)},completeSucceed:function(t){e.$broadcast(EVENT_OBI_COMPLETE_SUCCEED,t)},completeFailed:function(t){console.warn(t),e.$broadcast(EVENT_OBI_COMPLETE_FAILED,t)}}}function obiCheckoutServiceFactory(e,t,n,r,o){return{changeTerm:function(i){var a=e.defer();return o.getStats().then(function(e){r({method:"post",url:t.TPParam.CHANGE_TERM,params:i,data:{checkoutStats:e}}).success(function(e){n.mergeStats(e),e.errors&&e.errors.length>0?a.reject(e.errors):a.resolve(e.models)}).error(function(e){a.reject(e.errors)})}),a.promise},loadCountries:function(i){var a=e.defer();return o.getStats().then(function(e){r({method:"post",url:t.TPParam.LOAD_TERM_COUNTRIES,params:i,data:{checkoutStats:e}}).success(function(e){n.mergeStats(e),a.resolve(e.models)}).error(function(e){a.reject(e.errors)})}),a.promise}}}function obiFormComponent(e,t,n,r,o,i,a,c,s,u,l,d,p){return{restrict:"A",require:"^view",transclude:!0,templateUrl:"/widget/checkout/component/partials/obi-form-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope",function(i){angular.extend(i,BaseComponentController),i.PAYMENT_PROVIDER_ID=OBI,i.customActionOnCompletePurchase=function(){var r=a.defer();if(t(i).reset(),!e.isPaymentMethod(i.PAYMENT_PROVIDER_ID)||e.isMockUsed())r.resolve(!0);else{var c=function(){var e=a.defer();i.cc.payWithNew?n.createCardToken({}).then(function(){e.resolve(!0)}).catch(function(r){console.warn(r);var a=n.processError(r);a.forEach(function(e){t(i).global(o.trc("checkout.platform",e.msg))}),e.resolve(!1)}):i.cc.selectedUpiId?e.resolve(!0):(t(i).global(o.trc("checkout.platform","Please select one of your cards or add new one")),e.resolve(!1));return e.promise}(),s=function(){var e=a.defer(),n=!0;!1!==i.cc.payWithNew||i.cc.selectedUpiId||(t(i).global(o.trc("checkout.platform","Please select one of your cards or add new one")),n=!1);return e.resolve(n),e.promise}();a.all([c,s]).then(function(e){var t=e.reduce(function(e,t){return e&&t});r.resolve(t)})}return r.promise};var f,m,h,g,v=["US","CA"],y=["expiryMonth","expiryYear","email","city","countryState","street","cardCountryCode","cardZipCode","firstName","lastName","token","reference"];i._isValid=function(){return!0},i.isBillingCountryEnabled=function(){return e.isBillingCountryEnabled()},i.isZipCodeRequired=function(){return e.getRequiredZipCode()},i.countrySelectorOptions={selectorModel:{label:"",item:{}},items:[]},i.state={billingData:{}},i.stateSelectorOptions={selectorModel:{label:"",item:{}},items:[]},i.hasStates=function(){return v.indexOf(i.state.billingData.countryCode)>-1},i.selectCountry=function(e){e.countryCode!==i.state.billingData.countryCode&&(i.state.billingData.countryCode=e.countryCode,i.state.billingData.stateCode=null,i.stateSelectorOptions.selectorModel={label:"",item:{}},i.stateSelectorOptions.items=e.stateList,"CA"===e.countryCode&&(i.stateSelectorOptions.items=i.stateSelectorOptions.items.filter(function(e){return"QC"!==e.stateCode})))},i.selectState=function(e){e.stateCode!==i.state.billingData.stateCode&&(i.state.billingData.stateCode=e.stateCode)},i.$watch(function(){return e.getBillingZipCode()+e.isPaymentMethod(i.PAYMENT_PROVIDER_ID)},function(t,n){t!==n&&e.isPaymentMethod(i.PAYMENT_PROVIDER_ID)&&e.isBillingCountryEnabled()&&e.getBillingZipCode()&&(i.input.zipCode=e.getBillingZipCode())});var C=null;s.subscribe(EVENT_CHECKOUT_TERM_SELECTED,function(){C&&u(function(){e.selectPaymentMethod(C),C=null},0)});var E={"font-family":"'Helvetica Neue', Arial, sans-serif","font-size":"13px",width:"100%",height:"38px","font-weight":"normal","box-sizing":"border-box",color:"#1c2544",padding:"0px","background-color":"#ffffff"},S={country:e.getGeoCountryCode()};function T(){e.input.storeInVault=i.credit_card.store_in_vault,e.input.firstName=i.credit_card.first_name,e.input.lastName=i.credit_card.last_name,e.input.expiryMonth=i.credit_card.expire_month,e.input.expiryYear=i.credit_card.expire_year,e.input.email=i.credit_card.email,e.input.city=i.credit_card.city,e.input.countryState=i.state.billingData.stateCode,e.input.street=i.credit_card.address1,e.input.cardCountryCode=i.state.billingData.countryCode,e.input.cardZipCode=i.credit_card.cardZipCode,e.input.defaultPaymentMethodId=i.credit_card.store_in_vault&&i.cc.defaultPaymentMethodId,p.countryCode=i.state.billingData.countryCode,p.zipCode=i.credit_card.cardZipCode}i.$watch("countrySelectorOptions.selectorModel.item",function(r,a){var s=r&&r.countryCode,u=a&&a.countryCode;if(s&&u!==s&&u){S.country=s,n.deInit().then(function(){n.init(E,S)}),e.disableCheckout(),t(i).reset();var l={termId:e.getSelectedTerm().termId,termChangeCountryCode:s,offerId:window.TPParam.params.offerId};C=angular.copy(e.flags.selectedPaymentMethod),c.changeTerm(l).then(function(t){var n=e.getSelectedTerm();t.newTermId&&n&&t.newTermId!==n.termId&&(i.cc.initiated=!1,e.selectTerm(t.newTermId)),e.enabledCheckout()}).catch(function(n){n.forEach(function(e){t(i).global({message:o.trc("checkout.platform",e.msg)}),console.warn(e)}),e.enabledCheckout()})}}),i.$on(EVENT_OBI_INITIATE_SUCCEED,function(t,r){e.getSelectedTerm();var o={orderId:e.input.oid};i.cc.defaultPaymentMethodId=r.defaultPaymentMethodId,c.loadCountries(o).then(function(t){var n=t.availableCountries.map(function(e){var t=window.TPParam.config.taxCountries.filter(function(t){return t.countryCode===e.countryCode})[0],n=angular.copy(t);return n.stateList=e.regions.map(function(e){return{stateCode:e.regionCode,name:e.regionName}}),n});if(i.countrySelectorOptions.items=n,!i.countrySelectorOptions.selectorModel.item.name){var r=e.getGeoCountryCode(),o=n.filter(function(e){return e.countryCode===r});o.length>0&&(i.selectCountry(o[0]),i.countrySelectorOptions.selectorModel.item=o[0],i.countrySelectorOptions.selectorModel.label=o[0].name)}}),void 0!==r.stored&&(i.cc.stored=JSON.parse(r.stored)),i.cc.storedRurl=r.stored_rurl,i.cc.payWithNew=void 0===i.cc.stored||0===i.cc.stored.length||i.cc.payWithNew&&i.cc.initiated,i.cc.selectedUpiId=void 0!==i.cc.stored&&i.cc.stored.length>0?i.cc.stored[0].id:null,i.cc.initiated=!0,i.credit_card.email=e.config.user.email,m=r.createInstrumentUrl,h=r.termId,g=r.obickUrl,S.serverUrl=r.obiPaymentMethodServerUrl,S.merchant3ds=r.merchant,S.threeDSOrgUnitId=r.orgUnitId,r.tokenServiceUrl&&(S.tokenServiceUrl=r.tokenServiceUrl),n.init(E,S)}),i.$on(EVENT_OBI_BEFORE_PROCESS,function(r,a){e.disableCheckout(),T(),i.cc.payWithNew?n.createCardToken({}).then(function(t){T(),e.input.token=t.token,e.input.reference=t.referenceId;var n={sourceId:i.PAYMENT_PROVIDER_ID};return y.forEach(function(t){n[t]=e.input[t]}),l({method:"post",url:m,params:{aid:e.params.aid,termId:h,userToken:e.params.userToken,userProvider:e.params.userProvider},data:n})}).then(function(e){f=e.models.initModel,a.resolve(y)}).catch(function(e){(e&&e.errors?e.errors:n.processError(e)).forEach(function(e){t(i).global({message:o.trc("checkout.platform",e.msg)})}),d.gotoPreviousState(),a.reject()}).finally(function(){e.enabledCheckout()}):(a.resolve(),e.enabledCheckout())}),i.$on(EVENT_OBI_BEFORE_CONFIRM,function(){T(),i.cc.payWithNew?e.setUpiId(void 0):e.setUpiId(i.cc.selectedUpiId)}),i.$on(EVENT_OBI_PROCESS_SUCCEED,function(c,s,u){if(e.disableCheckout(),i.cc.payWithNew)a.when(f).then(function(e){var t=s.rurl+"&instrumentId="+e.id;if(!("string"==typeof e.require3DS&&"true"===e.require3DS||"boolean"==typeof e.require3DS&&e.require3DS))return t;var r={stepUpUrl:e.stepUpURL,jwt:e.jwt,transactionId:e.transactionId,obickUrl:g};return n.process3DS(r).then(function(e){return"Y"!==e.challengeStatus?a.reject({status:"three_ds_challenge_completed",message:o.trc("checkout.platform","Authentication failed")}):t+"&threeDSTransactionId="+e.threeDSTransactionId})}).then(function(e){u.resolve(),r.injectHiddenIframe("obi-provider-form-component-iframe",e)}).catch(function(e){console.error(e),u.reject(),n.processError(e).forEach(function(e){t(i).global({message:o.trc("checkout.platform",e.msg)})})}).finally(function(){e.enabledCheckout()});else{var l=i.cc.storedRurl+"&id="+i.cc.selectedUpiId;r.injectHiddenIframe("obi-provider-form-component-iframe",l)}}),i.$on(EVENT_OBI_DECLINED,function(t,n){e.enabledCheckout()}),i.$on(EVENT_OBI_COMPLETE_FAILED,function(n,r){e.reInitPurchase(),d.gotoPreviousState(),function(e){if(!Array.isArray(e))return void t(i).global(e.message);for(var n=0;n<e.length;n++){var r=e[n].msg||e[n].message;r&&""!==r.trim()&&t(i).global(r)}}(r)}),i.cc={},i.cc.payWithNew=!0,i.cc.selectedUpiId=null,i.cc.initiated=!1,i.cc.defaultPaymentMethodId=null,i.credit_card={},i.credit_card.store_in_vault=!0,propagatePaymentVars(e,i)}]}}angular.module("obiCheckoutModule").factory("obiProvider",obiProviderFactory).factory("obiCheckoutService",obiCheckoutServiceFactory),obiProviderFactory.$inject=["$rootScope","$q"],obiCheckoutServiceFactory.$inject=["$q","$window","checkout","tpHTTP","statsService"],angular.module("obiCheckoutModule").directive("obiFormComponent",obiFormComponent),obiFormComponent.$inject=["checkout","errorService","obiIntegrationService","iframeService","lang","creditCardUtils","$q","obiCheckoutService","ngEventService","$timeout","tpHTTP","viewService","billingConfig"],angular.module("obiPaypalCheckoutModule",["checkoutModule","paymentProviderModule","tpComponentsModule","obiCommonModule"]);var EVENT_OBI_PAYPAL_INITIATE_SUCCEED="EVENT_OBI_PAYPAL_INITIATE_SUCCEED",EVENT_OBI_PAYPAL_BEFORE_CONFIRM="EVENT_OBI_PAYPAL_BEFORE_CONFIRM",EVENT_OBI_PAYPAL_BEFORE_PROCESS="EVENT_OBI_PAYPAL_BEFORE_PROCESS",EVENT_OBI_PAYPAL_PROCESS_SUCCEED="EVENT_OBI_PAYPAL_PROCESS_SUCCEED",EVENT_OBI_PAYPAL_DECLINED="EVENT_OBI_PAYPAL_DECLINED",EVENT_OBI_PAYPAL_COMPLETE_SUCCEED="EVENT_OBI_PAYPAL_COMPLETE_SUCCEED",EVENT_OBI_PAYPAL_COMPLETE_FAILED="EVENT_OBI_PAYPAL_COMPLETE_FAILED";function obiPaypalProviderFactory(e,t){var n={beforeInitiate:function(){},initiateSucceed:function(t){e.$broadcast(EVENT_OBI_PAYPAL_INITIATE_SUCCEED,t)},initiateFailed:function(e){},beforeProcess:function(){return e.$broadcast(EVENT_OBI_PAYPAL_BEFORE_PROCESS),["email","paypalEmail","residenceCountryCode"]},beforeConfirm:function(){return e.$broadcast(EVENT_OBI_PAYPAL_BEFORE_CONFIRM),["city","countryState","street","cardCountryCode","cardZipCode"]},processSucceed:function(n){var r=t.defer();return e.$broadcast(EVENT_OBI_PAYPAL_PROCESS_SUCCEED,n,r),r.promise},processFailed:function(e){},confirmed:function(e){},declined:function(t){e.$broadcast(EVENT_OBI_PAYPAL_DECLINED,t)},completeSucceed:function(t){e.$broadcast(EVENT_OBI_PAYPAL_COMPLETE_SUCCEED,t)},completeFailed:function(t){e.$broadcast(EVENT_OBI_PAYPAL_COMPLETE_FAILED,t)}};return n}function obiPaypalFormComponent(e,t,n,r,o,i,a,c,s,u){return{restrict:"A",require:"^view",transclude:!0,templateUrl:"/widget/checkout/component/partials/obi-paypal-form-component.html",scope:{skipValidation:"@"},link:function(e,t,n,r){r.registerComponentController(e)},controller:["$scope",function(r){angular.extend(r,BaseComponentController);var l=-1,d=function(){r.stored=[],r.data={},r.data.selectedCountry=null,r.data.selectedUpi=null,r.data.newUpi=null};function p(){r.stored.length>0&&(r.data.selectedUpi=r.stored[0])}function f(e){if(Array.isArray(e))for(var n=0;n<e.length;n++){var o=e[n].msg||e[n].message;o&&""!==o.trim()&&t(r).global(o)}else t(r).global(e.message)}function m(){r.data.newUpi=null,r.stored.splice(r.stored.length-1,1),r.data.selectedUpi.isNew&&(r.data.selectedUpi=null,p())}r.isCountrySelected=function(){return null!==r.data.selectedCountry},r._isValid=function(){if(!0!==e.isPreviewMod()){if(t(r).reset(),!e.isPaymentMethod(OBI_PAYPAL)||e.isMockUsed())return!0;if(!r.data.selectedCountry&&!r.data.selectedUpi)return t(r).global(o.trc("checkout.platform","Please select billing country")),!1;if(!r.data.selectedUpi)return t(r).global(o.trc("checkout.platform","Please select one of your PayPal accounts or add new one")),!1}return!0},r.$on(EVENT_OBI_PAYPAL_BEFORE_CONFIRM,function(){if(r.data.selectedUpi.billingAddress&&(e.input.city=r.data.selectedUpi.billingAddress.city,e.input.countryState=r.data.selectedUpi.billingAddress.state,e.input.street=r.data.selectedUpi.billingAddress.street,e.input.cardCountryCode=r.data.selectedUpi.billingAddress.country,e.input.cardZipCode=r.data.selectedUpi.billingAddress.postalCode),r.data.selectedUpi){if(r.data.selectedUpi.isNew)u.residenceCountryCode=r.data.selectedCountry;else{var t=function(){if(r.data.selectedUpi)for(var e=0;e<r.stored.length;e++){var t=r.stored[e];if(t.id===r.data.selectedUpi.id)return u.taxRequestFromUpi(t)}return null}();u.residenceCountryCode=t.residenceCountryCode}e.setUpiId(r.data.selectedUpi.id)}else e.setUpiId(void 0)}),r.$on(EVENT_OBI_PAYPAL_INITIATE_SUCCEED,function(t,n){l=e.getSelectedTerm().chargeAmount,r.stored=JSON.parse(n.stored),Object.keys(r.stored).forEach(function(e){var t=r.stored[e];t.billingAddress&&"string"==typeof t.billingAddress&&(t.billingAddress=JSON.parse(t.billingAddress))}),r.data.newUpi&&r.stored.push(r.data.newUpi),r.data.selectedUpi||p(),r.initUrl=n.init_url,r.storedUrl=n.storedUrl,r.commonUrl=n.commonUrl;e.getSelectedTerm();var o={orderId:e.input.oid};a.loadCountries(o).then(function(t){var n=t.availableCountries.map(function(e){var t=window.TPParam.config.taxCountries.filter(function(t){return t.countryCode===e.countryCode})[0],n=angular.copy(t);return n.stateList=e.regions.map(function(e){return{stateCode:e.regionCode,name:e.regionName}}),n});if(r.countrySelectorOptions.items=n,!r.countrySelectorOptions.selectorModel.item.name){var o=e.getGeoCountryCode(),i=n.filter(function(e){return e.countryCode===o});i.length>0&&(r.selectCountry(i[0]),r.countrySelectorOptions.selectorModel.item=i[0],r.countrySelectorOptions.selectorModel.label=i[0].name)}})}),r.$on(EVENT_OBI_PAYPAL_PROCESS_SUCCEED,function(t,o){e.disableCheckout(),n.processPurchase(r.data.selectedUpi,r.storedUrl,r.commonUrl,r.data.selectedCountry)}),r.$on(EVENT_OBI_PAYPAL_DECLINED,function(t,n){e.enabledCheckout()}),r.$on(EVENT_OBI_PAYPAL_COMPLETE_FAILED,function(t,n){e.reInitPurchase(),s.gotoPreviousState(),f(n)}),i.subscribe(EVENT_CHECKOUT_STARTED,function(){d()}),i.subscribe(EVENT_CHECKOUT_PRICE_CHANGED,function(){var t=e.input.chargeAmount;r.data.newUpi&&t!==l&&m(),l=t}),i.subscribe(EVENT_CHECKOUT_RELOADED,function(){var t=e.getSelectedTerm();r.data.newUpi&&t.chargeAmount!==l&&m(),l=t.chargeAmount}),r.addNewAccount=function(){var e=r.initUrl;n.addPaypalAccount(e,r.data.selectedCountry).then(function(e){r.data.newUpi={id:void 0,isNew:!0,instrumentId:e.instrumentId,billingAddress:{country:e.country,state:e.state,city:e.city,street:e.street,postalCode:e.postalCode},email:e.email,paypalEmail:e.paypalEmail},r.stored.push(r.data.newUpi),r.data.selectedUpi=r.data.newUpi}).catch(function(e){e&&f(e)})},r.cancelNewAccount=m,r.canContinue=function(){return!!r.data.selectedUpi},r.countrySelectorOptions={selectorModel:{label:"",item:{}},items:[]},r.selectCountry=function(e){e.countryCode!==r.data.selectedCountry&&(r.data.selectedCountry=e.countryCode)};var h=null;i.subscribe(EVENT_CHECKOUT_TERM_SELECTED,function(){h&&c(function(){e.selectPaymentMethod(h),h=null},0)}),r.$watch("countrySelectorOptions.selectorModel.item",function(n,i){var c=n&&n.countryCode,s=i&&i.countryCode;if(c&&s!==c&&s){e.disableCheckout(),t(r).reset();var u={termId:e.getSelectedTerm().termId,termChangeCountryCode:c,offerId:window.TPParam.params.offerId};h=angular.copy(e.flags.selectedPaymentMethod),a.changeTerm(u).then(function(t){var n=e.getSelectedTerm();t.newTermId&&n&&t.newTermId!==n.termId&&e.selectTerm(t.newTermId),e.enabledCheckout()}).catch(function(n){n.forEach(function(e){t(r).global({message:o.trc("checkout.platform",e.msg)}),console.warn(e)}),e.enabledCheckout()})}}),d(),propagatePaymentVars(e,r)}]}}angular.module("obiPaypalCheckoutModule").factory("obiPaypalProvider",obiPaypalProviderFactory),obiPaypalProviderFactory.$inject=["$rootScope","$q"],angular.module("obiPaypalCheckoutModule").directive("obiPaypalFormComponent",obiPaypalFormComponent),obiPaypalFormComponent.$inject=["checkout","errorService","obiPaypalIntegrationService","iframeService","lang","ngEventService","obiCheckoutService","$timeout","viewService","billingConfig"];var tpComponentsModule=angular.module("tpComponentsModule",["generalModule","containerServiceModule"]);tpComponentsModule.directive("a",["trackExternalEvent","getTrackingId","addQueryParameterToUrl","$timeout","ngEventService",function(e,t,n,r,o){return{restrict:"E",link:function(i,a,c){r(function(){var e=a.attr("href");function r(){var e=void 0===a.attr("noptid"),r=t();e&&r&&a.attr("href",n(a.attr("href"),"_ptid",r))}e&&0===e.indexOf("http")&&("_parent"!==a.attr("target")&&a.attr("target","_blank"),r(),o.subscribe(EVENT_TRACKING_ID_CHANGED,function(){r()}))}),a.on("touchstart click",function(t){if("click"===t.type){var n=a.attr("href")||"";0===n.lastIndexOf("http",0)&&e("EXTERNAL_LINK",decodeURI(function(e){var t=e.split(/[?#]/)[0],n=t.length-1;return"/"===t[n]&&(t=t.slice(0,n)),t}(n)),{href:encodeURI(n)})}})}}}]),tpComponentsModule.directive("radioTrackBy",function(){return{restrict:"A",scope:{ngModel:"=",ngValue:"=",radioTrackBy:"@"},link:function(e){e.ngValue[e.radioTrackBy]===e.ngModel[e.radioTrackBy]&&(e.ngModel=e.ngValue)}}}),tpComponentsModule.factory("getExternalEventParams",function(){return function(e){var t,n={};for(var r in e)e.hasOwnProperty(r)&&0===r.indexOf("externalEvent")&&"externalEvent"!==r&&(n[(t=r.split("externalEvent")[1],t.charAt(0).toLowerCase()+t.slice(1))]=e[r]);return n}}),tpComponentsModule.directive("externalEvent",["eventService","getExternalEventParams","trackExternalEvent",function(e,t,n){return{restrict:"A",link:function(r,o,i){o.on("touchstart click",function(r){if("click"===r.type){var o=t(i);n("EXTERNAL_EVENT",i.externalEvent,o),e.customEvent("customEvent",{eventName:i.externalEvent,params:t(i)})}})}}}]),tpComponentsModule.directive("showIf",["$animate",function(e){return{restrict:"A",link:function(e,t,n){e.$watch(n.showIf,function(e){t.html(toBoolean(e)?e:""),t.toggleClass("ng-hide",toBoolean(e))})}}}]),tpComponentsModule.factory("checkMobile",["$q","$timeout","containerService",function(e,t,n){return function(){return n.getNewWidth()<=600}}]),tpComponentsModule.directive("mobile",["checkMobile",function(e){return{restrict:"A",transclude:!0,scope:{},template:'<div class="mobile-mode" ng-if="check()" ng-transclude></div>',controller:["$scope",function(t){t.check=function(){return e()}}]}}]),tpComponentsModule.directive("desktop",["checkMobile",function(e){return{restrict:"A",transclude:!0,scope:{},template:'<div class="desktop-mode" ng-if="check()" ng-transclude></div>',controller:["$scope",function(t){t.check=function(){return!e()}}]}}]),tpComponentsModule.directive("onEnter",["$parse",function(e){return function(t,n,r){var o=e(r.onEnter);n.bind("keyup",function(e){13===e.keyCode&&t.$apply(function(){o(t,{$event:e})})})}}]),tpComponentsModule.directive("errorMessage",["$parse",function(e){return{scope:!1,controller:["$scope","$element","$attrs","ngEventService","errorService","shakeService",function(e,t,n,r,o,i){var a=o(e).TYPES,c=o(e).getId(),s=n.name,u=n.errorMessage,l=null,d=function(){l&&l.remove(),t.removeClass("error")};r.subscribe(EVENT_ERRORS_CHANGED,function(){d();var n=null,r=o(e).errors();angular.forEach(r,function(e){angular.isObject(e)&&e.field===s&&e.type===a.COMPONENT&&(n=e)}),!t.is(":visible")||!n||n.displayed&&n.displayedOn!==c||(n.displayed=!0,"shake"===u?(i.shake(t),t.addClass("error")):(l=$("<div class='"+u+"'>"+n.message+"</div>"),t.after(l),t.addClass("error")))}),t.click(function(){d()})}]}}]),tpComponentsModule.directive("config",["containerService","configService",function(e,t){return{restrict:"E",link:function(n,r,o){isNumber(o.width)&&(e.setPreferredWidth(o.width),e.resize());var i=!1;angular.forEach(o,function(e,n){var r;r="$",n.substr(0,r.length)!==r&&(i=!0,t.setProperty(n,e))}),i&&t.changed()}}}]),tpComponentsModule.directive("hideIfBlank",["$animate",function(e){return{link:function(e,t){e.$watch(function(){},function(){var e=t.text().replace(/[\s\uFEFF\xA0\n]/gim,""),n=0===t.children().length&&""===e;t.toggleClass("ng-hide",n)})}}}]),tpComponentsModule.directive("reCaptcha",["ngEventService","checkMobile","containerService",function(e,t,n){var r=3;return{restrict:"EA",template:"",scope:{key:"@",showResetButton:"=?",onResolve:"&?",onReady:"&?"},link:function(e,o){var i=!1;if(!e.key)return void console.warn("There is no re-captcha site-key. See more: https://developers.google.com/recaptcha/docs/display");function a(t){if(0!==t)try{var n=grecaptcha.render(o.get(0),{sitekey:e.key,callback:l});e.showResetButton&&(o.addClass("re-captcha--right-padded"),u(n)),$(window).on("resize",_.debounce(c,300)),e.onReady&&e.onReady({id:n})}catch(e){setTimeout(function(){a(t--)},1e3)}else console.warn("ReCaptcha can't be initialized")}function c(){s(),function(){var e=n.getNewWidth()>320;if(!i)return void o.removeClass("re-captcha--mobile re-captcha--mobile-wide");e?o.addClass("re-captcha--mobile-wide"):o.removeClass("re-captcha--mobile-wide");o.addClass("re-captcha--mobile")}()}function s(){i=t()}function u(e){if(grecaptcha&&grecaptcha.reset){var t=document.createElement("div");t.className="reset-icon pn-icon--refresh",t.onclick=function(){grecaptcha.reset(e),u(e)},n=t,angular.element(".reset-icon.pn-icon--refresh").length||o.append(n)}var n}function l(t){o.addClass("captcha-resolved"),e.onResolve&&e.$apply(function(){e.onResolve({response:t})})}a(r),s(),e.resolve=l}}}]),tpComponentsModule.directive("ngEnter",function(){return function(e,t,n){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(n.ngEnter)}),t.preventDefault())})}}),angular.module("exceptionHandler",[]).factory("$exceptionHandler",["$log",function(e){return function(t,n){e.warn(t);var r=window.pnErrorHandler;r&&r.manualLog(t)}}]),window.PP_LIST={PAYPAL:1,CREDIT_CARD:4,DWOLLA:7,AMAZON:8,COINBASE:9,MOCK:5,ZERO:0,PAYPAL_BT:11,WORLDPAY_HPP:12,WORLDPAY_PAYPAL:13,WORLDPAY_IDEAL:14,WORLDPAY_ELV:15,SPREEDLY_CC:16,SPREEDLY_STRIPE_CC:17,SPREEDLY_BEANSTREAM:18,EDGIL_PAYWAY:19,WORLDPAY_CC_TOKEN:20,SPREEDLY_PAYU_LATAM:21,PAYPAL_EXPRESS_CHECKOUT:22,SPREEDLY_OPENPAY:23,EIGEN:24,APPLE_PAY_BT:25,OPENPAY_CASH:26,EASYPAY_MULTIBANCO:28,EASYPAY_MBWAY:29,EASYPAY_DIRECT_DEBIT:30,EASYPAY_BOLETO:31,KLARNA:32,OBI:33,OBI_PAYPAL:34,DATATRANS:35,DATATRANS_POSTFINANCE:36,ONET:37,APPLE_PAY_SS:38,CYBER_SOURCE:39,STRIPE:40,STRIPE_APPLEPAY:41,PAYWAY_APPLEPAY:42,WIRECARD:45},angular.extend(window,window.PP_LIST);var generalModule=angular.module("generalModule",["ui.router","ajaxServices","ngSanitize","appConfigModule"]);function getMonths(){return{"01":"1 - Jan","02":"2 - Feb","03":"3 - Mar","04":"4 - Apr","05":"5 - May","06":"6 - Jun","07":"7 - Jul","08":"8 - Aug","09":"9 - Sept",10:"10 - Oct",11:"11 - Nov",12:"12 - Dec"}}function getYears(){for(var e=(new Date).getFullYear(),t={},n=e;n<e+13;++n){t[(n+"").substring(2)]=n}return t}function isString(e){return"string"==typeof e}function isNumber(e){return e&&""!==e&&!isNaN(e)}function lowercase(e){return isString(e)?e.toLowerCase():e}function toBoolean(e){if("function"==typeof e)e=!0;else if(e&&0!==e.length){var t=lowercase(""+e);e=!("f"===t||"0"===t||"false"===t||"no"===t||"n"===t||"[]"===t)}else e=!1;return e}function _randomString(e){e||(e=5);for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}generalModule.factory("cookieService",function(){var e={getCookie:function(e){for(var t=e+"=",n=decodeURIComponent(document.cookie).split(";"),r=0;r<n.length;r++){for(var o=n[r];" "===o.charAt(0);)o=o.substring(1);if(0===o.indexOf(t))return o.substring(t.length,o.length)}return""},setCookie:function(e,t,n,r){var o=e+"="+t+";expires="+n;r&&(o+=";path="+r),document.cookie=o},eraseCookie:function(e,t){this.setCookie(e,"",(new Date).toUTCString(),t)}};return e});var util={debug:getParameterByName("debug"),log:function(){if(util.debug&&void 0!==window.console&&void 0!==window.console.log){var e=arguments;(function(){var e=["__webdriver_evaluate","__selenium_evaluate","__webdriver_script_function","__webdriver_script_func","__webdriver_script_fn","__fxdriver_evaluate","__driver_unwrapped","__webdriver_unwrapped","__driver_evaluate","__selenium_unwrapped","__fxdriver_unwrapped"],t=["_phantom","__nightmare","_selenium","callPhantom","callSelenium","_Selenium_IDE_Recorder"];for(var n in t){var r=t[n];if(window[r])return!0}for(var o in e){var i=e[o];if(window.document[i])return!0}for(var a in window.document)if(a.match(/\$[a-z]dc_/)&&window.document[a].cache_)return!0;return!!(window.external&&window.external.toString&&window.external.toString()&&-1!==window.external.toString().indexOf("Sequentum")||window.document.documentElement.getAttribute("selenium")||window.document.documentElement.getAttribute("webdriver")||window.document.documentElement.getAttribute("driver"))})()&&(e=function(e){var t="";try{for(var n=0;n<e.length;n++)try{t+=JSON.stringify(e[n])+", "}catch(e){t+=""+e}return e=[t]}catch(t){return e}}(e)),"object"==typeof window.console.log?window.console.log.apply.call(console.log,console,e):console.log.apply(console,e)}}},urlParams=null;function getParameterByName(e){if(!urlParams){var t,n=/\+/g,r=/([^&=]+)=?([^&]*)/g,o=function(e){return decodeURIComponent(e.replace(n," "))},i=window.location.search.substring(1);for(urlParams={};t=r.exec(i);)urlParams[o(t[1])]=o(t[2])}return urlParams[e]}function getQueryParamInStringByName(e,t){var n=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))}function getIntParam(e,t){var n=getParameterByName(e);return void 0!==n&&isNaN(n)?t:new Number(n)}BaseComponentController={_isValid:function(){return!0}};var EVENT_CHECKOUT_PAYMENT_METHODS_CHANGED="EVENT_CHECKOUT_PAYMENT_METHODS_CHANGED",EVENT_CHECKOUT_TERM_SELECTED="EVENT_CHECKOUT_TERM_SELECTED",EVENT_CHECKOUT_CONSENT_CHANGED="EVENT_CHECKOUT_CONSENT_CHANGED",EVENT_CHECKOUT_PRICE_CHANGED="EVENT_CHECKOUT_PRICE_CHANGED",EVENT_CHECKOUT_REDEEM_DONE="EVENT_CHECKOUT_REDEEM_DONE",EVENT_APPLE_PAY_CAN_MAKE_PAYMENTS="EVENT_APPLE_PAY_CAN_MAKE_PAYMENTS",EVENT_BILLING_COUNTRY_SELECTED="EVENT_BILLING_COUNTRY_SELECTED",EVENT_BILLING_FROM_TAX_REQUEST="EVENT_BILLING_FROM_TAX_REQUEST",EVENT_USER_ACCESS_CHANGED="EVENT_USER_ACCESS_CHANGED",EVENT_ERRORS_CHANGED="EVENT_ERRORS_CHANGED",EVENT_TERMINAL_ERROR="EVENT_TERMINAL_ERROR",EVENT_CONFIG_RELOAD="EVENT_CONFIG_RELOAD",EVENT_STATS_TRACKED="EVENT_STATS_TRACKED",EVENT_TRACKING_ID_CHANGED="EVENT_TRACKING_ID_CHANGED",EVENT_SETUP_CUSTOM_VARIABLES="setupCustomVariables",EVENT_SETUP_EVT_FIELDS="setupEVTFields";generalModule.factory("ngEventService",["$rootScope",function(e){var t={fire:function(t,n,r,o,i,a){if(!t||""===t)throw new Error("eventName is required");util.log("[NG EVENT SERVICE] Firing event:",arguments),e.$broadcast(t,n,r,o,i,a)},subscribe:function(t,n){if(!t||""===t)throw new Error("eventName is required");if(!n)throw new Error("callback is required");return e.$on(t,n)}};return t}]),generalModule.factory("stateService",function(){var e={active:!(TPParam&&TPParam.params?TPParam.params:{}).preload};return{get:function(t){return e[t]},set:function(t,n){e[t]=n}}}),generalModule.factory("eventLogger",["$http","$window",function(e,t){var n={log:"https://api.tinypass.com/api/v3/anon/error/log"};function r(r,o){try{var i=function(){var e={aid:null,offerId:null,gaTrackingId:null},n=location.href.match(/aid=([\w\d]+)&/),r=location.href.match(/offerId=([\w\d]+)&/);return n&&(e.aid=n[1]),r&&(e.offerId=r[1]),t.ga&&t.ga(function(t){e.gaTrackingId=t.get("trackingId")}),e}(),a=function(e,t,n){var r,o,i=[];try{r="string"==typeof t?{message:t}:JSON.stringify(t)}catch(e){r="parse error"}try{o=JSON.stringify(n)}catch(e){o="meta error"}return i.push("=====checkout event====="),i.push("eventName: "+e),t&&i.push("payload: "+r),i.push("meta: "+o),i.push("=====event body end====="),i.join("\n")}(r,o,i);if(!i)return;if("lGr3ciYmC7"!==i.aid&&"6qv8OniKQO"!==i.aid)return;e({method:"POST",url:n.log,data:"log_message="+a,headers:{"Content-Type":"application/x-www-form-urlencoded","Piano-request-without-spinner":1}})}catch(e){console.warn("can't log event due to:",e)}}return{logGaEvent:function(e){r("gaEvent",e)},logGaFailedEvent:function(e){r("gaEvent [FAILED]",e)},logEvent:r}}]),generalModule.factory("gaService",["$window","stateService","integrationEventsService","eventLogger",function(e,t,n,r){var o=["showOffer","termSelected","promoApplied","promoInvalid","loginSuccess","loginFailed","registrationFailed","registrationSuccess","checkoutSuccess"],i={},a=[],c=!1,s=function(){if(!angular.isArray(arguments[0]))return!!e.ga&&(e.ga.apply(this,arguments),!0);for(var t=0;t<arguments.length;++t)s.apply(this,arguments[t])};return i.notReadyEmitEvents=function(){return!t.get("active")||!c},i.sendGoogleAnalyticsEvent=function(e,t){if(i.notReadyEmitEvents())a.push({event:e,callback:t});else if(e){e.hitType="event",e.eventCategory=e.eventAction;var n=" ";e.eventAction="",angular.forEach(e.params,function(t,r){t&&(e.eventAction+=n+r+"_"+t,n="____",e.eventLabel+=" "+r+":"+t)});var c={},u=!1,l=function(){!u&&t&&(u=!0,t())};t&&(c.hitCallback=l),-1!==o.indexOf(e.eventCategory)&&(c.nonInteraction=!0);var d=s("send",e.hitType,e.eventCategory,e.eventAction,e.eventLabel,0,c);r.logGaEvent(e),setTimeout(l,1e3),d||l()}},i.execBatch=function(){if(c){var e=a;a=[],e.forEach(function(e){i.sendGoogleAnalyticsEvent(e.event,e.callback)})}},n.listenExternal("ga.created",function(){c=!0,i.execBatch()}),i}]),generalModule.factory("statsService",["ngEventService","stateService","gaService","$q","$http",function(e,t,n,r,o){var i=null,a=null,c=[],s=[];function u(){if(i)return r.when(i);var e=r.defer();return c.push(e),e.promise}function l(e){u().then(function(){angular.extend(i,e)})}return e.subscribe("trackStat",function(r,u){if(function(e){if(e&&e.preview){var t=e.preview;return"string"==typeof t?"true"===t:t}return!1}(u))p(u,{});else if(t.set("active",!0),n.execBatch(),TPParam.TRACK_SHOW){var l;if(TPParam.config){var d=Object.assign({},TPParam.config);delete d.taxCountries,l=d}else l=TPParam.config;o({method:"POST",url:TPParam.TRACK_SHOW,data:{initStatParams:u,checkoutConfig:l},headers:{"Piano-request-without-spinner":1}}).then(function(e){p(u,e.data.models.stats)})}function p(t,n){i=n,a=t,angular.forEach(c,function(e){e.resolve(i)}),c=[],angular.forEach(s,function(e){e.resolve(a)}),s=[],e.fire(EVENT_STATS_TRACKED,{params:a,stat:i})}}),{getStats:u,mergeStats:l,getParams:function(){var e=r.defer();return a?e.resolve(a):s.push(e),e.promise},trackView:function(e){"offer"!==e&&TPParam.TRACK_VIEW&&u().then(function(t){o({method:"POST",url:TPParam.TRACK_VIEW,params:{view:e},data:{checkoutStats:t},headers:{"Piano-request-without-spinner":1}}).then(function(e){e&&e.models&&e.models.checkoutStats&&l(e.models.checkoutStats)})})}}}]),generalModule.factory("browserIdService",["ngEventService","$q",function(e,t){var n=t.defer();return e.subscribe("passBrowserId",function(e,t){n.resolve(t.browserId)}),{getBrowserId:function(){return n.promise}}}]),generalModule.factory("configService",["ngEventService",function(e){var t={};return{get:function(){return t},setProperty:function(e,n){t[e]=n},changed:function(){e.fire(EVENT_CONFIG_RELOAD,t)}}}]),generalModule.factory("apiService",["$http",function(e){var t={method:"post",headers:{"Piano-request-without-spinner":1}};return{call:function(n,r,o){var i=angular.copy(t);return i.url="/api/v3"+n,o&&(i.method=o),i.params=r,e(i)}}}]),generalModule.factory("modalService",["$rootScope","$q","$http","$templateCache","$injector","$timeout","$document","$compile","$controller",function(e,t,n,r,o,i,a,c,s){var u={},l={created:!1,visible:!1,domEl:null},d={created:!1,scope:null,domEl:null};return u.openDialog=function(i){var u,p,f,m={close:function(e){!function(e,t,n){var r=t.speed||600;l.created&&l.visible&&($(l.domEl).animate({opacity:0},r,"swing"),$(l.domEl).removeClass("active"),l.visible=!1),d.created&&$(d.domEl).animate({opacity:0,marginTop:0},r,"swing",function(){$(d.domEl).removeClass("active"),$(d.domEl).removeClass("error"),d.domEl.remove(),d.scope.$destroy(),d.scope=null,d.domEl=null,d.created=!1,n&&n()})}(0,i,e)}};if(util.log("MODAL OPTIONS",i),!i.template&&!i.templateUrl)throw new Error("One of template or templateUrl options is required.");t.all([(f=i,f.template?t.when(f.template):n.get(f.templateUrl,{cache:r}).then(function(e){return e.data}))].concat((u=i.resolve,p=[],angular.forEach(u,function(e,n){(angular.isFunction(e)||angular.isArray(e))&&p.push(t.when(o.invoke(e)))}),p))).then(function(t){var n=(i.scope||e).$new();n.close=m.close;var r={},o=1;i.controller&&(r.$scope=n,r.$modalInstance=m,angular.forEach(i.resolve,function(e,n){r[n]=t[o++]}),s(i.controller,r)),function(t,n,r){var o=a.find("body").eq(0);if(!l.created){var i=e.$new(!0),s=c('<div class="modal-overlay"></div> ')(i);o.append(s),l.created=!0,l.domEl=s}if(!l.visible){var u=$(l.domEl),p=r.speed||600;u.addClass("active"),u.animate({opacity:.7},p),l.visible=!0}var f=angular.element('<div class="modal '+(r.class||"")+'"></div>');f.addClass("active"),f.animate({opacity:1},p),f.html(n.content);var m=c(f)(n.scope);d.created=!0,d.scope=n.scope,d.domEl=f,o.append(m)}(0,{scope:n,content:t[0]},i)})},u.getModalEl=function(){return d?d.domEl:null},u}]),generalModule.factory("shakeService",function(){var e={shake:function(e){for(var t=Math.random()<.5?-2:2,n=0;n<10;n++)$(e).animate({"margin-left":(t=-t)+"px"},10+2*n);$(e).animate({"margin-left":0},5)}};return e}),generalModule.factory("EventManager",function(){return function(){var e={};return{emit:function(t,r){n(t);var o=e[t];if(!o)return void console.info("Event `",t,"` with no subscribers was emitted.");o.forEach(function(e){e.call(this,r)})},subscribe:function(r,o){n(r),function(e){if("function"!=typeof e)throw new TypeError("Expected callback to be a function, but got "+e)}(o);var i=e[r];i||(i=e[r]=[]);return i.push(o),t.bind(null,r,o)},unsubscribe:t};function t(t,r){n(t);var o=e[t];if(o){var i=o.indexOf(r);-1!==i?o.splice(i,1):console.warn("Given callback was not found for the event `{0}`.".format(t))}else console.warn("Attempt to unsubscribe from the unknown event `{0}`.".format(t))}function n(e){if(!e)throw new TypeError("Expected event name to be a non-empty string, but got "+e)}}}),generalModule.directive("customScript",function(){return{restrict:"A",scope:{},link:function(e,t,n){var r=document.createElement("script");r.type="text/javascript",r.innerText=t.text(),r.innerHTML=t.text(),t.empty(),document.getElementsByTagName("body")[0].appendChild(r)}}}),generalModule.directive("boilerplateCloseButton",["configService",function(e){return{restrict:"E",transclude:!0,replace:!0,template:"<div ng-if='isShowBoilerplateCloseButton()' class='boilerplate-close-button' ng-click='close()'></div>",link:function(t,n,r){t.isShowBoilerplateCloseButton=function(){var t=e.get().closeButtonType;return"false"!==getParameterByName("showCloseButton")&&"boilerplate"===t}}}}]),generalModule.directive("pnSticky",["$timeout","$interval","utilsService",function(e,t,n){return{restrict:"A",link:function(e,r){var o=r.parent(),i=o[0];o.scroll(n.throttle(function(){u(),i.scrollHeight>i.clientHeight?s||(r.css({position:"fixed",bottom:"0"}),s=!0):s&&(r.css({position:"static",bottom:""}),s=!1)},200));var a=t(function(){i.scrollHeight>i.clientHeight&&(r.css({position:"fixed",bottom:"0"}),u())},100,100),c=!1,s=!1;function u(){c||(t.cancel(a),c=!0)}e.$on("$destroy",u)}}}]),generalModule.factory("windowStateService",[function(){return{checkIframeOrChildWindow:function(){return!0}}}]),generalModule.factory("exposeTemplateParams",function(){return function(e){var t=["aid","debug","displayMode","iframeId","offerId","tags","templateId","templateVariantId","url","width"].concat(["trackingId","experienceId","experienceExecutionId","experienceActionId"]),n={};return angular.forEach(t,function(t){e[t]&&(n[t]=e[t])}),n}}),generalModule.factory("exposeCustomVariables",function(){return function(e){var t={};try{t=JSON.parse(e)}catch(e){}return t}}),generalModule.factory("exposeCustomCookies",function(){return function(e){var t={};try{t=JSON.parse(e)}catch(e){}return t}}),generalModule.factory("exposeActiveMeters",function(){return function(e){var t=[];try{t=JSON.parse(e)}catch(e){}return t}}),generalModule.service("integrationEventsService",function(){this.dispatchLocal=function(e,t){IntegrationEvents.dispatchLocal(e,t)},this.listenExternal=function(e,t){IntegrationEvents.listenExternal(e,t)},this.listenLocal=function(e,t){IntegrationEvents.listenLocal(e,t)}}),generalModule.factory("topLocation",["$window","eventService","$q",function(e,t,n){var r=function(){var r=n.defer();return t.postMessage("getLocation",{resultCallback:function(t){var n=e.document.createElement("a");n.href=t.result,r.resolve(n)}}),r.promise};return r.hash=function(e){t.postMessage("setLocationHash",{hash:e})},r}]),generalModule.factory("addQueryParameterToUrl",function(){return function(e,t,n){var r,o;e.indexOf("#")>0?(o=e.indexOf("#"),r=e.substring(e.indexOf("#"),e.length)):(r="",o=e.length);var i=e.substring(0,o).split("?"),a="?";if(i.length>1){var c=i[1];c.length&&(a+=c+"&")}return a+=t+"="+encodeURIComponent(n),i[0]+a+r}}),generalModule.factory("setupTrackingId",["ngEventService",function(e){return function(t){var n=piano._getTrackingId();piano._setTrackingId(t),n!==t&&e.fire(EVENT_TRACKING_ID_CHANGED,t)}}]),generalModule.service("utilsService",["cookieService",function(e){this.isIphone=function(){return/iPhone/.test(navigator.userAgent)&&!window.MSStream},this.isIOS=function(){return!!navigator.platform&&/iP(ad|hone|od)/.test(navigator.platform)},this.contains=function(e,t){return angular.isArray(e)?e.some(function(e){return e===t}):(util.log("method contains() works only with Arrays"),!1)},this.last=function(e){if(angular.isArray(e))return e[e.length-1];util.log("method last() works only with Arrays")},this.forEach=function(e,t){return angular.isArray(e)?(e.forEach(function(e,n){t(e,n)}),e):angular.isObject(e)?(Object.keys(e).forEach(function(n){t(e[n],n)}),e):e},this.map=function(e,t){return angular.isArray(e)?e.map(function(e,n){return t(e,n)}):angular.isObject(e)?Object.keys(e).map(function(n){return t(e[n],n)}):[]},this.reduce=function(e,t,n){if(angular.isArray(e))return e.reduce(t,n)},this.find=function(e,t){if(angular.isArray(e))return e.find(t);util.log("method find() works only with Arrays")},this.filter=function(e,t){return angular.isArray(e)?e.filter(t):(util.log("method filter() works only with Arrays"),[])},this.omit=function(e,t){var n=[],r={};return"string"==typeof t&&(n=[t]),angular.isArray(t)&&(n=[].concat(t)),angular.isArray(e)&&e.forEach(function(e,t){r[t]=e}),angular.isObject(e)&&!angular.isArray(e)&&(r=angular.extend({},e)),n.forEach(function(e){delete r[e]}),r},this.debounce=function(e,t,n){var r;return function(){var o=this,i=arguments,a=n&&!r;clearTimeout(r),r=setTimeout(function(){r=null,n||e.apply(o,i)},t),a&&e.apply(o,i)}},this.setExtendExpiredAccessCookie=function(t,n){var r=new Date;r.setMonth(r.getMonth()+6),e.setCookie(t+"__eea",n?"true":"false",r.toUTCString(),"/")},this.removeExtendExpiredAccessCookie=function(t){e.eraseCookie(t+"__eea","/")},this.jwtDecode=function(e,t){if(e)return"";var n=!0===(t=t||{}).header?0:1;return JSON.parse(o(e.split(".")[n]))};var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function n(e){this.message=e}n.prototype=new Error,n.prototype.name="InvalidCharacterError";var r=window.atob&&window.atob.bind(window)||function(e){var r=String(e).replace(/=+$/,"");if(r.length%4==1)throw new n("'atob' failed: The string to be decoded is not correctly encoded.");for(var o,i,a=0,c=0,s="";i=r.charAt(c++);~i&&(o=a%4?64*o+i:i,a++%4)?s+=String.fromCharCode(255&o>>(-2*a&6)):0)i=t.indexOf(i);return s};var o=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(r(e).replace(/(.)/g,function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}(t)}catch(e){return r(t)}};this.throttle=function(e,t){var n,r,o=!1;return function i(){if(o)return n=arguments,void(r=this);e.apply(this,arguments),o=!0,setTimeout(function(){o=!1,n&&(i.apply(r,n),n=r=null)},t)}},this.callAll=function(e){e.forEach(function(e){"function"==typeof e&&e()})};var i=/^([_A-Za-z0-9-&№^=%'"!?*+.\/#\\$]+)@([_A-Za-z0-9-&№^=%'"!?*+.\/#\\]+)\.([_A-Za-z0-9-+.]+)$/;this.isEmailValid=function(e){var t=e&&e.trim();return!!t&&(!(t.length>255)&&i.test(t))},this.queryStringToMap=function(e){var t={};if(!e)return t;for(var n,r=/\+/g,o=/([^&=]+)=?([^&]*)/g,i=function(e){return decodeURIComponent(e.replace(r," "))};n=o.exec(e);)t[i(n[1])]=i(n[2]);return t}}]),generalModule.factory("getTrackingId",function(){return function(){return piano._getTrackingId()}}),generalModule.factory("trackExternalEvent",function(){return function(e,t,n){piano._logAutoMicroConversion(e,t,n)}}),generalModule.factory("interceptAjax",["lang",function(e){tinypass.waitLockedBy=null,tinypass.withoutWaitPanel=!1;var t=null;return tinypass.showWaitPanel=function(e,t){"function"==typeof window.CustomEvent&&document.dispatchEvent(new CustomEvent("EVENT_SHOW_WAIT_PANEL",{detail:{id:e,content:t}}))},tinypass.hideWaitPanel=function(e){(!e&&"others"===tinypass.waitLockedBy||e===tinypass.waitLockedBy)&&(t&&(t.stop(),t.remove()),tinypass.waitLockedBy=null)},{appendLoaderTo:function(n){document.addEventListener("EVENT_SHOW_WAIT_PANEL",function(r){!function(r){if(tinypass.withoutWaitPanel||tinypass.waitLockedBy)return;tinypass.waitLockedBy=r.detail.id||"others",t&&t.remove();t=r.detail.content?$('<div id="waitParent">'+r.detail.content+"</div>"):$('<div id="waitParent"><div id="waitPanel">'+e.tr("Loading...")+"</div></div>");$("."+n).prepend(t)}(r)})}}}]),generalModule.factory("keysService",[function(){return{isEscape:function(e){return"Esc"===e||"Escape"===e},isEnter:function(e){return"Enter"===e}}}]),generalModule.filter("encodeURIComponent",["$window",function(e){return e.encodeURIComponent}]);var Helper=function(){};Helper.wrapMethod=function(e,t,n){n[e]=function(n,r,o){return t[e](n,r,o)}};var IntegrationEvents=function(){var e={"externalApiFieldset.change":"externalApiFieldset.change","ga.created":"ga.created","ga.performance.tracker.created":"ga.performance.tracker.created"},t="_piano_._local_.",n="_piano_._external_.";function r(e){return t+e}function o(e){return n+e}function i(t){if(!(t in e))throw new Error("event "+t+" is not recognized")}function a(e){var t=angular.isDate(e),n=angular.isArray(e),r=angular.isObject(e);return t?new Date(e):n?angular.copy(e,[]):r&&!n?angular.copy(e,{}):e}return{dispatchLocal:function(e,t){i(e),document.dispatchEvent(new CustomEvent(r(e),{detail:a(t)}))},dispatchExternal:function(e,t){i(e),document.dispatchEvent(new CustomEvent(o(e),{detail:a(t)}))},listenLocal:function(e,t){document.addEventListener(r(e),function(e){t(e)})},listenExternal:function(e,t){document.addEventListener(o(e),function(e){t(e)})}}}();Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var r=arguments[1],o=0;o<n;){var i=t[o];if(e.call(r,i,o,t))return o;o++}return-1}});var piano=function(e){var t={},n={listen:function(t,n){e.listenLocal(t,n)},externalEvent:function(t,n){e.dispatchExternal(t,n)},_setTrackingId:function(e){t.trackingId=e},_getTrackingId:function(){return t.trackingId}},r=function(e,n){if(t.trackingId)switch(((TPParam||{}).params||{}).os||"desktop"){case"ios":case"android":o(e,n);break;default:parent.postMessage(JSON.stringify({event:"iframeLogRequest",url:e,queryParams:n}),"*")}},o=function(e,t){var n=[];for(var r in t){var o=t[r];n.push(encodeURIComponent(r)+"="+encodeURIComponent("object"==typeof o?JSON.stringify(o):o))}var i=e+"?"+(n=n.join("&"));if(!util.debug&&navigator.sendBeacon)navigator.sendBeacon(i);else{var a=new XMLHttpRequest;a.open("GET",i,!1),a.send()}};n._logAutoMicroConversion=function(e,n,o){var i={tracking_id:t.trackingId,event_type:e,event_group_id:n,custom_params:o||""};void 0!==n?void 0!==e?r("/api/v3/conversion/logAutoMicroConversion",i):util.log("Parameter eventType is required to log micro conversion."):util.log("Parameter eventGroupId is required to log micro conversion.")},n.logFunnelStep=function(e,n,o){var i={tracking_id:t.trackingId,step_number:e,step_name:n,custom_params:o||""};void 0!==e?void 0!==n?r("/api/v3/conversion/logFunnelStep",i):util.log("Parameter stepName is required to log funnel step."):util.log("Parameter stepNumber is required to log funnel step.")},n.logMicroConversion=function(e,n){var o={tracking_id:t.trackingId,event_group_id:e,custom_params:n||""};void 0!==e?r("/api/v3/conversion/logMicroConversion",o):util.log("Parameter eventGroupId is required to log micro conversion.")};var i=function(e,n,o,i,a,c,s){var u={tracking_id:t.trackingId,term_id:e,term_name:n};void 0!==e?void 0!==n?(void 0!==o&&(u.step_number=o),void 0!==i&&(u.amount=i),void 0!==a&&(u.currency=a),void 0!==c&&(u.custom_params=c),void 0!==s&&(u.conversion_category=s),r("/api/v3/conversion/log",u)):util.log("Parameter termName is required to log conversion."):util.log("Parameter termId is required to log conversion.")};return n.logConversion=function(e){"object"==typeof e?i(e.term_id,e.term_name,e.step_number,e.amount,e.currency,e.custom_params,e.conversion_category):i.apply(this,arguments)},n.reloadTemplateWithUserToken=function(e){},n}(IntegrationEvents);angular.module("appConfigModule",[]).factory("appConfigService",[function(){return{performanceMetrics:function(){return window.TPParam.performanceMetrics}}}]);var containerServiceModule=angular.module("containerServiceModule",["ui.router","ngSanitize","generalModule"]);containerServiceModule.factory("containerService",["$window","$rootScope","$rootElement","$timeout","$interval","$document","eventService","errorService","windowStateService","ngEventService",function(e,t,n,r,o,i,a,c,s,u){var l={};return l.$rootScope=t,l.rootElement=n,$(document).on("focus","input, textarea, select",function(){a.postMessage("inputFocus")}).on("blur","input, textarea, select",function(){a.postMessage("inputBlur")}),l.getConfig=function(){return{container:this._getConfigFn().container}},l.getPreferredWidth=function(){return this.preferredWidth},l.setPreferredWidth=function(e){this.preferredWidth=e},l.init=function(e,t){this._getConfigFn=t;var n=getParameterByName("displayMode");this.isModal="modal"===n,this.isPopup="popup"===n,this.isInline="inline"===n,this.isPreview=!!getParameterByName("preview"),this.isOpenedFromInlineCheckout="true"===getParameterByName("isOpenedFromInlineCheckout"),this.container=this.getConfig().container,this.suggestedWidth=getIntParam("width",1),this.preferredWidth=e.preferredWidth,l.initResizeHandler(this.container)},l.initResizeHandler=function(e){var t=document.createElement("iframe"),n=-1;e.css("position","relative"),t.width="100%",t.height="100%",t.setAttribute("style","position: absolute !important; z-index: -1 !important;"),e.prepend(t);var r=t.contentWindow||t.contentDocument,i=t.contentDocument||{};"function"==typeof ResizeObserver?new ResizeObserver(a).observe(t):r.onresize=a;function a(){var e=r.document?r.document.body:r.body,t=i.documentElement||{},o=Math.max(e.scrollHeight,t.scrollHeight,e.offsetHeight,t.offsetHeight,e.clientHeight,t.clientHeight);n!==o&&(n=o,l.resize())}o(a,500),window.onload=function(){l.resize()},l.onReady(function(){l.resize()}),u.subscribe("loaded",function(){l.resize()})},l.onReady=function(e){"loading"!==document.readyState?e():document.addEventListener?document.addEventListener("DOMContentLoaded",e):document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&e()})},u.subscribe("RESIZE_MODAL_CHECKOUT",function(e,t){var n=t.iframe,r=t.width;setTimeout(function(){l.suggestedWidth=r,n.config.width&&(l.suggestedWidth=r<n.config.width?r:n.config.width),l.resize()},100)}),l.resize=function(){var e=l.rootElement.height(),t=l.rootElement[0].parentElement?l.rootElement[0].parentElement.clientHeight:0,n=e||t;if(l.isModal||l.isPopup||l.isPreview){var r=l.getNewWidth();angular.element("body").css("min-width",r),angular.element("body").width(r),l.rootElement.width(r),l.container.width(r),a.resizeEvent({width:r,height:n}),setTimeout(l.scrollTop,500)}else a.resizeEvent({height:n})},l.scrollTop=function(){window.scrollTo(0,0)},l.getNewWidth=function(){var e=0;return l.isModal||l.isPopup?(e=l.suggestedWidth,l.preferredWidth<=l.suggestedWidth&&(e=l.preferredWidth)):e=l.suggestedWidth,parseInt(e)},l.getCenterScreen=function(e,t){e=e||0,t=t||0;var n=parseInt(getParameterByName("parentWidth"),10),r=parseInt(getParameterByName("parentDualScreenLeft"),10),o=parseInt(getParameterByName("parentDualScreenTop"),10);return{left:n/2-e/2+r,top:parseInt(getParameterByName("parentOuterHeight"),10)/2-t/2+o}},l.getOriginUrl=function(){return getParameterByName("url")},l.purge=function(e){try{l.rootElement.remove()}catch(e){}a.purgeEvent(e)},l.close=function(e){try{l.rootElement.remove()}catch(e){}a.closeEvent(e)},l}]);var tpDrop=function(e,t,n,r,o,i,a,c,s,u){var l=".tp-dropdown__container",d=".search-query";return function(e){return r.all({tpl:(t=e,t.template?r.when(t.template):o.get(t.templateUrl,{cache:i}).then(function(e){return e.data})),opts:r.when(e)}).then(p);var t};function p(e){var o,i,p=r.defer(),f=e.tpl,m=e.opts||{style:{width:200}},h=function(e){if(e.centerOn){var n=e.centerOn.parents().filter(function(){var e=$(this).css("position");return("fixed"===e||"absolute"===e)&&!1===$(this).hasClass("modal")}).last();return n.length>0?n:t.find("body")}return t.find("body")}(m),g=(m.scope||n).$new(),v=t.find("body");g.$close=function(e){y.remove(),p.resolve(e),v.removeClass("component-opened")},g.$dismiss=T,(m.rejecter||function(){var e=r.defer();return t.on("click",function n(r){t.off("click",n),r&&(r.preventDefault(),r.stopPropagation()),e.reject()}),e.promise}()).then(T,T),m.controller&&a(m.controller,{$scope:g});var y=c(angular.element(f))(g);h.append(y),v.addClass("component-opened");var C=function(){var e;!function(e,t){"right"===e.side&&e.centerOn.offset().left+e.centerOn.width()+t.width()>window.innerWidth&&(e.side="left");"left"===e.side&&e.centerOn.offset().left-t.width()<0&&(e.side="right")}(m,y),i=m.side||"bottom",o=function(e,t){return t.centerOn?function(e,t){var n=function(e,t,n,r,o){var a={};return a[e]=i(o.centerOn,e)+o.centerOn[n]()/2-o.style[t]/2,a}("right"===t.side||"left"===t.side?"top":"left","right"===t.side||"left"===t.side?"height":"width","right"===t.side||"left"===t.side?"outerHeight":"outerWidth",0,t);return n="right"===t.side?o("left","outerWidth",t,n):"left"===t.side?r("right","width","left","scrollLeft",e,t,n):"top"===t.side?r("bottom","height","top","scrollTop",e,t,n):o("top","outerHeight",t,n);function r(e,t,n,r,o,a,c){return c[e]=o[t]()-i(a.centerOn,n)-o[r](),c}function o(e,t,n,r){return r[e]=i(n.centerOn,e)+n.centerOn[t](),r}function i(e,t){return e.offset()[t]}}(e,t):function(e,t){return{left:e.width()/2-t.style.width/2,top:e.height()/2-t.style.height/2}}(e,t)}(h,m),y.css({display:"block",position:"absolute"}).on("click",function(e){e.preventDefault(),e.stopPropagation(),m.closeOnSelect&&T()}).addClass(i).addClass(m.cl).css(o).css(m.style),(e=angular.element(l)).is(":visible")&&e.find(d).focus()};if(g.type&&"enchained"===g.type){var E=s(C,50),S=function(){s.cancel(E)};p.promise.then(S,S)}else u(C,0);return p.promise;function T(e){y.remove(),p.reject(e),v.removeClass("component-opened")}}};tpDrop.$inject=["$injector","$document","$rootScope","$q","$http","$templateCache","$controller","$compile","$interval","$timeout"],angular.module("tpDrop.module",["ngSanitize","generalModule"]).factory("tpDrop",tpDrop);var userServiceModule=angular.module("userServiceModule",["ui.router","ajaxServices","ngSanitize","generalModule","tp.i18n"]);userServiceModule.factory("userService",["$rootScope","$rootElement","$q","tpHTTP","eventService","ngEventService","errorService","gaService","lang","utilsService","cookieService",function(e,t,n,r,o,i,a,c,s,u,l){var d=_randomString(16),p=null,f=!1,m=[],h={};h.$rootScope=e,h.rootElement=t;var g,v=function(){};function y(){var e=window.TPParam.params||window.TPParam.app||h.getConfig().app;return e?e.userProvider:""}function C(e){return e.extendExpiredAccessEnabled&&u.setExtendExpiredAccessCookie(h.getConfig().app.aid,e.extendExpiredAccessEnabled),h.loginSuccessNoPostMessage(e).then(function(){g&&g.resolve(e)})}return h.getConfig=function(){return{app:this._getConfigFn().app,user:this._getConfigFn().user,fillLoginIframeParams:this._getConfigFn().fillLoginIframeParams||v,fillLoginRequiredParamsToGoogleAnalytics:this._getConfigFn().fillLoginRequiredParamsToGoogleAnalytics||v,fillLoginRequiredEventParams:this._getConfigFn().fillLoginRequiredEventParams||v,fillLoginSuccessEventParams:this._getConfigFn().fillLoginSuccessEventParams||v}},h.init=function(e){if(this._getConfigFn=e,!TPParam.LOGIN)throw"Login handler URL (variable TPParam.LOGIN) is not set"},h.isUserValid=function(){return h.getConfig().user&&!0===h.getConfig().user.valid},h.isUserReadOnly=function(){if(this.isPianoIdUserProvider())return!1;var e=l.getCookie(h.getConfig().app.aid+"__eea"),t=h.getConfig().user;return"true"===e&&Date.now()>parseInt(t.login_timestamp,10)+t.token_expiration},h.isUserConfirmed=function(){return h.getConfig().user&&!1!==h.getConfig().user.confirmed},h.allowLogout=function(){return h.isUserValid()&&h.isProviderAllowLogout()},h.allowLogin=function(){return h.allowTinypassAccountsLogin()||h.isGigyaUserProvider()},h.allowTinypassAccountsLogin=function(){var e=h.getConfig().app;return e&&e.useTinypassAccounts},h.isPublisherUserRefProvider=function(){return"publisher_user_ref"===y()},h.isGigyaUserProvider=function(){return"gigya"===y()},h.isCondeUserProvider=function(){return"conde"===y()},h.isPianoIdUserProvider=function(){return"piano_id"===y()},h.isPianoIdLiteUserProvider=function(){return"piano_id_lite"===y()},h.isJanrainUserProvider=function(){return"janrain"===y()},h.allowMyAccountLogin=function(){return h.allowTinypassAccountsLogin()},h.allowTinypassAccountsLogout=function(){return h.isProviderAllowLogout()&&h.isUserValid()},h.isProviderAllowLogout=function(){return h.allowTinypassAccountsLogin()||h.isCondeUserProvider()||h.isPianoIdUserProvider()||h.isGigyaUserProvider()||h.isJanrainUserProvider()},h.logout=function(){h.isProviderAllowLogout()&&o.postMessage("logout",{closeOnLogout:getParameterByName("closeOnLogout")}),u.removeExtendExpiredAccessCookie(h.getConfig().app.aid),f=!1},h.loginSuccessNoPostMessage=function(e){return function(e){var t=n.defer();f?t.reject(!1):(f=!0,e||(e={}),h.getConfig().fillLoginSuccessEventParams(e),e.resultCallback=function(){angular.forEach(m,function(t){t.callback(e)}),m=u.filter(m,function(e){return!e.oneTime}),t.resolve(e)},o.postMessage("loginSuccess",e));return t.promise}(e)},h.onUserProfileUpdated=function(e){o.postMessage("userProfileUpdateSuccess",e)},h.register=function(){return h.login("register")},h.checkUser=function(e){return r({method:"get",url:"/checkout/user/check",params:e})},h.login=function(e){void 0===e&&(e="login");var t=getParameterByName("aid"),r=getParameterByName("url"),u=(g=n.defer()).promise;if(o.postMessage("loginStart",{}),u.finally(function(){o.postMessage("loginEnd",{})}),util.log("[USER SERVICE] Cannot continue without valid user...sending loginRequiredEvent"),h.allowTinypassAccountsLogin()){f=!1;var l={displayMode:"popup",aid:t,width:360,height:660,state:e,iframeId:"login-"+_randomString(10),host_url:r,url:window.location.href};h.getConfig().fillLoginIframeParams(l);var m=TPParam.LOGIN+"?"+$.param(l,!0)+"#/"+e;p=function(e,t){var n=parseInt(getParameterByName("parentWidth"),10),r=parseInt(getParameterByName("parentHeight"),10),o=e.width?e.width:n,i=e.height?e.height:r,a=parseInt(getParameterByName("parentDualScreenLeft"),10),c=parseInt(getParameterByName("parentDualScreenTop"),10),s=n/2-o/2+a,u=parseInt(getParameterByName("parentOuterHeight"),10)/2-i/2+c,l=window.open(t,d,"scrollbars=yes,status=0,toolbar=0,resizable=1, width="+o+", height="+i+", top="+u+", left="+s);return window.focus&&l.focus(),l}(l,m),i.subscribe("loginSuccess",function(e,t){if((t=t||{}).reloadAfterLogin=!0,g.resolve(t),C(t),p&&!1===p.closed){try{p.document.body.innerHTML=null}catch(e){}p.close()}})}else{var v={aid:t};h.getConfig().fillLoginRequiredParamsToGoogleAnalytics(v),c.sendGoogleAnalyticsEvent({eventAction:"loginRequired",eventLabel:"Login required",params:v});var y={};y.startScreen=e,h.getConfig().fillLoginRequiredEventParams(y),o.loginRequiredEvent(y).then(function(e){(e.callbackNotFound||!1!==e.result)&&(g.reject(!1),a().terminal(s.trc("checkout.platform","Cannot start checkout. User not logged in")))})}return g.promise},h.onLoginSuccess=function(e,t){e&&m.push({callback:e,oneTime:t})},h.cleanSuccessLoginCallbacks=function(){m=u.filter(m,function(e){return!e.oneTime})},h.loginSuccessPosted=function(){return f},h.setLoginSuccessPosted=function(e){f=e},h.onExternalLogin=C,i.subscribe("changeLocale",function(e,t){t&&t.locale&&s.list().then(function(e){for(var n in e)if(e[n].locale===t.locale){s.update(t.locale);break}})}),i.subscribe("externalLoginSuccess",function(e,t){(t=t||{}).reloadAfterLogin=!0,C(t)}),h.userChanged=function(e){g&&g.resolve(e)},h}]);var eventModule=angular.module("eventModule",["generalModule"]);eventModule.factory("eventService",["$window","$rootScope","$q","configService",function(e,t,n,r){var o={};return o.last=null,o.resultCallbacks={},o.postMessage=function(t,n){var r=((TPParam||{}).params||{}).os||"desktop";try{switch(r){case"ios":!function(e,t){window.webkit.messageHandlers[e].postMessage(t)}(t,n);break;case"android":!function(e,t){var n=JSON.stringify(t);PianoAndroid[e](n)}(t,n);break;default:!function(t,n){var r={};if(o.parentURL=getParameterByName("url"),r.sender=getParameterByName("iframeId"),r.displayMode=getParameterByName("displayMode"),r.recipient="opener",r.event=t,r.params=n,n&&n.resultCallback){var i=_randomString(16);r.params.resultCallbackId=i,o.resultCallbacks[i]=n.resultCallback,delete n.resultCallback}util.log("[EVENT SERVICE] Post message:"+t,r),$.postMessage(JSON.stringify(r),o.parentURL,"popup"===r.displayMode?e.opener:e.parent)}(t,n)}}catch(e){util.log("[EVENT SERVICE] Event wasn't expected: ",t)}},o.customPostMessage=function(e,t,n,r){var o={};o.sender=getParameterByName("iframeId"),o.event=e,o.params=t,util.log("[EVENT SERVICE] Custom post message:"+e,o),$.postMessage(JSON.stringify(o),n,r)},o.resizeEvent=function(e){if(e.iframeId=getParameterByName("iframeId"),null===o.last)o.postMessage("loaded",e),o.last=e;else if(e.height!==o.last.height||e.width!==o.last.width){var t=r.get().closeButtonType;void 0!==t&&(e.closeButtonType=t),o.postMessage("resize",e),o.last=e}},o.purgeEvent=function(e){o.postMessage("purge",e)},o.closeEvent=function(e){o.postMessage("close",e)},o.closeAndRefreshEvent=function(e){o.postMessage("closeAndRefresh",e)},o.checkoutStateChange=function(e,t){o.postMessage("checkoutStateChange",{stateName:e,offerId:TPParam.config.offerId,term:t})},o.startCheckoutEvent=function(e){o.postMessage("startCheckout",e)},o.startThreeDBankSecure=function(){o.postMessage("startThreeDBankSecure")},o.loginRequiredEvent=function(e){var t=n.defer();return e.resultCallback=function(e){t.resolve(e)},o.postMessage("loginRequired",e),t.promise},o.gigyaPasswordlessLoginEvent=function(e){e.iframeId=getParameterByName("iframeId"),o.postMessage("gigyaPasswordlessLogin",e)},o.customEvent=function(e,t){o.postMessage(e,t)},o.systemErrorEvent=function(e){o.postMessage("error",e)},o.submitPayment=function(e){o.postMessage("submitPayment",e)},o.completeEvent=function(e){o.postMessage("complete",e)},o.alreadyPurchasedEvent=function(e){o.postMessage("alreadyPurchased",e)},o.checkoutPaymentErrorEvent=function(e){o.postMessage("checkoutPaymentError",{message:e})},o.loginEvent=function(e){o.postMessage("login",e)},o.registerEvent=function(e){o.postMessage("register",e)},o.getParentSize=function(){o.postMessage("parentSize")},o.isMobileDevice=function(){return TPParam&&TPParam.params&&("ios"===TPParam.params.os||"android"===TPParam.params.os)},$.receiveMessage(function(e){var n;try{if(util.log("[EVENT SERVICE] Received message:",e),-1!==["https://core.spreedly.com","https://jsl.prod.obi.aol.com","https://pay.datatrans.com"].indexOf(e.origin))return;(n=JSON.parse(e.data)).sender&&0===n.sender.indexOf("piano-id-")&&(n.event=n.sender+"-"+n.event),t.$broadcast(n.event,n.params),n.params&&n.params.resultCallbackId&&o.resultCallbacks[n.params.resultCallbackId]&&(o.resultCallbacks[n.params.resultCallbackId](n.params),delete o.resultCallbacks[n.params.resultCallbackId])}catch(t){return void util.log("[EVENT SERVICE][Could not parse message:",e)}}),o}]);var errorModule=angular.module("errorModule",["generalModule"]);errorModule.factory("errorService",["$rootScope","eventService","ngEventService",function(e,t,n){var r={},o={GLOBAL:"global",COMPONENT:"component",TERMINAL:"terminal"};return function(i){var a={},c=null;return a.error=function(e,t){if(!i)throw Error("The $scope is undefined");var r=t;r||(r={}),angular.isString(r)&&(r={message:t}),r.type=e,r.errorInstanceId=i.errorInstanceId,c.errors.push(r),n.fire(EVENT_ERRORS_CHANGED)},a.global=function(e){a.error(o.GLOBAL,e)},a.globals=function(e){angular.forEach(e,function(e){a.error(o.GLOBAL,e)})},a.component=function(e){a.error(o.COMPONENT,e)},a.components=function(e){angular.forEach(e,function(e){a.error(o.COMPONENT,e)})},a.terminal=function(r){var a=r;a||(a={}),angular.isString(a)&&(a={message:r}),a.type=o.TERMINAL,i&&(a.errorInstanceId=i.errorInstanceId),n.fire(EVENT_TERMINAL_ERROR,a),e.terminalError=a.message,e.terminalErrorHeading=a.heading,t.systemErrorEvent({message:a.message})},a.reset=function(){i&&c.errors.length>0&&(c.errors=[],n.fire(EVENT_ERRORS_CHANGED,i.errorInstanceId))},a.errors=function(e){var t=[];if(i){var n=function(r){angular.forEach(r.errors,function(e){t.push(e)}),e||angular.forEach(r.children,function(e){n(e)})};n(c)}else angular.forEach(r,function(e){angular.forEach(e.errors,function(e){t.push(e)})});return t},a.childrenErrors=function(){var e=[];if(i){var t=function(n){angular.forEach(n.errors,function(t){e.push(t)}),angular.forEach(n.children,function(e){t(e)})};angular.forEach(c.children,function(e){t(e)})}else e=[];return e},a.resetDisplayed=function(){var e=a.getId();angular.forEach(r,function(t){var n=[];angular.forEach(t.errors,function(t){t.displayedOn!==e&&n.push(t)}),t.errors=n}),n.fire(EVENT_ERRORS_CHANGED,i.errorInstanceId)},a.TYPES=o,a.getId=function(){return i?i.errorInstanceId:null},function(){var e,t,n;if(i){if(!((n=i)&&n.$evalAsync&&n.$watch))throw Error("The first parameter should be scope");i.errorInstanceId?c=r[i.errorInstanceId]:(i.errorInstanceId=_randomString(16),c={children:[],errors:[],errorInstanceId:i.errorInstanceId,$id:i.$id},r[i.errorInstanceId]=c,(e=(t=function(e){return e?e.errorInstanceId?e.errorInstanceId:e.$parent?t(e.$parent):void 0:null})(i.$parent))&&r[e].children.push(c))}}(),a}}]);var dependencies=["exceptionHandler","generalModule","tpComponentsModule","checkoutModule","giftModule","promocodeModule","redemptionModule","externalVerificationModule","authModule","passThroughModule","country.selector","tpDrop.module","tp.i18n","paymentProviderModule","consentModule","html5.placeholder","amazonmwsModule","coinbaseModule","creditCardModule","mockModule","dwollaModule","paymentServiceModule","payPalModule","applePayBtModule","payWhatYouWantModule","spreedlyModule","alreadyHasAccessModule","zeroModule","confirmationModule","checkoutMockModule","bankSecureModule","sharedSubscriptionModule","continueThreeDSPurchaseModule","printAddressModule","providersModuleCH"],checkoutComponentsModule=angular.module("checkoutComponentsModule",dependencies);checkoutComponentsModule.constant("COMPONENT_TO_OPTIONS_MAP",{"account-header-component":{},"term-selector-component":{termSelector:!0},"promo-code-component":{},"pay-what-you-want-form-component":{},"auth-component":{},"payment-form-component":{paymentForm:!0},"already-has-access-component":{},"external-verification-component":{},"print-address-component":{},"confirmation-component":{},"gift-form-component":{},"redemption-component":{redemptionForm:!0}}),checkoutComponentsModule.directive("view",["$animate","checkout","COMPONENT_TO_OPTIONS_MAP","$compile","viewService","$timeout","performanceMetricsService","billingConfig","checkoutGoTo",function(e,t,n,r,o,i,a,c,s){var u="lazy-transclude",l='<div>    <div error-list=""></div>    <div class="'+u+'"></div>     <div class="clearfix"></div></div>';function d(e){var t=NodeFilter?NodeFilter.SHOW_ELEMENT:1,r=function e(t,n){var r=n||[],o=t.nextNode();return o?e(t,r.concat(o)):r}(document.createNodeIterator(e.get(0),t,null,null),null).map(function(e){return Array.prototype.slice.call(e.attributes)}).filter(function(e){return e.length}).reduce(function(e,t){return e.concat(t)},[]).map(function(e){return e.name});return Object.keys(n).filter(function(e){return-1!==r.indexOf(e)}).reduce(function(e,t){return angular.extend(e,n[t])},{})}return{restrict:"A",replace:!0,template:function(e,t){var n=d(e),r=e.get(0).innerHTML.trim();return o.registerState(t.view,n,r),l},link:function(e,n,c,s){var l="view-"+c.view,d=o.getStateManager(c.view);e.isPreviewMod=t.isPreviewMod,n.addClass("view "+l),n.attr("id",l),s.setViewAsInactive=function(){n.removeClass("view-show")},s.setViewAsActive=function(){if(n.addClass("view-show"),!n.hasClass("view-showed")){var t=function(e){return e.find("."+u)}(n);n.addClass("view-showed"),t.append(d.template),r(t.contents())(e),i(function(){a.onViewRendered(c.view)},0)}}},controller:["$scope","$q","$element","$attrs","ngEventService","viewService","$timeout","exposeTemplateParams","exposeCustomVariables","exposeActiveMeters","exposeCustomCookies","userService","giftService","redemptionService","setupTrackingId","statsService","browserIdService","offerStateService","isMobileUserAgent",function(e,n,r,o,i,a,s,u,l,d,p,f,m,h,g,v,y,C,E){var S=this;this.options={hasTermSelector:!1,hasPaymentForm:!1,hasRedemptionForm:!1,hasPasswordlessLoginForm:!1},this.active=!1,this.components=[],this.stateName=o.view,this.name="view-"+this.stateName,this.registerComponentController=function(e,t){e.providerName&&(this.components=this.components.filter(function(t){return e.providerName!==t.providerName})),t&&this.registerComponentOptions(t),this.components.push(e)},this.unregisterComponentController=function(e){this.components=this.components.filter(function(t){return t.$id!==e.$id})},this.registerComponentOptions=function(e){e&&e.termSelector&&(S.options.hasTermSelector=e.termSelector),e&&e.paymentForm&&(S.options.hasPaymentForm=e.paymentForm),e&&e.redemptionForm&&(S.options.hasRedemptionForm=e.redemptionForm),e&&e.passwordlessLoginForm&&(S.options.hasPasswordlessLoginForm=e.passwordlessLoginForm)},this._isValid=function(){var e=n.defer(),t=[];return angular.forEach(this.components,function(e){(!e._validateViewOnCompletePurchase||e._validateViewOnCompletePurchase&&e._validateViewOnCompletePurchase())&&e._isValid&&t.push(n.when(e._isValid()))}),n.all(t).then(function(t){var n=!0;angular.forEach(t,function(e){!1===e&&(util.log('["'+S.name+'" validation] component is not valid'),n=!1)}),e.resolve(n)},function(){util.log('["'+S.name+'" validation] validation has failed with rejection'),e.resolve(!1)}),e.promise},this.extendScope=function(n){function r(){n.app=t.config.app,n.terms=t.config.terms,n.user=t.config.user,n.passwordlessCaptchaEnabled=t.config.passwordlessCaptchaEnabled,n.input=t.input,n.billingConfig=c,n.access=t.access,n.selectedTerm=t.flags.selectedTerm,n.flags=t.flags,n.allowLogout=t.allowLogout,n.isShowBoilerplateCloseButton=t.isShowBoilerplateCloseButton,n.giftEmailParams=m.form,n.voucher=h.voucher,n.externalCheckoutConfig=t.getExternalCheckoutConfig(),n.gotoOfferState=C.gotoOfferState,n.getOfferState=C.getOfferState,n.preselectTermId=t.preselectTermId,n.startCheckoutWithPreselectedTerm=t.startCheckoutWithPreselectedTerm,v.getParams().then(function(t){var r={};angular.extend(r,TPParam.params),angular.extend(r,t),n.params=u(r),n.custom=l(r.customVariables||{}),n.customCookies=p(r.customCookies||{}),n.activeMeters=d(r.activeMeters||[]),y.getBrowserId().then(function(t){e.browserId=t})})}Helper.wrapMethod("startCheckout",t,n),Helper.wrapMethod("startRedemption",t,n),Helper.wrapMethod("allowRedemption",t,n),Helper.wrapMethod("canInitCheckoutWithAnon",t,n),Helper.wrapMethod("isUserValid",t,n),Helper.wrapMethod("isNewCustomer",t,n),Helper.wrapMethod("allowTinypassAccountsLogin",t,n),Helper.wrapMethod("allowTinypassAccountsLogout",t,n),Helper.wrapMethod("allowTinypassAccountsLogout1",t,n),Helper.wrapMethod("logout",t,n),Helper.wrapMethod("login",t,n),Helper.wrapMethod("register",t,n),Helper.wrapMethod("isSelectedTermLocked",t,n),Helper.wrapMethod("isPaymentMethod",t,n),Helper.wrapMethod("isSupportedWorldpayCcMethod",t,n),Helper.wrapMethod("isSupportedSpreedlyCcMethod",t,n),Helper.wrapMethod("isPaymentMethodSelected",t,n),Helper.wrapMethod("isMockUsed",t,n),Helper.wrapMethod("selectPaymentMethod",t,n),Helper.wrapMethod("resetPaymentSelection",t,n),Helper.wrapMethod("close",t,n),Helper.wrapMethod("canSelectPaymentMethod",t,n),Helper.wrapMethod("isPayWhatYouWantTerm",t,n),Helper.wrapMethod("isConfirmStepEnabled",t,n),Helper.wrapMethod("selectTerm",t,n),Helper.wrapMethod("isPasswordlessCheckoutEnabled",t,n),Helper.wrapMethod("isDoubleOptInEnabled",t,n),Helper.wrapMethod("isVatEuEnabled",t,n),Helper.wrapMethod("isVatCanadaEnabled",t,n),Helper.wrapMethod("isTaxUsEnabled",t,n),Helper.wrapMethod("isUsBillingCountryLabel",t,n),Helper.wrapMethod("isEuBillingCountryLabel",t,n),Helper.wrapMethod("isBillingCountryEnabled",t,n),Helper.wrapMethod("isPaymentTerm",t,n),Helper.wrapMethod("isTermSelected",t,n),Helper.wrapMethod("isExternalTerm",t,n),Helper.wrapMethod("isGiftTerm",t,n),Helper.wrapMethod("isPayableTerm",t,n),Helper.wrapMethod("isChargingTerm",t,n),Helper.wrapMethod("hasTax",t,n),Helper.wrapMethod("toggleVatColumn",t,n),Helper.wrapMethod("isVatColumnAvailable",t,n),Helper.wrapMethod("isTaxColumnVisible",t,n),Helper.wrapMethod("isVatColumnVisible",t,n),Helper.wrapMethod("getVatLabel",t,n),Helper.wrapMethod("gotoAuthState",t,n),Helper.wrapMethod("hasAccess",t,n),Helper.wrapMethod("isExternalCheckoutAvailable",t,n),Helper.wrapMethod("startExternalCheckout",t,n),Helper.wrapMethod("isPromoCodeAvailable",t,n),r(),n.isAuthorizationSupportedByPaymentMethod=function(){var e=t.flags.selectedPaymentMethod;return!e||e&&!0===e.authSupported},n.getFreeTrialType=function(){var e=t.getSelectedTerm(),n=e.originalBillingPlan?e.originalBillingPlan.billingPlanTable:null,r=e.billingPlanTable.some(function(e,t){return"true"===e.isFree&&(!n||"true"===n[t].isFree)}),o=e.billingPlanTable.some(function(e,t){return"true"===e.isFree&&n&&"false"===n[t].isFree});return r&&o?"FREE_TRIAL_TERM_PROMO":r?"FREE_TRIAL_TERM":o?"FREE_TRIAL_PROMO":"NOT_FREE_TRIAL"},n.getPayableTermType=function(){var e=t.getSelectedTerm();return t.isPayableTerm(e)?!t.alreadyPurchased()&&e.isSubscription&&e.hasFreeTrial?"FREE_TRIAL_SUBSCRIPTION":!t.alreadyPurchased()&&e.hasFreeTrial?"FREE_TRIAL":"PAYABLE":"NOT_PAYABLE_TERM"},n.getTaxType=function(){if(t.hasTax()){if(t.isTaxCnbcEnabled())return"CNBC";if(t.isVatEuEnabled())return"EU";if(t.isTaxUsEnabled())return"US";if(t.isVatCanadaEnabled()&&t.input.canadianTaxes.length>1)return"MANY_RATE_CA";if(t.isVatCanadaEnabled()&&1===t.input.canadianTaxes.length)return"ONE_RATE_CA"}return"NONE"},n.getReceiptType=function(){return t.isPaymentMethod(OPENPAY_CASH)?"OpenpayCash":t.isPaymentMethod(EASYPAY_MULTIBANCO)?"EasypayMultibanco":t.isPaymentMethod(EASYPAY_MBWAY)?"EasypayMbway":t.isPaymentMethod(EASYPAY_DIRECT_DEBIT)?"EasypayDirectDebit":t.isPaymentMethod(EASYPAY_BOLETO)?"EasypayBoleto":t.isPaymentMethod(ONET)?"Onet":t.isGiftTerm(t.flags.selectedTerm)?"GiftPurchase":n.isRedemption()?"GiftRedemption":t.isExternalTerm(t.flags.selectedTerm)?"External":t.isRegistrationTerm(t.flags.selectedTerm)?"Registration":"Purchase"},n.getReceiptTemplateConfig=function(){var e={footer:!0};return t.isPaymentMethod(EASYPAY_BOLETO)?(e.footer=!1,e):e},n.isRedemption=function(){return h.state===h.STATE_DONE},n.getSelectedPaymentMethodName=function(){return t.flags.selectedPaymentMethod?t.flags.selectedPaymentMethod.name:null},n.isApplePayPaymentMethod=function(){return t.isPasswordlessCheckoutEnabled()&&n.getSelectedPaymentMethodName()&&n.getSelectedPaymentMethodName().toLowerCase().includes("apple pay")},n.isTermDiscounted=function(){return t.flags.isDiscounted},n.isMobileUserAgent=E,n.isGigyaUserProvider=f.isGigyaUserProvider,n.allowLogin=f.allowLogin,n.allowInvalidUser=function(){return t.canInitCheckoutWithAnon()||"offer"===a.getActiveState()&&(f.allowTinypassAccountsLogin()||f.isGigyaUserProvider())},i.subscribe(EVENT_CHECKOUT_RELOADED,function(){r()}),i.subscribe(EVENT_VIEW_ACTIVATED,function(){s(function(){t.resize()})}),i.subscribe(EVENT_CHECKOUT_TERM_SELECTED,function(){r()}),i.subscribe(EVENT_CHECKOUT_PRICE_CHANGED,function(){r()}),i.subscribe(EVENT_STATS_TRACKED,function(){r()})},this.extendScope(e),a.registerView(this),this.registerComponentOptions(a.getStateManager(this.stateName).options)}]}}]),checkoutComponentsModule.factory("isMobileUserAgent",function(){return function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}}),checkoutComponentsModule.directive("autoCloseApplePayReceipt",["checkout","eventService",function(e,t){return{restrict:"A",scope:{closingDelay:"@?",transitionTimeUp:"@?",transitionTimeDown:"@?",animationOffsetBottom:"@?",animationOffsetTop:"@?",animationContainerSize:"@?"},link:{pre:function(){t.postMessage("toggleIframeShadow",{isEnabled:!1})},post:function(n,r){var o,i=anime.timeline({}),a=!1,c=r.find("button.apple-pay-receipt__close");function s(){n.closingDelay=n.closingDelay?parseInt(n.closingDelay,10):4e3,n.transitionTimeUp=n.transitionTimeUp?parseInt(n.transitionTimeUp,10):1300,n.transitionTimeDown=n.transitionTimeDown?parseInt(n.transitionTimeDown,10):1300,n.animationOffsetBottom=n.animationOffsetBottom?parseInt(n.animationOffsetBottom,10):300,n.animationOffsetTop=n.animationOffsetTop?parseInt(n.animationOffsetTop,10):100,n.animationContainerSize=n.animationContainerSize?parseInt(n.animationContainerSize,10):560,r.parent().height(n.animationContainerSize),o=r.parent().height()-n.animationOffsetBottom,i.add({targets:".apple-pay-receipt-animation-container",keyframes:[{translateY:o,opacity:0},{translateY:n.animationOffsetTop,opacity:1,duration:n.transitionTimeUp}],easing:"easeInOutSine"}).add({targets:".in .circle",strokeDashoffset:[anime.setDashoffset,0],easing:"easeInOutSine",duration:n.transitionTimeUp+200},n.transitionTimeUp/3).add({targets:".in .check",strokeDashoffset:[anime.setDashoffset,0],easing:"easeInOutSine",duration:600,complete:function(){c.toggleClass("apple-pay-button--disabled",!1)}},n.transitionTimeUp).add({targets:".apple-pay-receipt-animation-container",keyframes:[{translateY:n.animationOffsetTop,opacity:1},{translateY:o,opacity:0}],duration:n.transitionTimeDown,easing:"easeInOutSine",delay:100,begin:i.pause,complete:u}),setTimeout(l,n.closingDelay)}function u(){e.close(function(){t.postMessage("toggleIframeShadow",{isEnabled:!0})})}function l(){a||(a=!0,c.toggleClass("apple-pay-button--disabled",!0),i.play())}r.ready(function(){s()}),c.on("click touch",function(){l()})}}}}]),checkoutComponentsModule.directive("errorMsg",["errorService",function(e){return{restrict:"A",require:["^view","ngModel"],scope:{msg:"@errorMsg"},link:function(t,n,r,o){var i=o[0],a=o[1];t._isValid=function(){e(t).reset();var n=!0;return a.$error&&angular.forEach(a.$error,function(e,t){e&&(n=!1)}),n||e(t).global(t.msg),n},i.registerComponentController(t)}}}]),checkoutComponentsModule.directive("termSelectorComponent",["checkout","$sce",function(e,t){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/term-selector-component.html",link:function(e,t,n,r){r.registerComponentController(e,{termSelector:!0}),t.attr("id","term-selector-component"),e.extendScope=function(){r.extendScope(e)},e.extendScope()},controller:["$scope","$timeout","ngEventService",function(t,n,r){angular.extend(t,BaseComponentController),t.isTermDiscounted=function(){return e.flags.isDiscounted},t.isUnlimInterval=function(e){return e&&2147483647===parseInt(e.cycles,10)},angular.forEach(e.config.terms,function(e,n){t["term"+(n+1)]=e}),t._isValid=function(){return e.isTermSelected()},r.subscribe(EVENT_CHECKOUT_RELOADED,function(){t.extendScope()})}]}}]),checkoutComponentsModule.directive("dynamicName",["$parse",function(e){return{restrict:"A",priority:1e4,controller:["$scope","$element","$attrs",function(t,n,r){var o=e(r.dynamicName)(t);delete r.dynamicName,n.removeAttr("data-dynamic-name"),n.removeAttr("dynamic-name"),r.$set("name",o)}]}}]),checkoutComponentsModule.directive("paymentFormComponent",["checkout","providersServiceCH",function(e,t){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/payment-form-component.html",transclude:!0,link:function(e,t,n,r){r.registerComponentController(e,{paymentForm:!0}),t.attr("id","payment-form-component"),r.extendScope(e)},controller:["$scope",function(n){angular.extend(n,BaseComponentController),Helper.wrapMethod("isPaymentMethodRequired",e,n),Helper.wrapMethod("isZeroPayment",e,n),Helper.wrapMethod("isSelectedTermAutoRenewChoiceAvailable",e,n),n.hasNewFlow=function(){var n=e.flags.selectedPaymentMethod&&e.flags.selectedPaymentMethod.id,r=n===EDGIL_PAYWAY;return t.hasNewFlow(n)&&!r},n.input=e.input}]}}]),checkoutComponentsModule.directive("paymentMethodSelectorComponent",["checkout","ngEventService",function(e,t){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/payment-method-selector-component.html",link:function(e,t,n,r){r.registerComponentController(e),t.attr("id","payment-method-selector-component")},controller:["$scope",function(n){angular.extend(n,BaseComponentController),n.paymentMethods=e.input.paymentMethods,n.selectedPaymentMethod=null,t.subscribe(EVENT_CHECKOUT_PAYMENT_METHODS_CHANGED,function(e,t){util.log("[PM SELECTOR] Got new payment method event",t),n.paymentMethods=t}),n.selectPaymentMethod=function(t){return n.hasErrors()&&n.reset(),n.selectedPaymentMethod=t,e.selectPaymentMethod.apply(e,Array.prototype.slice.call(arguments))},Helper.wrapMethod("isPaymentMethod",e,n),Helper.wrapMethod("isPaymentMethodSelected",e,n),Helper.wrapMethod("resetPaymentSelection",e,n),Helper.wrapMethod("canSelectPaymentMethod",e,n),Helper.wrapMethod("isPaymentMethodRequired",e,n),Helper.wrapMethod("isZeroPayment",e,n),n._isValid=function(){return e.isPaymentMethodSelected()}}]}}]),checkoutComponentsModule.directive("closeButton",["checkout",function(e){return{restrict:"A",require:"^view",replace:!0,templateUrl:"/widget/checkout/component/partials/close-button-component.html",scope:{title:"@"},link:function(t,n,r,o){o.registerComponentController(t),n.on("click",function(){t.$apply(function(){e.close()})})},controller:["$scope",function(e){angular.extend(e,BaseComponentController)}]}}]),checkoutComponentsModule.directive("nextButton",["viewService",function(e){return{restrict:"A",require:"^view",replace:!0,templateUrl:"/widget/checkout/component/partials/next-button-component.html",scope:{title:"@"},link:function(t,n,r,o){o.registerComponentController(t),n.on("click",function(){t.$apply(function(){e.gotoNextView()})})},controller:["$scope",function(e){angular.extend(e,BaseComponentController)}]}}]),checkoutComponentsModule.directive("previousButton",["viewService",function(e){return{restrict:"A",require:"^view",replace:!0,templateUrl:"/widget/checkout/component/partials/previous-button-component.html",scope:{title:"@"},link:function(t,n,r,o){o.registerComponentController(t),n.on("click",function(){t.$apply(function(){e.gotoPreviousState()})})},controller:["$scope",function(t){angular.extend(t,BaseComponentController),t.hasPreviousState=e.hasPreviousState}]}}]),checkoutComponentsModule.directive("errorList",function(){return{restrict:"A",templateUrl:"/widget/checkout/component/partials/error-list-component.html",scope:!1,controller:["$scope","ngEventService","errorService","$timeout",function(e,t,n,r){e.errors=[];var o=n(e).getId();t.subscribe(EVENT_ERRORS_CHANGED,function(){e.errors.length=0,r(function(){var t=[],i=n(e).errors(!0);angular.forEach(i,function(e){e.displayed&&e.displayedOn!==o||(t.push(e),e.displayed=!0,e.displayedOn=o)}),r(function(){var r=n(e).childrenErrors();angular.forEach(r,function(e){e.displayed&&e.displayedOn!==o||(t.push(e),e.displayed=!0,e.displayedOn=o)}),t.length>0&&(e.errors=t)},0)},0)}),e.reset=function(){n(e).resetDisplayed()},e.hasErrors=function(){return e.errors&&e.errors.length},e.hasOneError=function(){return e.errors&&1===e.errors.length}}]}}),checkoutComponentsModule.directive("completePurchaseButton",["checkout","ngEventService",function(e,t){return{restrict:"A",require:"^view",replace:!0,templateUrl:"/widget/checkout/component/partials/complete-purchase-button-component.html",scope:{title:"@",isDisabled:"="},link:function(n,r,o,i){var a=!1;t.subscribe("PURCHASE_FAILED",function(){a=!1}),i.registerComponentController(n),r.on("click",function(){n.isDisabled||a||(a=!0,e.completePayment().finally(function(){a=!1}))})},controller:["$scope",function(e){angular.extend(e,BaseComponentController)}]}}]),checkoutComponentsModule.directive("gotoConfirmationButton",["checkout",function(e){return{restrict:"A",require:"^view",replace:!0,templateUrl:"/widget/checkout/component/partials/goto-confirmation-component.html",scope:{title:"@"},link:function(t,n,r,o){var i=!1;o.registerComponentController(t),n.on("click",function(){i||(i=!0,e.confirmPayment().finally(function(){i=!1}))})},controller:["$scope",function(e){angular.extend(e,BaseComponentController)}]}}]),checkoutComponentsModule.directive("accountHeaderComponent",["checkout",function(e){return{restrict:"A",templateUrl:"/widget/checkout/component/partials/account-header-component.html",replace:!0,link:function(e,t,n){e.noLanguage=n.hasOwnProperty("noLanguage")},controller:["$scope",function(t){t.login=e.login,t.logout=e.logout,t.isUserValid=e.isUserValid,t.allowTinypassAccountsLogin=e.allowTinypassAccountsLogin,t.allowTinypassAccountsLogout=e.allowTinypassAccountsLogout}]}}]),checkoutComponentsModule.directive("debugger",["checkout",function(e){return{restrict:"A",templateUrl:"/widget/checkout/component/partials/debugger.html",link:function(e){e.$watch(function(){return e.log.length},function(){$("#debugger #log-output").scrollTop(1e10)})},controller:["$scopes",function(t){t.app=e.config.app,t.terms=e.config.terms,t.log=e.log,t.input=e.input,t.access=e.access}]}}]),checkoutComponentsModule.directive("checkout",["checkout",function(e){return{restrict:"A",link:function(e,t){t.addClass("checkout")},controller:["$scope","$element","$attrs",function(t,n,r){var o={preferredWidth:r.width,preferredHeight:r.height};e.init(t,o)}]}}]),checkoutComponentsModule.directive("purchaseReceipt",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/purchase-receipt-component.html",link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e)}}}),checkoutComponentsModule.directive("registrationReceipt",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/registration-receipt-component.html",scope:{},link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e)}}}),checkoutComponentsModule.directive("externalReceipt",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/external-receipt-component.html",link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e)}}}),checkoutComponentsModule.directive("giftRedemptionReceipt",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/gift-redemption-receipt-component.html",link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e)}}}),checkoutComponentsModule.directive("giftPurchaseReceipt",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/gift-purchase-receipt-component.html",link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e)}}}),checkoutComponentsModule.directive("openpayCashReceipt",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/openpay-cash-receipt-component.html",link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e)}}}),checkoutComponentsModule.directive("easypayMultibancoReceipt",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/easypay-multibanco-receipt-component.html",link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e)}}}),checkoutComponentsModule.directive("easypayMbwayReceipt",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/easypay-mbway-receipt-component.html",link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e)}}}),checkoutComponentsModule.directive("easypayDirectDebitReceipt",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/easypay-direct-debit-receipt-component.html",link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e)}}}),checkoutComponentsModule.directive("easypayBoletoReceipt",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/easypay-boleto-receipt-component.html",link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e)}}}),checkoutComponentsModule.directive("onetReceipt",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/onet-receipt-component.html",link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e)}}}),checkoutComponentsModule.directive("canadianTaxes",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/canadian-taxes.html",link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e)}}}),checkoutComponentsModule.directive("canadianHint",function(){return{restrict:"A",require:"^view",templateUrl:"/widget/checkout/component/partials/canadian-taxes-hint.html",scope:{},controller:["$scope",function(e){angular.extend(e,BaseComponentController)}],link:function(e,t,n,r){r.registerComponentController(e),r.extendScope(e)}}}),checkoutComponentsModule.factory("offerStateService",["containerService","eventService","checkout",function(e,t,n){var r=getParameterByName("offerState"),o=[];return{registerState:function(e){r||(r=e),o.push(e)},getOfferState:function(){return r},gotoOfferState:function(o){if(e.isInline)return n.params.offerState=o,void t.startCheckoutEvent(n.params);r=o}}}]),checkoutComponentsModule.directive("offerState",function(){return{restrict:"A",replace:!0,transclude:!0,template:'<div><div class="offer-state" ng-if="state === getOfferState()"  > <div ng-transclude></div></div></div>',controller:["$scope","offerStateService",function(e,t){e.state="",e.registerState=function(n){e.state=n,t.registerState(n)},e.gotoOfferState=t.gotoOfferState,e.getOfferState=t.getOfferState}],link:function(e,t,n){e.registerState(n.offerState)}}}),checkoutComponentsModule.directive("hideIfNoPaymentMethods",function(){return{restrict:"A",scope:{subscriptionPaymentMethods:"="},link:function(e,t){e.subscriptionPaymentMethods&&e.subscriptionPaymentMethods.length||t.remove()}}}),checkoutComponentsModule.directive("boilerplateLoginDropdown",function(){return{restrict:"E",replace:!0,templateUrl:"/widget/checkout/component/partials/boilerplate-login-dropdown.html",controller:["$scope","$document",function(e,t){e.isDropdownOpen=!1,e.logoutToggle=function(){e.isDropdownOpen=!e.isDropdownOpen},e.displayUserName=function(e){return e.firstName&&e.lastName?e.firstName+" "+e.lastName:e.firstName||e.lastName?e.firstName||e.lastName:e.email},t.on("click",function(){e.isDropdownOpen&&(e.isDropdownOpen=!1,e.$apply())})}]}});var checkoutService=angular.module("checkoutServiceModule",["checkoutModule"]);checkoutService.factory("checkoutService",["tpHTTP","$q","$window","statsService",function(e,t,n,r){var o={getOffer$:null,isTimeOutDelay:!1,getOffer:function(i,a){return r.getStats().then(function(r){return!0===o.isTimeOutDelay?o.getOffer$.promise:(o.getOffer$=t.defer(),o.isTimeOutDelay=!0,setTimeout(function(){o.isTimeOutDelay=!1;var t=o.getOffer$;o.getOffer$=null,e({method:"post",url:n.TPParam.GET_OFFER,params:i,data:{checkoutStats:r}}).then(function(e){a.mergeStats(e),t.resolve(e)}).catch(function(e){t.reject(e)}).finally(function(){t=null})},10),o.getOffer$.promise)})},getAccess:function(o,i){return r.getStats().then(function(r){var a=i?i.termId:null;return e({method:"post",url:n.TPParam.GET_ACCESS,params:{aid:o.params.aid,offerId:o.params.offerId,termId:a,userToken:o.params.userToken,userProvider:o.params.userProvider,zone:o.params.zone,preview:o.params.preview,checkoutFlowId:o.params.checkoutFlowId,countryCode:o.getBillingCountryCode(),residenceCountryCode:o.getResidenceCountryCode(),billingZipCode:o.getBillingZipCode(),zipCode:o.input.zipCode},data:{checkoutStats:r}}).catch(function(e){t.reject(e)})})},getUserResource:function(r){var o={aid:r.params.aid,userToken:r.params.userToken,userProvider:r.params.userProvider};return e({method:"post",url:n.TPParam.GET_USER_RESOURCES,params:o,data:{checkoutStats:r.stats}}).catch(function(e){t.reject(e)})},setAsDefaultPaymentMethod:function(t){return e({method:"post",url:n.TPParam.APPLY_DEFAULT_PAYMENT_METHOD,params:t})},createOrder:function(t,o,i,a,c,s){return r.getStats().then(function(r){return e({method:"post",url:n.TPParam.CREATE_ORDER,params:{aid:t,offer_id:o,offer_template_id:i,userToken:a,term_id:c,zone:s.params.zone,experienceId:s.params.experienceId,preview:s.params.preview,oid:s.input.oid,checkoutFlowId:s.params.checkoutFlowId,countryCode:s.getBillingCountryCode(),residenceCountryCode:s.getResidenceCountryCode(),billingZipCode:s.getBillingZipCode(),zipCode:s.input.zipCode},data:{checkoutStats:r}}).then(function(e){return s.mergeStats(e),e})})},restoreCheckoutObjects:function(t){return e({method:"post",url:n.TPParam.RESTORE_CHECKOUT_OBJECTS,params:{oid:t},data:{}})}};return o}]);var viewService=angular.module("viewServiceModule",["checkoutModule"]);viewService.factory("viewService",["$q","$document","$window","$rootScope","$state","eventService","ngEventService","lang","errorService","userService","utilsService","$injector","statsService",function(e,t,n,r,o,i,a,c,s,u,l,d,p){var f={views:[],viewStack:[]};if(f.$stateProvider=window.$stateProvider,f.startState=null,f.steps=[],f.disabled=!1,f.preventStateChange=!1,f.stateManager={},d.has("$transitions")){var m=d.get("$transitions");m.onStart({to:!0},function(e,t){return f._viewStateChange({},e.to(),e.params(),e.from()),!1}),m.onError({},function(){util.log("NOT FOUND STATE")})}else f.viewStateChangeListener=r.$on("$stateChangeStart",function(e,t,n,r){e.preventDefault(),f._viewStateChange(e,t,n,r)}),r.$on("$stateNotFound",function(){util.log("NOT FOUND STATE")});return f._viewStateChange=function(e,t,o,c){if(!f.preventStateChange){for(var u=0;u<n.document.styleSheets.length;u++){var l=n.document.styleSheets[u],d=(l.ownerNode?l.ownerNode:l.owningElement).getAttribute("tp-style");null!==d&&d.indexOf("-custom-style")>-1&&(l.disabled=!0)}angular.forEach(f.views,function(e){if(e.active=!1,e.setViewAsInactive(),e.stateName===t.name){p.trackView(e.stateName),e.active=!0,e.setViewAsActive();for(var r=0;r<n.document.styleSheets.length;r++){var o=n.document.styleSheets[r],i=(o.ownerNode?o.ownerNode:o.owningElement).getAttribute("tp-style");"offer"!==t.name&&"checkout-custom-style"===i&&(o.disabled=!1),i===t.name+"-custom-style"&&(o.disabled=!1)}}});var m,h=window.navigator.userAgent,g=h.indexOf("MSIE"),v=h.indexOf("Trident/"),y=h.indexOf("Edge/");if(g>0||v>0||y>0)var C=setInterval(function(){var e=$("input:visible:focus").first();e.length?(e.blur().focus(),clearInterval(C)):$("input:visible").first().focus()},1e3);f.viewStack.length>o.step&&(m=f.viewStack[o.step].params),s(r).resetDisplayed(),a.fire(EVENT_VIEW_ACTIVATED,t,m),i.postMessage(EVENT_VIEW_ACTIVATED)}},f.registerState=function(e,t,n){f.stateManager[e]={options:t||{},template:n||""}},f.getStateManager=function(e){return f.stateManager[e]},f.isActive=function(e){var t=!1;return angular.forEach(f.views,function(n){n.stateName===e&&(t=n.active)}),t},f.registerView=function(e){e.stateName.match(/^state/)&&f.steps.push(e.stateName),"error"===e.stateName&&(f.errorView=e),f.$stateProvider.state(e.stateName,{url:"/"+e.stateName+"/:step"});for(var t=0;t<f.views.length;t++)if(f.views[t].stateName===e.stateName)return void(f.views[t]=e);f.views.push(e)},f._saveHistoryAndGoToState=function(e,t){if(f.isViewExists(e)){var n=l.last(f.viewStack);return(n&&"auth"===n.stateName||n&&"state2"===n.stateName&&"alreadyHasAccess"===e)&&f.viewStack.pop(),n&&n.stateName===e&&f.viewStack.pop(),e===f.startState&&(f.viewStack=[]),t&&t.term?i.checkoutStateChange(e,t.term):i.checkoutStateChange(e),f.viewStack.push({stateName:e,params:t}),o.go(e,{step:f.viewStack.length-1},{location:"replace",reload:!1})}s(r).terminal(c.trc("checkout.platform","Error. State {0} doesn't exist",e))},f.saveHistory=function(e,t){f.viewStack.push({stateName:e,params:t})},f.gotoState=function(e,t){return f._saveHistoryAndGoToState(e,t)},f._validateCurrentView=function(){util.log("[ViewService] validateCurrentView");for(var t=e.defer(),n=[],r=0;r<f.views.length;r++)f.views[r].stateName===o.current.name&&n.push(e.when(f.views[r]._isValid()));return e.all(n).then(function(e){var n=!0;angular.forEach(e,function(e){!1===e&&(util.log('[ViewService] view for state "'+o.current.name+'" is not valid'),n=!1)}),util.log("[ViewService] validateCurrentView result = ",n),n?t.resolve():t.reject()},function(){util.log("[ViewService] validateCurrentView has failed with rejection"),t.reject()}),t.promise},f.getActiveState=function(){for(var e=0;e<f.views.length;e++)if(f.views[e].active)return f.views[e].stateName;return null},f.getViews=function(){return f.views},f.isViewExists=function(e){var t=!1;return f.getViews().forEach(function(n){n.stateName===e&&(t=!0)}),t},f._validateViews=function(){util.log("[ViewService] validateViews");var t=e.defer(),n=[];return angular.forEach(f.views,function(t){t._isValid&&n.push(e.when(t._isValid()))}),e.all(n).then(function(e){var n=!0;angular.forEach(e,function(e){!1===e&&(util.log("[ViewService] view is not valid"),n=!1)}),util.log("[ViewService] validateViews result = ",n),n?t.resolve():t.reject()},function(){util.log("[ViewService] validateViews has failed with rejection"),t.reject()}),t.promise},f.gotoPaymentStateFromBankSecureState=function(){"confirmation"===f.getActiveState()?f.gotoPaymentState():f.gotoPreviousState()},f._gotoNextState=function(e){for(var t=-1,n=0;n<f.views.length;n++)f.steps[n]===o.current.name&&(t=n+1);t>0&&t<f.steps.length&&f._saveHistoryAndGoToState(f.steps[t],e)},f.gotoPreviousState=function(){if(f.viewStack.length>1){var e=f.viewStack.pop();"auth"!==e.stateName&&"state2"!==e.stateName||u.cleanSuccessLoginCallbacks();var t=f.viewStack[f.viewStack.length-1];i.checkoutStateChange(t.stateName),o.go(t.stateName,{step:f.viewStack.length-1},{location:"replace"})}},f.hasPreviousState=function(){return!1===f.disabled&&f.viewStack&&f.viewStack.length>1},f.gotoNextView=function(e){f.notify("Next button clicked"),f._validateCurrentView().then(function(){f._gotoNextState(e)})},f.notify=function(e){},f.isTermSelectorState=function(e){var t=!1;return angular.forEach(f.views,function(n){n.options.hasTermSelector&&n.stateName===e&&(t=!0)}),t},f.isPaymentFormState=function(e){var t=!1;return angular.forEach(f.views,function(n){n.options.hasPaymentForm&&n.stateName===e&&(t=!0)}),t},f.isPasswordlessFormState=function(e){var t=!1;return angular.forEach(f.views,function(n){n.options.hasPasswordlessLoginForm&&n.stateName===e&&(t=!0)}),t},f.gotoRedemptionState=function(e){var t=null;if(angular.forEach(f.views,function(e){e.options.hasRedemptionForm&&(t=e)}),t)return f.gotoState(t.stateName,e),t.stateName;throw new Error(c.trc("checkout.platform","Not found redemption view"))},f.gotoTermSelectorState=function(e){var t=null;if(angular.forEach(f.views,function(e){e.options.hasTermSelector&&(t=e)}),t)return f.gotoState(t.stateName,e),t.stateName;throw new Error(c.trc("checkout.platform","Not found term selector view"))},f.gotoPaymentState=function(e){var t=null;if(angular.forEach(f.views,function(e){e.options.hasPaymentForm&&(t=e)}),t)return f.gotoState(t.stateName,e),t.stateName;throw new Error(c.trc("checkout.platform","Not found term selector view"))},f.disable=function(e){f.disabled=!0,f.preventStateChange=!e},f}]);var checkoutUpdates=angular.module("checkoutUpdatesModule",["checkoutModule"]);checkoutUpdates.factory("checkoutUpdatesService",["ngEventService","containerService","$q",function(e,t,n){var r={updateSelectedTerm:function(e){var t,n=e.getSelectedTerm();n&&(t=e._findTerm(n))&&(angular.forEach(e.config.terms,function(e){e.selected=!1}),t.selected=!0,angular.copy(t,e.flags.selectedTerm),t.isCustomPriceAvailable||e.input.chargeAmount!==e.flags.selectedTerm.chargeAmount||(e.input.chargeAmount=e.flags.selectedTerm.chargeAmount,e.input.chargeDisplayAmount=e.flags.selectedTerm.chargeDisplayAmount),e.input.chargeAmountInMinorUnit=e.flags.selectedTerm.chargeAmountInMinorUnit,e.input.chargeCurrency=e.flags.selectedTerm.chargeCurrency,e.input.canadianTaxes=e.canadianTaxes())},updatePaymentMethods:function(t,r){var o=r.flags.selectedTerm.isSubscription?r.flags.selectedTerm.subscriptionPaymentMethods:r.flags.selectedTerm.oneOffPaymentMethods;r.flags.selectedTerm.isZero&&!r.flags.selectedTerm.isSchedule&&(o=[{id:ZERO}]),o||(o=[]),util.log("[CHECKOUT] Selecting new payment methods list",o),angular.copy(o,r.input.paymentMethods),function(){if(!r.flags.applePayCanMakePayments){var e=[];angular.forEach(r.input.paymentMethods,function(t){"apple_pay"!==t.paymentTypeId&&e.push(t)}),angular.copy(e,r.input.paymentMethods)}}();var i,a=!t;if(r.input.paymentMethods&&1===r.input.paymentMethods.length&&void 0!==r.input.paymentMethods[0].id)i=r.selectPaymentMethod(r.input.paymentMethods[0],a);else if(r.flags.selectedPaymentMethod&&void 0!==r.flags.selectedPaymentMethod.id)i=r.selectPaymentMethod(r.flags.selectedPaymentMethod,a);else{var c,s=window.ApplePaySession;angular.forEach(r.input.paymentMethods,function(e){"apple_pay"===e.paymentTypeId&&(c=e)}),s&&c&&(i=r.selectPaymentMethod(c,!1))}return i?n.all([i]).then(function(){r.isZeroPayment()||e.fire(EVENT_CHECKOUT_PAYMENT_METHODS_CHANGED,r.input.paymentMethods)}):(r.isZeroPayment()||e.fire(EVENT_CHECKOUT_PAYMENT_METHODS_CHANGED,r.input.paymentMethods),n.when(!1))},updatePromoCode:function(){e.fire(EVENT_REAPPLY_PROMO_CODE)},updatePayWhatYouWant:function(){e.fire(EVENT_REAPPLY_PAY_WANT_YOU_WANT)},updatePreferredWith:function(e,n){t.setPreferredWidth(e),n.resize()}};return r}]),angular.element(document).ready(function(){window.TPInjector=angular.bootstrap(document.getElementById("ng-app"),["checkoutComponentsModule"],{strictDi:!0})});var EVENT_VIEW_ACTIVATED="EVENT_VIEW_ACTIVATED",EVENT_VIEW_CHANGED="EVENT_VIEW_CHANGED",EVENT_CHECKOUT_STARTED="EVENT_CHECKOUT_STARTED",EVENT_CHECKOUT_RELOADED="EVENT_CHECKOUT_RELOADED",EVENT_REAPPLY_PROMO_CODE="EVENT_REAPPLY_PROMO_CODE",EVENT_RESET_PROMO_CODE="EVENT_RESET_PROMO_CODE",EVENT_REAPPLY_PAY_WANT_YOU_WANT="EVENT_REAPPLY_PAY_WANT_YOU_WANT";window.angular=angular;var checkoutModule=angular.module("checkoutModule",["ui.router","ajaxServices","purchaseServiceModule","ngSanitize","generalModule","eventModule","errorModule","performanceMetricsModule","checkoutUpdatesModule","checkoutServiceModule","checkoutGoToModule","viewServiceModule","passwordlessModule","billingConfigModule","userServiceModule","containerServiceModule","tpComponentsModule","tp.i18n","consentModule","authModule","swgModule"]);function toBoolean(e){if(e&&0!==e.length){var t=angular.lowercase(""+e);e=!("f"==t||"0"==t||"false"==t||"no"==t||"n"==t||"[]"==t)}else e=!1;return e}checkoutModule.config(["$compileProvider","$qProvider","$stateProvider","$httpProvider",function(e,t,n,r){e.debugInfoEnabled&&e.debugInfoEnabled(!1),e.commentDirectivesEnabled&&e.commentDirectivesEnabled(!1),e.cssClassDirectivesEnabled&&e.cssClassDirectivesEnabled(!1),t.errorOnUnhandledRejections&&t.errorOnUnhandledRejections(!1),e.aHrefSanitizationWhitelist&&e.aHrefSanitizationWhitelist(/^\s*(https?|data|local|ftp|mailto|file|javascript|sms):/),r.interceptors.push(["$templateCache",function(e){return{request:function(t){return"GET"===t.method&&void 0===e.get(t.url)&&(t.url.indexOf("/widget/checkout/component")>=0||t.url.indexOf("/frontend/providers/components")>=0)&&(util.log("%c[CHECKOUT] Error: there is no template in $templateCache - ".concat(t.url),"color: red;"),e.put(t.url,"")),t}}}]),window.$stateProvider=n}]),checkoutModule.run(["interceptAjax",function(e){e.appendLoaderTo("checkout")}]),checkoutModule.factory("checkout",["$window","$rootScope","$state","$rootElement","eventService","purchaseService","$timeout","ngEventService","$q","viewService","$document","modalService","errorService","windowStateService","userService","containerService","tpHTTP","gaService","lang","checkConsents","configService","trackExternalEvent","utilsService","eventLogger","auth","statsService","swgService","setupTrackingId","performanceMetricsService","passwordlessService","externalVerificationService","billingConfig","checkoutService","checkoutUpdatesService","checkoutGoTo",function(e,t,n,r,o,i,a,c,s,u,l,d,p,f,m,h,g,v,y,C,E,S,T,_,w,b,P,A,$,I,k,N,x,D,M){angular.extend(t,window.PP_LIST);var O=null,R={name:"",details:[],startedAt:null,renewsOn:null,alreadyPurchased:null,canBeRenewed:null,canBeRenewedUsingExistedUPI:null,renewChargeAmount:null,renewChargeCurrency:null,renewChargeDisplayAmount:null,inRenewal:null},L={id:null,externalApiConfigurationId:null,externalApiFields:[],externalApiUserLocation:null},V={name:"CheckoutService"};V.$rootScope=t,V.rootElement=r,V.log=[],V.flags={},V.input={},V.internal={checkAccessAndGotoAlreadyPurchaseScreen:B};var U={oid:null,autoRenew:!0,chargeDisplayAmount:null,chargeAmount:null,chargeCurrency:"USD",originalChargeAmount:null,originalChargeCurrency:null,originalChargeDisplayAmount:null,promotionBillingPlan:null,isTermLockedByPromocode:!1,paymentMethods:[],receipt:{},user_data:{first_name:null,last_name:null},termId:null,offerId:null,zipCode:null,confirmated:{billingPlan:null,chargeAmount:null,taxAmount:null,total:null,taxRate:null,hstRate:null,hstAmount:null,qstRate:null,qstAmount:null,pstRate:null,pstAmount:null,gstRate:null,gstAmount:null},credit_card:{},paypalBt:{},applePayBt:{},consents:[],canadianTaxes:[],customFormTermId:null};V.setUpiId=function(e){var t=null===e&&null===V.input.upiId,n=V.input.upiId!==e;V.flags.isPaymentMethodChanged=t||n,V.input.upiId=e},V.getUpiId=function(){return V.input.upiId},angular.copy(U,V.input),V.termGate={},V.access={},angular.copy(R,V.access),V.flags.applePayCanMakePayments=!1,V.flags.selectedTerm={};var F={};function B(e){return e=e||V.getSelectedTerm(),x.getAccess(V,e).then(function(e){if(e.data.models.alreadyPurchased)if(h.isModal||h.isPopup)q(e.data);else{if(V.params.noNeedStartCheckoutAfterLogin)return void delete V.params.noNeedStartCheckoutAfterLogin;V._findTerm(e.data.models.sourceTermId)?V.startCheckout(e.data.models.sourceTermId):V.config.terms&&V.config.terms.length&&V.config.terms[0]&&V.config.terms[0].termId&&V.startCheckout(V.config.terms[0].termId)}return e.data.models.alreadyPurchased})}function H(){V.params.userToken=null,ae({}),V.config.checkoutAuthenticationInSeparateState&&V.getSelectedTerm()&&V._unselectTerm(),V.resetAssociatedData(),V.config.isRedemption&&!V.params.startFromInlineCheckout&&u.isActive("redemption")?u.gotoState("redemption"):u.gotoState("offer")}function W(){V.flags.isDiscounted=!1,V.input.originalChargeAmount=V.input.chargeAmount,V.input.originalChargeCurrency=V.input.chargeCurrency,V.input.originalChargeDisplayAmount=V.input.chargeDisplayAmount}function q(e,t,n){util.log("[CHECKOUT] already purchased",e);var r={alreadyPurchased:e.models.alreadyPurchased,name:e.models.name,details:e.models.details.split(";"),startedAt:e.models.startedAt,renewsOn:e.models.renewsOn,expiresOn:e.models.expiresOn,canBeRenewed:e.models.canBeRenewed,canBeRenewedUsingExistedUPI:e.models.canBeRenewedUsingExistedUPI,renewChargeAmount:e.models.renewChargeAmount,renewChargeCurrency:e.models.renewChargeCurrency,renewChargeDisplayAmount:e.models.renewChargeDisplayAmount,sourceTermId:e.models.sourceTermId,sourceTerm:e.models.sourceTerm,renewBillingCountryCode:e.models.renewBillingCountryCode,renewBillingZipCode:e.models.renewBillingZipCode,renewResidenceCountryCode:e.models.renewResidenceCountryCode,renewHasTax:e.models.renewHasTax};if(angular.copy(r,V.access),V._selectTerm(r.sourceTerm,!0),r.canBeRenewed&&(V.input.chargeAmount=r.renewChargeAmount,V.input.chargeCurrency=r.renewChargeCurrency,V.input.chargeDisplayAmount=r.renewChargeDisplayAmount,W(),V.config.hasTax=r.renewHasTax),N.renewBillingCountryCode=r.renewBillingCountryCode,N.renewBillingZipCode=r.renewBillingZipCode,N.renewResidenceCountryCode=r.renewResidenceCountryCode,V.config.hasTax=r.renewHasTax,e.models.renewalBillingPlan&&(V.getSelectedTerm().billingPlanTable=e.models.renewalBillingPlan),e.models.renewalBillingPlanModel){var i=V.getSelectedTerm();angular.forEach(e.models.renewalBillingPlanModel,function(e,t){i[t]=e})}e.models.renewalOriginalBillingPlanModel&&(V._findTerm(V.getSelectedTerm()).originalBillingPlan=e.models.renewalOriginalBillingPlanModel),c.fire(EVENT_USER_ACCESS_CHANGED),function(e){var t,n=V.getSelectedTerm();if(n&&n.resource)t=n.resource.rid;else if(e.models.sourceTermId){var r=V._findTerm(e.models.sourceTermId);r&&r.resource&&(t=r.resource.rid)}o.alreadyPurchasedEvent({rid:t})}(e),n||M.gotoAlreadyHasAccess(V)}angular.copy(F,V.flags.selectedTerm),V.flags.isRenewNow=!1,V.flags.selectedPaymentMethod=null,V.flags.termComplete=!1,V.flags.paymentComplete=!1,V.flags.termSelectorActivated=!1,V.flags.receiptActivated=!1,V.flags.hasLoginRequiredCallback=!1,V.flags.autoCompleteRegistrationTerm=!0,V.flags.needUpdateUserResources=!1,V.flags.isPaymentMethodChanged=!0,V.config={terms:[{}],originalTerms:[{}],additionalTerms:[{}],userResources:[{}]},V.GAProccesses=0,V.params={},V.redemptionLoginRequiredParams={state:null,form:{redeemCode:null}},V.closeButtonTypes={default:"default",boilerplate:"boilerplate"},V.SYSTEM_ERROR_CODES={100:y.trc("checkout.platform","Please try again later"),101:y.trc("checkout.platform","Your payment is being processed. Try to refresh the page in 30 seconds")},V.init=function(e,t){var n,r,i;u.startState=(n="true"===getParameterByName("isCheckout"),r=void 0===getParameterByName("termId"),i=getParameterByName("offerState"),n&&r&&!i?"state1":"offer");var s=t.preferredWidth||450;V.flags.hasLoginRequiredCallback="true"===getParameterByName("hasLoginRequiredCallback"),V.initConfig(),angular.copy(U,V.input),V.params.rurl_3ds&&window.TPParam.FULL_REDIRECT_3DS_ENABLED&&(V.input.rurl_3ds=V.params.rurl_3ds,u.startState="continueThreeDSPurchase",x.restoreCheckoutObjects(V.params.oid).then(function(e){V.flags.selectedTerm=e.models.currentTerm})),V.params.oid&&(V.input.oid=V.params.oid),V.params.promoCodeId&&(V.input.promoCodeId=V.params.promoCodeId),V.params.promoCodeTermId&&(V.input.promoCodeTermId=V.params.promoCodeTermId),this.config.isRedemption&&(u.startState="redemption");var l=getQueryParamInStringByName(getParameterByName("url"),"shared_account_code");l&&(V.params.shared_account_code=l,u.startState="redeemSharedSubscription"),"true"===getParameterByName("isAuth")&&(u.startState="auth",w.currentState.name=getParameterByName("authStartScreen")||"login");var d=angular.element("#checkout-container");function f(){"true"===getParameterByName("reloadAfterLogin")&&B()}h.init({preferredWidth:s},function(){return{container:d}}),m.init(function(){return{app:V.config.app,user:V.config.user,fillLoginIframeParams:function(e){e.offerId=V.config.offerId,e.templateId=V.config.offerTemplateId,e.templateVariantId=V.config.offerTemplateVariantId,e.gaClientId=V.params.gaClientId,e.email=V.config.sharedAccountEmail},fillLoginRequiredParamsToGoogleAnalytics:function(e){e.offerId=V.config.offerId,e.templateId=V.config.offerTemplateId,e.templateVariantId=V.config.offerTemplateVariantId},fillLoginRequiredEventParams:function(e){e.term=V._findTerm(V.params.termId||O),e.isRedemption=V.params.isRedemption,e.termId=O,e.currentState=u.getActiveState(),e.redemption={},angular.copy(V.redemptionLoginRequiredParams,e.redemption)},fillLoginSuccessEventParams:function(e){e.termId=O}}}),m.onLoginSuccess(function(e){V.params.userToken=e.user_token,ae(e.user),function(){if(!V.isAutoCompleteRegistrationTerm())return!1;!V.isTermSelected()&&V.config.terms&&1===V.config.terms.length&&"registration"===V.config.terms[0].type&&(e=V.config.terms[0],V.reload({}).then(function(){if(V.isUserValid()&&m.isUserConfirmed()){var t=V._findTerm(e);return V.selectTerm(t)}return!1}));var e}()},!1),TPParam.error?p().terminal(TPParam.error):(TPParam.config&&TPParam.config.consoleError&&util.log("%c[CHECKOUT] Error: ".concat(TPParam.config.consoleError),"color: red;"),util.log("[CHECKOUT] Startup params",this.params),util.log("[CHECKOUT] Startup config",this.config),V.input.user_data.first_name=V.config.user.firstName,V.input.user_data.last_name=V.config.user.lastName,"true"===getParameterByName("allowReturnToStartState")&&u.saveHistory(u.startState),t.isReload||(c.fire(EVENT_CHECKOUT_STARTED),V.params.termId?a(function(){var e=V._findTerm(V.params.termId);e&&e.newCustomersOnly&&!V.config.isNewCustomer?p().terminal(y.trc("term.name",e.name)+" "+y.trc("checkout.platform","is restricted for new customers only")+" "):(u.startState="state1",V.startCheckout(V.params.termId),f())},0):"offer"===u.startState?a(function(){V.startShowOffer(),f()},0):"redemption"===u.startState?a(function(){o.startCheckoutEvent(V.params),V.startRedemption()},0):"redeemSharedSubscription"===u.startState?a(function(){o.startCheckoutEvent(V.params),M.gotoRedeemSharedSubscriptionState()},0):"auth"===u.startState?a(function(){M.gotoAuthState(V,null,function(){V.close()},!0)},0):"continueThreeDSPurchase"===u.startState?a(function(){o.startCheckoutEvent(V.params),M.gotoContinueThreeDSPurchaseState()},0):a(function(){M.gotoCheckoutStart(V),f()},0)),b.getParams().then(function(e){A(e.trackingId)}))},V.initConfig=function(){if(window.TPParam&&window.TPParam.config&&angular.copy(window.TPParam.config,V.config),window.TPParam&&window.TPParam.params&&angular.copy(window.TPParam.params,V.params),V.params.userToken&&m.isPianoIdUserProvider()){var e=T.jwtDecode(V.params.userToken);V.config.user.login_timestamp=e.login_timestamp,V.config.user.token_expiration=1e3*(e.exp-e.iat)}angular.copy(V.config.consents,U.consents)},V.isUserValid=function(){return m.isUserValid()},V.isNewCustomer=function(){return V.config.isNewCustomer},V.isExternalCheckoutAvailable=function(e){return!!P.isAvailableForTerm&&P.isAvailableForTerm(e)},V.isTermAllowedToSelect=function(e){return!V.isTermRestrictedForNewCustomers(e,V.config.isNewCustomer)&&!V.hasAccess(V,e.resource.rid)},V.isTermRestrictedForNewCustomers=function(e,t){var n=e.newCustomersOnly&&!t;return n&&(p(V.$rootScope).global(y.trc("term.name",e.name)+" "+y.trc("checkout.platform","is restricted for new customers only")+" "),V.enabledCheckout()),n},V.isSelectedTermLocked=function(){return V.flags&&V.flags.selectedTerm&&V.input&&V.input.isTermLockedByPromocode&&!V.input.validUnlockPromoCode&&!V.access.alreadyPurchased},V.isPaymentMethodRequired=function(){return V.getSelectedTerm().isPaymentMethodRequired},V.isRequirePrintAddress=function(){return V.termGate.adrCollectionEnabled&&!V.termGate.adrCollectionSucceeded},V.isZeroPayment=function(){return V.flags&&V.flags.selectedPaymentMethod&&V.flags.selectedPaymentMethod.id===ZERO},V.isTermSelected=function(){return null!==V.flags.selectedTerm&&V.flags.selectedTerm.selected},V.isPaymentMethod=function(e){return V.isPaymentMethodSelected()&&V.flags.selectedPaymentMethod.id===e&&!V.isMockUsed()},V.isPaymentMethodSelected=function(){return null!==V.flags.selectedPaymentMethod},V.WORLDPAY_PP_LIST=[window.WORLDPAY_PAYPAL,window.WORLDPAY_IDEAL,window.WORLDPAY_ELV],V.isSupportedWorldpayCcMethod=function(){return V.WORLDPAY_PP_LIST.findIndex(function(e){return V.isPaymentMethod(e)})>=0},V.SPREEDLY_PP_LIST=[window.SPREEDLY_CC,window.SPREEDLY_STRIPE_CC,window.SPREEDLY_BEANSTREAM,window.SPREEDLY_PAYU_LATAM,window.SPREEDLY_OPENPAY],V.isSupportedSpreedlyCcMethod=function(){return V.SPREEDLY_PP_LIST.findIndex(function(e){return V.isPaymentMethod(e)})>=0},V.isPayWhatYouWantTerm=function(){return V.flags.selectedTerm.billingPlanTable&&1===V.flags.selectedTerm.billingPlanTable.length&&"true"===V.flags.selectedTerm.billingPlanTable[0].isPayWhatYouWant},V.isPaymentTerm=function(e){return e&&"payment"===e.type},V.isExternalTerm=function(e){return e&&"external"===e.type},V.isGiftTerm=function(e){return e&&"gift"===e.type},V.isPayableTerm=function(e){return V.isPaymentTerm(e)||V.isGiftTerm(e)},V.isChargingTerm=function(e){return e&&!e.isZero&&!e.hasFreeTrial&&V.isPayableTerm(e)},V.isRegistrationTerm=function(e){return e&&"registration"===e.type},V.isSelectedTermAutoRenewChoiceAvailable=function(){return V.flags.selectedTerm.isSubscription&&!V.flags.selectedTerm.forceAutoRenew&&(V.access&&!V.access.alreadyPurchased||!V.access)&&"gift"!==V.flags.selectedTerm.type},V.isConfirmStepEnabled=function(){return V.config.isConfirmStepEnabled&&(V.hasTax()||V.isTaxCnbcEnabled())},V.isDoubleOptInEnabled=function(){return V.config.isDoubleOptInEnabled},V.isPasswordlessCheckoutEnabled=function(){return V.config.isPasswordlessCheckoutEnabled},V.isSingleStepEnabled=function(){return V.config.isSingleStepEnabled&&V.isPasswordlessCheckoutEnabled()},V.isPromoCodeApplyWithoutUserEnabled=function(){return V.config.isPromoCodeApplyWithoutUserEnabled},V.isPasswordlessCheckoutEnabledAndUserInvalid=function(){return V.config.isPasswordlessCheckoutEnabled&&!V.isUserValid()},V.isAutoEmailDetectionEnabled=function(){return V.config.isAutoDetectEmailEnabled},V.isMockUsed=function(){return V.config&&V.config.useMock},V.isPreviewMod=function(){return!(!V.params||!V.params.preview||!0!==V.params.preview&&"true"!==V.params.preview)},V.isPromoCodeAvailable=function(e){var t=e||V.getSelectedTerm();return!t.isCustomPriceAvailable&&t.allowPromoCodes&&!V.input.validUnlockPromoCode&&(V.access||V.access&&!V.access.alreadyPurchased)},V.isSameResidence=function(){return N.sameResidence},V.isTaxCnbcEnabled=function(){return T.contains(V.config.taxSupports,"tax.cnbc")},V.isVatEuEnabled=function(){var e=T.contains(V.config.taxSupports,"vat.eu")||T.contains(V.config.taxSupports,"avalara.vat.eu");return e&&V.config.taxSupports.length>1?"vat.eu"===N.countryTaxSupport||"avalara.vat.eu"===N.countryTaxSupport:e},V.isBillingCountryEnabled=function(){return V.isVatMXEnabled()||V.isVatAUEnabled()||V.isVatNOEnabled()||V.isVatJPEnabled()||V.isVatChEnabled()||V.isVatCanadaEnabled()||V.isVatEuEnabled()||V.isTaxUsEnabled()||V.isCustomVatEnabled()},V.isEuBillingCountryLabel=function(){return N.needResidence},V.isUsBillingCountryLabel=function(){return!N.needResidence},V.isVatMXEnabled=function(){return(T.contains(V.config.taxSupports,"vat.mx")||T.contains(V.config.taxSupports,"avalara.vat.mx"))&&!V.isVatEuEnabled()},V.isVatAUEnabled=function(){return(T.contains(V.config.taxSupports,"vat.au")||T.contains(V.config.taxSupports,"avalara.vat.au"))&&!V.isVatEuEnabled()},V.isVatNOEnabled=function(){return(T.contains(V.config.taxSupports,"vat.no")||T.contains(V.config.taxSupports,"avalara.vat.no"))&&!V.isVatEuEnabled()},V.isVatJPEnabled=function(){return(T.contains(V.config.taxSupports,"vat.jp")||T.contains(V.config.taxSupports,"avalara.vat.jp"))&&!V.isVatEuEnabled()},V.isVatChEnabled=function(){return(T.contains(V.config.taxSupports,"vat.ch")||T.contains(V.config.taxSupports,"avalara.vat.ch"))&&!V.isVatEuEnabled()},V.isCustomVatEnabled=function(){return(T.contains(V.config.taxSupports,"custom.vat")||T.contains(V.config.taxSupports,"avalara.custom.vat"))&&!V.isVatEuEnabled()},V.isVatCanadaEnabled=function(){return(T.contains(V.config.taxSupports,"vat.canada")||T.contains(V.config.taxSupports,"avalara.vat.canada"))&&!V.isVatEuEnabled()},V.isTaxUsEnabled=function(){return(T.contains(V.config.taxSupports,"tax.us")||T.contains(V.config.taxSupports,"avalara.tax.us"))&&!V.isVatEuEnabled()},V.isVatColumnVisible=function(){return V.hasTax()&&N.taxIncludeBilling&&N.showVAT},V.isVatColumnAvailable=function(){return V.hasTax()&&N.taxIncludeBilling},V.isTaxColumnVisible=function(){return V.hasTax()&&!N.taxIncludeBilling},V.isAutoCompleteRegistrationTerm=function(){return V.flags.autoCompleteRegistrationTerm},V.isShowBoilerplateCloseButton=function(){var e=E.get().closeButtonType,t="false"!==getParameterByName("showCloseButton"),n=e===V.closeButtonTypes.boilerplate;return t&&n},V.hasExternalVerificationGate=function(){return V.termGate.externalApiConfigurationId&&"accepted"!==V.termGate.externalVerificationStatus},V.hasAccess=function(e){return V.flags.needUpdateUserResources&&(V.flags.needUpdateUserResources=!1,x.getUserResource(V).then(function(e){angular.copy(e.data.models.userResources,V.config.userResources)})),V.config.userResources.indexOf(e)>-1},V.hasResources=function(e){if(!e)return!1;if(!V.flags.selectedTerm||!V.flags.selectedTerm.resource||!V.flags.selectedTerm.resource.rid)return!1;var t=[];return"string"==typeof e&&(t=e.indexOf(",")>=0?e.replace(/\s/gm,"").split(","):[e]),Array.isArray(e)&&(t=e.slice(0)),t.some(function(e){return e===V.flags.selectedTerm.resource.rid})},V.hasMultiplePaymentMethods=function(){return V.input.paymentMethods&&V.input.paymentMethods.length>1},V.hasTax=function(){return V.config.hasTax},V.hasOnlyOneTerm=function(){return V.config.terms&&1===V.config.terms.length},V.reloadIfNeed=function(){ce.apply(V,arguments)},V.getGeoCountryCode=function(){return window.TPParam.GEO_COUNTRY_CODE},V.getCustomFormParams=function(){var e,t={},n=window.TPParam.params.formNameByTermId;if(n){var r=JSON.parse(n),o=V.input.customFormTermId;o&&(e=r[o])}return e&&(t.formName=e,t.hideCompletedFields=window.TPParam.params.hideCompletedFields||!1),t.trackingId=window.TPParam.params.trackingId,t},V.mergeStats=function(e){e&&e.models&&e.models.checkoutStats&&b.mergeStats(e.models.checkoutStats)},V.resize=function(){h.resize()},V.getPreferredWidth=function(){return h.getPreferredWidth()},V.allowTinypassAccountsLogin=function(){return m.allowTinypassAccountsLogin()},V.allowLogout=function(){return"receipt"!==u.getActiveState()&&m.allowLogout()},V.allowTinypassAccountsLogout=function(){return"receipt"!==u.getActiveState()&&m.allowTinypassAccountsLogout()},V.logout=function(){m.logout(),H()},V.resetAssociatedData=function(){c.fire(EVENT_RESET_PROMO_CODE)},V.sendGoogleAnalyticsEvent=function(e,t){e&&e.params&&(e.params.aid=V.getAid()),v.sendGoogleAnalyticsEvent(e,t)},V.register=function(){return V.login("register")},V.login=function(e){return function(){if(m.isCondeUserProvider()){var t=e||"login";if(h.isModal){var n=s.defer();return w.currentState.name=t,M.gotoAuthState(V,null,function(){"auth"===u.getActiveState()&&u.gotoPreviousState(),n.resolve()},!0),n.promise}var r={};return angular.copy(V.params,r),r.isAuth=!0,r.authStartScreen=t,o.startCheckoutEvent(r),s.reject()}return m.login(e).then(function(e){var t=e.user;return ce(!0,!1,t)})}().then(B)},V.startRedemption=function(){function e(e){e?u.gotoRedemptionState():o.startCheckoutEvent(V.params)}V.flags.inStartCheckoutFlow=!0,V.params.isRedemption=!0,V.params.startFromInlineCheckout=!1,h.isModal||h.isPopup?(o.startCheckoutEvent(V.params),e(!0)):(V.params.termId=null,V.params.startFromInlineCheckout=!0,e(!1)),V.flags.inStartCheckoutFlow=!1},V.gotoRedemptionState=function(){u.gotoRedemptionState()},V.startExternalCheckout=function(e){P.startCheckout(e).then(function(){V.sendGoogleAnalyticsEvent({eventAction:"externalReceiptDisplayed",eventLabel:"External receipt displayed",params:{offerId:V.config.offerId,templateId:V.config.offerTemplateId,templateVariantId:V.config.offerTemplateVariantId}})})},V.getExternalCheckoutConfig=function(){return P.getUiConfig?P.getUiConfig():{}},V.startCheckout=function(e){var t=e&&"object"==typeof e?e.termId:e;if(O=t,V.canCheckout()||V.isPasswordlessCheckoutEnabled()){if(V.notify("[CHECKOUT] Starting checkout with termId:"+t),b.mergeStats({promo_code:"",promotion_id:"",promo_state:0}),V.input.promotionBillingPlan=null,t&&(V.params.termId=t),V.input.oid&&(V.params.oid=V.input.oid),V.input.promoCodeId&&(V.params.promoCodeId=V.input.promoCodeId),V.input.promoCodeTermId&&(V.params.promoCodeTermId=V.input.promoCodeTermId),o.startCheckoutEvent(V.params),!h.isInline)if(t){var n=V._findTerm(t);n&&V.selectTerm(n)}else M.gotoCheckoutStart(V)}else m.loginSuccessPosted()||m.login("register").then(function(e){return ce(!0,!1,e.user)}).then(function(){m.isPublisherUserRefProvider()||V.startCheckout(t)})},V.allowRedemption=function(){return V.config.redemptionEnabled},V.systemError=function(e){o.systemErrorEvent({message:e})},V.notify=function(e,t){},V.canCheckout=function(){return!(V.config.settings.requiresValidUser&&!1===V.isUserValid()&&!V.canInitCheckoutWithAnon())||V.isPasswordlessCheckoutEnabled()},V.preselectTermId=function(e){V.flags.preselectedTermId=e},V.startCheckoutWithPreselectedTerm=function(){if(p(V.$rootScope).reset(),V.flags.preselectedTermId)return V.startCheckout(V.flags.preselectedTermId);p(V.$rootScope).global(y.trc("checkout.platform","Please select a plan before continuing"))},V.selectTerm=function(e,t,n,r,a){if("inline"===window.TPParam.params.displayMode)return V.startCheckout(e),s.reject();var c=t;if(c||(c=V.params.offerId),"string"==typeof e&&!(e=V._findTerm(e)))return p(V.$rootScope).reset(),p(V.$rootScope).global(y.trc("checkout.platform","Term not found")),V.enabledCheckout(),s.reject();if(e.termId===V.input.termId&&!a)return V.enabledCheckout(),s.reject();if(!V.canCheckout())return V.enabledCheckout(),s.reject();var l=e;return p(V.$rootScope).reset(),V.isTermRestrictedForNewCustomers(l,V.config.isNewCustomer)?s.reject():l.restrictCheckoutProcess?(l.sellDate?p(V.$rootScope).global(y.trc("term.name",l.name)+" "+y.trc("checkout.platform","sales start on")+" "+l.sellDate):l.hasFinishedSales?p(V.$rootScope).global(y.trc("term.name",l.name)+" "+y.trc("checkout.platform","sales of the old season has finished and the sales of new season have not started yet")):p(V.$rootScope).global(y.trc("term.name",l.name)+" "+y.trc("checkout.platform","sales have not started yet")),V.enabledCheckout(),s.reject()):(V.input.termId=e.termId,V.input.offerId=c,V.input.customFormTermId=e.termId,angular.copy(R,V.access),f().then(function(t){if((V.isRequirePrintAddress()||"registration"===l.type||V.isPasswordlessCheckoutEnabled()&&!V.isSingleStepEnabled()||!V.isPasswordlessCheckoutEnabled()&&V.config.checkoutAuthenticationInSeparateState)&&!V.isUserValid()||m.isUserReadOnly()){var n=s.defer();return M.gotoAuthState(V,function(){O=e.termId,V.input.customFormTermId=e.termId},function(){m.isUserValid()&&!m.isUserConfirmed()?n.reject():n.resolve(t)},!0),n.promise}return s.when(t)}).then(function(){var e=s.defer();return B(l).then(function(t){t?e.reject():e.resolve()}),e.promise}).then(d));function d(t,a){t&&t.models.alreadyPurchased?q(t,l.termId,r):a||(m.isUserValid()&&!m.isUserConfirmed()?u.gotoState("user-non-confirmed"):(V._selectTerm(e,n,r),o.postMessage("selectTerm",{alreadyPurchased:V.access.alreadyPurchased}),"registration"===e.type?i.purchaseStarting(V,e):M.gotoNextState(V,i,r)))}function f(){return V.disableCheckout(),i.createOrder(V,e.termId,c,V.params.templateId).then(function(e){if(util.log("[CHECKOUT] order created",e),V.input.oid=e.models.oid,V.input.sharedAccountCount=e.models.sourceTerm.sharedAccountCount,V.input.isTermLockedByPromocode=e.models.isTermLockedByPromocode,angular.copy(R,V.access),angular.copy(L,V.termGate),angular.copy(e.models.user,V.config.user),V.params.userToken&&m.isPianoIdUserProvider()){var t=T.jwtDecode(V.params.userToken);V.config.user.login_timestamp=t.login_timestamp,V.config.user.token_expiration=1e3*(t.exp-t.iat)}var n={id:e.models.termGateId,externalApiTitle:e.models.externalApiTitle,externalApiApplyButtonName:e.models.externalApiApplyButtonName,externalApiVerifyNew:e.models.externalApiVerifyNew,externalApiConfigurationId:e.models.externalApiConfigurationId,externalApiFields:e.models.externalApiFields,externalVerificationStatus:e.models.externalVerificationStatus,externalVerificationConversionId:e.models.externalVerificationConversionId,externalApiSource:e.models.externalApiSource,externalApiFieldCountry:e.models.externalApiFieldCountry,externalApiSavedForms:e.models.externalApiSavedForms,externalApiPrepopulationForm:e.models.externalApiPrepopulationForm,adrCollectionAvailableAddresses:e.models.adrCollectionAvailableAddresses,adrCollectionCountries:e.models.adrCollectionCountries,adrCollectionEnabled:e.models.adrCollectionEnabled,adrDefaultCountry:e.models.adrDefaultCountry,adrPrepopulationForm:e.models.adrPrepopulationForm};return n.externalApiFields&&n.externalApiFields.length&&angular.forEach(n.externalApiFields,function(e){e.value=e.defaultValue}),angular.copy(n,V.termGate),V.flags.isDiscounted=!1,s.when(e)}).catch(function(e){var t;return"object"==typeof e&&(e.errors&&e.errors.length?t=e.errors[0].message||e.errors[0].msg:e.message&&(t=e.message)),t?getParameterByName("termId")?p().terminal(y.trc("service.error.codes",t)):p(V.$rootScope).global(y.trc("service.error.codes",t)):p().terminal(y.trc("checkout.platform","Create order failed")),V._unselectTerm(),s.reject(e)}).finally(function(){V.enabledCheckout()})}},V.checkoutWithNewTerm=function(e,t){V.selectTerm(e,t,!0,!1),"gift"===e.type?M.gotoGiftParams(V):M.gotoPaymentState(V,i,e,t)},V.getWidthTerm=function(){return h.getNewWidth()},V.softResetDiscount=function(){return!0===V.flags.isDiscounted?(V.resetDiscount(),D.updatePaymentMethods(!0,V)):s.when(!1)},V.resetDiscount=function(){if(V.flags.isDiscounted=!1,V.input.promoCodeId=null,V.input.promoCodeTermId=null,V.input.promoCode=null,V.input.originalChargeAmount&&(V.input.chargeAmount=V.input.originalChargeAmount,V.input.chargeCurrency=V.input.originalChargeCurrency,V.input.chargeDisplayAmount=V.input.originalChargeDisplayAmount,V.input.promotionBillingPlan=null,delete V.input.originalChargeAmount,delete V.input.originalChargeCurrency,delete V.input.originalChargeDisplayAmount),angular.forEach(this.config.terms,function(e){e.originalBillingPlan&&(angular.forEach(e.originalBillingPlan,function(t,n){e[n]=t}),delete e.originalBillingPlan)}),D.updateSelectedTerm(V),V.isZeroPayment()){var e=null;V.input.paymentMethods&&1==V.input.paymentMethods.length&&(e=V.input.paymentMethods[0]),V.flags.selectedPaymentMethod=e}return c.fire(EVENT_CHECKOUT_PRICE_CHANGED),s.when(!1)},V.getAid=function(){return V.params.aid},V.getDoubleOptInParams=function(){return b.getStats().then(function(e){var t={};return angular.copy(V.params,t),V.getLoginTermId()&&(t.termId=V.getLoginTermId()),V.input.oid&&(t.oid=V.input.oid),k.passwordlessEVFields&&(t.externalVerificationFields=k.passwordlessEVFields),{tbc:e.tbc,params:t}})},V.discountSelectedTerm=function(e,t,n,r,o,i){util.log("[CHECKOUT] Discounting selected with:",e,t,n),W(),V.flags.isDiscounted=!0,V.input.chargeAmount=e,V.input.chargeCurrency=t,V.input.chargeDisplayAmount=n,V.input.promotionBillingPlan=r,V.input.promoCodeId=o,V.input.promoCodeTermId=i},V._selectTerm=function(e,t,n){var r;if(r=t?e:V._findTerm(e)){if(util.log("[CHECKOUT] Selecting term",r),angular.forEach(this.config.terms,function(e){e.selected=!1}),r.selected=!0,angular.copy(r,V.flags.selectedTerm),V.input.chargeAmount=V.flags.selectedTerm.chargeAmount,V.input.chargeCurrency=V.flags.selectedTerm.chargeCurrency,V.input.chargeDisplayAmount=V.flags.selectedTerm.chargeDisplayAmount,V.input.canadianTaxes=V.canadianTaxes(),V.input.customFormTermId=V.flags.selectedTerm.termId,V.params.termId=V.flags.selectedTerm.termId,n)return;angular.copy({},V.flags.selectedPaymentMethod),c.fire(EVENT_CHECKOUT_TERM_SELECTED,r);var i={termName:r.name,termId:r.termId,resourceName:r.resource.name,resourceId:r.resource.rid};o.customEvent("checkoutSelectTerm",i),V.sendGoogleAnalyticsEvent({eventAction:"termSelected",eventLabel:"Term selected",params:{offerId:V.config.offerId,templateId:V.config.offerTemplateId,templateVariantId:V.config.offerTemplateVariantId,termId:r.termId}})}else util.log("Did not find existing term for",e)},V._unselectTerm=function(){angular.forEach(this.config.terms,function(e){e.selected=!1});V.flags.selectedTerm;var e=V.input.zipCode,t=V.input.promoCode;angular.copy(U,V.input),angular.copy(F,V.flags.selectedTerm),angular.copy(U.consents,V.input.consents),V.params.termId=null,V.input.user_data.first_name=V.config.user.firstName,V.input.user_data.last_name=V.config.user.lastName,V.input.zipCode=e,V.input.customFormTermId=null,V.input.promoCode=t},V._findTerm=function(e){if(null===e)return null;var t=e;"object"==typeof e&&e.termId&&(t=e.termId);var n=null;return angular.forEach(this.config.terms,function(e){e.termId===t&&(V.notify("[CHECKOUT] Found existing term:"+t),n=e)}),n};var j,Y=!1;function G(){h.purge({alreadyPurchased:V.access.alreadyPurchased,completePayment:V.flags.termComplete})}V.initPurchase=function(e){var t=e||{purchaseInitiated:!1};return Y=!0,i.initiatePurchase(V).then(function(){return t.purchaseInitiated=!0,t}).finally(function(){Y=!1})},V.selectPaymentMethod=function(e,t){if(!0===Y)return s.when(!1);V.flags.selectedPaymentMethod=null,angular.forEach(this.input.paymentMethods,function(t){t.selected=!1,e&&t.id===e.id&&(V.notify("[CHECKOUT] Payment method selected:"+e.name),t.selected=!0,V.flags.selectedPaymentMethod=t)});var n={purchaseInitiated:!1};return!V.flags.selectedPaymentMethod||t||Y?n:(Y=!0,i.initiatePurchase(V).then(function(){return n.purchaseInitiated=!0,n}).finally(function(){Y=!1}))},V.selectPaymentMethodById=function(e,t){var n=ie(e);return V.selectPaymentMethod(n,t)},V.startRenewal=function(){V.flags.isRenewNow=!0,V.access&&V.access.alreadyPurchased&&!V.access.canBeRenewed?V._showSubscriptionHasAlreadyRenewed():(V.access.inRenewal=!0,M.gotoPaymentState(V,i,V.flags.selectedTerm))},V.isRefreshBillingInfoNeeded=function(){return V.flags.isPaymentMethodChanged},V.startShowOffer=function(){u.gotoState("offer")},V.onUserChanged=function(){var e=s.defer(),t=m.isUserValid(),n=c.subscribe(EVENT_CHECKOUT_RELOADED,function(){var r=m.isUserValid();t!==r&&(n(),i.waitInitPurchase().then(function(){e.resolve(r)}))});return e.promise},V.close=function(e){e&&e(),h.close({alreadyPurchased:V.access.alreadyPurchased,completePayment:V.flags.termComplete})},V.canInitCheckoutWithAnon=function(){return V.config.app&&!0===V.config.app.canInitCheckoutWithAnon},V.fireCheckoutPaymentErrorEvent=function(){var e=p(t).errors(!1);angular.forEach(e,function(e){o.checkoutPaymentErrorEvent(e.message)})};var z,K=function(){j.resolve(),V.enabledCheckout()},Z=function(){j.reject(),V.enabledCheckout()},J=function(e){_.logEvent("successPurchase",{async_processing:e?e.async_processing:"params not provided"}),"true"===e.async_processing?(util.log("[CHECKOUT] Asynchronous processing. Completing and granting provisional access",e),angular.copy(JSON.parse(e.receipt),V.input.receipt),V.GAProccesses++,V.sendGoogleAnalyticsEvent({eventAction:"checkoutSuccess",eventLabel:"Checkout success",params:{offerId:V.offerId,templateId:V.config.offerTemplateId,templateVariantId:V.config.offerTemplateVariantId}},function(){setTimeout(function(){V.GAProccesses--},3e3)}),o.completeEvent(V.input.receipt),X(V.input.receipt,K)):(util.log("[CHECKOUT] completing term",e),V._completeTerm(e).finally(K))},Q=function(e){if("object"==typeof e&&e.models&&e.models.alreadyPurchased)return q(e,V.getSelectedTerm().termId,!1),void Z();var n;"object"==typeof e?e.errors&&e.errors.length?n=e.errors[0].message||e.errors[0].msg:e.message&&(n=e.message):"string"==typeof e&&(n=e),n&&(p(t).global(y.trc("service.error.codes",n)),V.fireCheckoutPaymentErrorEvent()),Z(),i.initiatePurchase(V)};function X(e,t){"number"!=typeof V.input.sharedAccountCount||V.isGiftTerm(V.getSelectedTerm())?M.gotoReceipt(V).finally(t):(V.input.sharedAccounts=e.sharedAccounts,V.input.termConversionId=e.termConversionId,M.gotoSharedSubscriptionState().finally(t))}function ee(){var e=V.getSelectedTerm();return e&&e.newCustomersOnly&&!V.config.isNewCustomer?(p().terminal(y.trc("term.name",e.name)+" "+y.trc("checkout.platform","is restricted for new customers only")+" "),s.reject(!1)):s.when(!0)}V.completePaymentThreeDS=function(){i.completePurchaseThreeDS(V,J,Q)},V.reInitPurchase=function(){i.initiatePurchase(V)},V.completePayment=function(){return o.submitPayment({term:V._findTerm(V.params.termId)}),j=s.defer(),V.disableCheckout(),p(V.$rootScope).reset(),u._validateViews().then(function(){p(V.$rootScope).reset();return V.checkConsents(!0).then(function(){return I.loginUser(V)}).then(function(){return ee()}).then(function(){return le()}).then(function(){return i.processPurchase(V,J,Q)}).catch(Z)}).catch(function(){util.log("[CHECKOUT] Validation on completePayment has failed"),V.fireCheckoutPaymentErrorEvent(),Z()}),j.promise},V.confirmPayment=function(){var e=s.defer(),n=function(){e.resolve(),V.enabledCheckout()},r=function(){e.reject(),V.enabledCheckout()};return V.disableCheckout(),p(t).reset(),u._validateViews().then(function(){V.checkConsents(!1).then(function(){return I.loginUser(V)}).then(function(){return le()}).then(function(){return i.confirmPayment(V)}).then(function(e){var t=V.input.confirmated,r=e.models;t.billingPlan=r.billingPlan,t.taxAmount=r.taxAmount,t.chargeAmount=r.chargeAmount,t.amount=r.amount,t.total=r.total,t.taxRate=r.taxRate,t.taxAmount=r.taxAmount,t.hstRate=r.hstRate,t.hstAmount=r.hstAmount,t.qstRate=r.qstRate,t.qstAmount=r.qstAmount,t.pstRate=r.pstRate,t.pstAmount=r.pstAmount,t.gstRate=r.gstRate,t.gstAmount=r.gstAmount,V.input.canadianTaxes=V.canadianTaxes(),M.gotoConfirmation(V).finally(n)}).catch(function(e){e&&e.errors&&e.errors.length>0&&e.errors[0].msg?p(t).global(y.trc("service.error.codes",e.errors[0].msg)):e&&e.isCheckConsentsError||"BraintreeError"===e||p().terminal(y.tr("Confirmation order failed")),r()})},function(){util.log("[CHECKOUT] Validation on confirmPayment has failed"),V.fireCheckoutPaymentErrorEvent(),r()}),e.promise},V.checkConsents=function(e){var t=s.defer(),n=i.checkConsentsFunction(),r={isCheckConsentsError:!0},o=function(e){e&&e.length&&(angular.forEach(e,function(e){e.message=e.msg}),p(V.$rootScope).globals(e))};return n&&!0===e?n(V).then(function(){c.fire(EVENT_CHECKOUT_CONSENT_CHANGED),t.resolve()}).catch(function(e){o(e),t.reject(r)}):C.isNeeded(V)?(V.isPasswordlessCheckoutEnabled()&&-1!==["offer","auth"].indexOf(u.getActiveState())&&angular.forEach(V.input.consents,function(e){e.required&&(e.checked=!0)}),C(V).then(function(){c.fire(EVENT_CHECKOUT_CONSENT_CHANGED),t.resolve()}).catch(function(e){o(e.errors),t.reject(r)})):t.resolve(),t.promise},V._showSubscriptionHasAlreadyRenewed=function(){p().terminal(y.trc("checkout.platform","The subscription has already been renewed"))},V._completeTerm=function(e){var n=s.defer();return e.first_name=V.input.user_data.first_name,e.last_name=V.input.user_data.last_name,e.url=V.params.url,p(t).reset(),i.completePurchase(V,V.input.oid,e,function(e){_.logEvent("completePurchaseSuccess"),V.flags.termComplete=!0,angular.copy(e.receipt,V.input.receipt),V.GAProccesses++,V.sendGoogleAnalyticsEvent({eventAction:"checkoutSuccess",eventLabel:"Checkout success",params:{offerId:V.config.offerId,templateId:V.config.offerTemplateId,templateVariantId:V.config.offerTemplateVariantId}},function(){setTimeout(function(){V.GAProccesses--},3e3)}),o.completeEvent(V.input.receipt),X(e.receipt,n.resolve),document.cookie="ch_sid=; Path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;",V.enabledCheckout()},function(e){_.logEvent("completePurchaseError"),"object"==typeof e&&e.models&&e.models.renewalSubscriptionLockException?V._showSubscriptionHasAlreadyRenewed():(V.enabledCheckout(),n.reject())}),n.promise},V.getSelectedTerm=function(){return this.flags.selectedTerm},V.getLoginTermId=function(){return O},V.getPaymentMethodId=function(){return this.flags&&this.flags.selectedPaymentMethod&&this.flags.selectedPaymentMethod.id},V.goToPasswordlessLoginState=function(e,t){var n=!1;u.gotoState("passwordlessLogin");var r=c.subscribe("passwordlessLoginLoad",function(){r(),e&&e()}),o=c.subscribe("passwordlessLoginSuccess",function(){o(),n=!0,t&&t()});return n},V.setAsDefaultPaymentMethod=function(e){return x.setAsDefaultPaymentMethod(e).then(function(e){var t=e.data.models,n=t&&t.applyResult&&t.applyResult.updateFailedSubscriptionPubIds||{},r=t&&t.applyResult&&t.applyResult.updatedSubscriptionPubIds||[];return Object.keys(n).length>0?(console.error(n),p(V.$rootScope).reset(),r.length>0?p(V.$rootScope).global(y.trc("checkout.platform","Could not apply payment method to all subscriptions")):p(V.$rootScope).global(y.trc("checkout.platform","Could not apply payment method"))):0===r.length&&p(V.$rootScope).global(y.trc("checkout.platform","No active subscriptions")),{updated:r.length,failed:Object.keys(n).length}}).catch(function(e){p(V.$rootScope).reset(),p(V.$rootScope).global(e.data.errors[0].msg)})},V.canSelectPaymentMethod=function(){return V.input.paymentMethods&&V.input.paymentMethods.length>1&&!V.isZeroPayment()},V.resetPaymentSelection=function(){angular.forEach(this.input.paymentMethods,function(e){e.selected=!1}),V.flags.selectedPaymentMethod=null},V.disableCheckout=function(){tinypass.showWaitPanel("checkoutDisable",'<div id="lock-modal-overlay"></div>')},V.enabledCheckout=function(){tinypass.hideWaitPanel("checkoutDisable")},V.reload=function(e,t){var n=ue(e);return n.countryCode=V.getBillingCountryCode(),n.residenceCountryCode=V.getResidenceCountryCode(),n.billingZipCode=V.getBillingZipCode(),n.zipCode=V.input.zipCode,n.oid=V.input.oid,n.promoCodeId=V.input.promoCodeId,n.promoCodeTermId=V.input.promoCodeTermId,V.flags.selectedPaymentMethod&&void 0!==V.flags.selectedPaymentMethod.id&&(n.paySourceId=V.flags.selectedPaymentMethod.id),x.getOffer(n,V).then(function(e){util.log("CHECKOUT - RELOAD",getParameterByName("iframeId"),e);var r=!1;return window.TPParam.config=e.models.config,window.TPParam.params=n,V.initConfig(),D.updateSelectedTerm(V),ae(V.config.user),!V.isUserValid()&&m.loginSuccessPosted()&&m.setLoginSuccessPosted(!1),!V.config.settings.requiresValidUser||V.isUserValid()||V.canInitCheckoutWithAnon()||V.isPasswordlessCheckoutEnabled()||u.isActive("auth")||H(),D.updatePayWhatYouWant(),e.models.alreadyPurchased&&V.getSelectedTerm()&&(q(e,V.getSelectedTerm().termId,t),r=!0),ee(),c.fire(EVENT_CHECKOUT_RELOADED),!r},function(e){return p().terminal(y.trc("checkout.platform","Reload failed")),console.warn(e),util.log("CHECKOUT - RELOAD ERROR",getParameterByName("iframeId"),e),!1})},V.getBillingCountryCode=function(){return N.countryCode},V.getRequiredZipCode=function(){return N.requiredZipCode||!1},V.getBillingZipCode=function(){return N.zipCode},V.getResidenceCountryCode=function(){return N.residenceCountryCode},V.getVatLabel=function(){return N.vatLabel},V.toggleVatColumn=function(){N.showVAT=!N.showVAT},V.alreadyPurchased=function(){return V.access&&V.access.alreadyPurchased},V.canadianTaxes=function(){var e=V.input.confirmated,t=[];return e&&(n("HST",e.hstRate,e.hstAmount),n("QST",e.qstRate,e.qstAmount),n("PST",e.pstRate,e.pstAmount),n("GST",e.gstRate,e.gstAmount)),t;function n(e,n,r){n&&n>0&&t.push({name:e,rate:n,amount:r})}},V.setCustomConfirmationUrl=function(e){z=e},V.getCustomOrDefaultConfirmationUrl=function(e){return z||e},V.getPasswordlessEmail=function(){return I.data.email},V.getTermChargeAmount=function(e){return V.isFreeTrial(e)&&e.authorizationAmount||e.chargeAmount},V.getSelectedTermChargeAmount=function(e){var t=V.getSelectedTerm(),n=e||t.authorizationAmount;return V.isFreeTrial(t)&&n||V.input.chargeAmount||V.input.originalChargeAmount},V.isFreeTrial=function(e){return!V.isChargingTerm(e)},c.subscribe(EVENT_TERMINAL_ERROR,function(e,t){u.disable()}),c.subscribe(EVENT_APPLE_PAY_CAN_MAKE_PAYMENTS,function(e,t){V.flags.applePayCanMakePayments=t.canMakePayments}),c.subscribe(EVENT_SETUP_CUSTOM_VARIABLES,function(e,t){V.config.customVariables=t,window.TPParam.params.customVariables=t}),c.subscribe(EVENT_SETUP_EVT_FIELDS,function(e,t){k.setExternalVerificationFields&&k.setExternalVerificationFields(t)});var te,ne,re=!1,oe=!1;function ie(e){for(var t=0;t<V.input.paymentMethods.length;t++){var n=V.input.paymentMethods[t];if(n.id===e)return n}}function ae(e){if(e!==V.config.user&&(angular.copy(e,V.config.user),V.params.userToken&&m.isPianoIdUserProvider())){var t=T.jwtDecode(V.params.userToken);V.config.user.login_timestamp=t.login_timestamp,V.config.user.token_expiration=1e3*(t.exp-t.iat)}m.userChanged(e)}function ce(e,t,n,r,o){return e&&n?V.config.hasTermForNewCustomerBillingPlan?V.reload(o,r):(ae(n),a(function(){if(angular.copy(n,V.config.user),V.params.userToken&&m.isPianoIdUserProvider()){var e=T.jwtDecode(V.params.userToken);V.config.user.login_timestamp=e.login_timestamp,V.config.user.token_expiration=1e3*(e.exp-e.iat)}V.flags.needUpdateUserResources=!0,c.fire(EVENT_CHECKOUT_RELOADED)},0)):e&&t?a(function(){ae({valid:!0}),c.fire(EVENT_CHECKOUT_RELOADED)},0):V.reload(o,r)}c.subscribe(EVENT_VIEW_ACTIVATED,function(e,t,n){if("offer"===t.name&&re&&(V.softResetDiscount(),V.sendGoogleAnalyticsEvent({eventAction:"checkoutRestarted",eventLabel:"Checkout restarted",params:{offerId:V.config.offerId,templateId:V.config.offerTemplateId,templateVariantId:V.config.offerTemplateVariantId}})),"offer"===t.name&&(re=!0,V.sendGoogleAnalyticsEvent({eventAction:"showOffer",eventLabel:"Show offer",params:{offerId:V.config.offerId,templateId:V.config.offerTemplateId,templateVariantId:V.config.offerTemplateVariantId}})),"state1"===t.name&&oe&&V.softResetDiscount(),"state1"===t.name&&(oe=!0),"externalVerification"!==t.name||V.hasExternalVerificationGate())if("state2"===t.name&&V.alreadyPurchased()&&!V.access.inRenewal)u.gotoPreviousState();else if("lockedPromoCode"!==t.name||V.isPromoCodeAvailable())if("auth"===t.name&&V.isUserValid())u.gotoPreviousState();else if((!u.isTermSelectorState(t.name)||n&&n.termId)&&"offer"!==t.name){if("state2"===t.name&&n.paySource){var r=ie(+n.paySource);V.selectPaymentMethod(r)}}else V._unselectTerm();else u.gotoPreviousState();else a(function(){M.gotoCheckoutStart(V)},0)}),c.subscribe("pianoIdLoginSuccess",function(e,t){t.extendExpiredAccessEnabled&&T.setExtendExpiredAccessCookie(V.getAid(),t.extendExpiredAccessEnabled)}),c.subscribe("setExtendExpiredAccess",function(e,t){t&&T.setExtendExpiredAccessCookie(V.getAid(),t)}),c.subscribe("reloadOffer",function(e,t){var n=u.getActiveState(),r=u.isPaymentFormState(n)||"auth"===n||"offer"===n;t&&t.noNeedStartCheckout&&(delete t.noNeedStartCheckout,r=!1);var o=!r&&"auth"===n,i=(t=ue(t)).reloadAfterLogin,a=t.preventReloadAfterLogin,c=t.user;V.params.userToken=t.userToken,ce(i,a,c,o,t)}),c.subscribe(EVENT_CONFIG_RELOAD,function(){var e=!0;"false"!==E.get().autoCompleteRegistrationTerm&&!1!==E.get().autoCompleteRegistrationTerm||(e=!1),V.flags.autoCompleteRegistrationTerm=e}),y.on(function(e){ne&&e===ne||o.postMessage("langChangedWithinOffer",{lang:e}),ne=e,te&&e!==te&&V.reload(null,!0),te=e}),c.subscribe("langChanged",function(e,t){ne=t.lang,y.update(t.lang)});var se=null;function ue(e){var t=e||{};angular.forEach(["userToken","isRedemption","startFromInlineCheckout"],function(e){var n=V.params[e];void 0!==t[e]&&(n=t[e]),t[e]=n});var n=V.getSelectedTerm();return t.termId=n&&n.termId||t.termId,angular.forEach(window.TPParam.params,function(e,n){void 0===t[n]&&(t[n]=e)}),t.lang=ne,t}function le(){var e=s.when();return angular.forEach(u.views,function(t){angular.forEach(t.components,function(t){V.isPaymentMethod(t.PAYMENT_PROVIDER_ID)&&t.customActionOnCompletePurchase&&(e=t.customActionOnCompletePurchase())})}),e}return c.subscribe("checkProccessesForClose",function(){S("EXTERNAL_EVENT","close"),se=(new Date).getTime(),V.GAProccesses?function e(){!V.GAProccesses||(new Date).getTime()-se>3e4?(G(),se=null):setTimeout(function(){e()},50)}():G()}),c.subscribe("startDirectCheckout",function(){V.hasOnlyOneTerm()&&a(function(){V.startCheckout(V.config.terms[0])},0)}),V.createOrder=function(e,t,n,r,o){return x.createOrder(e,t,n,r,o,V)},V}]);var Log={info:function(){"undefined"!=typeof console&&void 0!==console.log&&console.log.apply(console,arguments)},error:function(){"undefined"!=typeof console&&void 0!==console.error&&console.error.apply(console,arguments)},debug:function(){try{"tpdebug"in localStorage&&"undefined"!=typeof console&&void 0!==console.log&&console.log.apply(console,arguments)}catch(e){}}},directives=angular.module("tp.directives",["tp.ui.grid","tp.ui.cc","tp.filters"]);directives.directive("tpclipboard",["lang",function(e){return{restrict:"A",scope:{},link:function(t,n){new Clipboard(n[0]).on("success",function(n){t.$apply(function(){tinypass.setMessage("success",e.trc("publisher.dashboard","Copied to clipboard"))})})}}}]),directives.directive("tpUploader",["$window",function(e){return function(e,t,n){$(t).click(function(){var t=n.tpUploader,r=e.$eval(n.onComplete),o=e.$eval(t),i=n.field?n.field:"";tinypass.uploadFile2(o.url,function(e){r(i,e)})})}}]),directives.directive("ignoreDirty",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,r){r.$pristine=!1}}}),directives.directive("fakeInput",function(){return{restrict:"E",replace:!0,scope:{value:"=",placeholder:"@",e2e:"@"},template:'<button data-e2e="{{e2e}}" class="btn-input btn-block">{{value}}<span ng-if="!value" class="placeholder">{{placeholder}}</span></button>'}}),directives.directive("tpImageCrop",["$timeout",function(e){return{scope:{cropOptions:"=",cropWidth:"@",cropHeight:"@",imgSrc:"@"},replace:!0,template:"<img ng-src='{{imgSrc}}' id='crop-target'>",link:function(t,n,r){var o={boxWidth:500,maxWidth:500,keySupport:!1};function i(){var n=t.cropOptions;if(n&&"object"==typeof n)for(var r in o)n.hasOwnProperty(r)||(n[r]=o[r]);else n=o;t.cropWidth&&t.cropHeight&&0!=t.cropHeight&&(n.aspectRatio=t.cropWidth/t.cropHeight),e(function(){t.$apply(function(){tinypass.initImageCropper("#crop-target",n,t.cropWidth,t.cropHeight)})})}i(),t.$on("tinypass-jcrop-changeImageSrc",function(n,r){t.imgSrc=r,tinypass.jcrop&&tinypass.jcrop.destroy(),t.$apply(),e(function(){i()})})}}}]),directives.directive("tpShow",[function(){return function(e,t,n){var r=n.duration?n.duration:"slow";isNaN(parseInt(r,10))||(r=parseInt(r,10)),e.$watch(n.tpShow,function(e){toBoolean(e)?$(t).fadeIn(r):$(t).fadeOut(r)})}}]),directives.directive("fadey",function(){return{restrict:"A",link:function(e,t,n){jQuery(t).css({opacity:0}).animate({opacity:1},parseInt(n.fadey))}}}),directives.directive("animatePosition",function(){return{link:function(e,t,n){e.$watch(n.animatePosition,function(e){switch(t.css({bottom:"auto",top:"auto",left:"auto",right:"auto"}),e){case 1:t.css({right:"0px",top:"0px"});break;case 2:t.css({left:"0px",top:"0px"});break;case 3:t.css({left:"0px",bottom:"0px"});break;case 4:t.css({right:"0px",bottom:"0px"})}})}}}),directives.directive("animateMargin",function(){return{link:function(e,t,n){e.$watch(n.animateMargin,function(e){$(".top-bottom").css({height:300-2*e,marginTop:e}),$(".left-right").css({width:878-2*e,marginLeft:e}),t.css({padding:e})})}}}),directives.directive("iframeContainer",function(){return{scope:{iframeId:"@",refreshFn:"&",maximizeFn:"&",fs:"="},restrict:"EA",replace:!0,template:'<div class="previewpane {{fs}}"><div class="tppreview" style="position: absolute; width: 100%; height: 100%; z-index: 50;"></div><iframe width="100%" height="100%" class="{{iframeId}}" id="{{iframeId}}" scrolling="no"></iframe><div class="inline-actions" style=\'z-index: 1000;\'><div id="btn-refresh" class="btn-icon rounded" ng-click="refreshFn()"><i class="icon-refresh"></i></div><div id="btn-maximize" class="btn-icon rounded" ng-click="maximizeFn()"><i class="icon-maximize"></i></div></div></div>'}}),directives.directive("errorSection",["$animate",function(e){return{scope:{errors:"=",heading:"@?",onCloseCallbackFn:"&?",renderAsPlainText:"=?"},replace:!0,template:'<div ng-show="errors && errors.length > 0" class="alert alert-block alert-error tinypass-alert-messase">  <button type="button" class="close" ng-click="clear()"><i class="icon-close-light"></i></button>  <div class="error-header" ng-show=\'heading\'>{{heading}}</div>  <div ng-repeat="error in errors" class="error-line" ng-show=\'error.msg.length > 0\'><strong>&middot;</strong> <span ng-if="renderAsPlainText">{{error.msg}}</span> <span ng-if="!renderAsPlainText" ng-bind-html="error.msg"></span></div></div>',link:function(t,n){t.clear=function(){t.onCloseCallbackFn&&t.onCloseCallbackFn(),e.addClass(n,"fade",function(){t.errors.length=0,t.$apply()})},t.$watchCollection("errors",function(t,r){"[object Array]"===Object.prototype.toString.call(t)&&t.length&&e.removeClass(n,"fade")})},controller:["$scope",function(e){e.errors?"string"!=typeof e.errors?Array.isArray(e.errors)?e.errors.every(e=>e.msg)||(e.errors=e.errors.map(function(e){return"object"==typeof e&&(e.msg=e.msg||e.message),"string"==typeof e&&(e={msg:e}),e})):"object"==typeof e.errors&&(e.errors.msg=e.errors.msg||e.errors.message,e.errors=[e.errors]):e.errors=[{msg:e.errors}]:e.errors=[]}]}}]),directives.directive("warningSection",["$animate",function(e){return{scope:{warnings:"=",heading:"@?",renderAsPlainText:"=?"},replace:!0,template:'<div ng-show="warnings && warnings.length > 0" class="alert alert-block alert-warning tinypass-alert-messase">  <button type="button" class="close" ng-click="clear()"><i class="icon-close"></i></button>  <div class="warning-header" ng-show=\'heading\'>{{heading}}</div>  <div ng-repeat="warning in warnings" class="warning-line" ng-show=\'warning.length > 0\'><strong>&middot;</strong> <span ng-if="renderAsPlainText">{{warning}}</span> <span ng-if="!renderAsPlainText" ng-bind-html="warning"></span></div></div>',link:function(t,n){t.clear=function(){e.addClass(n,"fade",function(){t.warnings.length=0,t.$apply()})},t.$watchCollection("warnings",function(t,r){"[object Array]"===Object.prototype.toString.call(t)&&t.length&&e.removeClass(n,"fade")})},controller:["$scope",function(e){var t,n;try{t=angular.injector(["ng","tp.i18n"]),(n=t.get("lang")).update()}catch(e){}var r=void 0!==n?n.trc("publisher.dashboard","Warning!"):"Warning!";e.heading=e.heading||r,e.headingLocalised=e.heading,angular.forEach(e.warnings,function(t,r){return e.warnings[r]=void 0!==n?n.trc("publisher.dashboard",t):t})}]}}]),directives.directive("autoSelect",function(){return{link:function(e,t){var n;t.on("focus",function(){n=setTimeout(function(){t.select()},1)}),t.on("blur",function(){n&&(clearTimeout(n),n=null)}),t.on("mouseup",function(){return!1}),e.$on("$destroy",function(){t.off("focus"),t.off("blur"),t.off("mouseup")})}}}),directives.directive("zeroClipboard",["$injector",function(e){return{restrict:"A",link:function(t,n,r){var o,i,a,c;try{o=e.get("lang")}catch(e){}if(a=angular.extend({},t.$eval(r.zeroClipboard)),null==(c=tinypass.copyToClipboard(n,a)))n.replaceWith("");else{c.on("dataRequested",function(e,n){c.setText(t.model.embed)}),c.on("complete",function(e,t){var a,c="false"===r.showCopiedText?"":"<b>"+(a=t.text,document.createElement("a").appendChild(document.createTextNode(a)).parentNode.innerHTML)+"</b>";i="Copied "+c+" to clipboard",o&&(i=o.trc("publisher.dashboard","Copied {0} to clipboard",c)),tinypass.setMessage("success",i),n.click()}),t.$watch("onClose",function(e){e&&"true"==r.cleanup&&ZeroClipboard.destroy()})}}}}]),directives.directive("selectAllCheckbox",function(){return{replace:!0,restrict:"E",scope:{checkboxes:"=",allselected:"=allSelected",allclear:"=allClear",includeRule:"=",selectedFlagName:"@"},template:'<div ng-model="master" ng-click="masterChange()" />',controller:["$scope","$element",function(e,t){var n=e.selectedFlagName||"isSelected";e.masterChange=function(){e.allselected?angular.forEach(e.checkboxes,function(e,t){e[n]=!1}):angular.forEach(e.checkboxes,function(t,r){e.includeRule&&!e.includeRule(t)||(t[n]=!0)})},e.$watch("checkboxes",function(){var r=!0,o=!0;angular.forEach(e.checkboxes,function(t,i){t[n]?o=!1:e.includeRule&&!e.includeRule(t)||(r=!1)}),void 0!==e.allselected&&(e.allselected=r),void 0!==e.allclear&&(e.allclear=o),t.prop("indeterminate",!1),r?e.master=!0:o?e.master=!1:(e.master=!1,t.prop("indeterminate",!0))},!0)}]}}),directives.directive("tpDisableEnter",function(){return{restrict:"A",link:function(e,t,n){t.bind("keypress",function(e){13==e.which&&e.preventDefault()})}}}),directives.directive("tpDecimalFilter",function(){return{restrict:"A",link:function(e,t,n){t.bind("keypress",function(e){if(-1==$.inArray(e.which,[46,48,49,50,51,52,53,54,55,56,57]))e.preventDefault();else if(46==e.which&&t.val().indexOf(".")>-1){var n=t.val().substring(t.context.selectionStart,t.context.selectionEnd);(n=-1==n.indexOf("."))&&e.preventDefault()}})}}}),directives.directive("searchInput",function(){return{scope:{changeSearchText:"&",searchPanelOpen:"=",inputPlaceholder:"@",magnifierHover:"@",searchText:"@",searchOnEnter:"&?",clearSearchResults:"&?",control:"=?"},link:function(e,t){e.internalControl=e.control||{},e.model={searchPanelOpen:!1,searchText:e.searchText||""},e.internalControl.changeSearchInput=function(t){e.model.searchText=t},e.openSearchPanel=function(){e.searchPanelOpen=!0,setTimeout(function(){t.find(".common-search-input").focus()},100)},e.dismissSearch=function(){e.model.searchText="",e.searchPanelOpen=!1,e.changeSearchInput(e.model.searchText),e.clearSearchResults()},e.$on("reset-search-field",function(){e.model.searchText=""}),e.changeSearchInput=function(t){e.changeSearchText({newSearchText:t})},e.onEnter=function(){e.searchOnEnter()}},templateUrl:"/ng/common/search-input/searchInput.shtml",restrict:"A"}}),directives.directive("tpCurrencyInput",["$filter",function(e){return{require:"ngModel",link:function(t,n,r,o){var i=function(t){if(!t)return"0.00";t=new String(t).replace(/,/g,"");var n=e("number")(t,2);return n||"0.00"};o.$parsers.push(function(e){return i(e).replace(/,/g,"")}),o.$formatters.unshift(i),n.bind("focusout",function(){n.val(i(n.val()))}),n.bind("keydown",function(e){-1!==$.inArray(e.keyCode,[46,8,9,27,13,110,190])||65==e.keyCode&&!0===e.ctrlKey||e.keyCode>=35&&e.keyCode<=39||(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()})}}}]),directives.directive("preventTypingNonNumber",["$filter",function(e){return{require:"ngModel",link:function(e,t,n,r){t.bind("keydown",function(e){-1!==$.inArray(e.keyCode,[46,8,9,27,13,110,190])||65==e.keyCode&&!0===e.ctrlKey||e.keyCode>=35&&e.keyCode<=39||(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()})}}}]),directives.directive("tpDropDown",["$document",function(e){return{restrict:"A",replace:!0,transclude:!0,scope:{alignment:"=",triangle:"=",actionAfterClick:"=?",actionAfterClose:"=?"},template:"<div ng-transclude></div>",link:function(e,t,n){n.alignment=void 0===n.alignment?"center":n.alignment;var r=void 0!==n.popoverUp,o=t.find(".dropdown-menu"),i=t.find(".tp-drop-down-button"),a=i.outerHeight(!0),c=0,s=0;e.close=function(e){o.removeClass("open")},o.addClass(n.alignment),void 0!==n.triangle&&o.addClass(n.triangle),void 0!==n.preventCloseOnClick&&o.on("click",function(e){$(e.target).hasClass("close-popover")||(e.preventDefault(),e.stopPropagation())}),i.bind("click",function(){var u=t.find(".dropdown-menu");c=u.outerHeight(!0),"center"==n.alignment&&(s=parseInt(u.outerWidth(!0)/2-i.outerWidth(!0)/2),o.css({left:-s,right:"auto"}));var l=t.offset().top,d=void 0!==window.pageYOffset,p="CSS1Compat"===(document.compatMode||""),f=d?window.pageYOffset:p?document.documentElement.scrollTop:document.body.scrollTop;r?(o.addClass("dropdown-up"),l-c-a-parseInt(o.css("marginTop"),10)<f&&o.removeClass("dropdown-up"),l+c+a+parseInt(o.css("marginBottom"),10)>f+window.innerHeight&&o.addClass("dropdown-up")):l+c+a>window.innerHeight+f&&l-f>c?o.hasClass("dropdown-up")||o.addClass("dropdown-up"):o.hasClass("dropdown-up")&&o.removeClass("dropdown-up"),setTimeout(function(){$("html").on("click.dropdown.data-api",function(){$("html").off("click.dropdown.data-api"),e.actionAfterClose&&e.actionAfterClose(o,!1)}),e.actionAfterClick&&e.actionAfterClick(o,"none"!==o.css("display"))},0)})}}}]),directives.directive("tpUnitPopover",function(){return{replace:!0,transclude:!0,template:"<div ng-transclude></div>",link:function(e,t){var n=t.find(".unit-popover"),r=t.find(".unit-popover-btn"),o=t.find(".unit-popover-triangle"),i=0;n.bind("click",function(e){e.stopPropagation(),e.preventDefault()}),r.bind("click",function(){var e=t.find(".unit-popover");i=e.outerHeight(!0),r.offset().left+r.innerWidth()/2<e.innerWidth()/2?n.offset({left:20}):r.offset().left+e.innerWidth()/2+r.innerWidth()/2>$(window).innerWidth()?n.offset({left:$(window).innerWidth()-e.innerWidth()-20}):n.offset({left:parseInt(r.offset().left-e.innerWidth()/2)+r.innerWidth()/2}),o.offset({left:r.offset().left+r.innerWidth()/2-5});var a=t.offset().top,c=void 0!==window.pageYOffset,s="CSS1Compat"===(document.compatMode||""),u=c?window.pageYOffset:s?document.documentElement.scrollTop:document.body.scrollTop;a-i<u?n.hasClass("unit-popover-down")||n.addClass("unit-popover-down"):n.hasClass("unit-popover-down")&&n.removeClass("unit-popover-down")})}}}),directives.directive("tpCharLimit",["$interval",function(e){return{restrict:"A",link:function(t,n,r){var o=r.tpCharLimit;n.bind("keypress",function(e){n.val().length>=o&&n.context.selectionStart==n.context.selectionEnd&&e.preventDefault()}),n.bind("paste",function(t){var r=e(function(){n.val().length>=o&&n.val(n.val().substring(0,o)),e.cancel(r),r=void 0},1)})}}}]),directives.directive("onEnter",["$parse",function(e){return function(t,n,r){var o=e(r.onEnter);n.on("keydown",function(e){13==e.keyCode&&(t.$apply(function(){o(t,{$event:e})}),e.preventDefault())})}}]),directives.directive("tpHeaderDescription",function(){return{scope:{header:"=",description:"=",hline:"@"},restrict:"EA",transclude:!0,template:'<div class="h-line-title-container"><div ng-transclude></div><div class="h-line-title-text">{{header}}</div><div class="h-line-title" ng-if="hline"></div></div><div class="description-hint">{{description}}</div>'}}),directives.directive("d3Planet",function(){return{scope:{idRenderTo:"@"},restrict:"EA",template:'<div class="planet"></div>',link:function(e){var t=160,n=t>>1,r=.015,o=Date.now(),i=d3.geo.orthographic().scale(n-2).translate([n,n]).clipAngle(90).precision(0),a=d3.select("#"+e.idRenderTo).selectAll("canvas").data(d3.range(1)).enter().append("canvas").attr("width",t).attr("height",t),c=d3.geo.path().projection(i);d3.json("/libs/d3/world-110m.json",function(n,s){if(n)throw n;var u=topojson.feature(s,s.objects.land),l={type:"Sphere"},d=[0,0,0],p=a.node().getContext("2d"),f=p.createRadialGradient(160,160,160,160,160,0);f.addColorStop(0,"rgba(84, 142, 209, 1.000)"),f.addColorStop(1,"rgba(22, 82, 168, 1.000)"),p.fillStyle=f;var m=setInterval(function(){var e=r*(Date.now()-o);d[0]=e,i.rotate(d),p.clearRect(0,0,t,t),p.beginPath(),c.context(p)(u),p.fill(),p.beginPath(),c(l)},50);e.$on("$destroy",function(){clearInterval(m)})})}}}),directives.directive("translationsProgressMeter",function(){return{restrict:"EA",scope:{cfg:"=translationsProgressMeter"},template:'<div id="progress-meter" class="progress-meter"><div class="foreground"></div></div>',link:function(e,t,n){var r=2*Math.PI,o=d3.select("#progress-meter").append("svg").attr("width",220).attr("height",220).append("g").attr("transform","translate(110,110)").append("g").attr("class","progress-meter").append("path").attr("class","foreground");e.$watch("cfg.percentageOfTranslatedKeys",function(){var t=Math.PI,n=e.cfg.percentageOfTranslatedKeys/100*r+Math.PI-.04,i=d3.svg.arc().startAngle(t).innerRadius(106).outerRadius(110).cornerRadius(10);o.transition().duration(e.cfg.animationSpeed).attrTween("d",function(){var e=d3.interpolate(t,n);return function(t){return i.endAngle(e(t))()}})})}}}),directives.directive("translationsTotal",function(){return{restrict:"EA",scope:{cfg:"=translationsTotal"},template:'<div id="total-translation-percentage" class="inline"></div>',link:function(e,t,n){e.$watch("cfg.percentageOfTranslatedKeys",function(){d3.select("#total-translation-percentage").text(e.cfg.startValue||0).transition().duration(e.cfg.animationSpeed).tween("text",function(){var t=parseInt(this.textContent),n=d3.interpolateRound(t,e.cfg.percentageOfTranslatedKeys);return function(e){this.textContent=n(e)}})})}}}),directives.directive("setIframeHeightOnload",function(){return{restrict:"A",scope:{},link:function(e,t,n){t.on("load",function(){t.height(t.contents().height())})}}}),directives.directive("tpInfiniteScroll",["$window",function(e){return{restrict:"A",scope:{tpInfiniteScroll:"&",tpInfiniteScrollOffset:"@?",tpInfiniteScrollDebounce:"@?",tpInfiniteScrollConfig:"=?"},link:function(t,n,r){if(!t.tpInfiniteScroll)return;var o,i=Number(t.tpInfiniteScrollOffset)||0,a=Number(t.tpInfiniteScrollDebounce)||250,c=t.tpInfiniteScrollConfig,s=c&&c.containerSelector,u=n;c&&"window"===c.containerSelector&&(u=angular.element(e));function l(e){var r=u.scrollTop()>=n[0].clientHeight-i,a=e.target.scrollTop;o=e.target.scrollHeight,a+e.target.clientHeight>=o-i&&t.tpInfiniteScroll(),s&&"window"===c.containerSelector&&r&&t.tpInfiniteScroll()}d=u,d.on("scroll",(p=l,f=a,function(){var e=this,t=arguments,n=m&&!h;clearTimeout(h),h=setTimeout(function(){h=null,m||p.apply(e,t)},f),n&&p.apply(e,t)}));var d,p,f,m,h}}}]),directives.filter("tpDateFormatFilter",function(){return function(e){if(null==e)return null;var t=new Date(e),n=new Date,r=t.getDate(),o=t.getMonth()+1,i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()],a=t.getFullYear(),c=o+"/"+r+"/"+a,s=t.getHours(),u=t.getMinutes();u<10&&(u="0"+u);var l=s<12?" am":" pm";s>12&&(s-=12);var d=s+":"+u+" "+l;return n.getFullYear()==t.getFullYear()&&n.getDate()==t.getDate()?d:n.getFullYear()==a?i+" "+r:(n.getFullYear(),c)}});var address=angular.module("tp.ui.address",[]);address.filter("formatAddress",function(){return function(t,n,r,o){if(!t)return null;void 0===r&&(r=", ");void 0===o&&(o=" ");var i=t.additionalFields?JSON.parse(t.additionalFields):"",a=[t.region&&t.region.regionName||t.regionName,t.postalCode,i?i.CEP:"",i?i.CPF:""].filter(e).join(o),c=[t.address1,t.address2,i?i.address3:"",t.city,a,t.country.countryName];n&&c.push(t.phone);return c.filter(e).join(r)};function e(e){return null!=e&&""!==e}}),address.directive("regionSelect",function(){return{restrict:"E",replace:!0,scope:{region:"=",country:"=",countries:"=",inputId:"@",clearOnInit:"=?",inputClass:"@",selectClass:"@",placeholder:"@",inputPlaceholder:"@",selectPlaceholder:"@",wrapperInputClass:"@",wrapperSelectClass:"@"},template:'<div ng-class="wrapperClass"><select name="region" ng-if="regions.length" ng-required="regions.length" ng-options="region.regionName for region in regions track by region.regionName" ng-model="region" ng-change="onChangeRegion(region)" id="{{inputId}}" class="no-animate" ng-class="selectClass"><option value="" disabled selected style="display: none;">{{getSelectPlaceholder()}}</option></select><input name="region" type="text" ng-if="!regions.length" ng-model="region.regionName" ng-change="onChangeRegionName(region.regionName)" id="{{inputId}}" autocomplete="off" class="no-animate" ng-class="inputClass" placeholder="{{getInputPlaceholder()}}"/></div>',link:function(e,t,n){e.preSelectFirst=void 0!==n.preSelectFirst},controller:["$scope",function(e){e.getInputPlaceholder=function(){return e.inputPlaceholder?e.inputPlaceholder:e.placeholder},e.getSelectPlaceholder=function(){return e.selectPlaceholder?e.selectPlaceholder:e.placeholder},e.$watch("country",function(t,n){e.regions=function(e,t){if(!e||!e.length||!t||!t.countryId&&!t.pubId)return null;for(var n=e.length,r=0;r<n;r++){var o=e[r]===t||t.countryId&&e[r].countryId===t.countryId||t.countryId&&e[r].pubId===t.countryId||t.pubId&&e[r].pubId===t.pubId;if(o)return e[r].regions}return null}(e.countries,t)||[],e.wrapperClass=e.regions.length?e.wrapperSelectClass:e.wrapperInputClass,t!==n&&(!t||n&&(t.pubId||t.countryId)!==(n.pubId||n.countryId))&&(e.region=e.clearOnInit?null:{});!e.preSelectFirst||!e.regions.length||t===n||n&&(t.pubId||t.countryId)===(n.pubId||n.countryId)||!n&&e.region||(e.region=e.regions[0])}),e.onChangeRegion=function(t){e.region=t},e.onChangeRegionName=function(t){e.region={regionName:t}}}]}});var grid=angular.module("tp.ui.grid",[]);grid.normalizeCaption=function(e){return e.toLowerCase().replace(/\W+/g,"-")},grid.filter("toCssClass",function(){return grid.normalizeCaption}),grid.directive("tpGrid",function(){return{restrict:"A",transclude:!0,scope:{model:"=tpGrid",tpOnEmptyMessage:"@",tpOnEvent:"&"},templateUrl:"/ng/common/template/grid.shtml",link:function(e,t){t.find("#page").bind("keypress",function(n){if(13===n.which)try{if(page=parseInt(t.find("#page").val()),isNaN(page))return void(page=e.model.page);page>e.model.pageCount&&(page=e.model.pageCount),page<1&&(page=1),e.tpOnEvent()({name:"page",page:page}),t.find("#page").val(page).blur().focus()}catch(e){}})},controller:["$scope","$sce",function(e,t){e.$watch("model",function(){if(e.model&&e.model.data){e.model.page||(e.model.page=1),e.model.pageCount||(e.model.pageCount=1);for(var n=0;n<e.model.data.length;n++)for(var r=e.model.data[n],o=0;o<r.series.length;o++){var i=r.series[o];switch(i.type){case"PLAIN":i.compiled=t.trustAsHtml(i.content);break;case"LINK_EXTERNAL":i.compiled=t.trustAsHtml('<a href="'+i.data+'" target="blank">'+i.content+"</a>");break;case"LINK_INTERNAL":i.compiled=t.trustAsHtml('<a href="'+i.data+'">'+i.content+"</a>");break;case"LINK_AJAX":i.compiled=t.trustAsHtml("<a onclick=\"ajaxItGet('"+i.data+"'); return false;\">"+i.content+"</a>")}}}}),e.handleEvent=function(t){if("page"==t.name){if(t.page>e.model.pageCount)return;if(t.page<1)return}if("cell"==t.name){if("PLAIN"!=e.model.data[t.row.index].series[t.cell.index].type)return;t.name="row"}"menu"==t.name&&(t.menu.name=grid.normalizeCaption(t.menu.caption)),e.tpOnEvent()(t)}}],replace:!0}});var cc=angular.module("tp.ui.cc",[]);cc.directive("tpCreditCardForm",["$timeout",function(e){return{restrict:"A",transclude:!0,scope:{model:"=tpCreditCardForm"},templateUrl:"/ng/common/template/credit_card_form.shtml",controller:["$scope",function(e){e.model||(e.model={}),e.model.exp_mon||(e.model.exp_mon=(new Date).getMonth()+1),e.model.exp_yr||(e.model.exp_yr=(new Date).getFullYear()),alert("YYY")}],link:function(e,t,n){var r=function(t){var n=Braintree.create(e.model.braintree.client_key);return t?n.encrypt(t):""};e.model.encrypt=function(){return{number:r(e.model.number),exp_mon:e.model.exp_mon,exp_yr:e.model.exp_yr,cvv:r(e.model.cvv),zipcode:e.model.zipcode}},e.model.validate=function(){return e.model.formErrors=[],e.creditCardForm.number.$modelValue=tinypass.stripSpaces(e.creditCardForm.number.$modelValue),e.creditCardForm.number.$modelValue&&tinypass.ccLuhnCheck(e.creditCardForm.number.$modelValue)||e.model.formErrors.push({field:"number",msg:"Invalid credit card number"}),e.model.isValid()},e.model.isValid=function(){return!e.model.formErrors||0==e.model.formErrors},e.model.formErrors=[],e.$watch("model.formErrors",function(){angular.forEach(e.creditCardForm,function(e){e.$setValidity&&(e.$setValidity("error",!0),e.$setPristine())}),e.creditCardForm.$setPristine(),angular.forEach(e.model.formErrors,function(t){var n=t.field;e.creditCardForm[n].$setValidity("error",!1),e.creditCardForm[n].$error.msg=t.msg})},!0)},replace:!0}}]);var goToModule=angular.module("checkoutGoToModule",["checkoutModule"]);goToModule.factory("checkoutGoTo",["viewService","userService","errorService","lang","ngEventService",function(e,t,n,r,o){var i={gotoNextState:function(n,r,a,c,s){var u,l=n.getSelectedTerm(),d=n._findTerm(l);c&&e.viewStack.pop(),t.isPianoIdUserProvider()&&t.isUserValid()&&!t.isUserConfirmed()?u=function(){"auth"!==e.getActiveState()&&e.gotoState("user-non-confirmed")}:n.isSelectedTermLocked()?u=i.gotoLockedPromoCode.bind(this,n):n.hasExternalVerificationGate()?u=i.gotoExternalVerificationState.bind(this,n):n.isRequirePrintAddress()?u=i.gotoPrintAddress.bind(this,n):"gift"!==d.type||n.input.giftParamsFormFilled?a||(u=function(){i.gotoPaymentState(n,r,l,void 0,s),t.isUserValid()||t.onLoginSuccess(function(t){var i=n.config.preventReloadAfterLogin;n.reloadIfNeed(!0,i,t.user);var a=o.subscribe(EVENT_CHECKOUT_RELOADED,function(){a(),n.flags.selectedPaymentMethod&&"alreadyHasAccess"!==e.getActiveState()&&(s||r.initiatePurchase(n))})},!0)}):u=i.gotoGiftParams.bind(this,n),!a&&u?u():a&&!u&&(s||r.purchaseStarting(n,d))},gotoPaymentState:function(t,n,r,o,i){var a=o;a||(a=t.params.offerId),i||n.purchaseStarting(t,r),e.gotoPaymentState({termId:r.termId,term:r,offerId:a,paySource:t.params.paySource})},gotoCheckoutStart:function(t){t.flags.termSelectorActivated=!0;var n=e.gotoTermSelectorState();if(e.isPaymentFormState(n)&&t.config.terms&&t.config.terms.length){for(var r=t.config.terms[0],o=0;o<t.config.terms.length;o++){var i=t.config.terms[o];if(!i.newCustomersOnly||t.config.isNewCustomer){r=i;break}}var a=!0;t.config.checkoutAuthenticationInSeparateState&&!t.isUserValid()&&(a=!1),t.selectTerm(r,null,!1,a)}},gotoReceipt:function(t){return t.sendGoogleAnalyticsEvent({eventAction:"receiptDisplayed",eventLabel:"Receipt displayed",params:{offerId:t.config.offerId,templateId:t.config.offerTemplateId,templateVariantId:t.config.offerTemplateVariantId}}),t.flags.receiptActivated=!0,e.disable(!0),e.gotoState("receipt",{term:t._findTerm(t.params.termId)})},gotoAlreadyHasAccess:function(t){return e.gotoState("alreadyHasAccess",{term:t._findTerm(t.params.termId)})},gotoUserLogin:function(){return e.gotoState("userLogin")},gotoLockedPromoCode:function(t){return e.gotoState("lockedPromoCode",{term:t._findTerm(t.params.termId)})},gotoExternalVerificationState:function(t){return t.termGate.externalVerificationStatus=null,e.gotoState("externalVerification",{term:t._findTerm(t.params.termId)})},gotoConfirmation:function(t){return e.gotoState("confirmation",{term:t._findTerm(t.params.termId)})},goToBankSecureState:function(o){return t.isUserValid()&&t.isUserConfirmed()?e.gotoState("bankSecure"):(o.enabledCheckout(),n(o.$rootScope).resetDisplayed(),n(o.$rootScope).global(r.trc("checkout.platform","You should sign in or sign up first")),$q.reject())},gotoSharedSubscriptionState:function(){return e.disable(!0),e.gotoState("sharedSubscription")},gotoRedeemSharedSubscriptionState:function(){return e.disable(!0),e.gotoState("redeemSharedSubscription")},gotoContinueThreeDSPurchaseState:function(){return e.disable(!0),e.gotoState("continueThreeDSPurchase")},gotoAuthState:function(r,o,i,a){return!r.isUserValid()&&(o&&(c=o()),c&&"function"==typeof c.then?c.then(function(){return s()}):s());var c;function s(){if(i||(i=function(){"auth"===e.getActiveState()&&e.gotoPreviousState()}),a){var o=i;i=function(e){var t=r.config.preventReloadAfterLogin;r.reloadIfNeed(!0,t,e.user)},r.onUserChanged().then(function(){o()})}return t.onLoginSuccess(i,!0),n(r.$rootScope).reset(),e.gotoState("auth"),!0}},gotoPrintAddress:function(t){t.termGate.adrCollectionSucceeded=!1,e.gotoState("printAddress",t._findTerm(t.params.termId))},gotoGiftParams:function(t){t.input.giftParamsFormFilled=!1,e.gotoState("giftParams",{term:t._findTerm(t.params.termId)})}};return i}]);
'use strict';
angular.module("ngLocale", [], ["$provide", function($provide) {
var PLURAL_CATEGORY = {ZERO: "zero", ONE: "one", TWO: "two", FEW: "few", MANY: "many", OTHER: "other"};
$provide.value("$locale", {
  "DATETIME_FORMATS": {
    "AMPMS": [
      "AM",
      "PM"
    ],
    "DAY": [
      "Sunday",
      "Monday",
      "Tuesday",
      "Wednesday",
      "Thursday",
      "Friday",
      "Saturday"
    ],
    "MONTH": [
      "January",
      "February",
      "March",
      "April",
      "May",
      "June",
      "July",
      "August",
      "September",
      "October",
      "November",
      "December"
    ],
    "SHORTDAY": [
      "Sun",
      "Mon",
      "Tue",
      "Wed",
      "Thu",
      "Fri",
      "Sat"
    ],
    "SHORTMONTH": [
      "Jan",
      "Feb",
      "Mar",
      "Apr",
      "May",
      "Jun",
      "Jul",
      "Aug",
      "Sep",
      "Oct",
      "Nov",
      "Dec"
    ],
    "fullDate": "EEEE, MMMM d, y",
    "longDate": "MMMM d, y",
    "medium": "MMM d, y h:mm:ss a",
    "mediumDate": "MMM d, y",
    "mediumTime": "h:mm:ss a",
    "short": "M/d/yy h:mm a",
    "shortDate": "M/d/yy",
    "shortTime": "h:mm a"
  },
  "NUMBER_FORMATS": {
    "CURRENCY_SYM": "$",
    "DECIMAL_SEP": ".",
    "GROUP_SEP": ",",
    "PATTERNS": [
      {
        "gSize": 3,
        "lgSize": 3,
        "macFrac": 0,
        "maxFrac": 3,
        "minFrac": 0,
        "minInt": 1,
        "negPre": "-",
        "negSuf": "",
        "posPre": "",
        "posSuf": ""
      },
      {
        "gSize": 3,
        "lgSize": 3,
        "macFrac": 0,
        "maxFrac": 2,
        "minFrac": 2,
        "minInt": 1,
        "negPre": "(\u00a4",
        "negSuf": ")",
        "posPre": "\u00a4",
        "posSuf": ""
      }
    ]
  },
  "id": "en-us",
  "pluralCat": function (n) {  if (n == 1) {   return PLURAL_CATEGORY.ONE;  }  return PLURAL_CATEGORY.OTHER;}
});
}]);
